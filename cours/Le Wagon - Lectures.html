<!DOCTYPE html>
<!-- saved from url=(0028)https://karr.lewagon.org/all -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Le Wagon - Lectures</title>
    <meta name="viewport" content="width=device-width">

    <link rel="stylesheet" href="./Le Wagon - Lectures_files/all-d2e531c354c1e49e950f2a8972414171.css">
  </head>

  <body data-pinterest-extension-installed="cr1.39.1">
    <div class="container">
      <h1>Setup - (1) Setup your computer</h1>

<h2>We need tools</h2>

<hr>

<h2>Sublime Text</h2>

<p>A text editor. Your new companion, day &amp; night.</p>

<p><img src="./Le Wagon - Lectures_files/logo_sublime_text-9eb214809bffa5c97b076f3bbd2180d4.png" alt=""></p>

<hr>

<h2>Terminal</h2>

<p>Don't fear the command line.</p>

<p><img src="./Le Wagon - Lectures_files/logo_terminal-72d539c8ec698a838fe061d5a0f0f970.png" alt=""></p>

<hr>

<h2>Package manager</h2>

<p>You can't imagine how easy it is to install new software with just one
command. <strong>Homebrew</strong> on OSX, <strong>Aptitude</strong> on Ubuntu</p>

<hr>

<h2>Git &amp; GitHub</h2>

<p>Version Control. Collaboration.</p>

<p><img src="./Le Wagon - Lectures_files/logo_github_waldo-b44460f955422e07ccdc67a3f39b491c.png" alt=""></p>

<hr>

<h2>Ruby</h2>

<p>Ruby is the programming language. Rails will be the framework to build
awesome web app in no time.</p>

<p><img src="./Le Wagon - Lectures_files/logo_ruby-21bc68a399f175ba58276aada3660685.png" alt=""></p>

<hr>

<h2>Your turn!</h2>

<p>Go to <a href="https://github.com/lewagon/setup">github.com/lewagon/setup</a></p>

<h1>Setup - (2) Terminal 101</h1>

<h2>Different names</h2>

<ul>
<li>Command prompt</li>
<li>Console</li>
<li>Terminal</li>
</ul>

<h2>Basic commands</h2>

<h3>Where am I ?</h3>

<ol>
<li>Look for the folder name before the prompt <code>$</code></li>
<li>Or print the path of the current directory</li>
</ol>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">pwd</span>
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/terminal_pwd-7e57590437a407c51fbca4547ebd1a16.png" alt=""></p>

<h2>Where can I go ?</h2>

<p><strong><code>ls</code></strong> (or <strong><code>ll</code></strong>, an alias of <code>ls -lh</code>)</p>

<p><img src="./Le Wagon - Lectures_files/terminal_ls-04d338e7544a7ca0c8382ad3d5220559.png" alt=""></p>

<h2>Let's go there</h2>

<p><strong><code>cd &lt;FOLDER_NAME&gt;</code></strong></p>

<p><img src="./Le Wagon - Lectures_files/terminal_cd_bis-614cae198b772507961988e2799d3ee2.png" alt=""></p>

<h2>How can I go up?</h2>

<p><strong><code>cd ..</code></strong></p>

<p><img src="./Le Wagon - Lectures_files/terminal_cd_stepback-12d9587caccceaa4b24fcfd65aa2ddb5.png" alt=""></p>

<h2>Let's create a folder</h2>

<p><strong><code>mkdir &lt;NEW_FOLDER&gt;</code></strong></p>

<p><img src="./Le Wagon - Lectures_files/terminal_mkdir-d51f14dc94a7b5d5cf04e033a7c875ea.png" alt=""></p>

<h2>Let's create a file</h2>

<p><strong><code>touch &lt;FILE_NAME&gt;</code></strong></p>

<p><img src="./Le Wagon - Lectures_files/terminal_touch-f2b6a3b81acb1b8b6bed758e0c035626.png" alt=""></p>

<h2>Open your folder in sublime</h2>

<p>Open your current folder in Sublime with <strong><code>stt</code></strong></p>

<p><img src="./Le Wagon - Lectures_files/terminal_stt-7b5a88698c5a436a749079cbb1d204a6.png" alt=""></p>

<h1>Setup - (3) Git 101</h1>

<h2>We are knowledge Workers</h2>

<p>We create and edit <strong>files</strong> (text, images, etc.)</p>

<h3>Everyday workflow</h3>

<ol>
<li>Create a file</li>
<li>Save it</li>
<li>Edit it</li>
<li>Save it again</li>
<li>etc.</li>
</ol>

<h3>File life</h3>

<p><img src="./Le Wagon - Lectures_files/history_tracking-7274c11cf200ba2b4d898d67769028a7.png" alt=""></p>

<h3>Manual Version Control</h3>

<p>How most people keep track of different versions of a file</p>

<p><img src="./Le Wagon - Lectures_files/manual_version_control-5ee067ecce284a0a11410599c2d07112.png" alt=""></p>

<h3>Can we automate this?</h3>

<p>For each document version, we need to know:</p>

<ol>
<li><strong>When</strong> the file was modified</li>
<li><strong>What</strong> changed</li>
<li><strong>Why</strong> it was modified</li>
</ol>

<h3>There's more: Teams</h3>

<p><img src="./Le Wagon - Lectures_files/history_tracking_team-7b80b709ea8a3792604957986b42c4a0.png" alt=""></p>

<h3>That's one more question:</h3>

<p>For each document version, we need to know:</p>

<ol>
<li>When the file was modified</li>
<li>What changed</li>
<li>Why it was modified</li>
<li><strong>Who</strong> did the change</li>
</ol>

<h3>In a nutshell</h3>

<p>We want a tool which:</p>

<ul>
<li>tracks document versions</li>
<li>keeps an history of document changes</li>
<li>foster team work</li>
</ul>

<h3>That would be</h3>

<p><img src="./Le Wagon - Lectures_files/git_logo-21285582e920d0433f8dcc6fed6e0014.png" alt=""></p>

<hr>

<h2>Git basic commands</h2>

<h3>Starting</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># From existing repository (on GitHub for instance)</span>
<span class="nv">$ </span>git clone &lt;github_ssh_clone_url&gt;

<span class="c"># Or from scratch</span>
<span class="nv">$ </span>mkdir new_project
<span class="nv">$ </span><span class="nb">cd </span>new_project
<span class="nv">$ </span>git init
</code></pre></div>
<h3>Status</h3>

<p>git can tell you if your folder
has some modified files (dirty)</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git status
</code></pre></div>
<h3>Commit</h3>

<p>A <code>commit</code> (a snapshot of the folder) is a 3-steps job.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># First check which files have been modified</span>
<span class="nv">$ </span>git status

<span class="c"># Then, add the ones you want to the staging area.</span>
<span class="nv">$ </span>git add &lt;file_1_which_has_been_modified&gt;
<span class="nv">$ </span>git add &lt;file_2_which_has_been_modified&gt;

<span class="c"># You can review your staging area</span>
<span class="nv">$ </span>git status

<span class="c"># Take a snapshot of what is in the staging area.</span>
<span class="nv">$ </span>git commit --message <span class="s2">"A meaningful message about this change"</span>
</code></pre></div>
<h3>Diff</h3>

<p>If <code>git status</code> tells you something changed, you can inspect exactly what changed:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git diff
<span class="nv">$ </span>git diff &lt;a_specific_file_or_folder&gt;
</code></pre></div>
<h3>Log</h3>

<p>Show commit history with:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git log

<span class="c"># More fancy command in your ~/.gitconfig</span>
<span class="nv">$ </span>git lg
</code></pre></div>
<h3>Live-code: git init</h3>

<p>Let's create a project and start tracking it</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>mkdir -p ~/code/<span class="nv">$GITHUB_USERNAME</span>/git-101 <span class="o">&amp;&amp;</span> <span class="nb">cd</span> <span class="nv">$_</span>
<span class="nv">$ </span>git init
<span class="nv">$ </span>ls -a <span class="c"># it has created a .git hidden folder</span>
</code></pre></div>
<h3>Live-code: first commit</h3>

<p>Let's create an <code>index.html</code> file and code some basic HTML content</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>touch index.html
<span class="nv">$ </span>stt <span class="c"># code some basic HTML content</span>
</code></pre></div>
<p>Time to commit our work</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git status <span class="c"># file not staged</span>
<span class="nv">$ </span>git add index.html
<span class="nv">$ </span>git status <span class="c"># file staged, ready to commit</span>
<span class="nv">$ </span>git commit -m <span class="s2">"Basic HTML content for home page"</span>
<span class="nv">$ </span>git status
</code></pre></div>
<h3>Live-code: second commit</h3>

<p>Let's add an image in our project</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>curl http://bit.ly/290qWwm &gt; logo.png
<span class="nv">$ </span>stt <span class="c"># add &lt;img src="logo.png"&gt; to your HTML</span>
</code></pre></div>
<p>Time to commit our work</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git status
<span class="nv">$ </span>git diff index.html <span class="c"># what has changed?</span>
<span class="nv">$ </span>git add index.html
<span class="nv">$ </span>git add logo.png
<span class="nv">$ </span>git status
<span class="nv">$ </span>git commit -m <span class="s2">"Adding logo to home page"</span>
<span class="nv">$ </span>git status
<span class="nv">$ </span>git log <span class="c"># check commits history</span>
</code></pre></div>
<h3>Live-code: <code>git add .</code></h3>

<p>Here instead of</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git add index.html
<span class="nv">$ </span>git add logo.png
</code></pre></div>
<p>You can write</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git add . <span class="c"># add all files of current directory</span>
</code></pre></div>
<hr>

<h2>Remote</h2>

<h3>Fork and clone</h3>

<p><img src="./Le Wagon - Lectures_files/fork-clone-1-d2c91bcaeacf2b5b7f945c5de512104e.png" alt=""></p>

<h3>Fork and clone</h3>

<p><img src="./Le Wagon - Lectures_files/fork-clone-2-53d3360e3bf6d89f5454ee092722bac8.png" alt=""></p>

<h3>Fork and clone</h3>

<p><img src="./Le Wagon - Lectures_files/fork-clone-3-2a68a465ae6b1978dc4e3fc564566aa2.png" alt=""></p>

<h3>Pushing the changes</h3>

<p>Once you've committed your work, push it to Github.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Generic command</span>
<span class="nv">$ </span>git push &lt;remote&gt; &lt;branch&gt;

<span class="c"># What we'll use</span>
<span class="nv">$ </span>git push origin master
</code></pre></div>
<h3>Live-code: forking and cloning a remote</h3>

<ol>
<li>Let's fork <a href="https://github.com/lewagon/git-101-boilerplate">Le Wagon's git 101 boilerplate</a></li>
<li>Then let's clone it with:</li>
</ol>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd</span> ~/code/<span class="nv">$GITHUB_USERNAME</span>
<span class="nv">$ </span>git clone git@github.com:<span class="nv">$GITHUB_USERNAME</span>/git-101-boilerplate.git
<span class="nv">$ </span>git status <span class="c"># it's already tracked by git</span>
</code></pre></div>
<h3>Live-code: commit and push</h3>

<p>Let's make a change, commit <strong>and push</strong></p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>stt <span class="c"># change the HTML code</span>
<span class="nv">$ </span>git add index.html
<span class="nv">$ </span>git commit <span class="s2">"adding some custom text"</span>
<span class="nv">$ </span>git status
<span class="nv">$ </span>git push origin master <span class="c"># Pushing on Github</span>
</code></pre></div>
<p>Check that <strong>project was updated on Github</strong>.</p>

<hr>

<h2>Git advanced</h2>

<p>In the next few weeks, we'll see how git can help us with</p>

<ul>
<li>Solving conflicts</li>
<li>collaboration (using branches)</li>
<li>production deployment (using multiple remotes)</li>
</ul>

<hr>

<h2>Kitt Demo</h2>

<ul>
<li>Navigation</li>
<li>Lectures</li>
<li>Videos</li>
<li>Classmates</li>
<li>Buddies</li>
<li>Tickets</li>
<li>Flashcards: <strong>let's test it on "Terminal and git"</strong></li>
<li>Challenges: <strong>let's solve and push <code>00-Setup/00-Demo</code></strong></li>
</ul>

<h1>Ruby - Programming basics</h1>

<h2>How to run your code?</h2>

<h3>Experiment with IRB</h3>

<ul>
<li>run <code>irb</code> to launch a ruby interpreter</li>
<li>IRB is your <strong>playground</strong>. So test things, be insane!</li>
</ul>

<p><img src="./Le Wagon - Lectures_files/irb-3f3e388b9f13481ee1f1d5f3dd2c9755.png" alt=""></p>

<h3>Running a ruby file (1)</h3>

<p>Launch your ruby script with</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>ruby path/to/your/file.rb
</code></pre></div>
<h3>Running a ruby file (2)</h3>

<ul>
<li>Use <code>puts</code> to test results of your script</li>
</ul>

<p><img src="./Le Wagon - Lectures_files/script-1cb6e7c647bb5a5f12b94edf9c225007.png" alt=""></p>

<hr>

<h2>Built-in objects</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s2">"Sponge Bob"</span><span class="o">.</span><span class="n">class</span>              <span class="c1">#=&gt; String</span>
<span class="mi">12</span><span class="o">.</span><span class="n">class</span>                        <span class="c1">#=&gt; Fixnum</span>
<span class="mi">3</span><span class="o">.</span><span class="mi">14</span><span class="o">.</span><span class="n">class</span>                      <span class="c1">#=&gt; Float</span>
<span class="o">[</span><span class="s2">"Sponge Bob"</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="o">.</span><span class="mi">14</span><span class="o">].</span><span class="n">class</span>  <span class="c1">#=&gt; Array</span>
<span class="kp">true</span><span class="o">.</span><span class="n">class</span>                      <span class="c1">#=&gt; TrueClass</span>
<span class="kp">false</span><span class="o">.</span><span class="n">class</span>                     <span class="c1">#=&gt; FalseClass</span>
<span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">class</span>                  <span class="c1">#=&gt; Range</span>
</code></pre></div>
<h3>String</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s2">"yipi yeah"</span><span class="o">.</span><span class="n">upcase</span>   <span class="c1">#=&gt; "YIPI YEAH"</span>
<span class="s2">"Hello"</span> <span class="o">==</span> <span class="s1">'Hello'</span>   <span class="c1">#=&gt; true</span>
</code></pre></div>
<p>Interpolation</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s1">'two: #{1 + 1}'</span>      <span class="c1">#=&gt; "two: #{1 + 1}"</span>
<span class="s2">"two: </span><span class="si">#{</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">"</span>      <span class="c1">#=&gt; "two: 2"</span>
</code></pre></div>
<p>Conversion to integer</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s1">'1984'</span><span class="o">.</span><span class="n">class</span>        <span class="c1">#=&gt; String</span>
<span class="s1">'1984'</span><span class="o">.</span><span class="n">to_i</span>         <span class="c1">#=&gt; 1984</span>
<span class="s1">'1984'</span><span class="o">.</span><span class="n">to_i</span><span class="o">.</span><span class="n">class</span>   <span class="c1">#=&gt; Fixnum</span>
</code></pre></div>
<h3>Fixnum</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Standard arithmetic</span>
<span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span>      <span class="c1">#=&gt; 3</span>
<span class="mi">2</span> <span class="o">*</span> <span class="mi">4</span>      <span class="c1">#=&gt; 8</span>
<span class="c1"># Custom methods</span>
<span class="mi">20</span><span class="o">.</span><span class="n">even?</span>   <span class="c1">#=&gt; true</span>
<span class="mi">20</span><span class="o">.</span><span class="n">odd?</span>    <span class="c1">#=&gt; false</span>
</code></pre></div>
<p>Conversion to string</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="mi">1984</span><span class="o">.</span><span class="n">to_s</span>    <span class="c1">#=&gt; "1984"</span>
</code></pre></div>
<h3>Float</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">3.1416.truncate   #=&gt; 3
</code></pre></div>
<h3>Array</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">[</span><span class="s1">'Sponge Bob'</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="o">.</span><span class="mi">14</span><span class="o">].</span><span class="n">size</span>      <span class="c1">#=&gt; 3</span>
<span class="o">[</span><span class="s1">'Huey'</span><span class="p">,</span> <span class="s1">'Dewey'</span><span class="p">,</span> <span class="s1">'Louie'</span><span class="o">].</span><span class="n">sort</span>    <span class="c1">#=&gt; ["Dewey", "Huey", "Louie"]</span>
<span class="o">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="o">].</span><span class="n">sort</span>                     <span class="c1">#=&gt; [1, 3, 5]</span>
</code></pre></div>
<p>Shortcut for array of strings</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="sx">%w[Huey Dewey Louie]</span>  <span class="c1">#=&gt; ["Huey", "Dewey", "Louie"]</span>
<span class="sx">%w(Huey Dewey Louie)</span>  <span class="c1">#=&gt; ["Huey", "Dewey", "Louie"]</span>
<span class="sx">%w{Huey Dewey Louie}</span>  <span class="c1">#=&gt; ["Huey", "Dewey", "Louie"]</span>
</code></pre></div>
<h3>Range</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span>       <span class="c1">#=&gt; [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span>
<span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span>      <span class="c1">#=&gt; [1, 2, 3, 4, 5, 6, 7, 8, 9]</span>
</code></pre></div>
<h3>ruby doc is your friend!</h3>

<p>Want to perform some basic treatment?</p>

<ul>
<li>shuffle an array</li>
<li>capitalize a word</li>
<li>split a word into an array of characters</li>
<li>etc..</li>
</ul>

<h3>Do not re-invent the Wheel</h3>

<p>=&gt; http://www.ruby-doc.org/core/</p>

<hr>

<h2>Variables</h2>

<p><strong>Deeply</strong> understand them!</p>

<p>They are the <strong>elementary blocks of programming</strong>.</p>

<h3>Why variables?</h3>

<p>Store values to re-use them</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">age</span> <span class="o">=</span> <span class="mi">17</span>
<span class="nb">puts</span> <span class="s2">"You are </span><span class="si">#{</span><span class="n">age</span><span class="si">}</span><span class="s2"> years old"</span>

<span class="nb">puts</span> <span class="s2">"Lucky you, it's your birthday"</span>
<span class="n">age</span> <span class="o">=</span> <span class="n">age</span> <span class="o">+</span> <span class="mi">1</span>
<span class="nb">puts</span> <span class="s2">"You are now </span><span class="si">#{</span><span class="n">age</span><span class="si">}</span><span class="s2">"</span>
</code></pre></div>
<h3>Assignment</h3>

<p><img src="./Le Wagon - Lectures_files/variable-1-08d29a517c867a02142dd042631a9882.png" alt=""></p>

<h3>Assignment</h3>

<p><img src="./Le Wagon - Lectures_files/variable-2-dabed252a7c582d86896cab3ccb66b51.png" alt=""></p>

<h3>Assignment</h3>

<p><img src="./Le Wagon - Lectures_files/variable-3-496895acc56171714629e4e5f2a8c32c.png" alt=""></p>

<hr>

<h2>Methods</h2>

<p><strong>Factoring</strong> your code</p>

<h3>Why methods?</h3>

<p><strong>Concise</strong> way to call a ruby code</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">tomorrow</span>
  <span class="n">tomorrow_date</span> <span class="o">=</span> <span class="no">Date</span><span class="o">.</span><span class="n">today</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="k">return</span> <span class="n">tomorrow_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%B %d"</span><span class="p">)</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="n">tomorrow</span>
</code></pre></div>
<h3>Why methods?</h3>

<p>Apply a ruby code to <strong>dynamic inputs</strong></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">full_name</span><span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">)</span>
  <span class="nb">name</span> <span class="o">=</span> <span class="n">first_name</span><span class="o">.</span><span class="n">capitalize</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="n">last_name</span><span class="o">.</span><span class="n">capitalize</span>
  <span class="k">return</span> <span class="nb">name</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="n">full_name</span><span class="p">(</span><span class="s2">"boris"</span><span class="p">,</span> <span class="s2">"paillard"</span><span class="p">)</span>
<span class="nb">puts</span> <span class="n">full_name</span><span class="p">(</span><span class="s2">"sebastien"</span><span class="p">,</span> <span class="s2">"saunier"</span><span class="p">)</span>
</code></pre></div>
<h3>Combine variables and methods</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">full_name</span><span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">)</span>
  <span class="nb">name</span> <span class="o">=</span> <span class="n">first_name</span><span class="o">.</span><span class="n">capitalize</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="n">last_name</span><span class="o">.</span><span class="n">capitalize</span>
  <span class="k">return</span> <span class="nb">name</span>
<span class="k">end</span>

<span class="n">boris_first_name</span> <span class="o">=</span> <span class="s2">"boris"</span>
<span class="n">boris_last_name</span> <span class="o">=</span> <span class="s2">"paillard"</span>
<span class="n">boris_full_name</span> <span class="o">=</span> <span class="n">full_name</span><span class="p">(</span><span class="n">boris_first_name</span><span class="p">,</span> <span class="n">boris_last_name</span><span class="p">)</span>
<span class="nb">puts</span> <span class="n">boris_full_name</span>
</code></pre></div>
<h3>Parameters vs. arguments</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">new_population</span><span class="p">(</span><span class="n">population</span><span class="p">,</span> <span class="n">births</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">population</span> <span class="o">+</span> <span class="n">births</span>
<span class="k">end</span>
</code></pre></div>
<ul>
<li><code>population</code> and <code>births</code> are <strong>parameters</strong></li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">puts new_population(2000000, 300)
</code></pre></div>
<ul>
<li><code>2000000</code> and <code>300</code> are <strong>arguments</strong></li>
<li>Arguments are values taken by the parameters</li>
</ul>

<h3>The return convention</h3>

<p>A method returns the <strong>last statement executed</strong>.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="k">end</span>

<span class="c1"># is the same as</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
  <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="k">end</span>
</code></pre></div>
<h3>Conventions</h3>

<p>Methods and variables in <strong>snake_case</strong></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">good_method_or_variable_name
</code></pre></div>
<h3>Conventions</h3>

<p>a method ending with a <code>?</code> returns <code>true</code> or <code>false</code></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="mi">42</span><span class="o">.</span><span class="n">even?</span> <span class="c1">#=&gt; true</span>
<span class="mi">42</span><span class="o">.</span><span class="n">odd?</span>  <span class="c1">#=&gt; false</span>
</code></pre></div>
<p>a method ending with a <code>!</code> is destructive or dangerous</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">text</span> <span class="o">=</span> <span class="s1">'Hello'</span>

<span class="n">text</span><span class="o">.</span><span class="n">upcase</span>
<span class="c1">#=&gt; "HELLO"</span>

<span class="n">text</span>
<span class="c1">#=&gt; "Hello"</span>

<span class="n">text</span><span class="o">.</span><span class="n">upcase!</span>
<span class="c1">#=&gt; "HELLO"</span>

<span class="n">text</span>
<span class="c1">#=&gt; "HELLO"</span>
</code></pre></div>
<hr>

<h2>Happy hacking!</h2>

<h1>Ruby - Flow and Array</h1>

<h2>Controlling the flow</h2>

<h3>Basic flow</h3>

<p>Top to bottom / line-by-line</p>

<p><img src="./Le Wagon - Lectures_files/standard_flow-3e8298abbe9b74145da12c4b966d364d.png" alt=""></p>

<h3>Let's change this flow</h3>

<h3>if</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">if</span> <span class="n">condition</span>
  <span class="c1"># code executed only when condition is "truthy"</span>
<span class="k">end</span>
</code></pre></div>
<p><em>truthy:</em> anything that is different from <code>false</code> or <code>nil</code>.</p>

<p><strong>0 is true!</strong></p>

<h3>if !</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">if</span> <span class="o">!</span><span class="n">condition</span>
  <span class="c1"># code executed only when condition is not "truthy"</span>
<span class="k">end</span>
</code></pre></div>
<h3>unless</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">unless</span> <span class="n">condition</span>
  <span class="c1"># code executed only when condition is not "truthy"</span>
<span class="k">end</span>
</code></pre></div>
<h3>Live-code - voting age</h3>

<p>Can you vote?</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">puts</span> <span class="s2">"How old are you?"</span>
<span class="nb">print</span> <span class="s2">"&gt;"</span>
<span class="n">age</span> <span class="o">=</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span><span class="o">.</span><span class="n">to_i</span>

<span class="k">if</span> <span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">18</span>
  <span class="nb">puts</span> <span class="s2">"you can vote!"</span>
<span class="k">end</span>
</code></pre></div>
<h3>if / else</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">if</span> <span class="n">condition</span>
  <span class="c1"># executed when condition is truthy</span>
<span class="k">else</span>
  <span class="c1"># executed when condition is not truthy</span>
<span class="k">end</span>
</code></pre></div>
<h3>Live-code: voting age (enhanced)</h3>

<p>Can you vote? enhanced version</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">puts</span> <span class="s2">"what's your age?"</span>
<span class="nb">print</span> <span class="s1">'&gt;'</span>

<span class="n">age</span> <span class="o">=</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span><span class="o">.</span><span class="n">to_i</span>

<span class="k">if</span> <span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">18</span>
  <span class="nb">puts</span> <span class="s2">"you can vote!"</span>
<span class="k">else</span>
  <span class="nb">puts</span> <span class="s2">"too young to vote.."</span>
<span class="k">end</span>
</code></pre></div>
<h3>Ternary operator</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">condition</span> <span class="p">?</span> <span class="n">code_when_truthy</span> <span class="p">:</span> <span class="n">code_when_falsey</span>
</code></pre></div>
<p><strong>Live-code:</strong> let's flip coins</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">puts</span> <span class="s2">"heads or tails?"</span>
<span class="n">choice</span> <span class="o">=</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span>
<span class="n">coin</span> <span class="o">=</span> <span class="o">[</span><span class="s2">"heads"</span><span class="p">,</span> <span class="s2">"tails"</span><span class="o">].</span><span class="n">sample</span>

<span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">choice</span> <span class="o">==</span> <span class="n">coin</span><span class="p">)</span> <span class="p">?</span> <span class="s2">"winner"</span> <span class="p">:</span> <span class="s2">"looser"</span>
<span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">result</span><span class="si">}</span><span class="s2">, that was </span><span class="si">#{</span><span class="n">coin</span><span class="si">}</span><span class="s2">"</span>
</code></pre></div>
<h3>if / elsif / else</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">if</span> <span class="n">condition</span>
  <span class="c1"># ...</span>
<span class="k">elsif</span> <span class="n">other_condition</span>
  <span class="c1"># ...</span>
<span class="k">else</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div>
<h3>Live-code: Morning? Afternoon? Night?</h3>

<p><strong>What's wrong</strong> with this program?</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">hour</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">hour</span>

<span class="k">if</span> <span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">12</span>
  <span class="nb">puts</span> <span class="s2">"Good morning!"</span>
<span class="k">elsif</span> <span class="n">hour</span> <span class="o">&gt;</span> <span class="mi">12</span>
  <span class="nb">puts</span> <span class="s2">"Good afternoon!"</span>
<span class="k">elsif</span> <span class="n">hour</span> <span class="o">&gt;=</span> <span class="mi">20</span>
  <span class="nb">puts</span> <span class="s2">"Good night!"</span>
<span class="k">else</span>
  <span class="nb">puts</span> <span class="s2">"Lunch time!"</span>
<span class="k">end</span>
</code></pre></div>
<h3>case / when / else</h3>

<p>Old school UI</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">puts</span> <span class="s2">"Which action? [read|write|exit]"</span>
<span class="n">action</span> <span class="o">=</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span>

<span class="k">case</span> <span class="n">action</span>
<span class="k">when</span> <span class="s2">"read"</span>
  <span class="nb">puts</span> <span class="s1">'You are in READ mode'</span>
<span class="k">when</span> <span class="s2">"write"</span>
  <span class="nb">puts</span> <span class="s1">'You are in WRITE mode'</span>
<span class="k">when</span> <span class="s2">"exit"</span>
  <span class="nb">puts</span> <span class="s1">'Bye Bye'</span>
<span class="k">else</span>
  <span class="nb">puts</span> <span class="s1">'Wrong action'</span>
<span class="k">end</span>
</code></pre></div>
<h3>Inline conditions</h3>

<p>For short single-line statements</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">do_something</span> <span class="k">if</span> <span class="n">condition</span>
<span class="n">do_something</span> <span class="k">unless</span> <span class="n">condition</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">number</span> <span class="o">=</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span><span class="o">.</span><span class="n">to_i</span>
<span class="nb">puts</span> <span class="s2">"your number </span><span class="si">#{</span><span class="n">number</span><span class="si">}</span><span class="s2"> is so even !"</span> <span class="k">if</span> <span class="n">number</span><span class="o">.</span><span class="n">even?</span>
</code></pre></div>
<h3>Multiple conditions - AND</h3>

<p><code>&amp;&amp;</code> is the logical AND</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="kp">true</span>  <span class="o">&amp;&amp;</span> <span class="kp">true</span>             <span class="c1">#=&gt; true</span>
<span class="kp">false</span> <span class="o">&amp;&amp;</span> <span class="kp">false</span>            <span class="c1">#=&gt; false</span>
<span class="kp">true</span>  <span class="o">&amp;&amp;</span> <span class="kp">false</span>            <span class="c1">#=&gt; false</span>
<span class="kp">false</span> <span class="o">&amp;&amp;</span> <span class="kp">true</span>             <span class="c1">#=&gt; false</span>
<span class="kp">true</span>  <span class="o">&amp;&amp;</span> <span class="kp">false</span> <span class="o">&amp;&amp;</span> <span class="kp">true</span>    <span class="c1">#=&gt; ?</span>
</code></pre></div>
<h3>Multiple conditions - OR</h3>

<p><code>||</code> is the logical OR</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="kp">true</span>  <span class="o">||</span> <span class="kp">true</span>            <span class="c1">#=&gt; true</span>
<span class="kp">false</span> <span class="o">||</span> <span class="kp">false</span>           <span class="c1">#=&gt; false</span>
<span class="kp">true</span>  <span class="o">||</span> <span class="kp">false</span>           <span class="c1">#=&gt; true</span>
<span class="kp">false</span> <span class="o">||</span> <span class="kp">true</span>            <span class="c1">#=&gt; true</span>
<span class="kp">true</span>  <span class="o">||</span> <span class="kp">false</span> <span class="o">||</span> <span class="kp">true</span>   <span class="c1">#=&gt; ?</span>
</code></pre></div>
<h3>Live-code - Opening hours</h3>

<p>When is the shop opened?</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">hour</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">hour</span>

<span class="k">if</span> <span class="p">(</span><span class="n">hour</span> <span class="o">&gt;</span> <span class="mi">9</span> <span class="o">&amp;&amp;</span> <span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">hour</span> <span class="o">&gt;</span> <span class="mi">14</span> <span class="o">&amp;&amp;</span> <span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">18</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"The shop is opened!"</span>
<span class="k">else</span>
  <span class="nb">puts</span> <span class="s2">"Sorry, the shop is closed.."</span>
<span class="k">end</span>
</code></pre></div>
<h3>Looping with <code>while</code></h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">while</span> <span class="n">condition</span>
  <span class="c1"># executed while condition is truthy</span>
<span class="k">end</span>
</code></pre></div>
<h3>Live-code: find the right price</h3>

<p>Let's find the right price!</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">price_to_find</span> <span class="o">=</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">choice</span> <span class="o">=</span> <span class="kp">nil</span>

<span class="k">while</span> <span class="n">choice</span> <span class="o">!=</span> <span class="n">price_to_find</span>
  <span class="nb">puts</span> <span class="s2">"How much (between 0$ and 4$)?"</span>
  <span class="n">choice</span> <span class="o">=</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span><span class="o">.</span><span class="n">to_i</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="s2">"You won! Price was </span><span class="si">#{</span><span class="n">price_to_find</span><span class="si">}</span><span class="s2">$"</span>
</code></pre></div>
<h3>Looping with <code>until</code></h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">until</span> <span class="n">condition</span>
  <span class="c1"># executed until condition is truthy</span>
<span class="k">end</span>
</code></pre></div>
<h3>Live-code: find the right price (refacto)</h3>

<p>Let's find the right price! refacto</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">price_to_find</span> <span class="o">=</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">choice</span> <span class="o">=</span> <span class="kp">nil</span>

<span class="k">until</span> <span class="n">choice</span> <span class="o">==</span> <span class="n">price_to_find</span>
  <span class="nb">puts</span> <span class="s2">"How much (between 0$ and 4$)?"</span>
  <span class="n">choice</span> <span class="o">=</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span><span class="o">.</span><span class="n">to_i</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="s2">"You won! Price was </span><span class="si">#{</span><span class="n">price_to_find</span><span class="si">}</span><span class="s2">$"</span>
</code></pre></div>
<h3>Looping with <code>for</code></h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">for</span> <span class="n">num</span> <span class="k">in</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span>
  <span class="nb">puts</span> <span class="n">num</span>
<span class="k">end</span>
</code></pre></div>
<hr>

<h2>Arrays</h2>

<h3>Define an array</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">empty_array</span> <span class="o">=</span> <span class="o">[]</span>                        <span class="c1"># an empty array</span>
<span class="n">beatles</span> <span class="o">=</span> <span class="o">[</span><span class="s2">"john"</span><span class="p">,</span> <span class="s2">"ringo"</span><span class="p">,</span> <span class="s2">"seb"</span><span class="o">]</span>      <span class="c1"># array of 3 strings</span>
</code></pre></div>
<h3>Get an element with its index</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">beatles</span> <span class="o">=</span> <span class="o">[</span><span class="s2">"john"</span><span class="p">,</span> <span class="s2">"ringo"</span><span class="p">,</span> <span class="s2">"seb"</span><span class="o">]</span>
<span class="n">beatles</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>  <span class="c1">#=&gt; "john"</span>
<span class="n">beatles</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>  <span class="c1">#=&gt; "seb"</span>
<span class="n">beatles</span><span class="o">[</span><span class="mi">8</span><span class="o">]</span>  <span class="c1">#=&gt; nil</span>
</code></pre></div>
<p><strong>indices start at 0</strong></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">beatles</span> <span class="o">=</span> <span class="o">[</span><span class="s2">"john"</span><span class="p">,</span> <span class="s2">"ringo"</span><span class="p">,</span> <span class="s2">"seb"</span><span class="o">]</span>
<span class="c1"># index =&gt;    0       1       2</span>
</code></pre></div>
<h3>Modify an element</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">beatles</span> <span class="o">=</span> <span class="o">[</span><span class="s2">"john"</span><span class="p">,</span> <span class="s2">"ringo"</span><span class="p">,</span> <span class="s2">"seb"</span><span class="o">]</span>
<span class="n">beatles</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"george"</span>
<span class="nb">p</span> <span class="n">beatles</span> <span class="c1">#=&gt; ["john", "ringo", "george"]</span>
</code></pre></div>
<h3>Append an element</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">beatles</span> <span class="o">=</span> <span class="o">[</span><span class="s2">"john"</span><span class="p">,</span> <span class="s2">"ringo"</span><span class="p">,</span> <span class="s2">"george"</span><span class="o">]</span>
<span class="n">beatles</span> <span class="o">&lt;&lt;</span> <span class="s2">"paul"</span>
<span class="nb">p</span> <span class="n">beatles</span> <span class="c1">#=&gt; ["john", "ringo", "george", "paul"]</span>
</code></pre></div>
<h3>Delete an element</h3>

<p>By <strong>element</strong>:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">beatles</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">"john"</span><span class="p">)</span>
</code></pre></div>
<p>By <strong>index</strong>:
<code>ruby
beatles.delete_at(2)
</code></p>

<h3><code>size</code> / <code>count</code> / <code>length</code></h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">].</span><span class="n">size</span> <span class="c1">#=&gt; 3</span>
<span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">].</span><span class="n">count</span> <span class="c1">#=&gt; 3</span>
<span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">].</span><span class="n">length</span> <span class="c1">#=&gt; 3</span>
</code></pre></div>
<h3><code>each</code></h3>

<p><code>each</code> is your new best friend</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">beatles</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">beatle</span><span class="o">|</span>
 <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">beatle</span><span class="si">}</span><span class="s2">&nbsp;is in the Beatles"</span>
<span class="k">end</span>

<span class="n">beatles</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">beatle</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">beatle</span><span class="si">}</span><span class="s2">&nbsp;is in the Beatles"</span> <span class="p">}</span>
</code></pre></div>
<h3>And many more...</h3>

<ul>
<li>http://www.ruby-doc.org/core/Array.html</li>
<li>http://www.ruby-doc.org/core/Enumerable.html</li>
</ul>

<hr>

<h2>Happy Hacking!</h2>

<h1>Ruby - Iterators &amp; Blocks</h1>

<hr>

<p>layout: reveal</p>

<h2>transition: 'none'</h2>

<h2>Recap</h2>

<h3>Array</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">musicians</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'Jimmy Page'</span><span class="p">,</span> <span class="s1">'Robert Plant'</span><span class="p">,</span> <span class="s1">'John Paul Jones'</span><span class="p">,</span> <span class="s1">'John Bonham'</span><span class="o">]</span>
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/array-a186792c343fabf9a6c0fb1da4cb90ae.png" alt=""></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">musicians</span><span class="o">.</span><span class="n">size</span>                  <span class="c1"># =&gt; 4</span>
<span class="n">musicians</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>                    <span class="c1"># =&gt; "Robert Plant"</span>
<span class="n">musicians</span> <span class="o">&lt;&lt;</span> <span class="s1">'Miles Davis'</span>      <span class="c1"># =&gt; [..., 'Miles Davis']</span>
</code></pre></div>
<h3>Range</h3>

<p>Collection of <strong>successive</strong> elements</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">10</span>         <span class="c1"># including upper bound</span>
<span class="c1"># =&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="mi">10</span>        <span class="c1"># excluding upper bound</span>
<span class="c1"># =&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span>  <span class="c1"># conversion to array</span>
<span class="c1"># =&gt; [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span>
</code></pre></div>
<p><a href="http://www.ruby-doc.org/core/Range.html">rubydoc for Range</a></p>

<hr>

<h2>Array iteration</h2>

<h3>Looping with <code>for</code> on indices</h3>

<p>Let's loop through the <strong>indices</strong></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">for index in 0...(musicians.size) do
  musician = musicians[index]
  puts "#{index + 1} - #{musician}"
end

# =&gt; 1 - Jimmy Page
#    2 - Robert Plant
#    3 - John Paul Jones
#    4 - John Bonham
</code></pre></div>
<h3>Looping with <code>for</code> on elements</h3>

<p>Or directly on the <strong>elements</strong></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">for</span> <span class="n">musician</span> <span class="k">in</span> <span class="n">musicians</span>
  <span class="nb">puts</span> <span class="s2">"Listen to </span><span class="si">#{</span><span class="n">musician</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>

<span class="c1"># =&gt; Listen to Jimmy Page</span>
<span class="c1">#    Listen to Robert Plant</span>
<span class="c1">#    Listen to John Paul Jones</span>
<span class="c1">#    Listen to John Bonham</span>
</code></pre></div>
<h3>Well, that's not idiomatic.</h3>

<hr>

<h2>Iterators</h2>

<h3><code>#each</code></h3>

<p><strong>Live-code</strong>: Let's greet musicians one by one.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">musicians</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">musician</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"Hello </span><span class="si">#{</span><span class="n">musician</span><span class="si">}</span><span class="s2">!"</span>
<span class="k">end</span>

<span class="c1"># =&gt; Hello Jimmy Page!</span>
<span class="c1">#    Hello Robert Plant!</span>
<span class="c1">#    Hello John Paul Jones!</span>
<span class="c1">#    Hello John Bonham!</span>
</code></pre></div>
<h3><code>#each_with_index</code></h3>

<p><strong>Live-code</strong>: Let's display an ordered list of musicians.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">musicians</span><span class="o">.</span><span class="n">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">musician</span><span class="p">,</span> <span class="n">index</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2"> - </span><span class="si">#{</span><span class="n">musician</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>

<span class="c1"># =&gt; 1 - Jimmy Page</span>
<span class="c1">#    2 - Robert Plant</span>
<span class="c1">#    3 - John Paul Jones</span>
<span class="c1">#    4 - John Bonham</span>
</code></pre></div>
<h3>There's more</h3>

<h3><code>#map</code></h3>

<p>"Transform" one array to another one by applying some code on <strong>each</strong> element.</p>

<p><img src="./Le Wagon - Lectures_files/map_scheme-3f0a1aff611ae9fe149394a556ee0e5d.png" alt=""></p>

<h3><code>#map</code> - upcased names</h3>

<p><strong>Live-code</strong>: Let's build an array of upcased musician names.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">musicians</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'Jimmy Page'</span><span class="p">,</span> <span class="s1">'Robert Plant'</span><span class="p">,</span> <span class="s1">'John Paul Jones'</span><span class="p">,</span> <span class="s1">'John Bonham'</span><span class="o">]</span>

<span class="n">upcased_musicians</span> <span class="o">=</span> <span class="n">musicians</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">musician</span><span class="o">|</span>
  <span class="n">musician</span><span class="o">.</span><span class="n">upcase</span>
<span class="k">end</span>

<span class="nb">p</span> <span class="n">upcased_musicians</span>
<span class="c1"># =&gt; ['JIMMY PAGE', 'ROBERT PLANT', 'JOHN PAUL JONES', 'JOHN BONHAM']</span>
</code></pre></div>
<h3><code>#map</code> - first names</h3>

<p><strong>Live-code</strong>: Let's build an array of musician first names.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">musicians</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'Jimmy Page'</span><span class="p">,</span> <span class="s1">'Robert Plant'</span><span class="p">,</span> <span class="s1">'John Paul Jones'</span><span class="p">,</span> <span class="s1">'John Bonham'</span><span class="o">]</span>

<span class="n">musician_first_names</span> <span class="o">=</span> <span class="n">musicians</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">musician</span><span class="o">|</span>
  <span class="n">musician</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">" "</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
<span class="k">end</span>

<span class="nb">p</span> <span class="n">musician_first_names</span>
<span class="c1"># =&gt; ['Jimmy', 'Robert', 'John', 'John']</span>
</code></pre></div>
<h3><code>#count</code></h3>

<ul>
<li><p>Count element of an array for which some code is <strong>true</strong></p></li>
<li><p><strong>Live-code</strong>: count musicians starting with "J"</p></li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">musicians</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'Jimmy Page'</span><span class="p">,</span> <span class="s1">'Robert Plant'</span><span class="p">,</span> <span class="s1">'John Paul Jones'</span><span class="p">,</span> <span class="s1">'John Bonham'</span><span class="o">]</span>

<span class="n">j_musicians_count</span> <span class="o">=</span> <span class="n">musicians</span><span class="o">.</span><span class="n">count</span> <span class="k">do</span> <span class="o">|</span><span class="n">musician</span><span class="o">|</span>
  <span class="n">musician</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">==</span> <span class="s2">"J"</span>
<span class="k">end</span>

<span class="nb">p</span> <span class="n">j_musicians_count</span>
<span class="c1"># =&gt; 3</span>
</code></pre></div>
<h3><code>#select</code></h3>

<ul>
<li><p>Filter from an array elements for which some code is <strong>true</strong>.</p></li>
<li><p><strong>Live-code</strong>: extract musicians starting with "J"</p></li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">musicians</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'Jimmy Page'</span><span class="p">,</span> <span class="s1">'Robert Plant'</span><span class="p">,</span> <span class="s1">'John Paul Jones'</span><span class="p">,</span> <span class="s1">'John Bonham'</span><span class="o">]</span>

<span class="n">j_musicians</span> <span class="o">=</span> <span class="n">musicians</span><span class="o">.</span><span class="n">select</span> <span class="k">do</span> <span class="o">|</span><span class="n">musician</span><span class="o">|</span>
  <span class="n">musician</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">==</span> <span class="s2">"J"</span>
<span class="k">end</span>

<span class="nb">p</span> <span class="n">j_musicians</span>
<span class="c1">#=&gt; ['Jimmy Page', 'John Paul Jones', 'John Bonham']</span>
</code></pre></div>
<h3>And many more</h3>

<ul>
<li>http://www.ruby-doc.org/core/Array.html</li>
<li>http://www.ruby-doc.org/core/Enumerable.html</li>
</ul>

<p><br></p>

<p>(<strong>Today's first challenge</strong> is to pick the right methods from this documentation)</p>

<h3>To summarize...</h3>

<h3><code>#each</code>, <code>#map</code>, <code>#count</code>...</h3>

<ul>
<li>Are called <strong>iterators</strong>.</li>
<li><strong>Enumerable</strong> is a <strong>module included</strong> in the <code>Array</code> class.</li>
<li>An iterator is just a <strong>method of <a href="http://ruby-doc.org/core/Enumerable.html">Enumerable</a></strong>.</li>
</ul>

<h3>Understand what they return</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># .map      [] -&gt; []</span>
<span class="c1"># .count    [] -&gt; Fixnum</span>
<span class="c1"># .select   [] -&gt; []</span>
</code></pre></div>
<h3>Understand how they work</h3>

<p>The block of code <strong>has a different role</strong> in each case.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">musicians</span><span class="o">.</span><span class="n">each</span>   <span class="p">{</span> <span class="o">|</span><span class="n">musician</span><span class="o">|</span> <span class="n">any_code_with</span><span class="p">(</span><span class="n">musician</span><span class="p">)</span> <span class="p">}</span>
<span class="n">musicians</span><span class="o">.</span><span class="n">map</span>    <span class="p">{</span> <span class="o">|</span><span class="n">musician</span><span class="o">|</span> <span class="n">transform</span><span class="p">(</span><span class="n">musician</span><span class="p">)</span>     <span class="p">}</span>
<span class="n">musicians</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">musician</span><span class="o">|</span> <span class="n">condition_on</span><span class="p">(</span><span class="n">musician</span><span class="p">)</span>  <span class="p">}</span>
</code></pre></div>
<h3>What the hell was this?</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">do</span> <span class="o">|</span><span class="n">musician</span><span class="o">|</span>
  <span class="n">musician</span><span class="o">.</span><span class="n">upcase</span>
<span class="k">end</span>
</code></pre></div>
<p>This is a piece of code called a <strong>block</strong></p>

<hr>

<h2>Blocks</h2>

<p>Blocks are pieces of code</p>

<p><br>
You can think of blocks as <strong>anonymous</strong> methods.</p>

<h3>Block Syntax</h3>

<p>1-line syntax</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="p">{</span> <span class="o">|</span><span class="n">num</span><span class="o">|</span> <span class="n">num</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">}</span>
</code></pre></div>
<p>multi-line syntax</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">do</span> <span class="o">|</span><span class="n">num</span><span class="o">|</span>
  <span class="n">num</span> <span class="o">*</span> <span class="mi">2</span>
<span class="k">end</span>
</code></pre></div>
<h2>Block return</h2>

<p>A multi-line block works as a method, it returns the last statement executed.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">do</span> <span class="o">|</span><span class="n">num</span><span class="o">|</span>
  <span class="n">num</span> <span class="o">*</span> <span class="mi">2</span>
  <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="s2">"Hello"</span>
<span class="k">end</span>
</code></pre></div>
<p>This block will return ? <code>"Hello"</code> </p>

<h3>Methods using a block</h3>

<p>Multi-line syntax</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">method</span><span class="p">(</span><span class="n">arg_1</span><span class="p">,</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">block_arg_1</span><span class="p">,</span> <span class="o">.</span><span class="n">.</span><span class="o">.|</span> <span class="c1"># A block can pass on multiple arguments</span>
  <span class="c1"># Some code</span>
<span class="k">end</span>
</code></pre></div>
<p>Or with the 1-line syntax</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">method</span><span class="p">(</span><span class="n">arg_1</span><span class="p">,</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">block_arg_1</span><span class="p">,</span> <span class="o">.</span><span class="n">.</span><span class="o">.|</span> <span class="n">some_code</span> <span class="p">}</span>
</code></pre></div>
<p><strong>IMPORTANT</strong></p>

<p>The block is just an argument of the method</p>

<h2>Example <code>#each</code></h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">number</span><span class="o">|</span>
  <span class="c1"># Do what ever you want with each number</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">].</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">number</span><span class="o">|</span> <span class="n">some_code</span> <span class="p">}</span>
</code></pre></div>
<p><br></p>

<ul>
<li>Remember, those two syntaxes are the same</li>
<li>The block is <strong>part of the method call</strong></li>
</ul>

<hr>

<h2>Define methods using blocks</h2>

<h3>DISCLAIMER</h3>

<ul>
<li><p>Advanced concept, normal if you struggle!</p></li>
<li><p>You'll probably never have to <strong>define</strong> such methods in your ruby/Rails career.</p></li>
<li><p>But you will <strong>use</strong> lots of them (like <code>each</code>, <code>map</code>, etc..)</p></li>
</ul>

<h3><code>yield</code> calls the block</h3>

<ul>
<li><p><code>yield</code> is a Ruby keyword <strong>executing</strong> the block.</p></li>
<li><p><strong>Live-code</strong>: let's code a <code>timer</code> method</p></li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">timer</span>
  <span class="n">start_time</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span>
  <span class="k">yield</span>
  <span class="nb">puts</span> <span class="s2">"Elapsed time: </span><span class="si">#{</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="n">start_time</span><span class="si">}</span><span class="s2">s"</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">timer</span><span class="p">()</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="s2">"I'm doing something slow..."</span>
  <span class="nb">sleep</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"I'm done :)"</span>
<span class="k">end</span>
<span class="c1"># =&gt; I'm doing somethings slow...</span>
<span class="c1"># =&gt; I'm done :)</span>
<span class="c1"># =&gt; Elapsed time: 4s</span>
</code></pre></div>
<h3>Flow of a method called with a block (1)</h3>

<p><img src="./Le Wagon - Lectures_files/block-1-ef6d8e8ca75a94307e29295d6239b569.png" alt=""></p>

<h3>Flow of a method called with a block (2)</h3>

<p><img src="./Le Wagon - Lectures_files/block-2-00c2665dd8633f9b359d0a0089b38e7e.png" alt=""></p>

<h3>Flow of a method called with a block (3)</h3>

<p><img src="./Le Wagon - Lectures_files/block-3-6558c8f281570f02a7e31618362d2022.png" alt=""></p>

<h3>Flow of a method called with a block (4)</h3>

<p><img src="./Le Wagon - Lectures_files/block-4-2378bf075941cf2d4db9406cc973e1d7.png" alt=""></p>

<h3>Flow of a method called with a block (5)</h3>

<p><img src="./Le Wagon - Lectures_files/block-5-8d5db65381451f30b594e29cca49422b.png" alt=""></p>

<h3><code>yield</code> can be called with parameters</h3>

<p><strong>Live-code</strong>: let's code a custom greeting method.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="n">capitalized_name</span> <span class="o">=</span> <span class="nb">name</span><span class="o">.</span><span class="n">capitalize</span>
  <span class="nb">puts</span> <span class="s2">"Hello, </span><span class="si">#{</span><span class="n">capitalized_name</span><span class="si">}</span><span class="s2">."</span>
<span class="k">end</span>

<span class="n">greet</span><span class="p">(</span><span class="s1">'john'</span><span class="p">)</span> <span class="c1">#=&gt; "Hello, John."</span>
</code></pre></div>
<p><br>
We want to <em>customize</em> this greeting message with a <strong>block</strong>.</p>

<h3>Using a block</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="n">capitalized_name</span> <span class="o">=</span> <span class="nb">name</span><span class="o">.</span><span class="n">capitalize</span>
  <span class="nb">puts</span> <span class="k">yield</span><span class="p">(</span><span class="n">capitalized_name</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">me</span> <span class="o">=</span> <span class="s1">'john'</span>

<span class="n">greet</span><span class="p">(</span><span class="n">me</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="o">|</span>
  <span class="s2">"Greetings, </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">, you look quite fine today!"</span>
<span class="k">end</span>
<span class="c1"># =&gt; "Greetings, John, you look quite fine today!"</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">me</span> <span class="o">=</span> <span class="s1">'john'</span>

<span class="n">greet</span><span class="p">(</span><span class="n">me</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="o">|</span>
  <span class="s2">"Bonjour </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">, comment allez-vous ?"</span>
<span class="k">end</span>
<span class="c1"># =&gt; "Bonjour John, comment allez-vous ?"</span>
</code></pre></div>
<hr>

<h2>Your turn!</h2>

<h1>Ruby - Hash &amp; Symbols</h1>

<h2>Data types we know</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="mi">42</span>                          <span class="c1"># Fixnum</span>
<span class="mi">1</span><span class="o">.</span><span class="mi">25</span>                        <span class="c1"># Float</span>
<span class="kp">true</span>                        <span class="c1"># Boolean</span>
<span class="s2">"hello world"</span>               <span class="c1"># String</span>
<span class="o">[</span> <span class="s2">"a"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">,</span> <span class="s2">"i"</span><span class="p">,</span> <span class="s2">"o"</span><span class="p">,</span> <span class="s2">"u"</span> <span class="o">]</span> <span class="c1"># Array</span>
</code></pre></div>
<hr>

<h2>From arrays to hash</h2>

<h3>Let's take an example</h3>

<h3>Students</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">students</span> <span class="o">=</span>     <span class="o">[</span> <span class="s2">"Peter"</span><span class="p">,</span> <span class="s2">"Mary"</span><span class="p">,</span> <span class="s2">"George"</span><span class="p">,</span> <span class="s2">"Emma"</span> <span class="o">]</span>
<span class="n">student_ages</span> <span class="o">=</span> <span class="o">[</span> <span class="mi">24</span>     <span class="p">,</span> <span class="mi">25</span>    <span class="p">,</span> <span class="mi">22</span>      <span class="p">,</span>  <span class="mi">20</span>    <span class="o">]</span>
</code></pre></div>
<p>Write a program to display a list of students with their age</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">students</span><span class="o">.</span><span class="n">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">student</span><span class="p">,</span> <span class="n">index</span><span class="o">|</span>
  <span class="n">age</span> <span class="o">=</span> <span class="n">student_ages</span><span class="o">[</span><span class="n">index</span><span class="o">]</span>
  <span class="nb">puts</span> <span class="s2">"- </span><span class="si">#{</span><span class="n">student</span><span class="si">}</span><span class="s2"> (</span><span class="si">#{</span><span class="n">age</span><span class="si">}</span><span class="s2"> years old)"</span>
<span class="k">end</span>
</code></pre></div>
<h3>Do you like this solution?</h3>

<ul>
<li><p>Imagine with <strong>10k students</strong> in the array.</p></li>
<li><p>You have to know that <strong><code>"sebastien"</code></strong> has index <strong><code>6783</code></strong> to read his age.</p></li>
<li><p>Hard to maintain, you'll make mistakes when updating or injecting students.</p></li>
</ul>

<h3>What if we could do?</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">puts</span> <span class="n">students_age</span><span class="o">[</span><span class="s2">"Peter"</span><span class="o">]</span>
</code></pre></div>
<h3>We can!</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">students_age</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"Peter"</span> <span class="o">=&gt;</span> <span class="mi">24</span><span class="p">,</span>
  <span class="s2">"Mary"</span> <span class="o">=&gt;</span> <span class="mi">25</span><span class="p">,</span>
  <span class="s2">"George"</span> <span class="o">=&gt;</span> <span class="mi">22</span><span class="p">,</span>
  <span class="s2">"Emma"</span> <span class="o">=&gt;</span> <span class="mi">20</span>
<span class="p">}</span>
</code></pre></div>
<hr>

<h2><code>Hash</code></h2>

<p>A Hash is a dictionary-like collection of <strong>unique</strong> keys.</p>

<p>For each key, a <strong>value</strong> is associated.</p>

<p><br><br></p>

<p><a href="http://www.ruby-doc.org/core/Hash.html">rubydoc</a></p>

<h3>Reading keys</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">paris</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"country"</span> <span class="o">=&gt;</span> <span class="s2">"France"</span><span class="p">,</span>
  <span class="s2">"population"</span> <span class="o">=&gt;</span> <span class="mi">2211000</span>
<span class="p">}</span>
</code></pre></div>
<p>You can access hash value by <strong>keys</strong> with:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">paris</span><span class="o">[</span><span class="s2">"country"</span><span class="o">]</span>     <span class="c1"># =&gt; "France"</span>
<span class="n">paris</span><span class="o">[</span><span class="s2">"population"</span><span class="o">]</span>  <span class="c1"># =&gt; 2211000</span>
</code></pre></div>
<h3>Adding key/value</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">paris</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"country"</span> <span class="o">=&gt;</span> <span class="s2">"France"</span><span class="p">,</span>
  <span class="s2">"population"</span> <span class="o">=&gt;</span> <span class="mi">2211000</span>
<span class="p">}</span>
</code></pre></div>
<p>You can add a new key/value to your hash with:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">paris</span><span class="o">[</span><span class="s2">"star_monument"</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"Tour Eiffel"</span>
</code></pre></div>
<h3>Updating value</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">paris</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"country"</span> <span class="o">=&gt;</span> <span class="s2">"France"</span><span class="p">,</span>
  <span class="s2">"population"</span> <span class="o">=&gt;</span> <span class="mi">2211000</span>
<span class="p">}</span>
</code></pre></div>
<p>You can update the hash with:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">paris</span><span class="o">[</span><span class="s2">"population"</span><span class="o">]</span> <span class="o">=</span> <span class="mi">2211001</span>
</code></pre></div>
<h3>Deleting key/value</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">paris</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"country"</span> <span class="o">=&gt;</span> <span class="s2">"France"</span><span class="p">,</span>
  <span class="s2">"population"</span> <span class="o">=&gt;</span> <span class="mi">2211000</span><span class="p">,</span>
  <span class="s2">"star_monument"</span> <span class="o">=&gt;</span> <span class="s2">"Tour Eiffel"</span>
<span class="p">}</span>
</code></pre></div>
<p>You can delete a key/value with:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">paris</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">"star_monument"</span><span class="p">)</span>
</code></pre></div>
<h3><code>#each</code></h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">paris</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">"country"</span> <span class="o">=&gt;</span> <span class="s2">"France"</span><span class="p">,</span> <span class="s2">"population"</span> <span class="o">=&gt;</span> <span class="mi">2211000</span> <span class="p">}</span>

<span class="n">paris</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"Paris </span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="s2"> is </span><span class="si">#{</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre></div>
<p>This code will print:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Paris country is France</span>
<span class="c1"># Paris population is 2211000</span>
</code></pre></div>
<h3>Custom methods</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">paris</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"country"</span> <span class="o">=&gt;</span> <span class="s2">"France"</span><span class="p">,</span>
  <span class="s2">"population"</span> <span class="o">=&gt;</span> <span class="mi">2211000</span><span class="p">,</span>
  <span class="s2">"star_monument"</span> <span class="o">=&gt;</span> <span class="s2">"Tour Eiffel"</span>
<span class="p">}</span>
<span class="nb">p</span> <span class="n">paris</span><span class="o">.</span><span class="n">has_key?</span><span class="p">(</span><span class="s2">"country"</span><span class="p">)</span>
<span class="nb">p</span> <span class="n">paris</span><span class="o">.</span><span class="n">has_key?</span><span class="p">(</span><span class="s2">"language"</span><span class="p">)</span>
<span class="nb">p</span> <span class="n">paris</span><span class="o">.</span><span class="n">keys</span>
<span class="nb">p</span> <span class="n">paris</span><span class="o">.</span><span class="n">values</span>
</code></pre></div>
<h3>Similar to <code>Array</code>?</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">cities</span> <span class="o">=</span> <span class="o">[</span> <span class="s2">"London"</span><span class="p">,</span> <span class="s2">"Paris"</span><span class="p">,</span> <span class="s2">"NYC"</span> <span class="o">]</span>
<span class="n">city</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="s2">"Paris"</span><span class="p">,</span>
  <span class="s2">"population"</span> <span class="o">=&gt;</span> <span class="mi">2211000</span>
<span class="p">}</span>
</code></pre></div>
<p>
  `Array` are accessed by **indexes**, `Hash` by **keys**
</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">cities</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>    <span class="c1"># =&gt; "London"</span>
<span class="n">city</span><span class="o">[</span><span class="s2">"name"</span><span class="o">]</span> <span class="c1"># =&gt; "Paris"</span>
</code></pre></div>
<h3>More readable for rich data</h3>

<p>Which one do you prefer?</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">cities</span> <span class="o">=</span> <span class="o">[</span> <span class="o">[</span><span class="s2">"London"</span><span class="p">,</span> <span class="s2">"England"</span><span class="p">,</span> <span class="s2">"Big Ben"</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">"Paris"</span><span class="p">,</span> <span class="s2">"France"</span><span class="p">,</span> <span class="s2">"Tour Eiffel"</span><span class="o">]]</span>

<span class="n">cities</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"London"</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="s2">"country"</span> <span class="o">=&gt;</span> <span class="s2">"England"</span><span class="p">,</span> <span class="s2">"monument"</span> <span class="o">=&gt;</span> <span class="s2">"Big Ben"</span> <span class="p">},</span>
  <span class="s2">"Paris"</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="s2">"country"</span> <span class="o">=&gt;</span> <span class="s2">"France"</span><span class="p">,</span> <span class="s2">"monument"</span> <span class="o">=&gt;</span> <span class="s2">"Tour Eiffel"</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Well, what's the more readable?</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">cities</span><span class="o">[</span><span class="mi">1</span><span class="o">][</span><span class="mi">2</span><span class="o">]</span>
<span class="n">cities</span><span class="o">[</span><span class="s2">"Paris"</span><span class="o">][</span><span class="s2">"monument"</span><span class="o">]</span>
</code></pre></div>
<hr>

<h2><code>Symbol</code></h2>

<p>Cousin of <code>String</code> used for <strong>text identifiers</strong></p>

<p><a href="http://www.ruby-doc.org/core/Symbol.html">ruby-doc.org/core/Symbol.html</a></p>

<h3>Let's take two cities</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">paris = {
  "country" =&gt; "France",
  "population" =&gt; 2211000
}

london = {
  "country" =&gt; "England",
  "population" =&gt; 8308000
}
</code></pre></div>
<p><strong><code>country</code></strong> and <strong><code>population</code></strong> are keys of the two hashes. They are <strong>identifiers</strong> more than data.</p>

<h3>Use symbols for identifiers</h3>

<p>In Ruby, when in need of internal <strong>identifiers</strong>, we use <strong>symbols</strong></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="ss">:country</span> <span class="c1"># this is a symbol. This is a new data type</span>
</code></pre></div>
<h3><code>Symbol</code> plays nicely with <code>Hash</code></h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">paris</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">:country</span> <span class="o">=&gt;</span> <span class="s2">"France"</span><span class="p">,</span>
  <span class="ss">:population</span> <span class="o">=&gt;</span> <span class="mi">2211000</span>
<span class="p">}</span>
</code></pre></div>
<p>is equivalent to:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">paris</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">country</span><span class="p">:</span> <span class="s2">"France"</span><span class="p">,</span>
  <span class="ss">population</span><span class="p">:</span> <span class="mi">2211000</span>
<span class="p">}</span>

<span class="c1"># New syntax does not change the way we read a key</span>
<span class="nb">puts</span> <span class="n">paris</span><span class="o">[</span><span class="ss">:population</span><span class="o">]</span>
</code></pre></div>
<p>As ruby developers, we prefer the latter syntax.</p>

<h3><code>Symbol</code> vs <code>String</code></h3>

<p>Strings for <strong>data</strong>. Symbols for <strong>identifiers</strong>.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># Text data =&gt; String
"Sebastien Saunier"
"seb@lewagon.org"
"ruby on Rails"
"Paris"

# Text identifiers =&gt; Symbol
:fullname
:email
:skill
:city
</code></pre></div>
<p><a href="http://stackoverflow.com/a/16621092/197944">Great answer on StackOverflow</a></p>

<hr>

<h2><code>Hash</code> as last method argument</h2>

<h3>Let's code an HTML generator</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">tag("h1", "Hello world")
# =&gt; &lt;h1&gt;Hello world"&lt;/h1&gt;

tag("h1", "Hello world", { class: "bold" })
# =&gt; &lt;h1 class='bold'&gt;Hello world&lt;/h1&gt;

tag("a", "Le Wagon", { href: "http://lewagon.org", class: "btn" })
# =&gt; &lt;a href='http://lewagon.org' class='btn'&gt;Le Wagon&lt;/a&gt;
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">tag</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">attrs</span> <span class="o">=</span> <span class="p">{})</span>
  <span class="n">flat_attrs</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="o">|</span> <span class="s2">"</span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="s2">='</span><span class="si">#{</span><span class="n">val</span><span class="si">}</span><span class="s2">'"</span> <span class="p">}</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">" "</span><span class="p">)</span>
  <span class="k">return</span> <span class="s2">"&lt;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">flat_attrs</span><span class="si">}</span><span class="s2">&gt;</span><span class="si">#{</span><span class="n">content</span><span class="si">}</span><span class="s2">&lt;/</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">&gt;"</span>
<span class="k">end</span>
</code></pre></div>
<p>Note: You should not reveal the solution and live code it with students. Start by showing them that we need to do "</p><h1 attributes="">" + content "</h1>", then telling them that we will focus on ATTRIBUTES. Usually they will start with #each, and guide them to use #map in the end.<p></p>

<h3>Rails will use similar methods</h3>

<hr>

<h2>Data Format</h2>

<ul>
<li>CSV</li>
<li>JSON / XML</li>
</ul>

<h2>CSV / <code>Array</code></h2>
<div class="highlight"><pre><code class="language-text" data-lang="text"># file.csv
Paris,2211000,"Tour Eiffel"
London,8308000,"Big Ben"
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s2">"csv"</span>
<span class="no">CSV</span><span class="o">.</span><span class="n">foreach</span><span class="p">(</span><span class="s2">"file.csv"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
  <span class="c1"># row is an array. For first iteration:</span>
  <span class="c1"># row[0] is "Paris"</span>
  <span class="c1"># row[1] is 2211000, etc.</span>
<span class="k">end</span>
</code></pre></div>
<h2>JSON / <code>Hash</code></h2>

<p>A JSON document will look like this:
<code>javascript
{
  "name": "Paris",
  "population": 2211000
}
</code></p>

<p>And in Ruby, we'll get</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s2">"json"</span>
<span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">'{ "name": "Paris", "population": 2211000 }'</span><span class="p">)</span>
<span class="c1"># =&gt; { "name" =&gt; "Paris", "population" =&gt; 2211000 }</span>
</code></pre></div>
<h2>JSON is everywhere in APIs</h2>

<p>Example: <a href="https://api.github.com/users/ssaunier">GitHub Api: <code>/users/ssaunier</code></a></p>

<hr>

<h2>Your turn!</h2>

<h1>Ruby - Regular Expressions (regex)</h1>

<h2>Regular Expressions</h2>

<h2>Why use it?</h2>

<h2>Data validation</h2>

<p><img src="./Le Wagon - Lectures_files/data-validation-54b18c7580ce038a994bf1f686cc5507.png" alt=""></p>

<h2>Data extraction</h2>

<p><img src="./Le Wagon - Lectures_files/data-extraction-8810d437862ea6accb0a58db03399d31.png" alt=""></p>

<hr>

<h2>How does it work?</h2>

<h2>It's a compact syntax</h2>

<p>The following RegExp</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="sr">/^(?=.*\d)(?=.*[A-Z])(?=.*[\W_]).{6,}$/</span>
</code></pre></div>
<p>Matches a 6-plus-character password with at least</p>

<ul>
<li>an upcase letter anywhere</li>
<li>a number anywhere</li>
<li>a special char anywhere</li>
</ul>

<h2>Delimiters</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">/.../
</code></pre></div>
<h2>Basics</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">/a/           # a
/ab/          # a directly followed by b
</code></pre></div>
<h2>Quantifiers</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">/abc?/         # ab followed by 0..1 c
/abc*/         # ab followed by 0.. c
/abc+/         # ab followed by 1.. c
/abc{3}/       # ab followed by 3 c
</code></pre></div>
<h2>Grouping</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">/(abc)+/      # 1.. abc
/(a|b)c/      # ac OR bc
</code></pre></div>
<h2>Ranges 1/2</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">/./           # any character
/[aB9]/       # a OR B OR 9
/[0-9]/       # any numeric character
/[a-zA-Z]/    # any alphabetical character
/[^a-c]/      # any char BUT a, b OR c
</code></pre></div>
<h2>Ranges 2/2</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">/\d/          # like /[0-9]/
/\w/          # like /[a-zA-Z0-9_]/
/\W/          # like /[^a-zA-Z0-9_]/
/\b/          # word boundary (start or end of word)
/\s/          # whitespace (space, tab, line-break, ...)
</code></pre></div>
<h2>Anchors</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">/^abc/        # starts with abc
/abc$/        # ends with abc
/^abc$/       # contains only abc
</code></pre></div>
<h2>Modifiers</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">/hello/i          # Will match hello, Hello, HeLlO, HELLO, ...
/hello.world/m    # Will match hello\nworld
</code></pre></div>
<hr>

<h2>RegExps and Ruby</h2>

<h2>Tools</h2>

<ul>
<li><code>irb</code></li>
<li><a href="http://rubular.com/">Rubular</a></li>
<li><a href="http://regexr.com/">RegExr Community</a></li>
<li><a href="https://www.debuggex.com/">Debuggex</a></li>
</ul>

<h2>The <a href="http://ruby-doc.org/core/Regexp.html">Regexp</a> class</h2>

<p>Regular Expressions are first class citizens in Ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="sr">/hello/</span><span class="o">.</span><span class="n">class</span>         <span class="c1"># =&gt; Regexp</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s2">"hello"</span> <span class="o">=~</span> <span class="sr">/l{2}/</span>       <span class="c1"># =&gt; 2</span>
<span class="s2">"hello"</span> <span class="o">=~</span> <span class="sr">/m{2}/</span>       <span class="c1"># =&gt; nil</span>
</code></pre></div>
<h2>Usage in conditionals</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">if</span> <span class="n">password</span> <span class="o">=~</span> <span class="sr">/^(?=.*\d)(?=.*[A-Z])(?=.*[\W_]).{6,}$/</span>
  <span class="nb">puts</span> <span class="s2">"A strong one your password is, mmh!"</span>
<span class="k">else</span>
  <span class="nb">puts</span> <span class="s2">"The force with your password is not!"</span>
<span class="k">end</span>
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/yoda-45ee7ad26ebbe473efedcfea34921ed5.jpg" alt=""></p>

<h2>RegExps and Ruby</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">text</span> <span class="o">=</span> <span class="s2">"</span>
<span class="s2">this is a multi-line text</span>
<span class="s2">try to match only this line</span>
<span class="s2">and not the others</span>
<span class="s2">"</span>

<span class="n">text</span> <span class="o">=~</span> <span class="sr">/^try .* line$/</span>       <span class="c1"># =&gt; 25 ?!</span>
<span class="n">text</span> <span class="o">=~</span> <span class="sr">/\Atry .* line\z/</span>     <span class="c1"># =&gt; nil</span>
</code></pre></div>
<h2><a href="http://ruby-doc.org/core/String.html#method-i-match"><code>match</code></a></h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">match_data</span> <span class="o">=</span> <span class="s2">"John Doe"</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">/^(\w+) (\w+)$/</span><span class="p">)</span>
<span class="nb">puts</span> <span class="s2">"Firstname: </span><span class="si">#{</span><span class="n">match_data</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">"</span>
<span class="nb">puts</span> <span class="s2">"Lastname: </span><span class="si">#{</span><span class="n">match_data</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="si">}</span><span class="s2">"</span>
<span class="c1">#&gt;&gt; Firstname: John</span>
<span class="c1">#&gt;&gt; Lastname: Doe</span>
</code></pre></div>
<h2><a href="http://ruby-doc.org/core/String.html#method-i-gsub"><code>gsub</code></a></h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s2">"hello guys"</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/g..s/</span><span class="p">,</span> <span class="s1">'le wagon'</span><span class="p">)</span>
<span class="c1"># =&gt; "hello le wagon"</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s2">"hello guys"</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/^(\w+) (\w+)$/</span><span class="p">,</span> <span class="s1">'Oh \2, \1!'</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh guys, hello!"</span>
</code></pre></div>
<h2><a href="http://ruby-doc.org/core/String.html#method-i-scan"><code>scan</code></a></h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s2">"Let's play tic tac toe"</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="sr">/t../</span><span class="p">)</span>
<span class="c1"># =&gt; ["t's", "tic", "tac", "toe"]</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s2">"Let's play tic tac toe"</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="sr">/\bt../</span><span class="p">)</span>
<span class="c1"># =&gt; ["tic", "tac", "toe"]</span>
</code></pre></div>
<h2>Documentation</h2>

<ul>
<li>http://regular-expressions.info/</li>
<li>http://www.ruby-doc.org/core/Regexp.html</li>
</ul>

<hr>

<h2>Happy Hacking!</h2>

<h1>Ruby - Parsing &amp; Storing Data</h1>

<h2>Data formats</h2>

<p>3 common data formats: CSV, XML &amp; JSON</p>

<h2>Lecture Boilerplate</h2>

<p>https://github.com/lewagon/parsing-demo</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd</span> ~/code/<span class="nv">$GITHUB_USERNAME</span>
<span class="nv">$ </span>git clone git@github.com:lewagon/parsing-demo.git
<span class="nv">$ </span><span class="nb">cd </span>parsing-demo
<span class="nv">$ </span>stt
</code></pre></div>
<h2>CSV</h2>

<h3>CSV (1)</h3>

<p>Filename: <code>beers.csv</code></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">"Name","Appearance","Origin"
"Edelweiss","White","Austria"
"Cuve des Trolls","Blond","Belgium"
"Choulette Ambre","Amber","France"
"Gulden Draak","Dark","Belgium"
</code></pre></div>
<h3>CSV (2)</h3>

<h4>Comma-Separated Values</h4>

<ul>
<li>Human readable plain text containing any number of records</li>
<li>One row per record</li>
<li>Fields of a record are separated by a comma</li>
<li>Header row (optional)</li>
</ul>

<h3>CSV (3)</h3>

<h4>But with a lack of standard</h4>

<ul>
<li>Delimiters aren't always commas</li>
<li>Fields aren't always quoted</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">Name;Appearance;"Origin"
Edelweiss;"White";Austria
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">Name  Appearance  Origin
Edelweiss  White  Austria
</code></pre></div>
<h2>XML</h2>

<h3>XML (1)</h3>

<p>Filename: <code>beers.xml</code></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beers&gt;
  &lt;title&gt;Great beers&lt;/title&gt;
  &lt;beer&gt;
    &lt;name&gt;Edelweiss&lt;/name&gt;
    &lt;appearance&gt;White&lt;/appearance&gt;
    &lt;origin&gt;Austria&lt;/origin&gt;
  &lt;/beer&gt;
  &lt;beer&gt;
    &lt;name&gt;Cuve des Trolls&lt;/name&gt;
    &lt;appearance&gt;Blond&lt;/appearance&gt;
    &lt;origin&gt;Belgium&lt;/origin&gt;
  &lt;/beer&gt;
  ...
&lt;/beers&gt;
</code></pre></div>
<h3>XML (2)</h3>

<h4>Extensible Markup Language</h4>

<ul>
<li>Human/machine readable text</li>
<li>XML declaration line</li>
<li>Focus on a document containing elements and nested sub-documents</li>
<li>Elements composed of a tag and a content</li>
<li>Several schemas systems on top of XML</li>
</ul>

<h2>JSON</h2>

<h3>JSON (1)</h3>

<p>Filename: <code>beers.json</code></p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">"title"</span><span class="p">:</span> <span class="s2">"Great beers"</span><span class="p">,</span>
  <span class="nt">"beers"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"Edelweiss"</span><span class="p">,</span>
      <span class="nt">"appearance"</span><span class="p">:</span> <span class="s2">"White"</span><span class="p">,</span>
      <span class="nt">"origin"</span><span class="p">:</span> <span class="s2">"Austria"</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"Cuve des Trolls"</span><span class="p">,</span>
      <span class="nt">"appearance"</span><span class="p">:</span> <span class="s2">"Blond"</span><span class="p">,</span>
      <span class="nt">"origin"</span><span class="p">:</span> <span class="s2">"Belgium"</span>
    <span class="p">},</span>
    <span class="err">#</span> <span class="err">...</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<h3>JSON (2)</h3>

<h4>JavaScript Object Notation</h4>

<ul>
<li>Human readable text</li>
<li>Format derived from JavaScript but completely independent</li>
<li>Key-value pair datas</li>
<li>Just like Ruby hashes</li>
</ul>

<h2>All format heavily used in web services</h2>

<hr>

<h2>Parsing &amp; Storing</h2>

<h3>What's parsing?</h3>

<p><img src="./Le Wagon - Lectures_files/parsing-8c044f312ad4d4a7f354674b5fc5a611.png" alt=""></p>

<h3>What's storing?</h3>

<p><img src="./Le Wagon - Lectures_files/storing-129f0704c2e2cc5fca879f796de73774.png" alt=""></p>

<h3>Parsing CSV (1)</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'csv'</span>

<span class="n">filepath</span> <span class="o">=</span> <span class="s1">'beers.csv'</span>

<span class="no">CSV</span><span class="o">.</span><span class="n">foreach</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
  <span class="c1"># Here, row is an array of columns</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">row</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="si">}</span><span class="s2"> | </span><span class="si">#{</span><span class="n">row</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2"> | </span><span class="si">#{</span><span class="n">row</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre></div>
<h3>Parsing CSV (2)</h3>

<p>If your file has headers</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'csv'</span>

<span class="n">csv_options</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">col_sep</span><span class="p">:</span> <span class="s1">','</span><span class="p">,</span> <span class="ss">quote_char</span><span class="p">:</span> <span class="s1">'"'</span><span class="p">,</span> <span class="ss">headers</span><span class="p">:</span> <span class="ss">:first_row</span> <span class="p">}</span>
<span class="n">filepath</span>    <span class="o">=</span> <span class="s1">'beers.csv'</span>

<span class="no">CSV</span><span class="o">.</span><span class="n">foreach</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">csv_options</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">row</span><span class="o">[</span><span class="s1">'Name'</span><span class="o">]</span><span class="si">}</span><span class="s2">, a </span><span class="si">#{</span><span class="n">row</span><span class="o">[</span><span class="s1">'Appearance'</span><span class="o">]</span><span class="si">}</span><span class="s2"> beer from </span><span class="si">#{</span><span class="n">row</span><span class="o">[</span><span class="s1">'Origin'</span><span class="o">]</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre></div>
<h3>Storing CSV</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'csv'</span>

<span class="n">csv_options</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">col_sep</span><span class="p">:</span> <span class="s1">','</span><span class="p">,</span> <span class="ss">force_quotes</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">quote_char</span><span class="p">:</span> <span class="s1">'"'</span> <span class="p">}</span>
<span class="n">filepath</span>    <span class="o">=</span> <span class="s1">'beers.csv'</span>

<span class="no">CSV</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">'wb'</span><span class="p">,</span> <span class="n">csv_options</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">csv</span><span class="o">|</span>
  <span class="n">csv</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="s1">'Name'</span><span class="p">,</span> <span class="s1">'Appearance'</span><span class="p">,</span> <span class="s1">'Origin'</span><span class="o">]</span>
  <span class="n">csv</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="s1">'Asahi'</span><span class="p">,</span> <span class="s1">'Pale Lager'</span><span class="p">,</span> <span class="s1">'Japan'</span><span class="o">]</span>
  <span class="n">csv</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="s1">'Guinness'</span><span class="p">,</span> <span class="s1">'Stout'</span><span class="p">,</span> <span class="s1">'Ireland'</span><span class="o">]</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div>
<h3>Parsing JSON</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'json'</span>

<span class="n">filepath</span> <span class="o">=</span> <span class="s1">'beers.json'</span>

<span class="n">serialized_beers</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

<span class="n">beers</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">serialized_beers</span><span class="p">)</span>

<span class="c1"># =&gt; beers is a Hash</span>
</code></pre></div>
<h3>Storing JSON</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">require 'json'

beers = { beers: [
  {
    name:       'Edelweiss',
    appearance: 'White',
    origin:     'Austria'
  },
  {
    name:       'Guinness',
    appearance: 'Stout',
    origin:     'Ireland'
  }
  # etc...
]}

File.open(filepath, 'w') do |file|
  file.write(JSON.generate(beers))
end
</code></pre></div>
<h3>Parsing XML</h3>

<p>We will use the <a href="http://www.nokogiri.org/">Nokogiri</a> gem.</p>

<p><strong>No live-code</strong>, just use the code below when you need it :)</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'nokogiri'</span>

<span class="n">file</span>      <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'beers.xml'</span><span class="p">)</span>
<span class="n">document</span>  <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">XML</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="n">document</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'beer'</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">beer</span><span class="o">|</span>
  <span class="nb">name</span>        <span class="o">=</span> <span class="n">beer</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
  <span class="n">appearance</span>  <span class="o">=</span> <span class="n">beer</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'appearance'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
  <span class="n">origin</span>      <span class="o">=</span> <span class="n">beer</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'origin'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>

  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">, a </span><span class="si">#{</span><span class="n">appearance</span><span class="si">}</span><span class="s2"> beer from </span><span class="si">#{</span><span class="n">origin</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre></div>
<h3>Storing XML with Nokogiri</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'nokogiri'</span>

<span class="n">filepath</span>  <span class="o">=</span> <span class="s1">'beers.xml'</span>
<span class="n">builder</span>   <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">XML</span><span class="o">::</span><span class="no">Builder</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">encoding</span><span class="p">:</span> <span class="s1">'UTF-8'</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">beers</span> <span class="k">do</span>
    <span class="n">beer</span> <span class="k">do</span>
      <span class="nb">name</span>        <span class="s1">'Edelweiss'</span>
      <span class="n">appearance</span>  <span class="s1">'White'</span>
      <span class="n">origin</span>      <span class="s1">'Austria'</span>
    <span class="k">end</span>
    <span class="n">beer</span> <span class="k">do</span>
      <span class="c1"># [...]</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span> <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">to_xml</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div>
<hr>

<h2>Data from the Web</h2>

<h2>Using JSON API</h2>

<p>Most services have a JSON API.</p>

<h3>Chuck Norris JSON API</h3>

<p>Example: http://api.icndb.com/jokes/random</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">require 'json'
require 'open-uri'

api_url = 'http://api.icndb.com/jokes/random?escape=javascript'
quote_serialized = open(api_url).read
quote = JSON.parse(quote_serialized)

puts quote["value"]["joke"]

# =&gt; "Chuck Norris knows everything there is to know -
#     Except for the definition of mercy."
</code></pre></div>
<h2>Scraping</h2>

<p>Sometimes there is no API. We have to <strong>scrape</strong> the HTML directly</p>

<h3>Inspect Element</h3>

<h3>CSS Selector</h3>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nc">.the_class</span>
</code></pre></div><div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"the_class"</span><span class="nt">&gt;</span>
  Some text
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<p>Documentation for <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/CSS/Getting_started/Selectors">selectors</a> on MDN</p>

<h3>Scraping</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'open-uri'</span>
<span class="nb">require</span> <span class="s1">'nokogiri'</span>

<span class="n">ingredient</span> <span class="o">=</span> <span class="s2">"chocolate"</span>

<span class="n">html_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"http://www.epicurious.com/tools/searchresults?search=</span><span class="si">#{</span><span class="n">ingredient</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">html_doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="n">html_file</span><span class="p">)</span>

<span class="n">html_doc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">'.recipeLnk'</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">element</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">element</span><span class="o">.</span><span class="n">text</span>
  <span class="nb">puts</span> <span class="n">element</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'href'</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<hr>

<h2>Happy scraping!</h2>

<h1>Object Oriented Programming - Introduction</h1>

<h2>Software Architecture</h2>

<p>Because real life programs aren't one file programs</p>

<h2>OOP = Data + Behavior</h2>

<h2><code>String</code></h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">name</span> <span class="o">=</span> <span class="nb">String</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">"John Lennon"</span><span class="p">)</span>  <span class="c1"># (same as) name = "John Lennon"</span>
<span class="nb">name</span><span class="o">.</span><span class="n">split</span>
<span class="c1"># =&gt; [ "John", "Lennon" ]</span>
</code></pre></div>
<ul>
<li><strong>Data</strong> (or <strong>State</strong>) is a list of characters.</li>
<li><strong>Behavior</strong> is a set of [methods]((http://www.ruby-doc.org/core/String.html) which can act on the list of characters.</li>
</ul>

<p><img src="./Le Wagon - Lectures_files/cake_mold-a69867b902ed49fd63fc0c0b7b4dd1db.jpg" alt=""></p>

<h2>Class and Instances</h2>

<ul>
<li>A <strong>class</strong> is like a cake mold. It helps to create a cake, but is not a cake</li>
<li>An <strong>instance</strong> of a class is a cake created from a given cake mold</li>
</ul>

<p><img src="./Le Wagon - Lectures_files/cake_mold_annotated-a69f6f0a7c9f1f2a8743e96656cb5cd4.jpg" alt=""></p>

<hr>

<h2>My first Class</h2>

<h2>Let's create a <code>Car</code> class</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># car.rb</span>
<span class="k">class</span> <span class="nc">Car</span>
<span class="k">end</span>
</code></pre></div>
<p>Convention: filename is in lower snake case, class name in upper camel case.</p>

<p>For example:  <code>sports_car.rb</code>  <code>class SportsCar</code></p>

<h2>Instantiation</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">my_car</span> <span class="o">=</span> <span class="no">Car</span><span class="o">.</span><span class="n">new</span>
<span class="n">your_car</span> <span class="o">=</span> <span class="no">Car</span><span class="o">.</span><span class="n">new</span>
</code></pre></div>
<p>We just created two new <strong>instances</strong> of the class <code>Car</code>.</p>

<h2>Constructor</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Car</span><span class="o">.</span><span class="n">new</span> <span class="c1"># =&gt; Instantiates the class, then calls the method `initialize`.</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Car</span>
  <span class="k">def</span> <span class="nf">initialize</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>Instance variable - Data</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Car</span>
  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@engine_started</span> <span class="o">=</span> <span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>Instance methods - Behavior 1/2</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Car</span>
  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@engine_started</span> <span class="o">=</span> <span class="kp">false</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">engine_started?</span>
    <span class="k">return</span> <span class="vi">@engine_started</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">my_car</span> <span class="o">=</span> <span class="no">Car</span><span class="o">.</span><span class="n">new</span>
<span class="n">my_car</span><span class="o">.</span><span class="n">engine_started?</span>
<span class="c1"># =&gt; false</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Car</span>
  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@engine_started</span> <span class="o">=</span> <span class="kp">false</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">engine_started?</span>
    <span class="k">return</span> <span class="vi">@engine_started</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">start_engine</span>
    <span class="vi">@engine_started</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">my_car</span> <span class="o">=</span> <span class="no">Car</span><span class="o">.</span><span class="n">new</span>
<span class="n">my_car</span><span class="o">.</span><span class="n">engine_started?</span>
<span class="c1"># =&gt; false</span>
<span class="n">my_car</span><span class="o">.</span><span class="n">start_engine</span>
<span class="n">my_car</span><span class="o">.</span><span class="n">engine_started?</span>
<span class="c1"># =&gt; true</span>
</code></pre></div>
<hr>

<h2>Setting and accessing state</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Car</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="vi">@color</span> <span class="o">=</span> <span class="n">color</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">red_car</span> <span class="o">=</span> <span class="no">Car</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">"red"</span><span class="p">)</span>
<span class="n">green_car</span> <span class="o">=</span> <span class="no">Car</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">"green"</span><span class="p">)</span>
</code></pre></div>
<h2><code>attr_reader</code></h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Car</span>
  <span class="kp">attr_reader</span> <span class="ss">:color</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="vi">@color</span> <span class="o">=</span> <span class="n">color</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">red_car</span> <span class="o">=</span> <span class="no">Car</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">"red"</span><span class="p">)</span>
<span class="n">red_car</span><span class="o">.</span><span class="n">color</span>
<span class="c1"># =&gt; "red"</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Car</span>
  <span class="kp">attr_reader</span> <span class="ss">:color</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="vi">@color</span> <span class="o">=</span> <span class="n">color</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">paint</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="vi">@color</span> <span class="o">=</span> <span class="n">color</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">my_car</span> <span class="o">=</span> <span class="no">Car</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">"red"</span><span class="p">)</span>
<span class="n">my_car</span><span class="o">.</span><span class="n">color</span>
<span class="c1"># =&gt; "red"</span>
<span class="n">my_car</span><span class="o">.</span><span class="n">paint</span><span class="p">(</span><span class="s2">"green"</span><span class="p">)</span>
<span class="n">my_car</span><span class="o">.</span><span class="n">color</span>
<span class="c1"># =&gt; "green"</span>
</code></pre></div>
<h2><code>attr_writer</code></h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Car</span>
  <span class="kp">attr_writer</span> <span class="ss">:color</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="vi">@color</span> <span class="o">=</span> <span class="n">color</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">my_car</span> <span class="o">=</span> <span class="no">Car</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">"red"</span><span class="p">)</span>
<span class="n">my_car</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s2">"green"</span>  <span class="c1"># =&gt; car color has been updated</span>
</code></pre></div>
<h2><code>attr_accessor</code></h2>

<p><code>attr_reader</code> + <code>attr_writer</code> = <code>attr_accessor</code></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Car</span>
  <span class="kp">attr_accessor</span> <span class="ss">:color</span>  <span class="c1"># Can read and write the color property</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">my_car</span> <span class="o">=</span> <span class="no">Car</span><span class="o">.</span><span class="n">new</span>
<span class="n">my_car</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s2">"red"</span>
<span class="n">my_car</span><span class="o">.</span><span class="n">color</span>
<span class="c1"># =&gt; "red"</span>
</code></pre></div>
<hr>

<h2>Interface</h2>

<h2>Public Interface</h2>

<p>A <strong>contract</strong> with the external world</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Car</span>
  <span class="k">def</span> <span class="nf">start_engine</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>Private interface</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Car</span>
  <span class="k">def</span> <span class="nf">start_engine</span>
    <span class="n">start_petrol_pump</span>
    <span class="n">init_spark_plug</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">start_petrol_pump</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">init_spark_plug</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>External world does not know about both private methods.</p>

<hr>

<h2>Summary</h2>

<ul>
<li><strong>Everything</strong> in ruby is an object.</li>
<li>OOP is about <strong>data</strong> (or <strong>state</strong>) and <strong>behavior</strong>.</li>
<li>State is stored in <strong>instance variables</strong> (<code>@foo</code>)</li>
<li>Behavior is defined by <strong>instance methods</strong> (<code>def bar</code> in <code>class</code> definition)</li>
</ul>

<h1>Object Oriented Programming - Advanced concepts</h1>

<h2>Inheritance</h2>

<p>Sometime, your classes share some behavior and states</p>

<p>Imagine you had three classes, each one to create a different type of building</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">House</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Skyscraper</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Castle</span>
<span class="k">end</span>
</code></pre></div>
<h3>They share some properties</h3>

<ul>
<li>They all have a <strong>name</strong></li>
<li>They all have a <strong>height</strong>, a <strong>width</strong>, and a <strong>length</strong></li>
<li>For every building we have a way to calculate the floor area</li>
</ul>

<p>Thus, we could do :
```ruby
class House
  attr_accessor :name, :height, :width, :length
  def initialize(name, height, width, length)
    @name = name
    @height, @width, @length = height, width, length
  end</p>

<p>def floor<em>area
    width * length
  end
end
<code>
</code>ruby
class Castle
  attr</em>accessor :name, :height, :width, :length
  def initialize(name, height, width, length)
    @name = name
    @height, @width, @length = height, width, length
  end</p>

<p>def floor_area
    width * length
  end
end
```</p>

<h3>DRY</h3>

<p><strong>D</strong>on't <strong>R</strong>epeat <strong>Y</strong>ourself.</p>

<p>Houses, Castles and Skyscrapers are all <strong>buildings</strong></p>

<h3>The <code>Building</code> class</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Building</span>
  <span class="kp">attr_accessor</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:height</span><span class="p">,</span> <span class="ss">:width</span><span class="p">,</span> <span class="ss">:length</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
    <span class="vi">@height</span><span class="p">,</span> <span class="vi">@width</span><span class="p">,</span> <span class="vi">@length</span> <span class="o">=</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">length</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">floor_area</span>
    <span class="n">width</span> <span class="o">*</span> <span class="n">length</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Inheritance</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Castle</span> <span class="o">&lt;</span> <span class="no">Building</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">House</span> <span class="o">&lt;</span> <span class="no">Building</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">some_castle</span> <span class="o">=</span> <span class="no">Castle</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">'Tower of London'</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">480</span><span class="p">)</span>
<span class="n">some_castle</span><span class="o">.</span><span class="n">name</span> <span class="c1"># =&gt; Tower of London</span>
<span class="n">some_castle</span><span class="o">.</span><span class="n">floor_area</span> <span class="c1"># =&gt; 48000</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">my_house</span> <span class="o">=</span> <span class="no">House</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">'Ker Avel'</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">my_house</span><span class="o">.</span><span class="n">name</span> <span class="c1"># =&gt; Ker Avel</span>
<span class="n">my_house</span><span class="o">.</span><span class="n">floor_area</span> <span class="c1"># =&gt; 120</span>
</code></pre></div>
<h3>Specific behavior</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Castle</span> <span class="o">&lt;</span> <span class="no">Building</span>
  <span class="kp">attr_accessor</span> <span class="ss">:butler</span>

  <span class="k">def</span> <span class="nf">has_a_butler?</span>
    <span class="vi">@butler</span> <span class="o">!=</span> <span class="kp">nil</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">my_castle</span> <span class="o">=</span> <span class="no">Castle</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">'Moulinsard'</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">my_castle</span><span class="o">.</span><span class="n">has_a_butler?</span> <span class="c1"># =&gt; false</span>
<span class="n">my_castle</span><span class="o">.</span><span class="n">butler</span> <span class="o">=</span> <span class="s2">"George"</span>
<span class="n">my_castle</span><span class="o">.</span><span class="n">has_a_butler?</span> <span class="c1"># =&gt; true</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">my_house</span> <span class="o">=</span> <span class="no">House</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">'Ker Avel'</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">my_house</span><span class="o">.</span><span class="n">has_a_butler?</span> <span class="c1"># =&gt; Undefined method `has_a_butler?'</span>
</code></pre></div>
<h3>Change an inherited method</h3>

<p>With the <code>super</code> keyword, which <em>calls</em> the <strong>parent</strong>'s method with the <strong>same</strong> name.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Castle</span> <span class="o">&lt;</span> <span class="no">Building</span>
  <span class="c1"># A castle always has a garden of 300 sq. m</span>
  <span class="k">def</span> <span class="nf">floor_area</span>
    <span class="k">super</span> <span class="o">+</span> <span class="mi">300</span>  <span class="c1"># `super` calls `floor_area` of `Building`</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">some_castle</span> <span class="o">=</span> <span class="no">Castle</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">'Tower of London'</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">480</span><span class="p">)</span>
<span class="n">some_castle</span><span class="o">.</span><span class="n">floor_area</span> <span class="c1"># =&gt; 48300</span>
</code></pre></div>
<h3>Real world example : <code>IO</code></h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">IO</span> <span class="c1"># Stands for InputOutput</span>
  <span class="k">def</span> <span class="nf">read</span>
    <span class="c1"># [...]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">File</span> <span class="o">&lt;</span> <span class="no">IO</span>
  <span class="k">def</span> <span class="nf">each_line</span>
    <span class="c1"># [...]</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">CSV</span> <span class="o">&lt;</span> <span class="no">IO</span>
  <span class="k">def</span> <span class="nf">add_row</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
    <span class="c1"># [...]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Summary</h3>

<ul>
<li><p><em>Inheritance</em> is used when classes need to <strong>share</strong> behavior and properties</p></li>
<li><p><em>Subclasses</em> <strong>inherit</strong> <strong>methods</strong> and <strong>instance variables</strong> from parents</p></li>
<li><p>On top of that, <em>subclasses</em> can define <strong>more</strong> instance variables and methods</p></li>
<li><p>Use <strong><code>super</code></strong> to access the <strong>parent method</strong> with the <strong>same name</strong></p></li>
</ul>

<h3>Disclosure / Rails</h3>

<ul>
<li><p>As with <code>yield</code>, when building Rails app, you won't define a lot of parent/child classes. Still you need to know the mechanism to interpret the documentation.<br><br></p></li>
<li><p><strong>But</strong> you'll often <strong>inherit</strong> from Rails classes (<code>ActiveRecord::Base</code>, <code>ActionController::Base</code>, ...)</p></li>
</ul>

<hr>

<h2>Class methods</h2>

<h3>Reminder: Instance VS Class</h3>

<p>A <code>class</code> is used to create <strong><code>instances</code></strong> using the <strong><code>new</code></strong> method</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># castle.rb</span>
<span class="k">class</span> <span class="nc">Castle</span> <span class="c1"># =&gt; This is a class</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Castle</span><span class="o">.</span><span class="n">new</span> <span class="c1"># =&gt; This is an instance of the Castle class</span>
</code></pre></div>
<h3>Instance method</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Castle</span> <span class="o">&lt;</span> <span class="no">Building</span>
  <span class="k">def</span> <span class="nf">has_a_butler?</span>
    <span class="vi">@butler</span> <span class="o">!=</span> <span class="kp">nil</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>The <code>has_a_butler?</code> method is an <strong>instance method</strong>.</p>

<p>We can call it on a <code>Castle</code> <strong>instance</strong>
<code>ruby
my_castle = Castle.new
my_castle.has_a_butler? # =&gt; false
</code></p>

<p><br><br>
Not on the <code>Castle</code> class directly</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Castle</span> <span class="c1"># =&gt; This is the class</span>
<span class="no">Castle</span><span class="o">.</span><span class="n">has_a_butler?</span> <span class="c1"># =&gt; Undefined method `has_a_butler?` for Castle</span>
</code></pre></div>
<h3>Class methods</h3>

<p>They are called on the <strong>class</strong></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Castle</span><span class="o">.</span><span class="n">destroy_for</span><span class="p">(</span><span class="s2">"Boris"</span><span class="p">)</span>
</code></pre></div>
<h3>Class methods - Syntax</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Castle</span> <span class="o">&lt;</span> <span class="no">Building</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">destroy_for</span><span class="p">(</span><span class="n">someone</span><span class="p">)</span>
    <span class="nb">puts</span> <span class="s2">"We are destroying your brand new castle, </span><span class="si">#{</span><span class="n">someone</span><span class="si">}</span><span class="s2">!"</span>
    <span class="c1"># [...]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Note the <strong><code>self</code></strong>.</p>

<p><br><br>
You can call this method <strong>directly</strong> on the Class.
```ruby
Castle.destroy_for("Boris")</p>

<h1>=&gt; We are destroying your brand new castle, Boris!</h1>
<div class="highlight"><pre><code class="language-text" data-lang="text">You **can't** call class methods on instances!

```ruby
castle = Castle.new
castle.destroy_for("Boris") # =&gt; Undefined method `destroy_for`
</code></pre></div>
<h3>When to create class methods?</h3>

<h3>Example</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">House</span>
  <span class="c1"># [...]</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">price_per_square_meter</span><span class="p">(</span><span class="n">city</span><span class="p">)</span>
  <span class="k">case</span> <span class="n">city</span>
  <span class="k">when</span> <span class="s2">"Paris"</span> <span class="k">then</span> <span class="mi">9000</span>
  <span class="k">when</span> <span class="s2">"Brussels"</span> <span class="k">then</span> <span class="mi">3000</span>
  <span class="k">else</span> <span class="k">raise</span> <span class="no">Exception</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">"No data for </span><span class="si">#{</span><span class="n">city</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Makes sense to use a class method</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">House</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">price_per_square_meter</span><span class="p">(</span><span class="n">city</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">city</span>
    <span class="k">when</span> <span class="s2">"Paris"</span> <span class="k">then</span> <span class="mi">9000</span>
    <span class="k">when</span> <span class="s2">"Brussels"</span> <span class="k">then</span> <span class="mi">3000</span>
    <span class="k">else</span> <span class="k">raise</span> <span class="no">Exception</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">"No data for </span><span class="si">#{</span><span class="n">city</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>In a nutshell</h3>

<p>You can create a <strong>class</strong> method if it does not need an instance</p>

<p>You will <strong>use class methods</strong> more than you <strong>define</strong> them.<br></p>

<h2>Real world examples (1)</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="c1"># =&gt; 2014-07-15 23:19:43 +0200</span>
</code></pre></div>
<p><code>now</code> is a <strong>class</strong> method of <code>Time</code> which returns an <strong>instance</strong> of <code>Time</code>.</p>

<h2>Real world examples (2)</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># `Nokogiri::HTML` is a module, and acts as a namespace</span>
<span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="o">::</span><span class="no">Document</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">"&lt;h1&gt;Hello guys&lt;/h1&gt;"</span><span class="p">)</span>
</code></pre></div>
<p><code>parse</code> is a <strong>class</strong> method of <code>Nokogiri::HTML::Document</code> which returns an <strong>instance</strong> of <code>Nokogiri::HTML::Document</code>.</p>

<h2>Real world examples (3)</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">'{ "key": "value", "other_key": "other_value" }'</span><span class="p">)</span>
</code></pre></div>
<p><code>parse</code> is a <strong>class</strong> method of <code>JSON</code> which returns an <strong>instance</strong> of <code>Hash</code>.</p>

<hr>

<h2>Self</h2>

<p>2 use cases:</p>

<ul>
<li>Inside an instance method</li>
<li>Inside a class definition, to define class methods</li>
</ul>

<h3>Inside an instance method</h3>

<p><code>self</code> refers to the <strong>current</strong> instance</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">House</span>
  <span class="k">def</span> <span class="nf">to_s</span>
    <span class="s2">"</span><span class="si">#{</span><span class="vi">@name</span><span class="si">}</span><span class="s2"> owned by </span><span class="si">#{</span><span class="nb">self</span><span class="o">.</span><span class="n">owner_name</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">owner_name</span>
    <span class="vi">@owner</span><span class="o">.</span><span class="n">name</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><code>self</code> is not mandatory in that case.</p>

<p>When do we actually need it explicitly?</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Butler</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">house</span><span class="p">)</span>
    <span class="vi">@house</span> <span class="o">=</span> <span class="n">house</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">clean_house</span>
    <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="vi">@house</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> cleaned!"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">House</span>
  <span class="kp">attr_reader</span> <span class="ss">:name</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
    <span class="vi">@butler</span> <span class="o">=</span> <span class="no">Butler</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="sc">???)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">House</span>
  <span class="kp">attr_reader</span> <span class="ss">:name</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
    <span class="vi">@butler</span> <span class="o">=</span> <span class="no">Butler</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Inside a class</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">House</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">price_per_square_meter</span><span class="p">(</span><span class="n">city</span><span class="p">)</span>
    <span class="c1"># [...]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>Good luck!</h2>

<h1>Object Oriented Programming - Building Software</h1>

<h2>How to figure out a class</h2>

<h2>Real-life object</h2>

<h2><code>Vehicle</code></h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Vehicle</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="vi">@color</span> <span class="o">=</span> <span class="n">color</span>
    <span class="vi">@engine_started</span> <span class="o">=</span> <span class="kp">false</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">start_engine</span>
    <span class="vi">@engine_started</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">engine_started?</span>
    <span class="k">return</span> <span class="vi">@engine_started</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><code>Vehicle</code> is written in the singular form, not plural.</p>

<h2><code>Recipe</code></h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Recipe</span>
  <span class="kp">attr_reader</span> <span class="ss">:ingredients</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
    <span class="vi">@ingredients</span> <span class="o">=</span> <span class="o">[]</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">add_ingredient</span><span class="p">(</span><span class="n">ingredient</span><span class="p">)</span>
    <span class="vi">@ingredients</span> <span class="o">&lt;&lt;</span> <span class="n">ingredient</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Again, <code>Recipe</code> is written in the singular form, not plural.</p>

<h2>Data structures</h2>

<p><img src="./Le Wagon - Lectures_files/plate_stack-c3986b03da9961e18fbf974209e331de.jpg" alt=""></p>

<ul>
<li><p>It's a list of plates</p></li>
<li><p>You can take a plate on top (<code>pop</code>)</p></li>
<li><p>You can put a new plate on top (<code>push</code>)</p></li>
</ul>

<h2><code>Stack</code></h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Stack</span>
  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@elements</span> <span class="o">=</span> <span class="o">[]</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
    <span class="vi">@elements</span> <span class="o">&lt;&lt;</span> <span class="n">element</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">pop</span>
    <span class="vi">@elements</span><span class="o">.</span><span class="n">delete_at</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>Ruby is awesome (1)</h2>

<p><code>Array</code> already has a <strong>stack</strong> behavior with
<a href="https://karr.lewagon.org/ruby-doc.org/core/Array.html#method-i-push"><code>push</code></a>
and <a href="https://karr.lewagon.org/ruby-doc.org/core/Array.html#method-i-pop"><code>pop</code></a></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">beatles</span> <span class="o">=</span> <span class="sx">%w(john paul george)</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># PUSH: =&gt; element is added at the end of the array.</span>
<span class="n">beatles</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s2">"ringo"</span><span class="p">)</span>

<span class="n">beatles</span><span class="o">.</span><span class="n">length</span>
<span class="c1"># =&gt; 4</span>
<span class="nb">p</span> <span class="n">beatles</span>
<span class="c1"># =&gt; [ "john", "paul", "george", "ringo" ]</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># POP: last element of the array is picked.</span>
<span class="n">beatle</span> <span class="o">=</span> <span class="n">beatles</span><span class="o">.</span><span class="n">pop</span>
<span class="c1"># =&gt; "ringo"</span>

<span class="nb">p</span> <span class="n">beatles</span>
<span class="c1"># =&gt; [ "john", "paul", "george" ]</span>
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/queue-f3790730ecce237ca9ce4cb4cc0b0a87.jpg" alt=""></p>

<h2><code>Queue</code></h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Queue</span>
  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@elements</span> <span class="o">=</span> <span class="o">[]</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">enqueue</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
    <span class="vi">@elements</span> <span class="o">&lt;&lt;</span> <span class="n">element</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">dequeue</span>
    <span class="vi">@elements</span><span class="o">.</span><span class="n">delete_at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>Ruby is awesome (2)</h2>

<p><code>Array</code> already has a <strong>queue</strong> behavior with
<a href="https://karr.lewagon.org/ruby-doc.org/core/Array.html#method-i-shift"><code>shift</code></a>
and <a href="https://karr.lewagon.org/ruby-doc.org/core/Array.html#method-i-push"><code>push</code></a></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">beatles</span> <span class="o">=</span> <span class="sx">%w(john paul george)</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># ENQUEUE: =&gt; element is added at the end of the array.</span>
<span class="n">beatles</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s2">"ringo"</span><span class="p">)</span>

<span class="n">beatles</span><span class="o">.</span><span class="n">length</span>
<span class="c1"># =&gt; 4</span>
<span class="nb">p</span> <span class="n">beatles</span>
<span class="c1"># =&gt; [ "john", "paul", "george", "ringo" ]</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># DEQUEUE: first element of the array is picked.</span>
<span class="n">beatle</span> <span class="o">=</span> <span class="n">beatles</span><span class="o">.</span><span class="n">shift</span>
<span class="c1"># =&gt; "john"</span>

<span class="nb">p</span> <span class="n">beatles</span>
<span class="c1"># =&gt; [ "paul", "george", "ringo" ]</span>
</code></pre></div>
<hr>

<h2>Let's build a TODO manager</h2>

<p>And it's gonna be a live code!</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Task</span>
  <span class="kp">attr_reader</span> <span class="ss">:description</span><span class="p">,</span> <span class="ss">:done</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
    <span class="vi">@description</span> <span class="o">=</span> <span class="n">description</span>
    <span class="vi">@done</span> <span class="o">=</span> <span class="kp">false</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">mark_as_done</span>
    <span class="vi">@done</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">TasksRepository</span>
  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@tasks</span> <span class="o">=</span> <span class="o">[]</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
    <span class="vi">@tasks</span> <span class="o">&lt;&lt;</span> <span class="n">task</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">all</span>
    <span class="vi">@tasks</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="vi">@tasks</span><span class="o">[</span><span class="n">index</span><span class="o">]</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="vi">@tasks</span><span class="o">.</span><span class="n">delete_at</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">View</span>
  <span class="k">def</span> <span class="nf">print_tasks</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
    <span class="n">tasks</span><span class="o">.</span><span class="n">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">task</span><span class="p">,</span> <span class="n">index</span><span class="o">|</span>
      <span class="n">done</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">done</span> <span class="p">?</span> <span class="s2">"[x]"</span> <span class="p">:</span> <span class="s2">"[ ]"</span>
      <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">done</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2"> - </span><span class="si">#{</span><span class="n">task</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">get_new_task_description</span>
    <span class="nb">puts</span> <span class="s2">"What do you want to do?"</span>
    <span class="k">return</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">get_task_index_to_remove</span>
    <span class="nb">puts</span> <span class="s2">"Which task do you want to delete?"</span>
    <span class="k">return</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span><span class="o">.</span><span class="n">to_i</span> <span class="o">-</span> <span class="mi">1</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">get_task_index_to_mark_as_done</span>
    <span class="nb">puts</span> <span class="s2">"Which task do you want to mark as done?"</span>
    <span class="k">return</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span><span class="o">.</span><span class="n">to_i</span> <span class="o">-</span> <span class="mi">1</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">require_relative</span> <span class="s2">"view"</span>
<span class="n">require_relative</span> <span class="s2">"task"</span>

<span class="k">class</span> <span class="nc">Controller</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">repository</span><span class="p">)</span>
    <span class="vi">@repository</span> <span class="o">=</span> <span class="n">repository</span>
    <span class="vi">@view</span> <span class="o">=</span> <span class="no">View</span><span class="o">.</span><span class="n">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">fetch_and_print_tasks</span>
    <span class="vi">@view</span><span class="o">.</span><span class="n">print_tasks</span><span class="p">(</span><span class="vi">@repository</span><span class="o">.</span><span class="n">all</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">add_task</span>
    <span class="n">description</span> <span class="o">=</span> <span class="vi">@view</span><span class="o">.</span><span class="n">get_new_task_description</span>
    <span class="vi">@repository</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="no">Task</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">description</span><span class="p">))</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">remove_task</span>
    <span class="n">index</span> <span class="o">=</span> <span class="vi">@view</span><span class="o">.</span><span class="n">get_task_index_to_remove</span>
    <span class="vi">@repository</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">mark_task_as_done</span>
    <span class="n">index</span> <span class="o">=</span> <span class="vi">@view</span><span class="o">.</span><span class="n">get_task_index_to_mark_as_done</span>
    <span class="n">task</span> <span class="o">=</span> <span class="vi">@repository</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">mark_as_done</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">require_relative</span> <span class="s1">'controller'</span>

<span class="k">class</span> <span class="nc">Router</span>
  <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">repository</span><span class="p">)</span>
    <span class="vi">@controller</span> <span class="o">=</span> <span class="no">Controller</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">repository</span><span class="p">)</span>
    <span class="kp">loop</span> <span class="k">do</span>
      <span class="vi">@controller</span><span class="o">.</span><span class="n">fetch_and_print_tasks</span>
      <span class="n">print_actions</span>
      <span class="n">action</span> <span class="o">=</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span><span class="o">.</span><span class="n">to_i</span>
      <span class="n">dispatch</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">print_actions</span>
    <span class="nb">puts</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">---"</span>
    <span class="nb">puts</span> <span class="s1">'What do you want to do?'</span>
    <span class="nb">puts</span> <span class="s1">'1 - Add a new task'</span>
    <span class="nb">puts</span> <span class="s1">'2 - Mark a task as done'</span>
    <span class="nb">puts</span> <span class="s1">'3 - Remove a task'</span>
    <span class="nb">puts</span> <span class="s1">'---'</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">action</span>
    <span class="k">when</span> <span class="mi">1</span> <span class="k">then</span> <span class="vi">@controller</span><span class="o">.</span><span class="n">add_task</span>
    <span class="k">when</span> <span class="mi">2</span> <span class="k">then</span> <span class="vi">@controller</span><span class="o">.</span><span class="n">mark_task_as_done</span>
    <span class="k">when</span> <span class="mi">3</span> <span class="k">then</span> <span class="vi">@controller</span><span class="o">.</span><span class="n">remove_task</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>Start the program</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">require_relative</span> <span class="s2">"tasks_repository"</span>
<span class="n">require_relative</span> <span class="s2">"router"</span>

<span class="n">repository</span> <span class="o">=</span> <span class="no">TasksRepository</span><span class="o">.</span><span class="n">new</span>
<span class="no">Router</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">repository</span><span class="p">)</span>
</code></pre></div>
<p>Get the code on GitHub! <a href="https://github.com/lewagon/oop-todolist">lewagon/oop-todolist</a></p>

<p><img src="./Le Wagon - Lectures_files/mvc-0827a4114c751e9b9a8e1c7950afc0c3.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/sequence_diagram_display_task-4ded8fd6d86f3561ee4fc21b02873240.png" alt=""></p>

<!--
title Display Tasks

Router->Controller: fetch_and_print_tasks
Controller->+TaskRepository: all
TaskRepository->-Controller: tasks
Controller->View: print_tasks(tasks)
-->

<p><img src="./Le Wagon - Lectures_files/sequence_diagram_add_new_task-6720358a0a62edb3001500733a94d5e5.png" alt=""></p>

<!--
title Add a new Task

Router->Controller: add_task
Controller->+View: get_new_task_description
View->-Controller: description
Controller->+Task: new(description)
Task->-Controller: task
Controller->TaskRepository: add(task)
-->

<h1>Object Oriented Programming - Modeling data</h1>

<h2>Real apps have several models</h2>

<h2>Example</h2>

<h3>Hospital</h3>

<h3>Patient</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Patient</span>
  <span class="kp">attr_reader</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:cured</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span>
    <span class="vi">@cured</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:cured</span><span class="o">]</span> <span class="o">||</span> <span class="kp">false</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">cure</span>
    <span class="vi">@cured</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Room</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Room</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
    <span class="vi">@capacity</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:capacity</span><span class="o">]</span> <span class="o">||</span> <span class="mi">0</span>
    <span class="vi">@patients</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:patients</span><span class="o">]</span> <span class="o">||</span> <span class="o">[]</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">full?</span>
    <span class="vi">@patients</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="vi">@capacity</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Assigned room to patient?</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">patient</span> <span class="o">=</span> <span class="no">Patient</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Bob"</span><span class="p">)</span>
<span class="n">patient</span><span class="o">.</span><span class="n">room</span>
<span class="c1"># =&gt; NoMethodError</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Patient</span>
  <span class="kp">attr_accessor</span> <span class="ss">:room</span>
  <span class="c1"># [...]</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Room</span>
  <span class="c1"># [...]</span>
  <span class="k">def</span> <span class="nf">add_patient</span><span class="p">(</span><span class="n">patient</span><span class="p">)</span>
    <span class="nb">fail</span> <span class="no">Exception</span><span class="p">,</span> <span class="s2">"Room is full!"</span> <span class="k">if</span> <span class="n">full?</span>
    <span class="n">patient</span><span class="o">.</span><span class="n">room</span> <span class="o">=</span> <span class="nb">self</span>
    <span class="vi">@patients</span> <span class="o">&lt;&lt;</span> <span class="n">patient</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<hr>

<h2>Persistence</h2>

<p>How will you store that in the database (CSV)?</p>

<h3>ids!</h3>

<h3>Rooms CSV file content</h3>

<p><img src="./Le Wagon - Lectures_files/rooms-5106ae23e5232a9f6f0ae3172919d659.png" alt=""></p>

<h3>Patients CSV file content</h3>

<p><img src="./Le Wagon - Lectures_files/patients-11d990258a3e85e8e5add8f9996d203d.png" alt=""></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Room</span>
  <span class="kp">attr_accessor</span> <span class="ss">:id</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Patient</span>
  <span class="kp">attr_accessor</span> <span class="ss">:id</span>
<span class="k">end</span>
</code></pre></div>
<p>There will be a <code>RoomRepository</code> and a <code>PatientRepository</code> setting the
<code>id</code> with an auto-increment strategy.</p>

<h3>Apart</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">people</span> <span class="o">=</span> <span class="o">[</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"John"</span><span class="p">),</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"Paul"</span><span class="p">)</span> <span class="o">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">CSV</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">csv</span><span class="o">|</span>
  <span class="n">csv</span> <span class="o">&lt;&lt;</span> <span class="o">[</span> <span class="s2">"id"</span><span class="p">,</span> <span class="s2">"name"</span> <span class="o">]</span>
  <span class="n">people</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">person</span><span class="o">|</span>
    <span class="n">csv</span> <span class="o">&lt;&lt;</span> <span class="o">[</span> <span class="n">person</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">person</span><span class="o">.</span><span class="n">name</span> <span class="o">]</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># id, name</span>
<span class="c1"># 1, John</span>
<span class="c1"># 2, Paul</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">people</span> <span class="o">=</span> <span class="o">[]</span>
<span class="no">CSV</span><span class="o">.</span><span class="n">foreach</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="ss">headers</span><span class="p">:</span> <span class="ss">:first_row</span><span class="p">,</span> <span class="ss">header_converters</span><span class="p">:</span> <span class="ss">:symbol</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
  <span class="n">people</span> <span class="o">&lt;&lt;</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">row</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">,</span> <span class="n">row</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<h2>Auto-increment</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">RoomRepository</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">csv_file</span><span class="p">)</span>
    <span class="vi">@csv_file</span> <span class="o">=</span> <span class="n">csv_file</span>
    <span class="vi">@rooms</span> <span class="o">=</span> <span class="o">[]</span>
    <span class="n">load_csv</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">room</span><span class="p">)</span>
    <span class="n">room</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="vi">@next_id</span>
    <span class="vi">@next_id</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="vi">@rooms</span> <span class="o">&lt;&lt;</span> <span class="n">room</span>
  <span class="k">end</span>

  <span class="kp">private</span>
  <span class="k">def</span> <span class="nf">load_csv</span>
    <span class="vi">@next_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># [...] # for each row, update @next_id to id of row</span>
    <span class="vi">@next_id</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Patient</span>
  <span class="kp">attr_accessor</span> <span class="ss">:room</span>
<span class="k">end</span>
</code></pre></div>
<p>The <code>PatientRepository</code> will have to store the <code>room.id</code> in the CSV. Plus, when
loading from the CSV, it will convert the <code>room_id</code> column into a <code>Room</code> instance
fetched from the <code>RoomRepository</code></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">RoomRepository</span>
  <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="c1"># Return the `Room` instance with the relevant id</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">PatientRepository</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">room_repository</span><span class="p">)</span>
    <span class="vi">@csv_file</span>         <span class="o">=</span> <span class="n">csv_filename</span>
    <span class="vi">@room_repository</span>  <span class="o">=</span> <span class="n">room_repository</span>
    <span class="vi">@patients</span>         <span class="o">=</span> <span class="o">[]</span>

    <span class="n">load_csv</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">load_csv</span>
    <span class="vi">@next_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="no">CSV</span><span class="o">.</span><span class="n">foreach</span><span class="p">(</span><span class="vi">@csv_file</span><span class="p">,</span> <span class="ss">headers</span><span class="p">:</span> <span class="ss">:first_row</span><span class="p">,</span> <span class="ss">header_converters</span><span class="p">:</span> <span class="ss">:symbol</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
      <span class="n">patient</span> <span class="o">=</span> <span class="no">Patient</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
      <span class="n">room</span>    <span class="o">=</span> <span class="vi">@room_repository</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">row</span><span class="o">[</span><span class="ss">:room_id</span><span class="o">].</span><span class="n">to_i</span><span class="p">)</span>
      <span class="n">room</span><span class="o">.</span><span class="n">add_patient</span><span class="p">(</span><span class="n">patient</span><span class="p">)</span>  <span class="c1"># patient room gets set!</span>
      <span class="vi">@patients</span> <span class="o">&lt;&lt;</span> <span class="n">patient</span>
      <span class="vi">@next_id</span> <span class="o">=</span> <span class="n">patient</span><span class="o">.</span><span class="n">id</span>
    <span class="k">end</span>
    <span class="vi">@next_id</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Serialization / Deserialization</h3>

<p>Storing a column <code>room_id</code> in <code>patients.csv</code> is a serialization of the reference to the
<code>Room</code> instance from <code>Patient</code>'s <code>room</code> instance variable.</p>

<hr>

<h2>Adding more models</h2>

<p><img src="./Le Wagon - Lectures_files/hospital-42d813a7f893e97e1ff1037eb4b3cad0.png" alt=""></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Doctor</span>
  <span class="kp">attr_accessor</span> <span class="ss">:id</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
    <span class="vi">@id</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Appointment</span>
  <span class="kp">attr_accessor</span> <span class="ss">:id</span><span class="p">,</span> <span class="ss">:doctor</span><span class="p">,</span> <span class="ss">:patient</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{})</span>
    <span class="vi">@id</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span>
    <span class="vi">@doctor</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:doctor</span><span class="o">]</span>
    <span class="vi">@patient</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:patient</span><span class="o">]</span>
    <span class="vi">@date</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:date</span><span class="o">]</span> <span class="o">||</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">AppointmentController</span>
  <span class="k">def</span> <span class="nf">create_appointment</span>
    <span class="n">doctor_id</span> <span class="o">=</span> <span class="vi">@view</span><span class="o">.</span><span class="n">ask_for_doctor_id</span>
    <span class="n">patient_id</span> <span class="o">=</span> <span class="vi">@view</span><span class="o">.</span><span class="n">ask_for_patient_id</span>
    <span class="n">appointment</span> <span class="o">=</span> <span class="no">Appointment</span><span class="o">.</span><span class="n">new</span>
    <span class="n">appointment</span><span class="o">.</span><span class="n">doctor</span> <span class="o">=</span> <span class="vi">@doctor_repository</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">doctor_id</span><span class="p">)</span>
    <span class="n">appointment</span><span class="o">.</span><span class="n">patient</span> <span class="o">=</span> <span class="vi">@patient_repository</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span>
    <span class="vi">@appointment_repository</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">appointment</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>Can you guess the CSV?</h2>

<p><img src="./Le Wagon - Lectures_files/appointments-9a8a043804d34707e43e07e1d900db9b.png" alt=""></p>

<hr>

<p>Your turn!</p>

<h1>Data Modeling &amp; ORM - Relational Database &amp; SQL</h1>

<h2>Why do we need databases?</h2>

<p>Store data. Persistently.</p>

<hr>

<h2>Excel</h2>

<p>Let's start with something we all know</p>

<h3>Example</h3>

<p>Let's store <strong>cities</strong> and their <strong>inhabitants</strong> using Excel. How would you do it?</p>

<p><img src="./Le Wagon - Lectures_files/02-excel-cities-inhabitants-f3f8f3c1c024b5b6d8b6e5504901d4fa.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/01-excel-cities-inhabitants-7c8e8c957802dc051163bb1dc7f1cea6.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/03-excel-cities-inhabitants-705db0156867535dba9c6b2fcb08eb31.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/04-excel-cities-inhabitants-8ba59747fa1d49a46b5b57104cd1736b.png" alt=""></p>

<h2>1:n relation (one to many)</h2>

<p>An inhabitant <strong>belongs to</strong> one city (or has one city)</p>

<hr>

<h2>Excel++</h2>

<p>Let's go further</p>

<p><img src="./Le Wagon - Lectures_files/01-excel-patients-ed27651c1810930341872913ea34d766.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/02-excel-doctors-7c64da682d0d5e8cbaa0d1d0561b99c6.png" alt=""></p>

<h2>Consultations ?</h2>

<ul>
<li><strong>One</strong> doctor can have <strong>many</strong> patients</li>
<li><strong>One</strong> patient can see <strong>many</strong> doctors</li>
</ul>

<p><img src="./Le Wagon - Lectures_files/03-excel-consultations-01-5e23508214beef65bd0429c2f09f2291.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/03-excel-consultations-02-d65f82d650bc7d726eb51272eeaa7cf8.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/04-excel-patients-with-id-01-ca90375f1411f0afd1e2028783983c94.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/04-excel-patients-with-id-02-f124839a0aa3561c7586edf53f0129b3.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/05-excel-doctors-a65d6ccbd912d5f8c8e3dc8e2394a966.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/03-excel-consultations-02-d65f82d650bc7d726eb51272eeaa7cf8.png" alt=""></p>

<p>George Abitbol (<strong><code>id = 1</code></strong>) has seen Doctor John Doe (<strong><code>id = 3</code></strong>)</p>

<p><img src="./Le Wagon - Lectures_files/06-excel-first-scenario-9a4a9e4d4ee1e593c7fd166dd9c82861.png" alt=""></p>

<h2>n:n relation (many to many)</h2>

<p>A patient <strong>has many</strong> doctors and a doctor <strong>has many</strong> patients.</p>

<p>You can download this example: <a href="https://karr.lewagon.org/assets/patients-doctors-cc7116f50822e8e5f4222fa6127891c9.xlsx">consultations.xslx</a></p>

<hr>

<h2>Relational Database</h2>

<h3>1:n</h3>

<p><img src="./Le Wagon - Lectures_files/cities-inhabitants-21334a74f578ea31c656e11483d3606c.png" alt=""></p>

<h3>n:n ?</h3>

<p><img src="./Le Wagon - Lectures_files/01-db-consultations-f60911623fab805a8b3660965d92b9d5.png" alt=""></p>

<h3>n:n</h3>

<p><img src="./Le Wagon - Lectures_files/02-db-consultations-full-b04ef6c3af370be9c2b43926d464b972.png" alt=""></p>

<h2>Vocabulary</h2>

<ul>
<li>A schema is composed of <strong>tables</strong>.</li>
<li>Each table has a set of <strong>columns</strong>.</li>
<li>When inserting data in a table, you create a <strong>record</strong> in a new <strong>row</strong>.</li>
</ul>

<h2>DB Schema Composer</h2>

<p><a href="http://db.lewagon.org/">db.lewagon.org</a></p>

<p>You can save/load schemas. Try with
<a href="https://karr.lewagon.org/assets/patients-doctors-641cf6e92e835470922ad77691474369.xml">patients-doctors.xml</a></p>

<hr>

<h2>Querying</h2>

<p>Retrieve data using the schema.</p>

<h2>SQL</h2>

<p>Structured Query Language</p>

<h3>Give me all patient names</h3>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span> <span class="k">FROM</span> <span class="n">patients</span>
</code></pre></div>
<h3>Give me all doctor names</h3>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span> <span class="k">FROM</span> <span class="n">doctors</span>
</code></pre></div>
<h3>Give me all you got about patients</h3>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">patients</span>
</code></pre></div>
<h3>Give me all patients of age 21</h3>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">patients</span> <span class="k">WHERE</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">21</span>
</code></pre></div>
<h3>Give me all doctors of cardiac surgery specialty</h3>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">doctors</span> <span class="k">WHERE</span> <span class="n">specialty</span> <span class="o">=</span> <span class="s1">'Cardiac Surgery'</span>
</code></pre></div>
<h3>Give me all surgery doctors</h3>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">doctors</span> <span class="k">WHERE</span> <span class="n">specialty</span> <span class="k">LIKE</span> <span class="s1">'%Surgery'</span>
</code></pre></div>
<h3>Give me all cardiac surgery doctors named Steve</h3>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">doctors</span>
<span class="k">WHERE</span> <span class="n">specialty</span> <span class="o">=</span> <span class="s1">'Cardiac Surgery'</span>
<span class="k">AND</span> <span class="n">first_name</span> <span class="o">=</span> <span class="s1">'Steve'</span>
</code></pre></div>
<h3>Give me all patients ordered by age</h3>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">patients</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">age</span> <span class="k">ASC</span>
</code></pre></div><div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">patients</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">age</span> <span class="k">DESC</span>
</code></pre></div>
<h3>How many doctors do I have?</h3>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">doctors</span>
</code></pre></div>
<h3>Count cardiac surgery doctors</h3>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">doctors</span> <span class="k">WHERE</span> <span class="n">specialty</span> <span class="o">=</span> <span class="s1">'Cardiac Surgery'</span>
</code></pre></div>
<h3>Count all doctors per specialty</h3>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="n">specialty</span>
<span class="k">FROM</span> <span class="n">doctors</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">specialty</span>
</code></pre></div>
<h3>Count all doctors per specialty, order by specialty</h3>

<p>You need to rename result column, with <code>AS</code>.</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="k">c</span><span class="p">,</span> <span class="n">specialty</span>
<span class="k">FROM</span> <span class="n">doctors</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">specialty</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="k">c</span> <span class="k">DESC</span>
</code></pre></div>
<hr>

<h2>Using 2 or more tables at once</h2>

<h3>Given this cities/inhabitants schema...</h3>

<p><img src="./Le Wagon - Lectures_files/cities-inhabitants-21334a74f578ea31c656e11483d3606c.png" alt=""></p>

<h3>... and this data</h3>

<p><img src="./Le Wagon - Lectures_files/sql_data_inhabitant_cities-72fdd0e8ffac544873487cb54d854b6e.png" alt=""></p>

<h3>Question: Give me all the inhabitants from Paris</h3>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">inhabitants</span> <span class="n">i</span>
<span class="k">JOIN</span> <span class="n">cities</span> <span class="k">c</span> <span class="k">ON</span> <span class="k">c</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">city_id</span>
<span class="k">WHERE</span> <span class="k">c</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">'Paris'</span>
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/sql_query_result_join_1-d2e1b810bbc45197c4de2f5c37ac1883.png" alt=""></p>

<h3>Question: Give me all the adults living Paris</h3>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">inhabitants</span> <span class="n">i</span>
<span class="k">JOIN</span> <span class="n">cities</span> <span class="k">c</span> <span class="k">ON</span> <span class="k">c</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">city_id</span>
<span class="k">WHERE</span> <span class="n">i</span><span class="p">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">18</span>
<span class="k">AND</span> <span class="k">c</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">'Paris'</span>
</code></pre></div>
<h2>Given this consultations schema</h2>

<p><img src="./Le Wagon - Lectures_files/02-db-consultations-full-b04ef6c3af370be9c2b43926d464b972.png" alt=""></p>

<h2>Question: For each consultation, give me its date, patient and doctor names</h2>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="k">c</span><span class="p">.</span><span class="n">created_at</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">last_name</span><span class="p">,</span> <span class="n">d</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">d</span><span class="p">.</span><span class="n">last_name</span>
<span class="k">FROM</span> <span class="n">consultations</span> <span class="k">c</span>
<span class="k">JOIN</span> <span class="n">patients</span> <span class="n">p</span> <span class="k">ON</span> <span class="k">c</span><span class="p">.</span><span class="n">patient_id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">id</span>
<span class="k">JOIN</span> <span class="n">doctors</span> <span class="n">d</span> <span class="k">ON</span> <span class="k">c</span><span class="p">.</span><span class="n">doctor_id</span> <span class="o">=</span> <span class="n">d</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</code></pre></div>
<h2>Going further</h2>

<p>You can read more about <code>INNER</code> (the default one), <code>LEFT OUTER</code>, <code>RIGHT OUTER</code> or <code>FULL OUTER</code> <code>JOIN</code> <a href="http://www.techonthenet.com/sql/joins.php">here</a> and <a href="http://www.lornajane.net/posts/2011/inner-vs-outer-joins-on-a-many-to-many-relationship">there</a>.</p>

<hr>

<h2>SQLite</h2>

<p>It is a simple database storing everything in <strong>one</strong> file. Great to quickly test, but not suited for production.</p>

<h3>Installation</h3>

<p>On OSX, run this:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>brew install sqlite
</code></pre></div>
<p>On Ubuntu, run this:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>sudo apt-get install sqlite libsqlite3-dev
</code></pre></div>
<h3>Quick start</h3>

<p>Create a new folder, and got into it.</p>

<p>Create a DB and start typing SQL queries:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>sqlite3 db.sqlite
</code></pre></div>
<p>It will create the <code>db.sqlite</code> file.</p>

<h2>Table creation</h2>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">cities</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="n">AUTOINCREMENT</span><span class="p">,</span>
  <span class="o">`</span><span class="n">name</span><span class="o">`</span> <span class="nb">VARCHAR</span>
<span class="p">);</span>
</code></pre></div>
<h2>Inserting and Querying</h2>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">cities</span> <span class="p">(</span><span class="s1">'name'</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Paris'</span><span class="p">);</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">cities</span> <span class="p">(</span><span class="s1">'name'</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'London'</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="p">.</span><span class="k">mode</span> <span class="k">column</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="p">.</span><span class="n">headers</span> <span class="k">on</span>
</code></pre></div><div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">cities</span><span class="p">;</span>
<span class="n">id</span>          <span class="n">name</span>
<span class="c1">----------  ----------</span>
<span class="mi">1</span>           <span class="n">Paris</span>
<span class="mi">2</span>           <span class="n">London</span>
</code></pre></div>
<h2>Help</h2>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">sqlite</span><span class="o">&gt;</span> <span class="p">.</span><span class="n">help</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">.exit                  Exit this program
.header(s) ON|OFF      Turn display of headers on or off
.read FILENAME         Execute SQL in FILENAME
.schema ?TABLE?        Show the CREATE statements
                         If TABLE specified, only show tables matching
                         LIKE pattern TABLE.
.show                  Show the current values for various settings
.tables ?TABLE?        List names of tables
                         If TABLE specified, only list tables matching
                         LIKE pattern TABLE.
[...]
</code></pre></div>
<h2>In 2 weeks: PostgreSQL</h2>

<h1>Data Modeling &amp; ORM - SQL CRUD</h1>

<h2>CRUD</h2>

<ul>
<li><strong>C</strong>reate<br></li>
<li><strong>R</strong>ead<br></li>
<li><strong>U</strong>pdate<br></li>
<li><strong>D</strong>elete<br></li>
</ul>

<hr>

<h2>Our example : A Doctors table</h2>

<h2>Table Schema</h2>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">doctors</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span>  <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="n">AUTOINCREMENT</span><span class="p">,</span>
  <span class="o">`</span><span class="n">name</span><span class="o">`</span> <span class="nb">TEXT</span><span class="p">,</span>
  <span class="o">`</span><span class="n">age</span><span class="o">`</span> <span class="nb">INTEGER</span><span class="p">,</span>
  <span class="o">`</span><span class="n">specialty</span><span class="o">`</span> <span class="nb">TEXT</span>
<span class="p">);</span>
</code></pre></div>
<h2>Sample Data</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">sqlite&gt; .mode column
sqlite&gt; .headers on
sqlite&gt; SELECT * FROM doctors;
id          name        age         specialty
----------  ----------  ----------  ----------------
1           John Smith  39          Anesthesiologist
2           Emma Reale  31          Cardiologist
</code></pre></div>
<p>You can download <a href="https://karr.lewagon.org/assets/02_sql_crud_doctors-cf43cfaf07025130e638de583d55e0ec.db">02<em>sql</em>crud_doctors.db</a></p>

<hr>

<h2>READ</h2>

<p><em>SQL keyword</em>: <strong><code>SELECT</code></strong><br><br></p>

<p><a href="http://www.techonthenet.com/sql/select.php"><strong><code>SELECT</code></strong></a> keyword to <strong>fetch records</strong> from the DB.</p>

<h3>Selecting all the rows</h3>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">doctors</span>
</code></pre></div>
<h3>Selecting a specific row</h3>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">doctors</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">2</span>
</code></pre></div>
<p>No quotes around <code>2</code> as it's a number.</p>

<hr>

<h2>CREATE</h2>

<p><em>SQL keyword</em>: <strong><code>INSERT</code></strong><br><br></p>

<p><a href="http://www.techonthenet.com/sql/insert.php"><strong><code>INSERT</code></strong></a> keyword to <strong>add records</strong> to a table.</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">doctors</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">specialty</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Dr. Dolladille'</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="s1">'Dentist'</span><span class="p">)</span>
</code></pre></div>
<p>inserts a new record:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sqlite&gt; SELECT * FROM doctors;
id          name        age         specialty
----------  ----------  ----------  ----------------
1           John Smith  39          Anesthesiologist
2           Emma Reale  31          Cardiologist
3           Dr. Dollad  45          Dentist
</code></pre></div>
<h2>Autoincrement</h2>

<p>Remember the schema definition:</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">doctors</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span>  <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="n">AUTOINCREMENT</span><span class="p">,</span>
  <span class="o">`</span><span class="n">name</span><span class="o">`</span> <span class="nb">TEXT</span><span class="p">,</span>
  <span class="o">`</span><span class="n">age</span><span class="o">`</span> <span class="nb">INTEGER</span><span class="p">,</span>
  <span class="o">`</span><span class="n">specialty</span><span class="o">`</span> <span class="nb">TEXT</span>
<span class="p">);</span>
</code></pre></div>
<h2>Let the DB handle <code>id</code></h2>

<p>Ensure that all records have a different id.</p>

<hr>

<h2>UPDATE</h2>

<p><em>SQL keyword</em>: <strong><code>UPDATE</code></strong><br><br></p>

<p><a href="http://www.techonthenet.com/sql/update.phpaAA11%60"><strong><code>UPDATE</code></strong></a> keyword to <strong>update records</strong> in a table.</p>

<h3>Update one record</h3>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">UPDATE</span> <span class="n">doctors</span> <span class="k">SET</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">'John Smith'</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">3</span>
</code></pre></div>
<hr>

<h2>DELETE</h2>

<p><em>SQL keyword</em>: <strong><code>DELETE</code></strong><br><br></p>

<p><a href="http://www.techonthenet.com/sql/delete.php"><strong><code>DELETE</code></strong></a> keyword to <strong>delete records</strong> from a table.</p>

<h3>Delete a single record</h3>

<p>The most used</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">doctors</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">32</span>
</code></pre></div>
<h3>Delete every record</h3>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">doctors</span>
</code></pre></div>
<p>Deletes every record in the <code>doctors</code> table.</p>

<hr>

<h2>SQlite and Ruby</h2>

<p>Some tips for the exercise</p>

<h2>Model</h2>

<p>We will use a model class (the M in MVC).</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/views/doctor.rb</span>
<span class="k">class</span> <span class="nc">Doctor</span>
  <span class="kp">attr_reader</span> <span class="ss">:id</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{})</span>
    <span class="vi">@id</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span>
    <span class="c1"># TODO: store other attributes as instanced variable (exercise)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Example</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">doctor</span> <span class="o">=</span> <span class="no">Doctor</span><span class="o">.</span><span class="n">new</span><span class="p">({</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">'John'</span><span class="p">,</span> <span class="ss">age</span><span class="p">:</span> <span class="mi">42</span> <span class="p">})</span>
<span class="n">doctor</span><span class="o">.</span><span class="n">id</span>
<span class="c1"># =&gt; nil</span>
</code></pre></div>
<h2>In-memory vs Stored in Database</h2>

<p><img src="./Le Wagon - Lectures_files/inmemory-model-d8535124a3ea88986e52d7a61f035de0.png" alt=""></p>

<p>You'll have to write the <code>save</code> method in your model.</p>

<h3>DB connection</h3>

<p>For today, we'll provide a global variable named <code>DB</code></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'sqlite3'</span>
<span class="no">DB</span> <span class="o">=</span> <span class="no">SQLite3</span><span class="o">::</span><span class="no">Database</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">"db/doctors.db"</span><span class="p">)</span>
</code></pre></div>
<p>Then you can use it in the model to run queries:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">rows</span> <span class="o">=</span> <span class="no">DB</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">'SELECT * FROM doctors'</span><span class="p">)</span>
</code></pre></div>
<h3>What about the id?</h3>

<p>Not your job to set it.
Your job to retrieve it and update the <code>@id</code> accordingly upon first save.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">DB</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"INSERT INTO doctors (name, age) VALUES ('John', 42)"</span><span class="p">)</span>
<span class="no">DB</span><span class="o">.</span><span class="n">last_insert_row_id</span>
</code></pre></div>
<h3>Something useful...</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">doctors</span> <span class="o">=</span> <span class="no">DB</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"SELECT name, age FROM doctors"</span><span class="p">)</span>
<span class="c1"># =&gt; [</span>
<span class="c1">#      [ "John Smith", 39 ],</span>
<span class="c1">#      [ "Emma Reale", 31 ]</span>
<span class="c1">#    ]</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">DB</span><span class="o">.</span><span class="n">results_as_hash</span> <span class="o">=</span> <span class="kp">true</span>
<span class="n">doctors</span> <span class="o">=</span> <span class="no">DB</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"SELECT name, age FROM doctors"</span><span class="p">)</span>
<span class="c1"># =&gt; [</span>
<span class="c1">#      { "name" =&gt; "John Smith", "age" =&gt; 39 , 0 =&gt; "John Smith", 1 =&gt; 39 },</span>
<span class="c1">#      { "name" =&gt; "Emma Reale", "age" =&gt; 31 , 0 =&gt; "Emma Reale", 1 =&gt; 31 }</span>
<span class="c1">#    ]</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">doctor</span> <span class="o">=</span> <span class="n">doctors</span><span class="o">.</span><span class="n">first</span>
<span class="nb">name</span> <span class="o">=</span> <span class="n">doctor</span><span class="o">[</span><span class="s2">"name"</span><span class="o">]</span>
<span class="n">age</span> <span class="o">=</span> <span class="n">doctor</span><span class="o">[</span><span class="s2">"age"</span><span class="o">]</span>
<span class="nb">puts</span> <span class="s2">"Doctor </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2"> is </span><span class="si">#{</span><span class="n">age</span><span class="si">}</span><span class="s2"> years old"</span>
</code></pre></div>
<h1>Data Modeling &amp; ORM - ActiveRecord Basics</h1>

<h2>Old School: SQL commands in code</h2>

<p>We did it. Painful</p>

<p>What we <strong>don't want</strong> to write</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">DB</span> <span class="o">=</span> <span class="no">SQLite3</span><span class="o">::</span><span class="no">Database</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">"db/database.sqlite3"</span><span class="p">)</span>
<span class="no">DB</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"INSERT INTO restaurants SET name = 'La Tour d</span><span class="se">\'</span><span class="s2">Argent'"</span><span class="p">)</span>
</code></pre></div>
<p>What we <strong>want</strong> to write</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"La Tour d'Argent"</span><span class="p">)</span>
<span class="n">restaurant</span><span class="o">.</span><span class="n">save</span>
</code></pre></div>
<p>Both will result in adding a row in database:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">+----+--------------------+
| id | name               |
+----+--------------------+
| 1  | "La Tour d'Argent" |
+----+--------------------+
</code></pre></div>
<p>We'll use the <a href="http://en.wikipedia.org/wiki/Active_record_pattern">Active Record Pattern</a> (2003)</p>

<blockquote>
<p>The active record pattern is a pattern found in software that stores its data in relational databases. [...] The interface of an object conforming to this pattern would include functions such as [<code>save</code>, <code>destroy</code>], plus [<strong>instance variables</strong>] that correspond [...] to the <strong>columns</strong> in the underlying database table.
<cite>Wikipedia</cite></p>
</blockquote>

<p>An <strong>object</strong> is represented as a <strong>row</strong> of a table in a relational database.</p>

<hr>

<h2>Active Record - Setup</h2>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>gem install activerecord
</code></pre></div>
<h2><code>rake</code></h2>

<p><code>rake</code> is a task launcher. All tasks are defined in a <code>Rakefile</code>.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rake -T
<span class="c"># rake rubocop     # Look for style guide offenses in your code</span>
<span class="c"># rake spec        # Run RSpec code examples</span>
</code></pre></div>
<p>Default task:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Rakefile</span>
<span class="n">task</span> <span class="ss">default</span><span class="p">:</span> <span class="o">[</span><span class="ss">:rubocop</span><span class="p">,</span> <span class="ss">:spec</span><span class="o">]</span>
</code></pre></div>
<h2>Database creation</h2>

<p>First specify a database</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="c1"># config/database.yml</span>
<span class="l-Scalar-Plain">development</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">adapter</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sqlite3</span>                   <span class="c1"># Database vendor (soon, postgres)</span>
  <span class="l-Scalar-Plain">database</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">db/development.sqlite3</span>   <span class="c1"># File path of the database</span>
</code></pre></div>
<p>Then create it, run this in your terminal</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rake db:create
</code></pre></div>
<h2>Droping database</h2>

<p>To get rid of your database and <strong>all its data</strong> (!!)</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rake db:drop
</code></pre></div>
<p><code>rake db:create</code> created a database with an empty schema.</p>

<p>You need to add tables, the one you figured out with
<a href="http://www.lewagon.org/">db.lewagon.org</a></p>

<h2>Migration</h2>

<p>Each time you change your schema (add / remove table), (add / remove column),
you need to create a <strong>schema migration</strong>.</p>

<p>It's a change in the <strong>structure</strong> of your schema, not the data.</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">...</span>
<span class="k">UPDATE</span> <span class="k">TABLE</span> <span class="p">...</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">...</span>
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/restaurants_schema-c47d3d752d2141087844730c2df008d2.png" alt=""></p>

<h2>Table creation migration</h2>

<p>ActiveRecord helps us to write schema migration with <strong>ruby</strong>, not SQL.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># db/migrate/20140725164644_create_restaurants.rb</span>
<span class="k">class</span> <span class="nc">CreateRestaurants</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:restaurants</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span>    <span class="ss">:name</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span>    <span class="ss">:address</span>
      <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span> <span class="ss">null</span><span class="p">:</span> <span class="kp">false</span> <span class="c1"># add 2 columns, `created_at` and `updated_at`</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>Run the migrations</h2>

<p>Once the schema migration is ready (the ruby file in <code>db/migrate</code> folder)</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rake db:migrate
</code></pre></div>
<p>ActiveRecord figures out which migration to run on your schema.</p>

<h2>Adding a column</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># 20140725174200_add_rating_to_restaurants.rb</span>
<span class="k">class</span> <span class="nc">AddRatingToRestaurants</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">add_column</span> <span class="ss">:restaurants</span><span class="p">,</span> <span class="ss">:rating</span><span class="p">,</span> <span class="ss">:integer</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rake db:migrate
</code></pre></div>
<h2>Live code</h2>

<p>https://github.com/lewagon/active-record-basics</p>

<hr>

<h2>Model</h2>

<p>We don't have a <code>Restaurant</code> class yet for our <code>restaurants</code> table.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/restaurant.rb</span>
<span class="k">class</span> <span class="nc">Restaurant</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
<span class="k">end</span>
</code></pre></div>
<p>No need for <code>attr_accessor</code> or <code>initialize</code>, ActiveRecord gives you all.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"La Tour d'Argent"</span><span class="p">)</span>
<span class="n">restaurant</span><span class="o">.</span><span class="n">name</span>
<span class="c1"># =&gt; "La Tour d'Argent"</span>

<span class="n">restaurant</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"La Tour d'Or"</span>
<span class="n">restaurant</span><span class="o">.</span><span class="n">name</span>
<span class="c1"># =&gt; "La Tour d'Or"</span>
</code></pre></div>
<h2>ActiveRecord naming convention</h2>

<p><img src="./Le Wagon - Lectures_files/ar_convention-f208d204d41b69d356677f31304ca30c.png" alt=""></p>

<h2>Remember the convention</h2>

<ul>
<li>Table name: <strong>lower<em>snake</em>case</strong>, <strong>plural</strong> form (store several rows)</li>
<li>Model class name: <strong>UpperCamelCase</strong>, <strong>singular</strong> form (mapped to 1 row)</li>
</ul>

<p>Rails is full of <strong>Convention</strong> over <strong>Configuration</strong>.</p>

<h2>Unleash the magic</h2>

<h2>Creating a record</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">new</span><span class="p">({</span>
  <span class="nb">name</span><span class="p">:</span> <span class="s2">"La Tour d'Argent"</span><span class="p">,</span>
  <span class="ss">address</span><span class="p">:</span> <span class="s2">"15 Quai de la Tournelle, 75005 Paris"</span>
<span class="p">})</span>
<span class="n">restaurant</span><span class="o">.</span><span class="n">save</span>
<span class="c1"># =&gt; INSERT INTO restaurants SET name = 'La Tour d\'Argent', address = '[...]'</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/restaurant.rb</span>
<span class="k">class</span> <span class="nc">Restaurant</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>

<span class="k">end</span>
</code></pre></div>
<blockquote>
<p>Where's the code?
<cite>A Java Developer</cite></p>
</blockquote>

<h2>Retrieving all records</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">restaurants</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">all</span>
<span class="c1"># =&gt; SELECT * FROM restaurants</span>
</code></pre></div>
<p>Calling <code>all</code> - a <strong>class method</strong> - on your model gives you an <code>Array</code>
of all your records for this model. Elements of the array are <strong>instances</strong>
of the model class <code>Restaurant</code>.</p>

<h2>Counting records of a table</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Restaurant</span><span class="o">.</span><span class="n">count</span>
</code></pre></div>
<p>(Faster than <code>Restaurant.all.length</code>, why?)</p>

<h2>Retrieving a specific record</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; SELECT * FROM restaurants WHERE id = 1</span>
</code></pre></div>
<p>The <code>restaurant</code> variable is an <strong>instance</strong> of the model class <code>Restaurant</code>.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">restaurant</span><span class="o">.</span><span class="n">name</span>
<span class="c1"># =&gt; "La Tour d'Argent"</span>

<span class="n">restaurant</span><span class="o">.</span><span class="n">address</span>
<span class="c1"># =&gt; "15 Quai de la Tournelle, 75005 Paris"</span>
</code></pre></div>
<h2>Updating an existing record</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">restaurant</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="s1">'14 Quai de la Tournelle, 75005 Paris'</span>
<span class="n">restaurant</span><span class="o">.</span><span class="n">save</span>
<span class="c1"># =&gt; UPDATE articles SET address = '14 Quai [...]' WHERE id = 1</span>
</code></pre></div>
<h2>Deleting a record</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">restaurant</span><span class="o">.</span><span class="n">destroy</span>
</code></pre></div>
<h2>Filtering records</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">restaurants</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">where</span><span class="p">({</span> <span class="ss">rating</span><span class="p">:</span> <span class="mi">3</span> <span class="p">})</span>
<span class="c1"># =&gt; SELECT * FROM restaurants WHERE rating = 3</span>
</code></pre></div>
<p>As for the <code>all</code> class method, <code>where</code> returns an <code>Array</code> of class model instances.</p>

<h2><code>where</code> <code>like</code></h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">restaurants</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">"name LIKE ?"</span><span class="p">,</span> <span class="s2">"%tour%"</span><span class="p">)</span>
<span class="c1"># =&gt; SELECT * FROM restaurants WHERE name LIKE '%tour%'</span>
</code></pre></div>
<h2>Finding by attribute</h2>

<p><code>find</code> =&gt; Returns <strong>one</strong> record</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s2">"La Tour d'Argent"</span><span class="p">)</span>
<span class="c1"># =&gt; SELECT * FROM restaurants WHERE name = 'La Tour d\'Argent' LIMIT 1</span>
</code></pre></div>
<h2>First and Last</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Article</span><span class="o">.</span><span class="n">first</span> <span class="c1"># Returns the first article in DB</span>
<span class="no">Article</span><span class="o">.</span><span class="n">last</span>  <span class="c1"># Returns the last article in DB</span>
</code></pre></div>
<p>Depends on the primary key (<code>id</code> column).</p>

<hr>

<h2>Seeds</h2>

<h3>Fake data as sample data</h3>

<h3>The Rails Way</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># db/seeds.rb</span>
<span class="n">tour_d_argent</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"La Tour d'Argent"</span><span class="p">)</span>
<span class="n">tour_d_argent</span><span class="o">.</span><span class="n">save</span>

<span class="n">chez_gladines</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Chez Gladines"</span><span class="p">)</span>
<span class="n">chez_gladines</span><span class="o">.</span><span class="n">save</span>
</code></pre></div>
<p>To run the seed, open your terminal:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rake db:seed
</code></pre></div>
<h2>Easily fake data</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="err">$</span> <span class="n">gem</span> <span class="n">install</span> <span class="n">faker</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># db/seeds.rb</span>
<span class="nb">require</span> <span class="s1">'faker'</span>

<span class="c1"># Creating 100 fake restaurants</span>
<span class="mi">100</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
  <span class="n">restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">new</span><span class="p">({</span>
    <span class="nb">name</span><span class="p">:</span> <span class="no">Faker</span><span class="o">::</span><span class="no">Company</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
    <span class="ss">address</span><span class="p">:</span> <span class="s2">"</span><span class="si">#{</span><span class="no">Faker</span><span class="o">::</span><span class="no">Address</span><span class="o">.</span><span class="n">street_address</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="no">Faker</span><span class="o">::</span><span class="no">Address</span><span class="o">.</span><span class="n">city</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
    <span class="ss">rating</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span><span class="o">.</span><span class="n">sample</span>
  <span class="p">})</span>
  <span class="n">restaurant</span><span class="o">.</span><span class="n">save</span>
<span class="k">end</span>
</code></pre></div>
<h2>See also</h2>

<ul>
<li><code>Faker::Address</code> / <code>Faker::Name</code> / <code>Faker::Lorem</code></li>
<li><code>Faker::Business</code> / <code>Faker::Commerce</code> / <code>Faker::Company</code></li>
<li><code>Faker::Internet</code> / <code>Faker::Number</code> / <code>Faker::PhoneNumber</code></li>
</ul>

<p><br><br></p>

<p>https://github.com/stympy/faker</p>

<h3>Growth Hacking</h3>

<p>Web scrapping (<a href="http://www.nokogiri.org/">nokogiri</a>)
or API calls (<a href="https://github.com/rest-client/rest-client">rest-client</a>)</p>

<h2>Fetch GitHub repos from @lewagon</h2>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>gem install rest-client
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s2">"json"</span>
<span class="nb">require</span> <span class="s2">"rest-client"</span>

<span class="n">response</span> <span class="o">=</span> <span class="no">RestClient</span><span class="o">.</span><span class="n">get</span> <span class="s2">"https://api.github.com/users/lewagon/repos"</span>
<span class="n">repos</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="c1"># =&gt; repos is an `Array` of `Hashes`.</span>

<span class="n">repos</span><span class="o">.</span><span class="n">size</span>
<span class="c1"># =&gt; 30</span>
</code></pre></div>
<p>Browser extension to install: JSONView (<a href="https://chrome.google.com/webstore/detail/jsonview/chklaanhfefbnpoihckbnefhakgolnmc">Chrome</a> / <a href="https://addons.mozilla.org/fr/firefox/addon/jsonview/">Firefox</a>)</p>

<hr>

<h2>Read this great doc</h2>

<p>http://guides.rubyonrails.org/active<em>record</em>basics.html</p>

<p>Skip the chapter 6 (Validations) and 7 (Callbacks) for now.</p>

<hr>

<h2>Your turn!</h2>

<h1>Data Modeling &amp; ORM - ActiveRecord Advanced</h1>

<h2>Topics</h2>

<ul>
<li>Associations</li>
<li>Validations</li>
</ul>

<hr>

<h2>Associations</h2>

<h3>Example: an Hospital</h3>

<h3>Same procedure. Always</h3>

<ol>
<li>Draw the tables in <a href="http://db.lewagon.org/">db.lewagon.org</a></li>
<li>Create the migrations</li>
<li>Create the models</li>
</ol>

<h3>A doctor has many interns</h3>

<p><img src="./Le Wagon - Lectures_files/01_hospital-4162886d1ec0b5ca9ef36cc155ca8015.png" alt=""></p>

<h3>Migration to create doctors</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># db/migrate/20141027100300_create_doctors.rb</span>
<span class="k">class</span> <span class="nc">CreateDoctors</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:doctors</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span>      <span class="ss">:first_name</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span>      <span class="ss">:last_name</span>
      <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span> <span class="ss">null</span><span class="p">:</span> <span class="kp">false</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Migration to create interns</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># db/migrate/20141027100400_create_interns.rb</span>
<span class="k">class</span> <span class="nc">CreateInterns</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:interns</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span>      <span class="ss">:first_name</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span>      <span class="ss">:last_name</span>
      <span class="n">t</span><span class="o">.</span><span class="n">references</span>  <span class="ss">:doctor</span><span class="p">,</span> <span class="ss">index</span><span class="p">:</span> <span class="kp">true</span>
      <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span> <span class="ss">null</span><span class="p">:</span> <span class="kp">false</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Note the <code>t.references</code>.</p>

<h3>Create 2 models</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/doctor.rb</span>
<span class="k">class</span> <span class="nc">Doctor</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:interns</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/intern.rb</span>
<span class="k">class</span> <span class="nc">Intern</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:doctor</span>
<span class="k">end</span>
</code></pre></div>
<p>Read it:</p>

<ul>
<li>A <strong><code>Doctor</code></strong> <strong><code>has_many</code></strong> <strong><code>interns</code></strong></li>
<li>An <strong><code>Intern</code></strong> <strong><code>belongs_to</code></strong> a <strong><code>doctor</code></strong></li>
</ul>

<h3>Create interns</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">doctor</span> <span class="o">=</span> <span class="no">Doctor</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">first_name</span><span class="p">:</span> <span class="s2">"Gregory"</span><span class="p">,</span> <span class="ss">last_name</span><span class="p">:</span> <span class="s2">"House"</span><span class="p">)</span>
<span class="n">doctor</span><span class="o">.</span><span class="n">save</span>

<span class="n">intern</span> <span class="o">=</span> <span class="no">Intern</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">first_name</span><span class="p">:</span> <span class="s2">"Allison"</span><span class="p">,</span> <span class="ss">last_name</span><span class="p">:</span> <span class="s2">"Cameron"</span><span class="p">)</span>
<span class="n">intern</span><span class="o">.</span><span class="n">doctor</span> <span class="o">=</span> <span class="n">doctor</span>
<span class="n">intern</span><span class="o">.</span><span class="n">save</span>
</code></pre></div>
<h3>Retrieve interns for a given doctor:</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">doctor</span> <span class="o">=</span> <span class="no">Doctor</span><span class="o">.</span><span class="n">last</span>
<span class="n">doctor</span><span class="o">.</span><span class="n">interns</span>
<span class="c1"># =&gt; `Array` of `Intern` instances</span>
</code></pre></div>
<h3>Let's add <code>patients</code> / <code>consultations</code> table</h3>

<p><img src="./Le Wagon - Lectures_files/02_hospital-1d6e15a5afba9409cc620677f7e03e2c.png" alt=""></p>

<h3>Migration to create patients</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># db/migrate/20141027114700_create_patients.rb</span>
<span class="k">class</span> <span class="nc">CreatePatients</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:patients</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span>      <span class="ss">:first_name</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span>      <span class="ss">:last_name</span>
      <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span> <span class="ss">null</span><span class="p">:</span> <span class="kp">false</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Migration to create consultations</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># db/migrate/20141027114800_create_consultations.rb</span>
<span class="k">class</span> <span class="nc">CreateConsultations</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:consultations</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="o">.</span><span class="n">references</span> <span class="ss">:doctor</span><span class="p">,</span> <span class="ss">index</span><span class="p">:</span> <span class="kp">true</span>
      <span class="n">t</span><span class="o">.</span><span class="n">references</span> <span class="ss">:patient</span><span class="p">,</span> <span class="ss">index</span><span class="p">:</span> <span class="kp">true</span>
      <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span> <span class="ss">null</span><span class="p">:</span> <span class="kp">false</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Create 2 new models</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/patient.rb</span>
<span class="k">class</span> <span class="nc">Patient</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:consultations</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/consultation.rb</span>
<span class="k">class</span> <span class="nc">Consultation</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:patient</span>
  <span class="n">belongs_to</span> <span class="ss">:doctor</span>
<span class="k">end</span>
</code></pre></div>
<h3>What about the <code>Doctor</code> model?</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/doctor.rb</span>
<span class="k">class</span> <span class="nc">Doctor</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:interns</span>

  <span class="c1"># Do not forget to add this! :)</span>
  <span class="n">has_many</span> <span class="ss">:consultations</span>
<span class="k">end</span>
</code></pre></div>
<h3>How can I retrieve patients for a given doctor?</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">doctor</span> <span class="o">=</span> <span class="no">Doctor</span><span class="o">.</span><span class="n">last</span>

<span class="n">patients</span> <span class="o">=</span> <span class="o">[]</span>
<span class="n">doctor</span><span class="o">.</span><span class="n">consultations</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">consultation</span><span class="o">|</span>
  <span class="n">patients</span> <span class="o">&lt;&lt;</span> <span class="n">consultation</span><span class="o">.</span><span class="n">patient</span>
<span class="k">end</span>
<span class="c1"># =&gt; `Array` of `Patient` instance</span>
</code></pre></div>
<h3>Use <code>:through</code></h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/doctor.rb</span>
<span class="k">class</span> <span class="nc">Doctor</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:interns</span>
  <span class="n">has_many</span> <span class="ss">:consultations</span>

  <span class="n">has_many</span> <span class="ss">:patients</span><span class="p">,</span> <span class="ss">through</span><span class="p">:</span> <span class="ss">:consultations</span>
<span class="k">end</span>
</code></pre></div>
<p>Then you can do: </p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">doctor</span> <span class="o">=</span> <span class="no">Doctor</span><span class="o">.</span><span class="n">last</span>
<span class="n">doctor</span><span class="o">.</span><span class="n">patients</span>
<span class="c1"># =&gt; `Array` of `Patient` instance</span>
</code></pre></div>
<h2>Migration to update a table</h2>

<p>Right now we've always created migrations to <code>create</code> new tables.
But 90% of the time, we write migrations to <code>update</code> a table schema (adding or removing columns).</p>

<h2>Adding / Removing a column</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># db/migrate/20141027200800_add_age_to_patients.rb</span>
<span class="k">class</span> <span class="nc">AddAgeToPatients</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">add_column</span> <span class="ss">:patients</span><span class="p">,</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">:integer</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># db/migrate/20141027201000_remove_age_from_patients.rb</span>
<span class="k">class</span> <span class="nc">RemoveAgeFromPatients</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">remove_column</span> <span class="ss">:patients</span><span class="p">,</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">:integer</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>Adding a foreign key</h2>

<p>Say that an intern has to take care of many patients.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># db/migrate/20141027201300_add_intern_reference_to_patients.rb</span>
<span class="k">class</span> <span class="nc">AddInternReferenceToPatients</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">add_reference</span> <span class="ss">:patients</span><span class="p">,</span> <span class="ss">:intern</span><span class="p">,</span> <span class="ss">index</span><span class="p">:</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>Live Code</h2>

<p>See <a href="https://github.com/lewagon/active-record-advanced">lewagon/karr-db-04-active-record-advanced</a></p>

<h3>Documentation</h3>

<p>http://guides.rubyonrails.org/association_basics.html</p>

<p>(There is also <code>has_one</code> which is rarely used, and <code>has_and_belongs_to_many</code> that you <a href="http://blog.flatironschool.com/post/35346328762/why-you-dont-need-has-and-belongs-to-many">should not use</a>)</p>

<hr>

<h2>Validations</h2>

<h3>Concept</h3>

<p>We want to <strong>check the validity</strong> of a model instance before saving it to the Database</p>

<h3>Example</h3>

<p>Suppose we have this:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">doctor</span> <span class="o">=</span> <span class="no">Doctor</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">first_name</span><span class="p">:</span> <span class="s2">"Gregory"</span><span class="p">)</span>
</code></pre></div>
<p>We want to enforce that all doctors have a <code>last_name</code>.</p>

<p>Therefore <code>doctor</code> is invalid.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">doctor</span><span class="o">.</span><span class="n">last_name</span> <span class="o">=</span> <span class="s2">"House"</span>
</code></pre></div>
<p>Now, it's valid.</p>

<h2>Presence validation</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/doctor.rb</span>
<span class="k">class</span> <span class="nc">Doctor</span>
  <span class="n">has_many</span> <span class="ss">:interns</span>
  <span class="n">has_many</span> <span class="ss">:consultations</span>
  <span class="n">has_many</span> <span class="ss">:patients</span><span class="p">,</span> <span class="ss">through</span><span class="p">:</span> <span class="ss">:consultations</span>

  <span class="n">validates</span> <span class="ss">:last_name</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>
</code></pre></div>
<h2>Checking if a model is valid:</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">doctor</span> <span class="o">=</span> <span class="no">Doctor</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">first_name</span><span class="p">:</span> <span class="s2">"Gregory"</span><span class="p">)</span>
<span class="n">doctor</span><span class="o">.</span><span class="n">valid?</span>
<span class="c1"># =&gt; false</span>
<span class="n">doctor</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">messages</span>
<span class="c1"># =&gt; { last_name: [ "can't be blank" ] }</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">doctor</span><span class="o">.</span><span class="n">last_name</span> <span class="o">=</span> <span class="s2">"House"</span>
<span class="n">doctor</span><span class="o">.</span><span class="n">valid?</span>
<span class="c1"># =&gt; true</span>
</code></pre></div>
<h2>Automatically happens</h2>

<p>When calling the <code>save</code> method when your instance is invalid, the record <strong>won't</strong> be inserted in the database!</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">doctor</span> <span class="o">=</span> <span class="no">Doctor</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">first_name</span><span class="p">:</span> <span class="s2">"Gregory"</span><span class="p">)</span>
<span class="n">doctor</span><span class="o">.</span><span class="n">save</span>
<span class="c1"># =&gt; false</span>
<span class="c1"># The record has not been inserted</span>
</code></pre></div>
<p><code>save</code> returns <code>true</code> if the record has been inserted.</p>

<p><code>save!</code> <strong>raises</strong> an Exception if the record is invalid.</p>

<h2>Validations type</h2>

<p>We've just seen the presence validation</p>

<h2>Uniqueness</h2>

<p>All doctors must have a unique <code>last_name</code>.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Doctor</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:last_name</span><span class="p">,</span> <span class="ss">uniqueness</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>
</code></pre></div>
<p>Or: All doctors must have a unique <code>first_name last_name</code></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Doctor</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:first_name</span><span class="p">,</span> <span class="ss">uniqueness</span><span class="p">:</span> <span class="p">{</span> <span class="ss">scope</span><span class="p">:</span> <span class="ss">:last_name</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div>
<h2>Length</h2>

<p>Doctor last names must be at least 3 characters</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">class Doctor &lt; ActiveRecord::Base
  validates :last_name, length: { minimum: 3 }
end
</code></pre></div>
<h2>Format</h2>

<p>Doctor email (column not yet created, migration!) must match a Regex.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">class Doctor &lt; ActiveRecord::Base
  validates :email, format: { with: /\A.*@.*\.com\z/ }
end
</code></pre></div>
<p>For all possibilities, read the <a href="http://guides.rubyonrails.org/active_record_validations.html">documentation</a></p>

<hr>

<h2>Happy Hacking!</h2>

<h1>Front-End Web Development - HTML &amp; CSS basics</h1>

<h2>Objectives of today</h2>

<ul>
<li>Learn HTML/CSS basics</li>
<li>Code a cool <a href="http://lewagon.github.io/html-css-challenges/04-advanced-selectors/">profile page</a></li>
<li>Put it online with <a href="https://pages.github.com/">Github Pages</a></li>
</ul>

<p><br></p>

<p><a href="http://lewagon.github.io/html-css-challenges/05-fixed-sidebar/">For most advanced</a></p>

<hr>

<h1>Front-developer setup</h1>

<h2>Sublime Packages</h2>

<ol>
<li>Open Sublime Text</li>
<li><code>Ctrl + Shift + p</code> =&gt; type <code>"Package Control: Install Package"</code></li>
<li>Search for packages in Package Control</li>
</ol>

<h3>Cool packages</h3>

<ul>
<li>Emmet</li>
<li>Color Picker (<code>  C</code>)</li>
<li>SCSS</li>
<li>Color Highlighter</li>
</ul>

<h2>Browser plugins</h2>

<ul>
<li><a href="http://fontface.ninja/">FontFace Ninja</a></li>
<li><a href="http://www.colorzilla.com/">Colorzilla</a> (use <a href="https://itunes.apple.com/fr/app/sip/id507257563?mt=12">Sip</a> on Mac)</li>
<li><a href="https://chrome.google.com/webstore/detail/jsonview/chklaanhfefbnpoihckbnefhakgolnmc">JSON view</a> to have nice JSON display in browser.</li>
<li><a href="https://chrome.google.com/webstore/detail/postman-rest-client/fdmmgilgnpjigdojojpjoooidkmcomcm">Postman</a> to simulate HTTP requests (useful when we will play with AJAX).</li>
</ul>

<h2>Live-code</h2>

<p>Let's create a project with:</p>

<ul>
<li>an <code>index.html</code> file</li>
<li>a <code>style.css</code> file</li>
<li>an <code>images</code> folder</li>
</ul>

<p><br></p>

<p><strong>Let's play 30 seconds</strong> with <a href="http://emmet.io/">Emmet</a> in the HTML and <a href="http://weslly.github.io/ColorPicker/">Color Picker</a> in the CSS.</p>

<hr>

<h2>Front-end languages</h2>

<p>The languages <strong>your browser speaks</strong></p>

<p><img src="./Le Wagon - Lectures_files/front-languages-13ea918e6ef5af631a3f604315306bba.png" alt=""></p>

<h2>Content</h2>

<p><img src="./Le Wagon - Lectures_files/html5-logo-7d612e8d7fd235d15ca74e7e5ecf5e2d.png" alt=""></p>

<p>This is what Google cares about. Think of SEO.</p>

<h2>Appearance</h2>

<p><img src="./Le Wagon - Lectures_files/css3-logo-c2192c25849582133d231a76a79fbe1b.png" alt=""></p>

<p>How does it look?</p>

<h2>Dynamic Behavior</h2>

<p><img src="./Le Wagon - Lectures_files/js-logo-41e4dd07ebbedbaecad75c63f22b533b.png" alt=""></p>

<p>Animate stuff on screen. Client-side form validation.</p>

<hr>

<p><img src="./Le Wagon - Lectures_files/html5-logo-7d612e8d7fd235d15ca74e7e5ecf5e2d.png" alt=""></p>

<p>It's a <strong>markup</strong> language (== structure)</p>

<h2>HTML</h2>

<p>Your page has different contents</p>

<p><img src="./Le Wagon - Lectures_files/content-c173b8012802b57e1c00ea17ee7cd8bf.png" alt=""></p>

<h2>HTML</h2>

<p>HTML tags help you <strong>identify</strong> content</p>

<p><img src="./Le Wagon - Lectures_files/content-with-tags-9586afd16167281a74f3e276ab5f5d56.png" alt=""></p>

<h2>HTML</h2>

<p>Hence, <strong>browser default styles</strong> will apply</p>

<p><img src="./Le Wagon - Lectures_files/content-with-tags-html-57df1a081702c245c73e86cd9e19839e.png" alt=""></p>

<h2>HTML</h2>

<p>And you will also be able to apply <strong>your own style rules</strong> if you want</p>

<p><img src="./Le Wagon - Lectures_files/content-tags-css-75d888950a4d0e098b15fad544a8ccbe.png" alt=""></p>

<h2>HTML Skeleton</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</code></pre></div>
<h2>HTML Skeleton</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>







<span class="nt">&lt;/html&gt;</span>
</code></pre></div>
<h2>HTML Skeleton</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>


  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>

  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>
<h2>HTML Skeleton - head</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;&lt;/meta&gt;</span>
    <span class="nt">&lt;title&gt;</span>TEST<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>

  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>
<h2>HTML Skeleton - head &amp; Google</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;head&gt;</span>

  <span class="nt">&lt;title&gt;</span>Le Wagon - Apprendre  coder - Bootcamp en ruby on Rails  Paris<span class="nt">&lt;/title&gt;</span>

  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">content=</span><span class="s">"Le Wagon est la meilleure formation au dveloppement web.."</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/google-card-3ea901c145df749d0359f222e9f9c577.png" alt=""></p>

<p>protip: max 55 characters for title &amp; 160 characters for description.</p>

<h2>HTML Skeleton - head &amp; Facebook</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">"og:title"</span> <span class="na">content=</span><span class="s">"Le Wagon - The French innovative coding school"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">"og:image"</span> <span class="na">content=</span><span class="s">"facebook-card.jpg"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">"og:description"</span> <span class="na">content=</span><span class="s">"Le Wagon is the best French coding school for entrepreneurs. Checkout by yourself the projects of our students. You will be impressed."</span><span class="nt">&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">"og:site_name"</span> <span class="na">content=</span><span class="s">"Le Wagon"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/head&gt;</span>
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/fb-card-3008de27ce130faae93a4a82269aa543.png" alt=""></p>

<h2>HTML Skeleton - head &amp; Twitter</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"twitter:card"</span> <span class="na">content=</span><span class="s">"summary_large_image"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"twitter:site"</span> <span class="na">content=</span><span class="s">"@Lewagonparis"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"twitter:title"</span> <span class="na">content=</span><span class="s">"Le Wagon - The French innovative coding school"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"twitter:description"</span> <span class="na">content=</span><span class="s">"Le Wagon is the best French coding school for entrepreneurs. Checkout by yourself the projects of our students. You will be impressed."</span><span class="nt">&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"twitter:creator"</span> <span class="na">content=</span><span class="s">"@Lewagonparis"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"twitter:image:src"</span> <span class="na">content=</span><span class="s">"http://twitter-card.jpg"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
</code></pre></div>
<h2>HTML Skeleton - body</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Hello world<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Hello buddies!<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>
<h2>Basic syntax</h2>

<p><img src="./Le Wagon - Lectures_files/element-syntax-7428ed25369763b4cdd80aea51b898c3.png" alt=""></p>

<h2>Example</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://www.lewagon.org"</span> <span class="na">target=</span><span class="s">"_blank"</span><span class="nt">&gt;</span>
  Le Wagon
<span class="nt">&lt;/a&gt;</span>
</code></pre></div>
<p>Result: <a href="http://www.lewagon.org/" target="_blank">Le Wagon</a></p>

<h3>Quizz</h3>

<ul>
<li>What is the element's name?</li>
<li>What is the element's content?</li>
<li>What are the 2 attributes (name and value)?</li>
</ul>

<h2>Titles</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;h1&gt;</span>[...]<span class="nt">&lt;/h1&gt;</span>  

<span class="nt">&lt;h2&gt;</span>[...]<span class="nt">&lt;/h2&gt;</span>
<span class="nt">&lt;h3&gt;</span>[...]<span class="nt">&lt;/h3&gt;</span>
<span class="nt">&lt;h4&gt;</span>[...]<span class="nt">&lt;/h4&gt;</span>
<span class="nt">&lt;h5&gt;</span>[...]<span class="nt">&lt;/h5&gt;</span>
<span class="nt">&lt;h6&gt;</span>[...]<span class="nt">&lt;/h6&gt;</span>
</code></pre></div>
<h2>Paragraphs</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;p&gt;</span>
  Lorem ipsum dolor sit amet, consectetur adipisicing elit.
  Veritatis laboriosam mollitia autem at ab omnis iure quis
  asperiores inventore eos nam aut iusto officiis deserunt
  nihil, sequi tempore impedit quae?
<span class="nt">&lt;/p&gt;</span>
</code></pre></div>
<h2>Emphasize</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;p&gt;</span>
  You can emphasize <span class="nt">&lt;em&gt;</span>some words<span class="nt">&lt;/em&gt;</span>,
  and even <span class="nt">&lt;strong&gt;</span>more if needed<span class="nt">&lt;/strong&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</code></pre></div>
<h2>Lists</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;h2&gt;</span>Shopping List<span class="nt">&lt;/h2&gt;</span>
<span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span>Milk<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>Butter<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="nt">&lt;h2&gt;</span>World Cup 2014<span class="nt">&lt;/h2&gt;</span>
<span class="nt">&lt;ol&gt;</span>
  <span class="nt">&lt;li&gt;</span>Germany<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>Argentina<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>Netherlands<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>Brazil<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ol&gt;</span>
</code></pre></div>
<h2>Images</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"logo.png"</span> <span class="na">alt=</span><span class="s">"Le Wagon logo"</span><span class="nt">&gt;</span>
</code></pre></div>
<h2>Tables</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;table&gt;</span>
  <span class="nt">&lt;thead&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;th&gt;</span>First Name<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Last Name<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
  <span class="nt">&lt;/thead&gt;</span>
  <span class="nt">&lt;tbody&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;td&gt;</span>Boris<span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span>Paillard<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
    [...]
  <span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</code></pre></div>
<h2>Forms</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;form&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"email"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Log in"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div>
<h2>Much more</h2>

<ul>
<li><a href="http://codeguide.co/">codeguide.co</a></li>
<li><a href="https://developer.mozilla.org/en/docs/Web/HTML/Element">MDN reference</a></li>
</ul>

<h2>Live-code</h2>

<p>Let's <strong>live-code</strong> a <a href="http://lewagon.github.io/html-css-challenges/01-profile-content/">HTML profile page without design</a></p>

<hr>

<p><img src="./Le Wagon - Lectures_files/css3-logo-c2192c25849582133d231a76a79fbe1b.png" alt=""></p>

<h2>Web without CSS ?</h2>

<p>Cut the <code>&lt;head&gt;</code> on <a href="http://lewagon.com/" target="_blank">lewagon.com</a> with Chrome dev tool.</p>

<h2>Linking stylesheet to HTML page</h2>

<p><img src="./Le Wagon - Lectures_files/linking-css-f366d591e0ddd8d1bdfac5e910607471.png" alt=""></p>

<h2>CSS syntax</h2>

<p><img src="./Le Wagon - Lectures_files/css-syntax-0a6f4548d76716b21baab46fe9f253db.png" alt=""></p>

<h2>CSS vocabulary</h2>

<p><img src="./Le Wagon - Lectures_files/css-vocabulary-43e703499fbe79a6aef80f7f29a2e5aa.png" alt=""></p>

<h2>Example</h2>

<p><img src="./Le Wagon - Lectures_files/css-syntax-example-b6fcfe1c2407245b31169fcac38b777f.png" alt=""></p>

<h2>Colors</h2>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">color</span><span class="o">:</span> <span class="nf">#FF530D</span><span class="o">;</span>
<span class="nt">color</span><span class="o">:</span> <span class="nt">rgb</span><span class="o">(</span><span class="nt">255</span><span class="o">,</span> <span class="nt">83</span><span class="o">,</span> <span class="nt">13</span><span class="o">);</span>
<span class="nt">color</span><span class="o">:</span> <span class="nt">rgba</span><span class="o">(</span><span class="nt">255</span><span class="o">,</span> <span class="nt">83</span><span class="o">,</span> <span class="nt">13</span><span class="o">,</span> <span class="nt">1</span><span class="nc">.0</span><span class="o">);</span>
</code></pre></div>
<div style="max-width: 100px; height: 100px; background-color: rgb(255, 83, 13); color: rgb(255, 83, 13) !important; margin: auto; border: 2px solid #999">x</div>

<h2>Colors - Tips</h2>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">body</span> <span class="p">{</span>
  <span class="k">color</span><span class="o">:</span> <span class="k">rgb</span><span class="p">(</span><span class="m">10</span><span class="o">,</span> <span class="m">10</span><span class="o">,</span> <span class="m">10</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><strong>RGB</strong> stands for <strong>R</strong>ed <strong>G</strong>reen <strong>B</strong>lue</li>
<li>each value is between 0 and 255</li>
<li>for same values of R, G and B, you are on the grey scale</li>
</ul>

<p><img src="./Le Wagon - Lectures_files/grey-scale-1e9e6470c54bcd99843d95bd5ff4ac9e.png" alt=""></p>

<h2>Text vs Background</h2>

<p><img src="./Le Wagon - Lectures_files/text-vs-bg-92481deeba0a79ae16e460d21e5f9e1e.png" alt=""></p>

<h2>Background image</h2>

<p><img src="./Le Wagon - Lectures_files/bg-image-311c2f95031e83cd302e7f2eeb67fcd1.png" alt=""></p>

<h2>Fonts - family (1)</h2>

<p><img src="./Le Wagon - Lectures_files/serif-c887918c775f97c51ae3d05fa5765bae.png" alt=""></p>

<h2>Fonts - family (2)</h2>

<p><img src="./Le Wagon - Lectures_files/sans-serif-aae3948d670220a241d9daaaae14068f.png" alt=""></p>

<h2>Fonts - family (3)</h2>

<p><img src="./Le Wagon - Lectures_files/monospace-8fcea768ae18c5b286024f5aabcf8e69.png" alt=""></p>

<h2>Fonts - size and spacing</h2>

<p><img src="./Le Wagon - Lectures_files/text-spaces-126e2f7b945bd1a0f4ad581c2e27a4e2.png" alt=""></p>

<h2>Fonts - colors</h2>

<p><img src="./Le Wagon - Lectures_files/text-colors-8546c520049faa848b5bedf6831edc09.png" alt=""></p>

<h2>Fonts - decoration</h2>

<p><img src="./Le Wagon - Lectures_files/text-decoration-07cd553df4dfdc684942fa0c1ca20124.png" alt=""></p>

<h2>Fonts - alignment</h2>

<p><img src="./Le Wagon - Lectures_files/text-align-acc6130e7c9b1db7c8aabd2517e6c429.png" alt=""></p>

<h2>Fonts - weight</h2>

<p><img src="./Le Wagon - Lectures_files/font-weight-15d69db599946c5665ccc313de205d7a.png" alt=""></p>

<h2>Fonts - Google fonts</h2>

<p>Make your shopping on <a href="http://www.google.com/fonts">Google fonts</a>.</p>

<h4>For main typo</h4>

<ul>
<li><strong>Open-Sans</strong> (don't beat around the bush)</li>
</ul>

<h4>For headers</h4>

<ul>
<li><strong>Raleway</strong></li>
<li><strong>Montserrat</strong></li>
<li><strong>Varela Round</strong></li>
<li><strong>Museo</strong></li>
</ul>

<h2>Fonts - Fontawesome</h2>

<p><a href="http://fortawesome.github.io/Font-Awesome/">Fontawesome</a> is a font of icons, really useful!</p>

<h2>Live-code</h2>

<p>Let's <strong>fix font and color design</strong> like in <a href="http://lewagon.github.io/html-css-challenges/02-fonts-colors/">this page</a> using Google fonts.</p>

<hr>

<h2>Div and box model</h2>

<h2>Real life...</h2>

<p><img src="./Le Wagon - Lectures_files/airbnb-0456ee59d3af0c63b824feee18e86b04.jpg" alt=""></p>

<h2>... is made of <code>&lt;div&gt;</code></h2>

<p><img src="./Le Wagon - Lectures_files/airbnb-with-div-43e18e215125c614ded0cb620f23d21d.jpg" alt=""></p>

<h2>Box model - content</h2>

<p><img src="./Le Wagon - Lectures_files/box-model-1-479b7f6a9486ed1c98cb5ce887f40010.png" alt=""></p>

<h2>Box model - padding &amp; margin</h2>

<p><img src="./Le Wagon - Lectures_files/box-model-2-2355d28f38ce0d5107218e066551656a.png" alt=""></p>

<h2>Box model - border</h2>

<p><img src="./Le Wagon - Lectures_files/box-model-3-799d0ed8ebe4dc29b4a03417ee94f401.png" alt=""></p>

<h2>Borders</h2>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">div</span> <span class="p">{</span>
  <span class="k">border-top</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="nb">red</span><span class="p">;</span>
  <span class="k">border-right</span><span class="o">:</span> <span class="m">2px</span> <span class="k">dotted</span> <span class="nb">black</span><span class="p">;</span>
  <span class="k">border-bottom</span><span class="o">:</span> <span class="m">1px</span> <span class="k">dashed</span> <span class="nb">green</span><span class="p">;</span>
  <span class="k">border-left</span><span class="o">:</span> <span class="m">2px</span> <span class="k">dotted</span> <span class="nb">black</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/borders-12381773304c4e5ff729b790388176e9.png" alt=""></p>

<h2>Border radius</h2>

<p><img src="./Le Wagon - Lectures_files/radius-1-6e572f5db62f4e6a21d10a10a92695bf.png" alt=""></p>

<h2>Border radius</h2>

<p><img src="./Le Wagon - Lectures_files/radius-2-484d5812f1feb4b30eb5cf517b7ea906.png" alt=""></p>

<h2>Box shadow</h2>

<p><img src="./Le Wagon - Lectures_files/box-shadow-d2dbac32f91e266586c45fc46d453f56.png" alt=""></p>

<h2>Units</h2>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="c">/* Absolute */</span>
<span class="nt">p</span> <span class="p">{</span>
  <span class="k">width</span><span class="o">:</span> <span class="m">50px</span><span class="p">;</span>
<span class="p">}</span>

<span class="c">/* Relative to parent */</span>
<span class="nt">p</span> <span class="p">{</span>
  <span class="k">width</span><span class="o">:</span> <span class="m">50%</span><span class="p">;</span>
<span class="p">}</span>

<span class="c">/* Relative to font size */</span>
<span class="nt">p</span> <span class="p">{</span>
  <span class="k">width</span><span class="o">:</span> <span class="m">2em</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2>Div design tips</h2>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">background</span><span class="o">:</span> <span class="nt">white</span><span class="o">;</span>                          <span class="c">/* White background */</span>
<span class="nt">padding</span><span class="o">:</span> <span class="nt">30px</span><span class="o">;</span>                              <span class="c">/* Internal space */</span>
<span class="nt">border-radius</span><span class="o">:</span> <span class="nt">4px</span><span class="o">;</span>                         <span class="c">/* Small radius */</span>
<span class="nt">box-shadow</span><span class="o">:</span> <span class="nt">1px</span> <span class="nt">1px</span> <span class="nt">3px</span> <span class="nt">rgba</span><span class="o">(</span><span class="nt">0</span><span class="o">,</span> <span class="nt">0</span><span class="o">,</span> <span class="nt">0</span><span class="o">,</span> <span class="nt">0</span><span class="nc">.1</span><span class="o">);</span> <span class="c">/* Subtle shadow */</span>
<span class="nt">border</span><span class="o">:</span> <span class="nt">1px</span> <span class="nt">solid</span> <span class="nt">rgba</span><span class="o">(</span><span class="nt">0</span><span class="o">,</span> <span class="nt">0</span><span class="o">,</span> <span class="nt">0</span><span class="o">,</span> <span class="nt">0</span><span class="nc">.1</span><span class="o">);</span>       <span class="c">/* OR subtle border */</span>
</code></pre></div>
<h4>Result:</h4>

<style>
#test-div {
  padding: 30px;
  font-size: 22px;
  font-weight: lighter;
  letter-spacing: 0px;
  background: white;
  border-radius: 4px;
  box-shadow: 1px 1px 3px rgba(0,0,0,0.1);
  line-height: 1.6;
  text-align: justify;
}
</style>

<div id="test-div">
  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eos voluptatibus, quis iure vel aliquam veritatis architecto fugiat necessitatibus? Quidem error explicabo nemo maiores voluptatem odio delectus ad, esse reprehenderit animi.
</div>

<h2>Div centering technique</h2>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">width</span><span class="o">:</span> <span class="nt">300px</span><span class="o">;</span>        <span class="c">/* Set the width */</span>
<span class="nt">margin</span><span class="o">:</span> <span class="nt">0</span> <span class="nt">auto</span><span class="o">;</span>      <span class="c">/* Set automatic margins on right/left */</span>
</code></pre></div>
<h4>Result:</h4>

<style>
#test-div-centered {
  padding: 30px;
  font-size: 22px;
  font-weight: lighter;
  letter-spacing: 0px;
  background: white;
  border-radius: 4px;
  box-shadow: 1px 1px 3px rgba(0,0,0,0.1);
  margin: 0 auto;
  width: 400px;
  line-height: 1.6;
  text-align: justify;
}
</style>

<div id="test-div-centered">
  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eos voluptatibus, quis iure vel aliquam veritatis architecto fugiat necessitatibus? Quidem error explicabo nemo maiores voluptatem odio delectus ad, esse reprehenderit animi.
</div>

<h2>Live-code</h2>

<p>Let's <strong>add divs</strong> in our HTML and play with the box model with Chrome Dev tool.</p>

<hr>

<h2>id and class</h2>

<h2>How do you style only the logo?</h2>

<p><img src="./Le Wagon - Lectures_files/id-dilemma-d0465f093ab5573b84d4d141b2843bbf.png" alt=""></p>

<h2>Name your tag with <code>id</code></h2>

<p><img src="./Le Wagon - Lectures_files/id-solution-59c0972676d355d061e6b0fc9b8d8dc7.png" alt=""></p>

<h2>How do you style your staff pictures?</h2>

<p><img src="./Le Wagon - Lectures_files/class-dilemma-c8b7bd17c5c0e79b8e310cdc2b4fc706.png" alt=""></p>

<h2>Name your tags with <code>class</code></h2>

<p><img src="./Le Wagon - Lectures_files/class-solution-785c51cdf7a3222219c1d2a4f7d77529.png" alt=""></p>

<h2>id or class?</h2>

<p><img src="./Le Wagon - Lectures_files/class-or-id-e11a7165584c54d7a2d27145c5e29ff2.png" alt=""></p>

<h2>Combine (1)</h2>

<p><img src="./Le Wagon - Lectures_files/combine-class-1-cfd29f063e631d479c5998f168c09e64.png" alt=""></p>

<h2>Combine (2)</h2>

<p><img src="./Le Wagon - Lectures_files/combine-class-2-32f12bf64fb46dc5dc771c508552b521.png" alt=""></p>

<h2>Combine (3)</h2>

<p><img src="./Le Wagon - Lectures_files/combine-class-3-8e08022a12952f7db01103bbe3dd31cd.png" alt=""></p>

<h2>Class naming - quizz</h2>

<p>Which one is <strong>more explicit</strong> (tells what it does)?</p>

<p><br></p>

<ul>
<li><code style="color:#FA4D6A">.btn-red</code> or <code style="color:#FA4D6A">.btn-signup</code>?</li>
<li><code style="color:#FA4D6A">.background-blue</code> or <code style="color:#FA4D6A">.background-home</code>?</li>
<li><code style="color:#FA4D6A">.img-user</code> or <code style="color:red">.img-circle</code>?</li>
</ul>

<p><br></p>

<p>Change your mindset =&gt; <strong>think graphical</strong></p>

<h2>Class naming - convention</h2>

<div class="text-center">
  <code style="color:#FA4D6A; font-size:50px;">.component-shape</code>
</div>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="c">/* Examples*/</span>
<span class="nc">.text-center</span>
<span class="nc">.text-justify</span>
<span class="nc">.btn-red</span>
<span class="nc">.btn-green</span>
<span class="nc">.btn-big</span>
<span class="nc">.list-inline</span>
<span class="nc">.form-horizontal</span>
<span class="nc">.img-rounded</span>
<span class="nc">.img-circle</span>
</code></pre></div>
<hr>

<h2>Selectors Summary</h2>

<h2>Element Selector</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html">[...]
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;h1&gt;</span>Hello World<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div>
<p>combined with
<code>css
/* style.css */
h1 {
  color: red;
  font-weight: bold;
}
</code>
makes the <code style="color:#FA4D6A">h1</code> elements red and bold.</p>

<h2>Class Selector</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html">[...]
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;p&gt;</span>This paragraph is not justified<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"text-justify"</span><span class="nt">&gt;</span>This one is<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"text-justify"</span><span class="nt">&gt;</span>This one also<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div>
<p>combined with</p>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="c">/* style.css */</span>
<span class="nc">.text-justify</span> <span class="p">{</span>
  <span class="k">text-align</span><span class="o">:</span> <span class="k">justify</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>will make only the second and third paragraphs justified.</p>

<h2>Id Selector</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;body&gt;
  &lt;div id="banner"&gt;
    &lt;h1&gt;Le Wagon&lt;/h1&gt;
    &lt;p&gt;We bring tech skills to creative people&lt;/p&gt;
  &lt;/div&gt;
&lt;/body&gt;
</code></pre></div>
<p>combined with</p>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="c">/* style.css */</span>
<span class="nf">#banner</span> <span class="p">{</span>
  <span class="k">background-image</span><span class="o">:</span> <span class="sx">url("example.jpg")</span><span class="p">;</span>
  <span class="k">background</span><span class="o">-</span><span class="k">size</span><span class="o">:</span> <span class="n">cover</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>will put an image background on the <strong>unique</strong> div with <code style="color:#FA4D6A">id="banner"</code>.</p>

<h2>Descendant Selectors</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;body&gt;
  &lt;div id="banner"&gt;
    &lt;h1&gt;Le Wagon&lt;/h1&gt;
    &lt;p&gt;We bring tech skills to creative people&lt;/p&gt;
  &lt;/div&gt;
&lt;/body&gt;
</code></pre></div>
<p>combined with</p>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="c">/* style.css */</span>
<span class="nf">#banner</span> <span class="nt">h1</span> <span class="p">{</span>
  <span class="k">color</span><span class="o">:</span> <span class="nb">white</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><code style="color:#FA4D6A">h1</code> <strong>children</strong> of the element <code style="color:#FA4D6A">id="banner"</code> will be white.</p>

<h2>Direct Children</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;body&gt;
  &lt;ul id="navigation"&gt;
    &lt;li&gt;&lt;a href="#"&gt;Home&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href="#"&gt;Team&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href="#"&gt;Contact&lt;/a&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/body&gt;
</code></pre></div>
<p>combined with</p>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="c">/* style.css */</span>
<span class="nf">#navigation</span> <span class="o">&gt;</span> <span class="nt">li</span> <span class="o">&gt;</span> <span class="nt">a</span> <span class="p">{</span>
  <span class="k">color</span><span class="o">:</span> <span class="nb">blue</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><code style="color:#FA4D6A">a</code> <strong>direct children</strong> of <code style="color:#FA4D6A">li</code> <strong>direct children</strong> of <code style="color:#FA4D6A">id="navigation"</code> will be blue.</p>

<h2>Grouping</h2>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="c">/* style.css */</span>
<span class="nt">h1</span><span class="o">,</span> <span class="nt">h2</span><span class="o">,</span> <span class="nt">h3</span> <span class="p">{</span>
  <span class="k">font-weight</span><span class="o">:</span> <span class="k">bold</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>is a shortcut syntax for</p>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="c">/* style.css */</span>
<span class="nt">h1</span> <span class="p">{</span>
  <span class="k">font-weight</span><span class="o">:</span> <span class="k">bold</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">h2</span> <span class="p">{</span>
  <span class="k">font-weight</span><span class="o">:</span> <span class="k">bold</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">[...]</span>
</code></pre></div>
<h2>Pseudo Classes</h2>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="c">/* style.css */</span>
<span class="nt">a</span> <span class="p">{</span>
  <span class="k">color</span><span class="o">:</span> <span class="nb">red</span><span class="p">;</span>
  <span class="k">text-decoration</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">a</span><span class="nd">:hover</span> <span class="p">{</span>
  <span class="k">text-decoration</span><span class="o">:</span> <span class="k">underline</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>will make links underlined when the mouse hovers over them.<br><br></p>

<p>See <a href="https://developer.mozilla.org/en/docs/Web/CSS/Pseudo-classes">other pseudo classes</a></p>

<h2>Quizz #1</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"text-red"</span><span class="nt">&gt;</span>
    Lorem ipsum dolor sit amet, consectetur adipisicing elit.
  <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div>
<p>combined with</p>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="c">/* style.css */</span>
<span class="nt">p</span> <span class="p">{</span>
  <span class="k">color</span><span class="o">:</span> <span class="nb">black</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.text-red</span> <span class="p">{</span>
  <span class="k">color</span><span class="o">:</span> <span class="nb">red</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2>Quizz #2</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;p</span> <span class="na">id=</span><span class="s">"bio"</span> <span class="na">class=</span><span class="s">"text-red"</span><span class="nt">&gt;</span>
    Lorem ipsum dolor sit amet, consectetur adipisicing elit.
  <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div>
<p>combined with</p>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="c">/* style.css */</span>
<span class="nc">.text-red</span> <span class="p">{</span>
  <span class="k">color</span><span class="o">:</span> <span class="nb">red</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#bio</span> <span class="p">{</span>
  <span class="k">color</span><span class="o">:</span> <span class="nb">green</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2>Specificity of Selectors</h2>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">p</span> <span class="p">{</span>                 <span class="c">/* least specific */</span>
  <span class="k">color</span><span class="o">:</span> <span class="nb">black</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.text-red</span> <span class="p">{</span>         <span class="c">/*               */</span>
  <span class="k">color</span><span class="o">:</span> <span class="nb">red</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#bio</span> <span class="p">{</span>              <span class="c">/* most specific  */</span>
  <span class="k">color</span><span class="o">:</span> <span class="nb">green</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Check out the <a href="http://specificity.keegan.st/">specificity calculator</a></p>

<h2>Live-code</h2>

<p>Let's <strong>finish our live-code</strong> and get this <a href="http://lewagon.github.io/html-css-challenges/04-advanced-selectors/">final result</a></p>

<p>Tonight, we will put our profile <strong>online</strong> using <a href="https://pages.github.com/">Github Pages</a>.</p>

<h2>Let's build your profile!</h2>

<h1>Front-End Web Development - CSS components design</h1>

<h2>Objectives of today</h2>

<ul>
<li>Improve your components culture</li>
<li>Code your own CSS library</li>
<li>Build pages using components</li>
</ul>

<p><br></p>

<ul>
<li><strong>First goal</strong>: code <a href="http://lewagon.github.io/ui-components">this CSS components library</a></li>
<li><strong>Second goal</strong>: build pages like <a href="http://lewagon.github.io/html-css-challenges/10-homepage-with-cards/">Airbnb Home</a> or <a href="http://lewagon.github.io/html-css-challenges/12-profile-with-products-bis/">Product Hunt dashboard</a> using components.</li>
</ul>

<h3>Components = lego bricks</h3>

<p><img src="./Le Wagon - Lectures_files/lego-blocks-54c997ccefd9e56a2a78045b1f03434e.png" alt=""></p>

<h3>Used to build pages</h3>

<p><img src="./Le Wagon - Lectures_files/lego-page-87bacdd0dbf988992a6e1cdb835b1b8e.png" alt=""></p>

<h3>10 components =&gt; 90% of your app design</h3>

<p>That's the secret of frontend developers</p>

<hr>

<h2>Components culture</h2>

<h3>Images</h3>

<p><img src="./Le Wagon - Lectures_files/avatars-200d51cca842d4cdb0629efcdab4eb74.png" alt=""></p>

<h3>Buttons</h3>

<p><img src="./Le Wagon - Lectures_files/buttons-546c31d72e975e20bea5813d50141528.png" alt=""></p>

<h3>Forms (Vertical or Inline)</h3>

<p><br></p>

<p><img src="./Le Wagon - Lectures_files/forms-fcb8c48b9ef483544637e2744f266798.png" alt=""></p>

<h3>Tabs / Nav</h3>

<p><img src="./Le Wagon - Lectures_files/tabs-b969c146b1c88e76aa5ee4d36807021d.png" alt=""></p>

<h3>Navbar</h3>

<p><img src="./Le Wagon - Lectures_files/navbars-dc6b47356c6fa80fbc9d61b3ad624fcd.png" alt=""></p>

<h3>Banner</h3>

<p><img src="./Le Wagon - Lectures_files/banner-ph-8abad835f4dd8ed807072d30db96a416.png" alt=""></p>

<h3>Card</h3>

<p><img src="./Le Wagon - Lectures_files/card-dribbble-7138acf2cdc773ada681059f77501f63.png" alt=""></p>

<p><small><i>Dribbble</i></small></p>

<h3>Card</h3>

<p><img src="./Le Wagon - Lectures_files/card-airbnb-5997eb5d7f89c0b21b6ad1133053cf3c.png" alt=""></p>

<p><small><i>Airbnb</i></small></p>

<h3>Card</h3>

<p><img src="./Le Wagon - Lectures_files/card-ph-bf6f37061795feee881441e21b3446c6.png" alt=""></p>

<p><small><i>Product Hunt</i></small></p>

<h3>List</h3>

<p><img src="./Le Wagon - Lectures_files/list-ph-38c8b7edec937e9e23c31101a06acd8a.png" alt=""></p>

<p><small><i>Product Hunt</i></small></p>

<h3>Dropdown</h3>

<p><img src="./Le Wagon - Lectures_files/dropdown-medium-6d694d9f80cac5b75ac15f376712880e.png" alt=""></p>

<p><small><i>Medium</i></small></p>

<hr>

<h2>Components - CSS organization</h2>

<h2>Organize CSS by components</h2>

<ul>
<li>Yesterday: one file <code>style.css</code></li>
<li>Today: one file <strong>per component</strong></li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">.
 css
&nbsp;&nbsp;  components
&nbsp;&nbsp; &nbsp;&nbsp;  avatar.css
&nbsp;&nbsp; &nbsp;&nbsp;  button.css
&nbsp;&nbsp; &nbsp;&nbsp;  card.css
&nbsp;&nbsp;  style.css
 index.html
</code></pre></div>
<h4>Style.css imports all other CSS files</h4>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="c">/* style.css */</span>
<span class="c">/* --- Import Google Fonts stylesheets --- */</span>
<span class="k">@import</span> <span class="nt">url</span><span class="o">(</span><span class="s2">"http://fonts.googleapis.com/</span>
<span class="s2">css?family=Open+Sans:400,300,700|Montserrat:400,700"</span><span class="o">)</span><span class="p">;</span>

<span class="c">/* --- Import Components stylesheets --- */</span>
<span class="k">@import</span> <span class="nt">url</span><span class="o">(</span><span class="s2">"components/avatar.css"</span><span class="o">)</span><span class="p">;</span>
<span class="k">@import</span> <span class="nt">url</span><span class="o">(</span><span class="s2">"components/button.css"</span><span class="o">)</span><span class="p">;</span>

<span class="c">/* --- Fonts --- */</span>
<span class="nt">body</span> <span class="p">{</span>
  <span class="k">font-family</span><span class="o">:</span> <span class="s2">"Open Sans"</span><span class="o">,</span> <span class="s2">"Helvetica"</span><span class="o">,</span> <span class="s2">"sans-serif"</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">h1</span><span class="o">,</span> <span class="nt">h2</span><span class="o">,</span> <span class="nt">h3</span> <span class="p">{</span>
  <span class="k">font-family</span><span class="o">:</span> <span class="s2">"Montserrat"</span><span class="o">,</span> <span class="s2">"sans-serif"</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Then <strong>one CSS link only</strong> in the HTML page</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"css/style.css"</span><span class="nt">&gt;</span>
</code></pre></div>
<h2>Basic component</h2>

<p>Let's <strong>live-code</strong> <a href="http://lewagon.github.io/ui-components/#avatar">avatar</a> and <a href="http://lewagon.github.io/ui-components/#button">button</a> components</p>

<p><img src="./Le Wagon - Lectures_files/avatar-button-922c5e8f1d269a19d0768f8fe8a37f7d.png" alt=""></p>

<hr>

<h2>Advanced CSS patterns</h2>

<p>For advanced components, we need advanced techniques</p>

<h2>1 - Gradient filter</h2>

<ul>
<li>Background pictures are too contrasted or of poor quality.</li>
<li>They need a filter.</li>
</ul>

<h3>Linear gradient - theory</h3>

<p><img src="./Le Wagon - Lectures_files/gradient-30eec018455e447812da6de72efe57fd.png" alt=""></p>

<p>Forget about theory, <strong>just play with parameters in the browser!</strong></p>

<h3>Linear gradient - code</h3>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nc">.banner</span> <span class="p">{</span>
  <span class="k">background-image</span><span class="o">:</span> <span class="n">linear</span><span class="o">-</span><span class="n">gradient</span><span class="p">(</span><span class="m">135</span><span class="n">deg</span><span class="o">,</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">.</span><span class="m">8</span><span class="p">)</span> <span class="m">0%</span><span class="o">,</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">.</span><span class="m">2</span><span class="p">)</span> <span class="m">50%</span><span class="p">)</span><span class="o">,</span>
              <span class="sx">url('background.jpg')</span><span class="p">;</span>
  <span class="k">background</span><span class="o">-</span><span class="k">size</span><span class="o">:</span> <span class="n">cover</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/gradient-example-36214325e8257ac116409cd04a3e0193.png" alt=""></p>

<h3>User-uploaded pictures</h3>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nc">.banner</span> <span class="p">{</span>
  <span class="k">background</span><span class="o">-</span><span class="k">size</span><span class="o">:</span> <span class="n">cover</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Put background image and gradient <strong>in your HTML</strong></p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"banner"</span> <span class="na">style=</span><span class="s">"background-image: linear-gradient(135deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.2) 50%), url('uploaded_by_user.jpg');"</span><span class="nt">&gt;</span>
  ...
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<h2>2 - Relative &gt; Absolute pattern</h2>

<p>When you need to position elements precisely in a div</p>

<h2>Position relative</h2>

<ul>
<li>Offset from <strong>initial</strong> position</li>
<li>A way to <strong>pin an element</strong></li>
</ul>

<p><img src="./Le Wagon - Lectures_files/pin-1e728b1166b3ef124c915882b15c5df1.png" alt=""></p>

<p>Lets offset the logo on https://www.lewagon.com/</p>

<h2>Position absolute</h2>

<ul>
<li>Offset from <strong>1st positioned parent</strong></li>
<li>If no pinned parent =&gt; <strong>body</strong></li>
</ul>

<h2>Relative &gt; Absolute</h2>

<p>The <strong>ultimate CSS pattern</strong>.</p>

<h2>Relative &gt; Absolute</h2>

<p>1) <strong>Pin</strong> a div with <code style="color:#FA4D6A">position: relative</code></p>

<p><img src="./Le Wagon - Lectures_files/relative-absolute-1-6749da6e7f705f8e9e0e95686a65c398.png" alt=""></p>

<h2>Relative &gt; Absolute</h2>

<p>2) Put an inside div with <code style="color:#FA4D6A">position: absolute</code></p>

<p><img src="./Le Wagon - Lectures_files/relative-absolute-2-a430badacbc9f0ffa75c88a8439b1136.png" alt=""></p>

<h2>Relative &gt; Absolute</h2>

<p>3) Now you can play with inside div</p>

<p><img src="./Le Wagon - Lectures_files/relative-absolute-3-498ba901c9fb86ee8903ba282adb4a68.png" alt=""></p>

<h2>Relative &gt; Absolute</h2>

<p><img src="./Le Wagon - Lectures_files/relative-absolute-4-534434ea6d25bca9dca8bf4152c1f93a.png" alt=""></p>

<h2>Card design</h2>

<p>Let's <strong>live-code</strong> a <a href="http://lewagon.github.io/ui-components/#card">card</a> component using:</p>

<ol>
<li>A linear gradient filter</li>
<li>The <strong>Relative &gt; absolute</strong> pattern</li>
</ol>

<p><img src="./Le Wagon - Lectures_files/card-1594577fa37ef93547ce91b88f9eb90e.png" alt=""></p>

<hr>

<h2>Flexbox</h2>

<h4>Awesome for:</h4>

<ul>
<li>Vertically align items</li>
<li>Build small component grids (ex: for tabs)</li>
</ul>

<h4>Not adapted for:</h4>

<ul>
<li>Positioning in corners: use the Relative &gt; Absolute pattern</li>
<li>For the main responsive grid, use Bootstrap</li>
</ul>

<h2>Flexbox - vocabulary</h2>

<p><img src="./Le Wagon - Lectures_files/flex-vocabulary-2356723b57f11f8ed599be42db72bf35.png" alt=""></p>

<h2>Flexbox - basics</h2>

<p><img src="./Le Wagon - Lectures_files/flex-1-6f9074f545a4d429fa439fc19759f794.png" alt=""></p>

<h2>Flexbox - space around</h2>

<p><img src="./Le Wagon - Lectures_files/flex-2-9d6f2b457c8d0f384ea93f00cd7da425.png" alt=""></p>

<h2>Flexbox - space between</h2>

<p><img src="./Le Wagon - Lectures_files/flex-3-035ffea6c59c8cd0c31ca944c84137b4.png" alt=""></p>

<h2>Flexbox - align items</h2>

<p><img src="./Le Wagon - Lectures_files/flex-4-e0cb74df14ca2e7a436940d323cce3a8.png" alt=""></p>

<h2>Flexbox - item behavior</h2>

<p><img src="./Le Wagon - Lectures_files/flex-grow-shrink-a50191d66f774266ae5b8a9e1a03ce98.png" alt=""></p>

<h2>Flexbox - grow example</h2>

<p><img src="./Le Wagon - Lectures_files/flex-5-d7a627dea34901a309195b1b5e1357f4.png" alt=""></p>

<h2>Flexbox - Banner</h2>

<p>Let's <strong>live-code</strong> a <a href="http://lewagon.github.io/ui-components/#banner">banner</a> (centering content on horizontal &amp; vertical axis)</p>

<p><img src="./Le Wagon - Lectures_files/banner-ph-8abad835f4dd8ed807072d30db96a416.png" alt=""></p>

<h2>Flexbox - Tabs</h2>

<p>Let's <strong>live-code</strong> a <a href="http://lewagon.github.io/ui-components/#tabs">tabs</a> building a simple grid in flexbox</p>

<p><img src="./Le Wagon - Lectures_files/tabs-b969c146b1c88e76aa5ee4d36807021d.png" alt=""></p>

<h2>Flexbox - List</h2>

<p>Let's <strong>live-code</strong> <a href="http://lewagon.github.io/ui-components/#list">list items</a> setting a <code>flex-grow</code> on the central description.</p>

<p><img src="./Le Wagon - Lectures_files/list-ph-38c8b7edec937e9e23c31101a06acd8a.png" alt=""></p>

<hr>

<h2>Building pages with components</h2>

<h2>What's a layout?</h2>

<ul>
<li>Components = <strong>elementary bricks</strong></li>
<li>Layout = <strong>global structure</strong></li>
</ul>

<h2>Two fundamental layout components</h2>

<h3>Container &amp; Wrapper</h3>

<h3>Container</h3>

<p>Full-width content is ugly. You should put page content in a container.</p>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nc">.container</span> <span class="p">{</span>
  <span class="k">margin</span><span class="o">:</span> <span class="m">0</span> <span class="k">auto</span><span class="p">;</span>
  <span class="k">width</span><span class="o">:</span> <span class="m">970px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/container-96a66bc4cc61652e18b764a2ff42085b.png" alt=""></p>

<h3>Wrapper</h3>

<p>You often need a background color (full-width) around content.</p>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nc">.wrapper</span> <span class="p">{</span>
  <span class="k">background-color</span><span class="o">:</span> <span class="nb">lightgrey</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/wrapper-2b324bc07764942613711446d4cc5607.png" alt=""></p>

<h2>Layout - use cases</h2>

<p><strong>Can you decompose each page into simple components?</strong></p>

<h3>Airbnb home?</h3>

<p><img src="./Le Wagon - Lectures_files/airbnb-home-678599cbd2420b6c2d9875a027f43b90.png" alt=""></p>

<h3>Solution</h3>

<p><img src="./Le Wagon - Lectures_files/airbnb-home-structure-e9cc9310630f3db4ef76e2ccfcf61418.png" alt=""></p>

<h3>Airbnb dashboard?</h3>

<p><img src="./Le Wagon - Lectures_files/airbnb-dashboard-561a0cca515bbd4130e22cb88f2132a8.png" alt=""></p>

<h3>Solution</h3>

<p><img src="./Le Wagon - Lectures_files/airbnb-dashboard-structure-7826b83416736d4497725da340f940ae.png" alt=""></p>

<h3>Product Hunt dashboard?</h3>

<p><img src="./Le Wagon - Lectures_files/ph-dashboard-baa5074ffbe4aabf9cff8ad2c8acd00a.png" alt=""></p>

<h3>Solution</h3>

<p><img src="./Le Wagon - Lectures_files/ph-dashboard-structure-a211e7d85cff2bb60141c2334c1dce5c.png" alt=""></p>

<h2>More Advanced layout</h2>

<p>Wait for Bootstrap grid tomorrow.</p>

<h2>Let's build your CSS components library!</h2>

<h1>Front-End Web Development - (1) Design resources &amp; tips</h1>

<h2>Graphical tool - Sketch</h2>

<p><img src="./Le Wagon - Lectures_files/sketch-362705e90cabc3ba1f07515cd2befafb.png" alt=""></p>

<p>http://bohemiancoding.com/sketch/</p>

<hr>

<h2>UI do's and don'ts</h2>

<p><a href="https://goodui.org/">https://goodui.org/</a></p>

<hr>

<h2>Pictures</h2>

<ul>
<li><a href="https://www.flickr.com/search/?q=quai%20de%20seine">Flickr</a>: exhaustive results</li>
<li><a href="http://thestocks.im/">thestocks</a>: High-res background images</li>
<li><a href="http://unsplash.it/">Unsplash.it</a>: High-res placeholders</li>
<li><a href="https://medium.com/@dustin/stock-photos-that-dont-suck-62ae4bcbe01b">Medium - stock photos that don't suck</a></li>
</ul>

<hr>

<h2>Colors</h2>

<ul>
<li><a href="http://coolors.co/">Coolors</a></li>
<li><a href="http://colorhunt.co/">Color Hunt</a></li>
</ul>

<hr>

<h2>Background gradient</h2>

<p><a href="http://uigradients.com/#">UI gradients</a></p>

<hr>

<h2>Fonts - Google fonts</h2>

<p>Make your shopping on <a href="http://www.google.com/fonts">Google fonts</a>. Our advice:</p>

<h4>For main typo</h4>

<ul>
<li><strong>Open-Sans</strong></li>
</ul>

<h4>For headers</h4>

<ul>
<li><strong>Raleway</strong></li>
<li><strong>Montserrat</strong></li>
<li><strong>Varela Round</strong></li>
<li><strong>Museo</strong></li>
</ul>

<hr>

<h2>Fonts - Hack on Github</h2>

<h4>Look for <code>.ttf/.eot/.woff/etc..</code> files on Github.</h4>

<ul>
<li><strong>Avenir</strong></li>
<li><strong>Proxima Nova</strong></li>
<li><strong>Gotham Rounded</strong></li>
<li><strong>Brandon</strong></li>
</ul>

<hr>

<h2>Icons</h2>

<h4>Basics</h4>

<ul>
<li><a href="http://fortawesome.github.io/Font-Awesome/">Fontawesome</a>: font of icons</li>
<li><a href="http://thenounproject.com/">TheNounProject</a>: the most famous</li>
<li><a href="http://psddd.co/">PSDDD</a>: freebies from Dribbble</li>
</ul>

<h4>Cool free packs</h4>

<ul>
<li><a href="https://nucleoapp.com/">NucleoApp</a></li>
<li><a href="http://www.streamlineicons.com/">Streamline Icons</a></li>
<li><a href="http://www.kameleon.pics/">Kameleon</a></li>
</ul>

<hr>

<h2>HTML/CSS snippets</h2>

<ul>
<li><a href="http://codepen.io/">Codepen</a></li>
<li><a href="http://give-n-go.co/">Give'n'go</a></li>
</ul>

<hr>

<h2>Inspiration</h2>

<ul>
<li>http://www.awwwards.com/</li>
<li>https://dribbble.com/</li>
<li>http://littlebigdetails.com/</li>
<li>http://freebbble.com/</li>
<li>http://www.calltoidea.com/</li>
<li>http://uptodate.frontendrescue.org/</li>
</ul>

<hr>

<h2>Of course - The best source</h2>

<p>http://alumni.lewagon.org</p>

<h1>Front-End Web Development - (2) Bootstrap</h1>

<p><img src="./Le Wagon - Lectures_files/bootstrap-d863f3d29e5008bd9b32cf1efad98a58.png" alt=""></p>

<h2>Why Bootstrap?</h2>

<ul>
<li>For rich components, we have our own <a href="http://lewagon.github.io/ui-components/">CSS library</a></li>
<li>For standard ones, let's not re-invent the wheel!</li>
<li>We also need a responsive grid system</li>
</ul>

<h2>Start with Bootstrap boilerplate</h2>

<p>https://github.com/lewagon/bootstrap-boilerplate</p>

<hr>

<h2>Basic components</h2>

<h2>Basic components - semantic scheme</h2>

<p><img src="./Le Wagon - Lectures_files/five-colors-b07346717754af1e61303876b60615ae.png" alt=""></p>

<h2>Basic components - alignment</h2>

<p><img src="./Le Wagon - Lectures_files/text-align-87c5592ee4da725ae46b0794c66d65c8.png" alt=""></p>

<h2>Basic components - list inline</h2>

<p><img src="./Le Wagon - Lectures_files/list-inline-854539a095f27ee5b7bc3d7886806197.png" alt=""></p>

<h2>Basic components - <a href="http://getbootstrap.com/css/#images">images</a></h2>

<p><img src="./Le Wagon - Lectures_files/images-e82e70912ad6bdf069f488d822b04c2f.png" alt=""></p>

<h2>Basic components - <a href="http://getbootstrap.com/css/#buttons">buttons</a></h2>

<p><img src="./Le Wagon - Lectures_files/buttons-1b5e939e0c4c84eefdc61365c5dc217c.png" alt=""></p>

<h2>Basic components - <a href="http://getbootstrap.com/css/#forms">forms</a></h2>

<p><img src="./Le Wagon - Lectures_files/form-d35496ef36cd59230f7ce2b08cb5c325.png" alt=""></p>

<h2>Basic components - <a href="http://getbootstrap.com/css/#forms">forms</a> with label</h2>

<p><img src="./Le Wagon - Lectures_files/form-with-label-a749316cda38357023aab27b8640b702.png" alt=""></p>

<h2>Basic components - <a href="http://getbootstrap.com/css/#forms">forms</a> inline</h2>

<p><img src="./Le Wagon - Lectures_files/inline-form-b787ad587b0c33494f1916d25794c980.png" alt=""></p>

<h2>Documentation</h2>

<p>http://getbootstrap.com/css/</p>

<hr>

<h2>Advanced Components</h2>

<h2>Advanced Components - <a href="http://getbootstrap.com/components/#labels">labels</a></h2>

<p><img src="./Le Wagon - Lectures_files/labels-9bd19bf36033287ebd09a4d3504d9ff6.png" alt=""></p>

<h2>Advanced Components - <a href="http://getbootstrap.com/components/#nav">nav</a></h2>

<p>Ugly!!!! let's use <a href="http://lewagon.github.io/ui-components/#tabs">Le Wagon tabs</a> instead</p>

<h2>Advanced Components - <a href="http://getbootstrap.com/components/#alerts">alerts</a></h2>

<p><img src="./Le Wagon - Lectures_files/alerts-bbd33fd62eec3888f0b5d3ab41cf4919.png" alt=""></p>

<h2>Advanced Components - <a href="http://getbootstrap.com/components/#navbar">navbar</a></h2>

<p>Ugly!!!! let's use <a href="http://lewagon.github.io/ui-components/#navbar">Le Wagon navbar</a> instead</p>

<hr>

<h2>Dynamic components</h2>

<h2>Dynamic components - <a href="http://getbootstrap.com/javascript/#modals">modals</a></h2>

<p><img src="./Le Wagon - Lectures_files/modal-9f5019424adf9fd666609c099d40377f.png" alt=""></p>

<h2>Dynamic components - <a href="http://getbootstrap.com/javascript/#dropdowns">dropdown</a></h2>

<p><img src="./Le Wagon - Lectures_files/dropdown-medium-6d694d9f80cac5b75ac15f376712880e.png" alt=""></p>

<h2>Dynamic components - <a href="http://getbootstrap.com/javascript/#popovers">popovers</a></h2>

<p><img src="./Le Wagon - Lectures_files/popover-b0dcbc8dd0d66d219c30a180badb4a31.png" alt=""></p>

<h2>Documentation</h2>

<p>http://getbootstrap.com/javascript/</p>

<h2>Live-code</h2>

<h4>Let's <strong>live-code</strong> a first <a href="http://lewagon.github.io/bootstrap-challenges/08-Final-airbnb-home-without-grid/">Airbnb home</a> in <strong>5 minutes</strong></h4>

<ul>
<li>Using <strong>a maximum of Bootstrap components</strong> (<code>btn-primary</code>, <code>form-inline</code>, <code>list-inline</code>..)</li>
<li>Using your own CSS components <strong>when really needed</strong> (e.g. banner, footer)</li>
</ul>

<hr>

<h2>Bootstrap grid</h2>

<p><img src="./Le Wagon - Lectures_files/bootstrap-grid-intro-fbf5c73223341b4f77d5b936667c4e60.png" alt=""></p>

<h2>Definition</h2>

<p>Bootstrap includes a <strong>responsive, mobile first</strong> fluid <strong>grid</strong> system that appropriately scales up to <strong>12 columns</strong> as the <strong>device</strong> size increases.</p>

<h2>Responsive</h2>

<p><img src="./Le Wagon - Lectures_files/bootstrap-responsive-9e4c672e224db4d69762d0a5a07cc677.png" alt=""></p>

<h2>Mobile-first</h2>

<p><img src="./Le Wagon - Lectures_files/bootstrap-mobile-first-8d7f710118c1dfca405b35b6d01944bc.png" alt=""></p>

<h2>How it works?</h2>

<h2>Container first</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>



<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/bootstrap-container-ba10485002e57a7cefebb36d882acec2.png" alt=""></p>

<h2>Then insert rows</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/bootstrap-row-1-6869bb69dbe1ded5ce7ae77a06ee7264.png" alt=""></p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/bootstrap-row-2-26d65c1924ea5b7fc164f4cb39fbe118.png" alt=""></p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/bootstrap-row-3-c7dcd46ba9d0d1d1a3dfeb6354851201.png" alt=""></p>

<h2>What's in the row?</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-6"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<ul>
<li><strong>col</strong>: because it fits a number of columns</li>
<li><strong>xs</strong>: screen width</li>
<li><strong>6</strong>: number of columns taken by the block (<strong>max 12</strong>)</li>
</ul>

<h2>Media</h2>

<ul>
<li><strong>xs</strong>: Extra small devices (Phones &lt; 768px)</li>
<li><strong>sm</strong>: Small devices (Tablets &gt; 768px)</li>
<li><strong>md</strong>: Medium devices (&gt; 992px)</li>
<li><strong>lg</strong>: Large devices (Desktops &gt; 1200px)</li>
</ul>

<h2>Example (2 columns)</h2>

<p><img src="./Le Wagon - Lectures_files/bootstrap-2-on-all-8777313e0f374c08ec2b7d1973c0e907.png" alt=""></p>

<h2>Code</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-6"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-6"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/bootstrap-2-divs-4c5aaa7b3213035ce69608c2623a0ec4.png" alt=""></p>

<h2>Mobile first</h2>

<ul>
<li>if you just give the <code>.col-xs</code> classes</li>
<li>it will apply on all larger screens</li>
</ul>

<h2>Now what happens?</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-6"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-6"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-6"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<h2>Just return on new line</h2>

<p><img src="./Le Wagon - Lectures_files/bootstrap-3-divs-3b50bed0a46ce928a9148289448b5d95.png" alt=""></p>

<h2>Responsive example</h2>

<p>We want 4 blocks for tablets or larger screens</p>

<p><img src="./Le Wagon - Lectures_files/bootstrap-4-on-tablet-127f28bbfcab650c6204132eb37875ac.png" alt=""></p>

<p>We want 2 lines for mobiles with 2 blocks on each line</p>

<p><img src="./Le Wagon - Lectures_files/bootstrap-4-on-mobile-e19d0879c5d46c9d4041a2cb5f615525.png" alt=""></p>

<h2>How will you do ?</h2>

<h2>Code</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-6 col-sm-3"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-6 col-sm-3"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-6 col-sm-3"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-6 col-sm-3"</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<p>Yeah baby !</p>

<h2>Offsetting blocks</h2>

<p><img src="./Le Wagon - Lectures_files/bootstrap-offset-8621868e14e95ac6cb481a1df2d76432.png" alt=""></p>

<p>Can we offset a block ?</p>

<h2>Yes we can</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-sm-offset-4 col-sm-4"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<p>Useful technique for <a href="http://lewagon.github.io/bootstrap-challenges/10-Login/">responsive form</a></p>

<h2>Grid dont's</h2>

<p>Don't break <strong><code>.container &gt; .row &gt; .col</code> succession</strong></p>

<p style="color:red;">Don't change CSS code of `.container`, `.row` or `.col` elements</p>

<h2>For full-width background</h2>

<p>Place a wrapper <strong>around</strong> the <code>.container</code></p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"wrapper-grey"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-6"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-6"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<h2>For inside cards</h2>

<p>Put cards <strong>inside</strong> the <code>.col</code></p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-6"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card"</span><span class="nt">&gt;</span>
        ...
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-6"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card"</span><span class="nt">&gt;</span>
        ...
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<h2>Then write your CSS on these divs.</h2>

<p><strong>As you don't touch grid elements, you won't break the grid.</strong></p>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nc">.wrapper-grey</span> <span class="p">{</span>
  <span class="k">background</span><span class="o">:</span> <span class="m">#CCCCCC</span><span class="p">;</span>
  <span class="k">padding</span><span class="o">:</span> <span class="m">30px</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.card</span> <span class="p">{</span>
  <span class="k">border</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="n">grey</span><span class="p">;</span>
  <span class="k">padding</span><span class="o">:</span> <span class="m">30px</span><span class="p">;</span>
  <span class="k">background</span><span class="o">:</span> <span class="nb">white</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2>Live-code</h2>

<p>Let's <strong>live-code</strong> 2 grid examples for features and flats, like in <a href="http://lewagon.github.io/bootstrap-challenges/09-Final-airbnb-home/index.html">this Airbnb home</a></p>

<h1>Front-End Web Development - Middleman</h1>

<h2>Install Middleman</h2>

<p><img src="./Le Wagon - Lectures_files/middleman-204113484b9cc0646f7b1a4ffafaab2c.png" alt=""></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ gem install middleman -v 3.4.1
</code></pre></div>
<h2>Objectives</h2>

<ul>
<li>Build a <a href="http://lewagon.github.io/middleman-airbnb/">static Airbnb</a> with Middleman</li>
<li>Understand ERB (layout, partial, loop) and SCSS (variables, Bootstrap over-ride)</li>
</ul>

<h2>HTML/CSS are not adapted</h2>

<ul>
<li>Copy/paste of HTML code for navbar, footer, cards, etc..</li>
<li>1000 lines of CSS to over-ride Bootstrap.</li>
</ul>

<p><br></p>

<p>Sadly, your browser <strong>speaks only HTML/CSS</strong></p>

<h2>ERB</h2>

<p>ERB (<strong>E</strong>mbedded <strong>R</strong>uby) comes with</p>

<ul>
<li><strong>layout</strong></li>
<li><strong>partial</strong></li>
<li><strong>loops</strong></li>
</ul>

<p><br></p>

<p style="font-size: 40px; color: #FF0000;">You will **refacto your HTML** using ruby!</p>

<h2>SCSS</h2>

<p><a href="http://sass-lang.com/guide">SCSS</a> comes with <strong>variables</strong></p>

<p><br></p>

<p style="font-size: 40px; color: #FF0000;">You will **over-ride Bootstrap** with variables.</p>

<h2>Advanced setup</h2>

<p>Since our browser is stupid, we need a tool:</p>

<ul>
<li>to compile ERB into HTML</li>
<li>to compile SCSS into CSS</li>
</ul>

<h2>Middleman</h2>

<p><img src="./Le Wagon - Lectures_files/middleman-204113484b9cc0646f7b1a4ffafaab2c.png" alt=""></p>

<p><a href="http://middlemanapp.com/">Middleman</a> = static site generator</p>

<h2>Setup</h2>

<p>Fork <a href="https://github.com/lewagon/frontend-advanced-boilerplate">our boilerplate</a> &amp; rename it in settings. Then:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd</span> ~/code/<span class="nv">$GITHUB_USERNAME</span>
<span class="nv">$ </span>git clone git@github.com:<span class="nv">$GITHUB_USERNAME</span>/REPO_NAME.git
<span class="nv">$ </span><span class="nb">cd </span>REPO_NAME
<span class="nv">$ </span>bundle install
<span class="nv">$ </span>middleman server <span class="c"># To launch local server</span>
<span class="nv">$ </span>middleman deploy <span class="c"># To build HTML/CSS and push it on Github Pages</span>
</code></pre></div>
<hr>

<h2>ERB basics</h2>

<ul>
<li>Middleman &amp; Rails use ERB</li>
<li>There are other templates (slim, handlebar, liquid, etc..).</li>
</ul>

<h2>ERB - <a href="https://middlemanapp.com/basics/templates/">layout</a></h2>

<p><img src="./Le Wagon - Lectures_files/layout-ca0d2bae135bed10a28611b88c8e61c5.png" alt=""></p>

<h2>Live-code</h2>

<ul>
<li>Let's add a <code>team.html.erb</code> page &amp; illustrate layout.</li>
<li>Let's add a footer partial to our layout.</li>
<li>Let's play with ERB in our team page.</li>
</ul>

<h2>URLs are tricky</h2>

<p>Depend on current file location.</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"images/logo.png"</span> <span class="na">alt=</span><span class="s">"Logo"</span><span class="nt">&gt;</span>
<span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"../images/logo.png"</span> <span class="na">alt=</span><span class="s">"Logo"</span><span class="nt">&gt;</span>
<span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"../../images/logo.png"</span> <span class="na">alt=</span><span class="s">"Logo"</span><span class="nt">&gt;</span>

<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"team.html"</span><span class="nt">&gt;</span>Team<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"../team.html"</span><span class="nt">&gt;</span>Team<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"../../team.html"</span><span class="nt">&gt;</span>Team<span class="nt">&lt;/a&gt;</span>
</code></pre></div>
<p>Are there nice methods <strong>generating <code>&lt;img&gt;</code> and <code>&lt;a&gt;</code> for us</strong>?</p>

<h2>ERB - <a href="https://middlemanapp.com/basics/helpers/">helpers</a></h2>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Press"</span><span class="p">,</span> <span class="s2">"press.html"</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;!-- =&gt; &lt;a href="/press.html"&gt;Press&lt;/a&gt; --&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="s2">"logo.png"</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;!-- =&gt; &lt;img src="/images/logo.png"&gt; --&gt;</span>
</code></pre></div>
<h2>Helpers with class</h2>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Press"</span><span class="p">,</span> <span class="s2">"press.html"</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">"btn btn-primary"</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;!-- =&gt; &lt;a href="/press.html" class="btn btn-primary"&gt;Press&lt;/a&gt; --&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="s2">"logo.png"</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">"logo"</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">"img-circle"</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;!-- =&gt; &lt;img src="/images/logo.png" id="logo" class="img-circle"&gt; --&gt;</span>
</code></pre></div>
<h2>Link with rich content</h2>

<p>When your link contains <strong>more than text</strong></p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%</span> <span class="n">link_to</span> <span class="s2">"index.html"</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">"navbar-brand"</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="s2">"logo.png"</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">"img-circle"</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">&lt;a href="index.html" class="navbar-brand"&gt;
  &lt;img src="logo.png" alt="" class="img-circle"&gt;
&lt;/a&gt;
</code></pre></div>
<h2>Helper in CSS</h2>
<div class="highlight"><pre><code class="language-scss" data-lang="scss"><span class="nc">.banner</span> <span class="p">{</span>
  <span class="na">background-image</span><span class="o">:</span> <span class="nf">image-url</span><span class="p">(</span><span class="s1">'</span><span class="s2">background.jpg'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h2>Live-code</h2>

<p>Let's import our <a href="http://lewagon.github.io/bootstrap-challenges/11-Airbnb-search-form/">Airbnb Home</a> in Middleman (just the HTML).</p>

<p><br></p>

<ul>
<li>Put common parts (navbar/footer) in the layout</li>
<li>Replace <strong style="color: red"><code>&lt;a&gt;</code></strong> and <strong style="color: red"><code>&lt;img&gt;</code></strong> with <strong style="color: #67CF9B"><code>link_to</code></strong> and <strong style="color: #67CF9B"><code>image_tag</code></strong></li>
</ul>

<hr>

<h2>SCSS basics</h2>

<h2>SASS vs SCSS</h2>

<p><em>.sass</em></p>
<div class="highlight"><pre><code class="language-sass" data-lang="sass"><span class="nt">li</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$emerald</span>
</code></pre></div>
<p><em>.scss</em></p>
<div class="highlight"><pre><code class="language-scss" data-lang="scss"><span class="nt">li</span> <span class="p">{</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$emerald</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><strong>SASS</strong> =&gt; <strong>new</strong> syntax (no overlap with CSS)</li>
<li><strong>SCSS</strong> (Sassy CSS) =&gt; <strong>extended</strong> syntax (accept raw CSS)</li>
<li>Both are processed to regular CSS</li>
</ul>

<h2>SCSS - partials</h2>

<p><img src="./Le Wagon - Lectures_files/partial-2822c96fd47870f544a151176e18f611.png" alt=""></p>

<h2>SCSS - variables</h2>

<p><img src="./Le Wagon - Lectures_files/variables-6ddc50324accfdd0bca9287353537aba.png" alt=""></p>

<h2>SCSS - partials organization</h2>

<p><img src="./Le Wagon - Lectures_files/css-organization-4-58375731c71efa8e46987a6c4b97b881.png" alt=""></p>

<h2>SCSS - Bootstrap over-ride</h2>

<p>Here are all <a href="http://getbootstrap.com/customize/#less-variables">Bootstrap variables</a> you can over-ride.</p>

<p><img src="./Le Wagon - Lectures_files/config-86a7e1e333a60565561d12e2c05202a9.png" alt=""></p>

<h2>SCSS - nesting</h2>

<p><img src="./Le Wagon - Lectures_files/nesting-7f7fcce6a876a278fd49e6b8bc12fc46.png" alt=""></p>

<h2>SCSS - chaining</h2>

<p><img src="./Le Wagon - Lectures_files/chaining-a14a5775c46f30159df1d1341c5aeca1.png" alt=""></p>

<h2>Live-code</h2>

<p>Let's import our <a href="http://lewagon.github.io/bootstrap-challenges/11-Airbnb-search-form/">Airbnb Home CSS</a> in Middleman (just the CSS).</p>

<ul>
<li>Put the code in the good folder (<code>layout</code>? <code>components</code>? <code>pages</code>?).</li>
<li>Replace colors by main variables.</li>
<li>Play with Bootstrap variables and change theme.</li>
</ul>

<hr>

<h1>Local data</h1>

<h2>Website = card repetition</h2>

<ul>
<li>Medium <strong>X</strong> posts</li>
<li>Airbnb <strong>X</strong> flats</li>
<li>Product Hunt <strong>X</strong> products</li>
<li>Epicurious <strong>X</strong> recipes</li>
</ul>

<h2>Middleman <a href="https://middlemanapp.com/advanced/local-data/">data</a></h2>

<p>Create as many <strong><code>data/database.yml</code></strong> as you want (<code>flats.yml</code>, <code>team.yml</code>..)</p>

<h2>YAML file - Array</h2>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="c1"># team.yml</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Romain</span>
  <span class="l-Scalar-Plain">role</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">COO</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Seb</span>
  <span class="l-Scalar-Plain">role</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">CTO</span>
</code></pre></div>
<p>Parsed by Middleman as?</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">data</span><span class="o">.</span><span class="n">team</span> <span class="c1">#=&gt; [{"name" =&gt; "Romain", "role" =&gt; "COO"}, {"name" =&gt; "Seb", "role" =&gt; "CTO"}]</span>
</code></pre></div>
<h2>YAML file - Hash</h2>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="c1"># team.yml</span>
<span class="l-Scalar-Plain">romain</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">picture</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">romain.png</span>
  <span class="l-Scalar-Plain">role</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">COO</span>
<span class="l-Scalar-Plain">seb</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">picture</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sebastien.png</span>
  <span class="l-Scalar-Plain">role</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">COO</span>
</code></pre></div>
<p>Parsed by Middleman as?</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">data</span><span class="o">.</span><span class="n">team</span> <span class="c1">#=&gt; {</span>
          <span class="c1">#     "romain" =&gt; {"picture" =&gt; "romain.png", "role" =&gt; "COO"},</span>
          <span class="c1">#     "seb" =&gt; {"picture" =&gt; "sebastien.png", "role" =&gt; "CTO"}</span>
          <span class="c1">#   }</span>
</code></pre></div>
<h2>Looping on data</h2>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;div class="container"&gt;</span>
<span class="x">  &lt;div class="row"&gt;</span>
<span class="x">    </span><span class="cp">&lt;%</span> <span class="n">data</span><span class="o">.</span><span class="n">team</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">member</span><span class="p">,</span> <span class="n">infos</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">      &lt;div class="col-md-4"&gt;</span>
<span class="x">        &lt;div class="card"&gt;</span>
<span class="x">          </span><span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="n">infos</span><span class="o">.</span><span class="n">picture</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">"img-thumbnail"</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">          &lt;h2&gt;</span><span class="cp">&lt;%=</span> <span class="n">member</span><span class="o">.</span><span class="n">capitalize</span> <span class="cp">%&gt;</span><span class="x">&lt;/h2&gt;</span>
<span class="x">          &lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="n">infos</span><span class="o">.</span><span class="n">role</span> <span class="cp">%&gt;</span><span class="x">&lt;/p&gt;</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">      &lt;/div&gt;</span>
<span class="x">    </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;/div&gt;</span>
<span class="x">&lt;/div&gt;</span>
</code></pre></div>
<h2>Middleman <a href="https://middlemanapp.com/advanced/dynamic_pages/">dynamic pages</a></h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># in config.rb</span>
<span class="o">[</span><span class="s2">"anne"</span><span class="p">,</span> <span class="s2">"seb"</span><span class="p">,</span> <span class="s2">"romain"</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">member</span><span class="o">|</span>
  <span class="n">proxy</span> <span class="s2">"/flats/</span><span class="si">#{</span><span class="n">member</span><span class="si">}</span><span class="s2">.html"</span><span class="p">,</span> <span class="s2">"/flats/show.html"</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:owner</span> <span class="o">=&gt;</span> <span class="n">member</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div>
<p>Then in <strong><code>source/flats/show.html.erb</code></strong></p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="n">data</span><span class="o">.</span><span class="n">team</span><span class="o">[</span><span class="n">owner</span><span class="o">].</span><span class="n">picture</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="n">owner</span><span class="o">.</span><span class="n">capitalize</span> <span class="cp">%&gt;</span><span class="x">'s flat&lt;/h1&gt;</span>
</code></pre></div>
<h2>Live-code</h2>

<ul>
<li>Replace 3 static flats on Home by data read from a <code>team.yml</code> file.</li>
<li>Add a dynamic template <code>/flats/show.html</code> showing each member's flat.</li>
</ul>

<h2>Your turn!</h2>

<h1>Front-End Web Development - JavaScript &amp; jQuery</h1>

<h1>JavaScript</h1>

<p>(<em>Vanilla</em> JavaScript)</p>

<h3><u>The</u> Client-side Programming Language</h3>

<h3>What's with the name?</h3>

<p>JavaScript != Java</p>

<h3>JS Bin</h3>

<p><a href="http://jsbin.com/?js,console">jsbin.com/?js,console</a></p>

<h3>Outside the Browser</h3>

<p><code>node</code> can be used as an equivalent of <code>irb</code> and <code>ruby</code>.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>node foo.js <span class="c"># Will execute the JS code inside `foo.js` (think `ruby foo.rb`)</span>
<span class="nv">$ </span>node        <span class="c"># Gives you a REPL to execute JS code (like `irb` for Ruby code)</span>
&gt;
<span class="c"># Ctrl-C twice to exit</span>
</code></pre></div>
<p>To install on OSX:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">brew update <span class="o">&amp;&amp;</span> brew install node
</code></pre></div>
<p>On Ubuntu:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo apt-get install nodejs
sudo ln -s /usr/bin/nodejs /usr/local/bin/node
</code></pre></div>
<hr>

<h2>Language Basics</h2>

<h3>Types</h3>

<p>Ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s2">"Hello Le Wagon"</span>            <span class="c1"># String</span>

<span class="mi">42</span>                          <span class="c1"># Fixnum</span>
<span class="mi">42</span><span class="o">.</span><span class="mi">0</span>                        <span class="c1"># Float</span>

<span class="kp">true</span> <span class="o">!=</span> <span class="kp">false</span>               <span class="c1"># Boolean</span>
</code></pre></div>
<p>JavaScript</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="s2">"Hello Le Wagon"</span>            <span class="c1">// string</span>

<span class="mi">42</span>                          <span class="c1">// number</span>
<span class="mf">42.0</span>                        <span class="c1">// number</span>

<span class="kc">true</span> <span class="o">!=</span> <span class="kc">false</span>               <span class="c1">// boolean</span>
</code></pre></div>
<h3>Checking type</h3>

<p>Ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">name</span> <span class="o">=</span> <span class="s2">"Boris"</span>
<span class="nb">name</span><span class="o">.</span><span class="n">class</span>
<span class="c1"># =&gt; String</span>
</code></pre></div>
<p>JavaScript</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="s2">"Boris"</span><span class="p">;</span>
<span class="k">typeof</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
<span class="c1">// =&gt; 'string'</span>
</code></pre></div>
<h3>More types</h3>

<p>Ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">[</span><span class="s1">'Hello'</span><span class="p">,</span> <span class="s1">'Le'</span><span class="p">,</span> <span class="s1">'Wagon'</span><span class="p">,</span> <span class="mi">42</span><span class="o">]</span>      <span class="c1"># Array</span>

<span class="p">{</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">'bob'</span><span class="p">,</span> <span class="ss">age</span><span class="p">:</span> <span class="mi">42</span> <span class="p">}</span>          <span class="c1"># Hash with symbol as keys</span>
<span class="p">{</span> <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'bob'</span><span class="p">,</span> <span class="s1">'age'</span> <span class="o">=&gt;</span> <span class="mi">42</span> <span class="p">}</span>  <span class="c1"># Hash with string as keys</span>
</code></pre></div>
<p>JavaScript</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">[</span><span class="s1">'Hello'</span><span class="p">,</span> <span class="s1">'Le'</span><span class="p">,</span> <span class="s1">'Wagon'</span><span class="p">,</span> <span class="mi">42</span><span class="p">]</span>      <span class="c1">// Array</span>

<span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">'bob'</span><span class="p">,</span> <span class="nx">age</span><span class="o">:</span> <span class="mi">42</span> <span class="p">}</span>          <span class="c1">// Object</span>
<span class="p">{</span> <span class="s1">'name'</span><span class="o">:</span> <span class="s1">'bob'</span><span class="p">,</span> <span class="s1">'age'</span><span class="o">:</span> <span class="mi">42</span> <span class="p">}</span>      <span class="c1">// Object (the exact same)</span>
</code></pre></div>
<h3>Variables</h3>

<p>Ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">count</span> <span class="o">=</span> <span class="mi">12</span>          <span class="c1"># Assignment</span>
<span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>   <span class="c1"># Re-assignment</span>
</code></pre></div>
<p>JavaScript</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
<span class="nx">count</span> <span class="o">=</span> <span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div>
<h3><code>if</code></h3>

<p>Ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">if</span> <span class="n">condition</span>
  <span class="c1"># [...]</span>
<span class="k">end</span>
</code></pre></div>
<p>JavaScript</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">if</span> <span class="p">(</span><span class="nx">condition</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// [...]</span>
<span class="p">}</span>
</code></pre></div>
<h3><code>for</code> (1)</h3>

<p>Ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="mi">10</span><span class="o">.</span><span class="n">times</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">do_something</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">}</span>

<span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="mi">10</span>
  <span class="n">do_something</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>JavaScript</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">doSomething</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3><code>forEach</code></h3>

<p>Ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">beatles</span> <span class="o">=</span> <span class="sx">%w(john paul ringo george)</span>
<span class="nb">puts</span> <span class="n">beatles</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>

<span class="n">beatles</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">beatle</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">beatle</span>
<span class="k">end</span>
</code></pre></div>
<p>JavaScript</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">beatles</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">"john"</span><span class="p">,</span> <span class="s2">"paul"</span><span class="p">,</span> <span class="s2">"ringo"</span><span class="p">,</span> <span class="s2">"george"</span><span class="p">];</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">beatles</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

<span class="nx">beatles</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">beatle</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">beatle</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<h3><a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Objets_globaux/Object/keys"><code>Object.keys</code></a></h3>

<p>Ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">instruments</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">"john"</span> <span class="o">=&gt;</span> <span class="s2">"guitar"</span><span class="p">,</span> <span class="s2">"paul"</span> <span class="o">=&gt;</span> <span class="s2">"bass"</span><span class="p">,</span> <span class="s2">"ringo"</span> <span class="o">=&gt;</span> <span class="s2">"drums"</span><span class="p">,</span> <span class="s2">"george"</span> <span class="o">=&gt;</span> <span class="s2">"guitar"</span> <span class="p">}</span>

<span class="n">instruments</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">beatle</span><span class="p">,</span> <span class="n">instrument</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">beatle</span><span class="si">}</span><span class="s2"> played the </span><span class="si">#{</span><span class="n">instrument</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre></div>
<p>JavaScript</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">instruments</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">"john"</span><span class="o">:</span> <span class="s2">"guitar"</span><span class="p">,</span> <span class="s2">"paul"</span><span class="o">:</span> <span class="s2">"bass"</span><span class="p">,</span> <span class="s2">"ringo"</span><span class="o">:</span> <span class="s2">"drums"</span><span class="p">,</span> <span class="s2">"george"</span><span class="o">:</span> <span class="s2">"guitar"</span> <span class="p">};</span>

<span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">instruments</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">beatle</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">beatle</span> <span class="o">+</span> <span class="s2">" played the "</span> <span class="o">+</span> <span class="nx">instruments</span><span class="p">[</span><span class="nx">beatle</span><span class="p">]);</span>
<span class="p">});</span>
</code></pre></div>
<h3><code>while</code></h3>

<p>Ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span>
  <span class="nb">puts</span> <span class="n">i</span>
  <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="k">end</span>
</code></pre></div>
<p>JavaScript</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
  <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3>Functions</h3>

<p>Ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">full_name</span><span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">)</span>
  <span class="s2">"</span><span class="si">#{</span><span class="n">first_name</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">last_name</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre></div>
<p>JavaScript</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">fullName</span><span class="p">(</span><span class="nx">firstName</span><span class="p">,</span> <span class="nx">lastName</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">firstName</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="nx">lastName</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// or</span>

<span class="kd">var</span> <span class="nx">fullName</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">firstName</span><span class="p">,</span> <span class="nx">lastName</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">firstName</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="nx">lastName</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3>Keywords</h3>

<p>Ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="kp">nil</span>
<span class="nb">self</span>
</code></pre></div>
<p>JavaScript</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kc">null</span>
<span class="k">this</span>
</code></pre></div>
<h3>Variable scope</h3>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">concatenate</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// ReferenceError: result is not defined</span>
</code></pre></div>
<hr>

<h2>Objects</h2>

<p>Trickier than Ruby</p>

<h3>Built-in objects</h3>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">firstName</span> <span class="o">=</span> <span class="nb">String</span><span class="p">(</span><span class="s2">"boris"</span><span class="p">);</span>
</code></pre></div>
<p>You can call functions on objects.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">firstName</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
<span class="c1">// =&gt; 5</span>
</code></pre></div>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects">More built-ins</a></p>

<h3>Built-in objects (2)</h3>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">();</span>
<span class="c1">// =&gt; 0.555923983729</span>
<span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
<span class="c1">// =&gt; 1422875735069</span>
</code></pre></div>
<h3>Your own class (Ruby)</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">User</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">)</span>
    <span class="vi">@first_name</span> <span class="o">=</span> <span class="n">first_name</span>
    <span class="vi">@last_name</span> <span class="o">=</span> <span class="n">last_name</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">full_name</span>
    <span class="s2">"</span><span class="si">#{</span><span class="vi">@first_name</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="vi">@last_name</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">john</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">"John"</span><span class="p">,</span> <span class="s2">"Smith"</span><span class="p">)</span>
<span class="n">john</span><span class="o">.</span><span class="n">full_name</span>
<span class="c1"># =&gt; "John Smith"</span>
</code></pre></div>
<h3>Your own object (JavaScript)</h3>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">User</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">firstName</span><span class="p">,</span> <span class="nx">lastName</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">firstName</span> <span class="o">=</span> <span class="nx">firstName</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">lastName</span> <span class="o">=</span> <span class="nx">lastName</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">User</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">fullName</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">firstName</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">lastName</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">john</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">(</span><span class="s2">"John"</span><span class="p">,</span> <span class="s2">"Smith"</span><span class="p">);</span>
<span class="nx">john</span><span class="p">.</span><span class="nx">fullName</span><span class="p">()</span>
<span class="c1">// =&gt; "John Smith"</span>
</code></pre></div>
<p>Read  more about <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Introduction_to_Object-Oriented_JavaScript#Object-oriented_programming">prototypes</a></p>

<h3>Using JavaScript with HTML</h3>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>

  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>



    <span class="c">&lt;!-- &lt;script src="first_file.js"&gt;&lt;/script&gt; --&gt;</span>
    <span class="c">&lt;!-- &lt;script src="other_file.js"&gt;&lt;/script&gt; --&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>
<p>Loading a JS file is <strong>blocking</strong> the page rendering =&gt; Put it at the end.</p>

<hr>

<h1>jQuery</h1>

<p>A JavaScript library to ease your life.</p>

<h3>Cross-Browser Standardization</h3>

<p><img src="./Le Wagon - Lectures_files/browser-war-78cbff51d79b06e4192a1d0b0bc74563.jpg" alt=""></p>

<hr>

<h2>DOM</h2>

<p>Document Object Model</p>

<p><a href="https://en.wikipedia.org/wiki/Tree_%28data_structure%29">wikipedia.org/Tree<em>(data</em>structure)</a></p>

<p><img src="./Le Wagon - Lectures_files/tree-f7694fa5cca45378e812fcf2d183f1ad.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/dom_example-ed7001cd6fe05ed3d60838868a70cdc7.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/request_0-aaf4f5cf03178bddda3f444a1593f52e.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/request_1-590aeb5cd7f616095af4d0cacd621011.png" alt=""></p>

<p>The browser <strong>parses</strong> the HTML response and <strong>creates</strong> the DOM from it.</p>

<p>You can visualize the DOM in the Chrome Inspector, in <strong>Elements</strong> tab.</p>

<p><img src="./Le Wagon - Lectures_files/inspect-024894d5f1eb73f66f0ac22dae02fe3c.png" alt=""></p>

<hr>

<h2>First usage : Manipulate the DOM</h2>

<h3>The <code>$()</code> function</h3>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">$</span><span class="p">(</span><span class="s1">'div'</span><span class="p">)</span>                   <span class="c1">// finds every &lt;div&gt; in the page</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">$</span><span class="p">(</span><span class="s1">'.hello'</span><span class="p">)</span>                <span class="c1">// finds every tag with a "hello" class</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">$</span><span class="p">(</span><span class="s1">'#wagon'</span><span class="p">)</span>                <span class="c1">// finds the one element with id="wagon"</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">$</span><span class="p">(</span><span class="s1">'td.title &gt; a'</span><span class="p">)</span>          <span class="c1">// any CSS selector will do</span>
</code></pre></div>
<p>Find all <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/CSS/Getting_started/Selectors">selectors on MDN</a></p>

<p>The <code>$(selector)</code> methods return a <strong>jQuery object</strong> containing</p>

<p>a <strong>collection</strong> of DOM elements.</p>

<p>This collection can contain <strong>zero</strong>, <strong>one</strong> or <strong>many</strong> elements.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">$</span><span class="p">(</span><span class="s1">'body'</span><span class="p">).</span><span class="nx">length</span>
<span class="c1">// =&gt; 1</span>

<span class="nx">$</span><span class="p">(</span><span class="s1">'a'</span><span class="p">).</span><span class="nx">length</span>
<span class="c1">// =&gt; 24</span>
</code></pre></div>
<p>If you matched several elements, you can loop with <a href="http://api.jquery.com/jquery.each/"><code>$.each()</code></a></p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">$</span><span class="p">(</span><span class="s1">'a'</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">item</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'href'</span><span class="p">));</span>
<span class="p">});</span>
</code></pre></div>
<p><strong>DO NOT use <code>forEach</code></strong> here, <code>$(a)</code> does not return a regular array.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// As a reminder, use forEach for regular arrays.</span>
<span class="kd">var</span> <span class="nx">beatles</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">'john'</span><span class="p">,</span> <span class="s1">'paul'</span><span class="p">,</span> <span class="s1">'ringo'</span><span class="p">];</span>
<span class="nx">beatles</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">beatle</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">beatle</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<h3>Hide &amp; Show elements</h3>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"wagon"</span><span class="nt">&gt;</span>
  Lorem ipsum...
<span class="nt">&lt;/div&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">$</span><span class="p">(</span><span class="s1">'#wagon'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
<span class="nx">$</span><span class="p">(</span><span class="s1">'#wagon'</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
</code></pre></div>
<p>Doc: <a href="http://api.jquery.com/hide/"><code>hide</code></a> and <a href="http://api.jquery.com/show/"><code>show</code></a></p>

<h3>Add / Remove classes</h3>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"lead"</span><span class="nt">&gt;</span>Paul<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"lead"</span><span class="nt">&gt;</span>John<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>George<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>Ringo<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">$</span><span class="p">(</span><span class="s1">'.lead'</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">'bold'</span><span class="p">);</span>
</code></pre></div>
<p>Doc: <a href="http://api.jquery.com/addClass/"><code>addClass</code></a>, <a href="http://api.jquery.com/removeClass/"><code>removeClass</code></a>
and <a href="http://api.jquery.com/toggleClass/"><code>toggleClass</code></a></p>

<h3>Read/Write inputs</h3>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">id=</span><span class="s">"email"</span> <span class="na">value=</span><span class="s">"bob@sponge.com"</span> <span class="nt">/&gt;</span>
</code></pre></div>
<p>Read</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">email</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#email'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
<span class="c1">// =&gt; 'bob@sponge.com'</span>
</code></pre></div>
<p>Write</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">$</span><span class="p">(</span><span class="s1">'#email'</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s1">'patrick@star.com'</span><span class="p">);</span>
</code></pre></div>
<h3>Extract text</h3>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://www.lewagon.org"</span> <span class="na">id=</span><span class="s">"home"</span><span class="nt">&gt;</span>Le Wagon <span class="nt">&lt;em&gt;</span>rocks<span class="nt">&lt;/em&gt;&lt;/a&gt;</span>
</code></pre></div>
<p>Read</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#home'</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
<span class="c1">// =&gt; 'Le Wagon rocks'</span>
</code></pre></div>
<h3>Read/Write HTML</h3>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"intro"</span><span class="nt">&gt;</span>
  Hello guys
<span class="nt">&lt;/div&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">$</span><span class="p">(</span><span class="s1">'#intro'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">'&lt;a href="http://www.lewagon.org"&gt;Le Wagon&lt;/a&gt;'</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"intro"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://www.lewagon.org"</span><span class="nt">&gt;</span>Le Wagon<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<p>Difference between <code>.text()</code> and <code>html()</code>: <a href="http://jsfiddle.net/hossain/sUTVg/">check this out</a></p>

<h3>Create new elements</h3>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">paragraph</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'&lt;p&gt;'</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">"Hello I'm new here"</span><span class="p">);</span>

<span class="nx">$</span><span class="p">(</span><span class="s1">'body'</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">paragraph</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;p&gt;</span>Hello I'm new here<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div>
<hr>

<h2>Second Usage - Events</h2>

<p>(Tomorrow)</p>

<hr>

<h2>Third usage - Animations</h2>

<p>(Tomorrow)</p>

<hr>

<h2>Fourth usage - AJAX</h2>

<p>(In 2 days)</p>

<hr>

<h2>Happy Hacking!</h2>

<h1>Front-End Web Development - Events/Callbacks &amp; jQuery Plugins</h1>

<h1>Events</h1>

<hr>

<p><a href="http://jsbin.com/ropemi/edit?html,js,output">Demo</a></p>

<h3>What happened?</h3>

<ul>
<li>The JavaScript put a <em>microphone</em> on all <code>img</code> elements to catch <code>click</code> events.</li>
<li>The user clicked on an image.</li>
<li>The browser fired the <code>click</code> event on the <code>img</code> element.</li>
<li>Some JavaScript code was executed to add the <code>img-circle</code> class to the <code>img</code>.</li>
</ul>

<h3>What's a callback?</h3>

<p><img src="./Le Wagon - Lectures_files/hollywood_principle-13797ca0d1f03153bede7ef04c022107.png" alt=""></p>

<h3>Registering a callback</h3>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">$</span><span class="p">(</span><span class="s1">'img'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s1">'img-circle'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>the <code>on()</code> method takes <strong>2 arguments</strong>:</p>

<ul>
<li>Name of the event to listen to, the <strong>String</strong> <code>'click'</code></li>
<li>JavaScript code to run when the event is triggered, a <code>function</code>. <code>this</code> is the <strong>DOM element</strong>
on which the event happened.</li>
</ul>

<h3>Wait for it</h3>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
 <span class="c1">// the DOM is now ready, you can traverse it,</span>
 <span class="c1">// and register events with on().</span>
<span class="p">});</span>
</code></pre></div>
<hr>

<h2>Event types</h2>

<p>There's <a href="https://developer.mozilla.org/en-US/docs/Web/Events">a lot</a>. jQuery has <a href="http://api.jquery.com/category/events/">shortcuts</a> for most of them</p>

<h3><code>click</code></h3>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"clickable"</span> <span class="na">src=</span><span class="s">"..."</span> <span class="nt">/&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="s2">".clickable"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Do something. // Do something. `this` is the &lt;img /&gt; DOM node.</span>
<span class="p">});</span>
</code></pre></div>
<p>Alternative syntax:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="s2">".clickable"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>

<span class="p">});</span>
</code></pre></div>
<h3><a href="https://api.jquery.com/event.preventDefault/"><code>preventDefault()</code></a></h3>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">id=</span><span class="s">"foo"</span><span class="nt">&gt;</span>Click here<span class="nt">&lt;/a&gt;</span>
</code></pre></div>
<p>Default behavior is to go <strong>back to top</strong>.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">$</span><span class="p">(</span><span class="s1">'#foo'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span> <span class="c1">// Won't go back to top.</span>
  <span class="c1">// Do something else</span>
<span class="p">});</span>
</code></pre></div>
<h3><code>hover</code></h3>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"#one"</span><span class="nt">&gt;&lt;/div&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="s2">"#one"</span><span class="p">).</span><span class="nx">hover</span><span class="p">(</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Do something when entering the div one.</span>
  <span class="p">},</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Do something when leaving the div one.</span>
  <span class="p">}</span>
<span class="p">);</span>
</code></pre></div>
<p><a href="http://jsbin.com/suyira/edit?html,css,js,output">Demo</a></p>

<h3><code>submit</code></h3>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="s2">"#apply"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"submit"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Code executed when a form is submitted</span>

  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// prevent it from being submitted (errors, etc.)</span>
<span class="p">});</span>
</code></pre></div>
<h3><code>scroll</code></h3>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"scroll"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Code executed for each pixel scrolled</span>
<span class="p">});</span>
</code></pre></div>
<p><code>focus</code> / <code>blur</code> / <code>change</code></p>

<p><code>keydown</code> / <code>keyup</code></p>

<!--
## Smooth scroll

Start with [jQuery smooth scroll script](http://css-tricks.com/snippets/jquery/smooth-scrolling/)

```javascript
// javascripts/smooth_scroll.js

$(document).ready(function() {
  $('a[href*=#]:not([href=#])').click(function() {
    if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
      var target = $(this.hash);
      target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
      if (target.length) {
        $('html,body').animate({
          scrollTop: target.offset().top
        }, 1000);
        return false;
      }
    }
  });
});
```

## Navbar animation

```javascript
// javascripts/navbar_animation.js

$(document).ready(function() {
  // navbar transition jQuery script
  $(window).scroll(function(e){
    if ($(this).scrollTop() > 300) {
      $(".navbar").css("margin-top", "-70px");
    }
    else {
      $(".navbar").css("margin-top", "0px");
    }
  });
});
```

-->

<hr>

<h2>Bootstrap JavaScript</h2>

<p><a href="http://getbootstrap.com/javascript/">getbootstrap.com/javascript</a></p>

<p>Let's clone <a href="http://github.com/lewagon/frontend-advanced-boilerplate">lewagon/frontend-advanced-boilerplate</a>.</p>

<p><strong>There's a <a href="https://github.com/twbs/bootstrap-sass">gem</a> for that</strong></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s1">'bootstrap-sass'</span>
</code></pre></div><div class="highlight"><pre><code class="language-sass" data-lang="sass"><span class="c1">// all.css.scss</span>
<span class="k">@import</span> <span class="s">"bootstrap-sprockets";</span>
<span class="k">@import</span> <span class="s">"bootstrap";</span>
</code></pre></div><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// all.js</span>
<span class="c1">//= require jquery</span>
<span class="c1">//= require bootstrap-sprockets</span>
</code></pre></div>
<h2>Bootstrap Modal</h2>

<p><img src="./Le Wagon - Lectures_files/modal-9f5019424adf9fd666609c099d40377f.png" alt=""></p>

<h2>Other useful JS components</h2>

<p>Dropdown / Tooltip / Popover / Alert / Carousel</p>

<p>Read the <a href="http://getbootstrap.com/javascript/">doc</a></p>

<hr>

<h2>Datepicker</h2>

<p>Beware of this on <strong>Chrome</strong></p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"date"</span><span class="nt">&gt;</span>
</code></pre></div>
<p><a href="http://jsbin.com/viruhi/edit?html,output">Open this</a> in Firefox/Safari, then Chrome.</p>

<h3>Plugin: bootstrap-datepicker</h3>

<p><a href="https://github.com/eternicode/bootstrap-datepicker">eternicode/bootstrap-datepicker</a>
and <a href="http://eternicode.github.io/bootstrap-datepicker">its demo</a></p>

<h3>How can I import it in Middleman/Rails?</h3>

<p>Is it on Bower? <a href="https://libraries.io/bower/bootstrap-datepicker">Yes!</a></p>

<p>We can use <a href="https://rails-assets.org/">rails-assets.org</a></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">source</span> <span class="s2">"https://rails-assets.org"</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'rails-assets-bootstrap-datepicker'</span>
<span class="k">end</span>
</code></pre></div>
<h3>Then:</h3>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// all.js</span>

<span class="c1">//= require bootstrap-datepicker</span>
</code></pre></div><div class="highlight"><pre><code class="language-css" data-lang="css"><span class="c">/* all.scss */</span>

<span class="k">@import</span> <span class="s2">"bootstrap-datepicker"</span><span class="p">;</span>
</code></pre></div>
<p>Let's live-code adding a datepicker to Airbnb home!</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ git clone git@github.com:lewagon/middleman-airbnb.git
</code></pre></div>
<hr>

<h2>Other components</h2>

<p>(All available on Bower, thus rails-assets)</p>

<p><a href="http://brutaldesign.github.io/swipebox/">swipebox</a> /
<a href="https://scrollrevealjs.org/">scrollreveal</a> /
<a href="https://libraries.io/bower/smoothscroll">smoothscroll</a></p>

<hr>

<h2>Happy Hacking!</h2>

<h1>Front-End Web Development - HTTP &amp; AJAX</h1>

<h2>How does the web work?</h2>

<p><img src="./Le Wagon - Lectures_files/client-535647062928f53d29d350960e4ac5c9.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/client-with-browser-16b36b27fc4b72c6e772ecc0a732ac82.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/client-request-801b3ac071bafffea674bed582be64bb.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/client-full-response-726bf1bfaef58b7d8bb1ffcee5089e95.png" alt=""></p>

<p><strong>1 HTTP request</strong> / file (<code>file.html</code>, <code>file.css</code>, <code>file.js</code>, <code>file.png</code>)</p>

<p><img src="./Le Wagon - Lectures_files/waterfall-c80dc7a9bbfca5a6be9dab069cb54124.png" alt=""></p>

<hr>

<h2>HTTP</h2>

<p>Base protocol of the <strong>Web</strong> (!= Internet)</p>

<h3>Hyper</h3>

<h3>Text</h3>

<h3>Transfer</h3>

<h3>Protocol</h3>

<h3>What is it?</h3>

<ul>
<li><p>A <strong>protocol</strong> to transfer <strong>resources</strong></p></li>
<li><p>Resource means <strong>file</strong> (HTML, CSS, images, JS, ...)</p></li>
<li><p>Based on a system of <strong>request / response</strong></p></li>
<li><p>Between 2 machines, <strong>a client and a server</strong></p></li>
</ul>

<h3>Let's look at an HTTP request</h3>

<p>It's <strong>more</strong> than just an URL</p>

<h3>1 - Request Method</h3>

<ul>
<li><p><strong>GET</strong>: get a page <br>
=&gt; <code>I want to read page http://www.google.com</code></p></li>
<li><p><strong>POST</strong>: send new data <br>
=&gt; <code>Here are my email and password, I want to sign up!</code>
<br>
<br>
Later, we'll see <strong>PATCH</strong> and <strong>DELETE</strong>.</p></li>
</ul>

<h3>2 - Request URL</h3>

<p><code>http://www.lewagon.org</code></p>

<h3>3 - Request Headers</h3>

<p><img src="./Le Wagon - Lectures_files/http-request-headers-4c7a8d24c3111dd205f125afac382697.png" alt=""></p>

<h3>4 - Request Body</h3>

<ul>
<li>No body for a <code>GET</code> Request</li>
<li>Body for a <code>POST</code> or <code>PATCH</code> request (usually with content from <strong>form</strong>)</li>
</ul>

<h3>GET</h3>

<p><img src="./Le Wagon - Lectures_files/get-8fd2dad12993daeb5b8d75c4f7aabdd5.png" alt=""></p>

<h3>POST</h3>

<p><img src="./Le Wagon - Lectures_files/post-3e7922fc2238c925b4df3e9624e532de.png" alt=""></p>

<h3>Get - params in URL</h3>

<ul>
<li>No body in GET request. No way to hide params in the body</li>
<li><strong>Query Parameters</strong> appear directly in the URL</li>
<li>More convenient to share a search with your friends :)</li>
</ul>

<p><br></p>

<p>Example: <a href="https://www.airbnb.com/s/Torino?checkin=10%2F02%2F2015&amp;checkout=27%2F02%2F2015&amp;guests=4">https://www.airbnb.com/s/Torino?checkin=10%2F02%2F2015&amp;checkout=27%2F02%2F2015&amp;guests=4</a></p>

<h3>Post - params in body</h3>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/users/sign_in"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">type=</span><span class="s">"password"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div>
<p>When posting this form, we'll generate this HTTP request:</p>

<pre>POST /users/sign_in HTTP/1.1
Content-Type: application/x-www-form-urlencoded

username=boris&amp;password=secret
</pre>

<h3>Speak HTTP (no browser required)</h3>

<p><img src="./Le Wagon - Lectures_files/telnet-step-1-bbcb0ae6aa8bceab977f76fcdf757255.png" alt=""></p>

<h3>Press <code>Enter</code> twice</h3>

<p><img src="./Le Wagon - Lectures_files/telnet-step-2-14c551a28bae1966a2f5329d642c816d.png" alt=""></p>

<h3><code>curl</code></h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>curl http://www.perdu.com
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>curl http://www.lewagon.com
<span class="nv">$ </span>curl -I http://www.lewagon.com
</code></pre></div>
<hr>

<h2>AJAX</h2>

<ul>
<li><strong>A</strong>synchronous <strong>J</strong>avascript <strong>A</strong>nd <strong>X</strong>ML</li>
<li>Historical naming, no more links with XML</li>
</ul>

<h3>What is it?</h3>

<ul>
<li>Allows to make <strong>HTTP requests in Javascript</strong></li>
<li>AJAX requests are <strong>asynchronous</strong> (non-blocking), <strong>after</strong> page loaded.</li>
<li>Build by Microsoft in 1998 for Internet Explorer 5</li>
</ul>

<h3><a href="https://api.jquery.com/jQuery.ajax/"><code>$.ajax</code></a> with <code>GET</code></h3>

<p>Let's <strong>read</strong> some info about GitHub repositories owned by <code>lewagon</code>.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="nx">type</span><span class="o">:</span> <span class="s2">"GET"</span><span class="p">,</span>
  <span class="nx">url</span><span class="o">:</span> <span class="s2">"https://api.github.com/users/lewagon/repos"</span><span class="p">,</span>
  <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">jqXHR</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">jqXHR</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p><a href="https://jsfiddle.net/ssaunier/4c90e805/3/">Demo</a></p>

<h3>Shortcut: <a href="https://api.jquery.com/jQuery.get"><code>$.get()</code></a></h3>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"https://api.github.com/users/lewagon/repos"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// success callback;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">})</span>
</code></pre></div>
<h3><code>$.ajax</code> with <code>POST</code></h3>

<p>Let's <strong>create</strong> a new gist (see <a href="https://developer.github.com/v3/gists/#create-a-gist">API doc</a>)</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">gist</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
  <span class="s2">"description"</span><span class="o">:</span> <span class="s2">"A gist from AJAX"</span><span class="p">,</span>
  <span class="s2">"public"</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">"files"</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">"README.md"</span><span class="o">:</span> <span class="p">{</span> <span class="s2">"content"</span><span class="o">:</span> <span class="s2">"It worked!"</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="nx">type</span><span class="o">:</span> <span class="s2">"POST"</span><span class="p">,</span>
  <span class="nx">url</span><span class="o">:</span> <span class="s2">"https://api.github.com/gists"</span><span class="p">,</span>
  <span class="nx">data</span><span class="o">:</span> <span class="nx">gist</span><span class="p">,</span>
  <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Successfully created gist at "</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">html_url</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p><a href="https://jsfiddle.net/ssaunier/72zmm6zh/11/">Demo</a></p>

<hr>

<h2>Your turn!</h2>

<h1>Projects - Product &amp; tech culture in startups</h1>

<h2>Entrepreneur roadmap</h2>

<p><img src="./Le Wagon - Lectures_files/tech-approach-ff21e912e1281b1c593f5463d17ea02f.png" alt=""></p>

<h2>Lean approach</h2>

<p><img src="./Le Wagon - Lectures_files/tech-approach-proto-460a2192b700b345dce3e73d7b01b6e3.png" alt=""></p>

<h2>"Think-big" approach</h2>

<p><img src="./Le Wagon - Lectures_files/tech-approach-scale-b1faa69d8a010e1850951393702035c2.png" alt=""></p>

<h2>In any case</h2>

<p><img src="./Le Wagon - Lectures_files/tech-approach-measure-ecf092e45cf3e4fe4a287d322bf02109.png" alt=""></p>

<hr>

<h2>Product pitch</h2>

<ul>
<li><strong>Target</strong>: what's my user typical profile?</li>
<li><strong>Problem</strong>: which problem do I tackle?</li>
<li><strong>Product</strong>: what's my <strong>techniqueal</strong> solution to solve it?</li>
</ul>

<h2>Think <strong><a href="http://en.wikipedia.org/wiki/Minimum_viable_product">MVP</a></strong></h2>

<p><img src="./Le Wagon - Lectures_files/mvp-02b16ec3cc6bf41a5813ff91a96ebf07.png" alt=""></p>

<p>Google started with a <strong>simple search</strong>.</p>

<h2>Use case: Kudoz</h2>

<p><a href="http://www.getkudoz.com/"><img src="./Le Wagon - Lectures_files/kudoz-cc71ab389f4b78d99cfec12c5bde3e29.jpg" alt=""></a></p>

<p><strong>What's their product pitch?</strong></p>

<h2>Use case: Roadstr</h2>

<p><a href="http://www.roadstr.fr/"><img src="./Le Wagon - Lectures_files/roadstr-0c6358132a8c1b269d9e387ed67f2f25.jpg" alt=""></a></p>

<p><strong>What's their product pitch?</strong></p>

<h2>[Pitch time]</h2>

<p><strong>Your turn</strong> to pitch your product to your mates and teachers.</p>

<hr>

<h2>Proof of concept</h2>

<ul>
<li><strong>Many ways</strong> to prove your concept (crowd-funding, door-to-door..)</li>
<li>A canonical approach: the <strong>landing page</strong></li>
<li>Don't neglect other aspects (like community management..)</li>
</ul>

<h2>A good landing page</h2>

<ul>
<li>Should translate clearly your product pitch (<strong>pain &amp; solution</strong>)</li>
<li>Should be <strong>well-designed</strong> (credibility)</li>
<li>Should embed a <strong>newsletter</strong> or <strong>web-form</strong> to <strong>capture some lead</strong></li>
<li>Should give you a <strong>first CRM system</strong></li>
</ul>

<h2>Landing page tools</h2>

<p><code>From less =&gt; to more =&gt; customizable</code></p>

<p><a href="http://launchrock.co/"><img src="./Le Wagon - Lectures_files/launchrock-29cf708528e11aeb80a8ccf5a29fea72.png" alt="launchrock"></a>
<a href="https://www.strikingly.com/"><img src="./Le Wagon - Lectures_files/strikingly-e4a7eb9a068117b12837ead0f4f376c2.png" alt="strikingly"></a>
<a href="http://www.squarespace.com/"><img src="./Le Wagon - Lectures_files/squarespace-113a63bd527be7bcd74a60c80ac60bed.jpeg" alt="squarespace"></a></p>

<h2>But..</h2>

<p>.. <strong>no hands on source code</strong> for further customization</p>

<h2>Learn front-end basics</h2>

<ul>
<li>HTML / CSS / Bootstrap =&gt; entry cost <strong>very low</strong></li>
<li>You keep hands on design</li>
<li>You can <strong>integrate external web-services</strong> and <strong>start delivering value</strong></li>
<li>Every web-entrepreneur should master front-end</li>
</ul>

<h2>Front-End languages</h2>

<p>The languages <strong>your browser speaks</strong></p>

<p><img src="./Le Wagon - Lectures_files/front-languages-13ea918e6ef5af631a3f604315306bba.png" alt="gh pages"></p>

<h2>CSS prototyping libraries</h2>

<p><a href="http://getbootstrap.com/"><img src="./Le Wagon - Lectures_files/bootstrap-83ceb792b026c1322972750a31c382d2.png" alt="bootstrap"></a>
<a href="http://foundation.zurb.com/"><img src="./Le Wagon - Lectures_files/foundation-71410ad8b830f2abb54ed260416fa8cf.png" alt="foundation"></a></p>

<h2>Front-end: tutorials</h2>

<h4>HTML / CSS / <a href="http://getbootstrap.com/">Bootstrap</a></h4>

<iframe width="640" height="390" src="./Le Wagon - Lectures_files/SXBX5UFHW64.html" frameborder="0" allowfullscreen=""></iframe>

<h2>Deploying your site</h2>

<p><a href="http://www.lewagon.org/blog/publier-site-github-pages"><img src="./Le Wagon - Lectures_files/gh-pages-718d0923cbece09824b7e8728cc6ebe5.jpg" alt="gh pages"></a></p>

<h2>Changing your domain name</h2>

<p>Use <a href="http://www.lewagon.org/blog/siteweb-domaine-mail-personalise">our tutorial</a></p>

<h2>External services</h2>

<p><img src="./Le Wagon - Lectures_files/frontend-services-8820b1b4a626c8f7c4ff03f047543f03.png" alt="gh pages"></p>

<h2>Activate - web-form services</h2>

<p><a href="https://formkeep.com/"><img src="./Le Wagon - Lectures_files/formkeep-d196305856bcb97bae27f731c13fac0c.png" alt="wufoo"></a>
<a href="http://www.wufoo.com/"><img src="./Le Wagon - Lectures_files/wufoo-fc50fa26ffb7f810689f666b7b428e18.png" alt="form keep"></a></p>

<h2>Activate - newsletter service</h2>

<p><a href="http://mailchimp.com/"><img src="./Le Wagon - Lectures_files/mailchimp-dcabaa8306c57d393f359a7f89cea435.png" alt="mailchimp"></a></p>

<h2>Measure</h2>

<p><img src="./Le Wagon - Lectures_files/analytics-a7034c0eb9cf9344f218bae87b441805.png" alt="analytics"></p>

<h3>Level-0 metrics</h3>

<ul>
<li>Number of <strong>Mailchimp subscribers</strong></li>
<li>You can launch marketing campaigns on your lists</li>
</ul>

<p><img src="./Le Wagon - Lectures_files/mailchimp-metrics-d81959dc93ca67f323ee89b2bcc067b5.png" alt="analytics"></p>

<h3>Simple questions</h3>

<p><a href="https://karr.lewagon.org/bitly.com"><img src="./Le Wagon - Lectures_files/bitly-c5b7a4e3854f18c344d79479b9602cc4.jpg" alt="bitly"></a></p>

<p>URL shortener <strong>&amp; analytics tool</strong></p>

<p><br></p>

<p><a href="http://bit.ly/1A8sZC0" class="btn">Demo: Offer 1</a></p>

<p><br></p>

<p><a href="http://bit.ly/1ubl0Av" class="btn blue">Demo: Offer 2</a></p>

<h3>Simple answers</h3>

<p><img src="./Le Wagon - Lectures_files/bitly-metrics-97c835abc82ac25f13bbc5bf9a80fad8.png" alt="bitly"></p>

<h3>Advanced questions</h3>

<p><a href="http://www.google.com/intl/fr/analytics/premium/"><img src="./Le Wagon - Lectures_files/ga-a7021792ecf2a8c7e23e15e7b5b12f61.jpg" alt="ga"></a></p>

<h3>Advanced answers (1)</h3>

<p><img src="./Le Wagon - Lectures_files/ga-metrics-referrals-42a64ea710b18ad73dcccaa495f33b73.png" alt="ga metrics referrals"></p>

<h3>Advanced answers (2)</h3>

<p><img src="./Le Wagon - Lectures_files/ga-metrics-new-2dd15666bdf7ef4edc8b3ad9d0cc8e8a.png" alt="ga metrics new"></p>

<h3>Check your bounce rate</h3>

<p><img src="./Le Wagon - Lectures_files/bounce-rate-d8eeb1f1223f747dcc0904c6ab1e2d2c.jpg" alt="bounce"></p>

<h3>Growth Hacking tools</h3>

<p><a href="http://snip.ly/"><img src="./Le Wagon - Lectures_files/sniply-e3961aaf6d8cc940ceb6fbd48ef41c7c.png" alt="ga"></a></p>

<p><br></p>

<p>URL shortener <strong>&amp; growth hacking tool</strong></p>

<p><strong>Ex</strong>: http://snip.ly/xRyF</p>

<hr>

<h2>Fast prototyping</h2>

<h2>We live in a world of APIs</h2>

<h2>What's an API?</h2>

<blockquote>
<p>In computer programming, an application programming interface (API) is a set of routines, protocols, and tools for building software applications. An API expresses a software component in terms of its operations, inputs, outputs, and underlying types. An API defines functionalities that are independent of their respective implementations, which allows definitions and implementations to vary without compromising each other. A good API makes it easier to develop a program by providing all the building blocks. A programmer then puts the blocks together.
<cite><a href="http://en.wikipedia.org/wiki/Application_programming_interface">Wikipedia</a></cite></p>
</blockquote>

<h3>humm...</h3>

<h2>Well, what's a website?</h2>

<p><img src="./Le Wagon - Lectures_files/client-535647062928f53d29d350960e4ac5c9.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/client-with-browser-16b36b27fc4b72c6e772ecc0a732ac82.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/client-request-801b3ac071bafffea674bed582be64bb.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/client-full-response-726bf1bfaef58b7d8bb1ffcee5089e95.png" alt=""></p>

<h3>Humans need friendly interface</h3>

<ul>
<li><strong>website</strong>: Application <strong>Human</strong> Interface (HTML / CSS)</li>
</ul>

<h3>Computers don't like fancy</h3>

<ul>
<li><strong>API</strong>: Application <strong>Programming</strong> Interface (JSON or XML)</li>
</ul>

<p><img src="./Le Wagon - Lectures_files/web-api-c3fc64790bf1930f7b349f9735e65a8f.png" alt=""></p>

<h2>What humans like to see</h2>

<p><img src="./Le Wagon - Lectures_files/people-html-b86f6d5719ceb2ac7e243e1b1a048d36.png" alt=""></p>

<p><strong>designed</strong> content</p>

<h2>What machines like to see</h2>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="nt">"richestPeople"</span><span class="p">:[</span>
    <span class="p">{</span><span class="nt">"firstName"</span><span class="p">:</span><span class="s2">"Bill"</span><span class="p">,</span> <span class="nt">"lastName"</span><span class="p">:</span><span class="s2">"Gates"</span><span class="p">,</span> <span class="nt">"value"</span><span class="p">:</span><span class="s2">"81"</span><span class="p">},</span>
    <span class="p">{</span><span class="nt">"firstName"</span><span class="p">:</span><span class="s2">"Carlos"</span><span class="p">,</span> <span class="nt">"lastName"</span><span class="p">:</span><span class="s2">"Slim"</span><span class="p">,</span> <span class="nt">"value"</span><span class="p">:</span><span class="s2">"79"</span><span class="p">},</span>
    <span class="p">{</span><span class="nt">"firstName"</span><span class="p">:</span><span class="s2">"Warren"</span><span class="p">,</span> <span class="nt">"lastName"</span><span class="p">:</span><span class="s2">"Buffet"</span><span class="p">,</span> <span class="nt">"value"</span><span class="p">:</span><span class="s2">"72"</span><span class="p">}</span>
<span class="p">]}</span>
</code></pre></div>
<p><strong>only structured</strong> content</p>

<h2>Popular services all have JSON APIs..</h2>

<p>Ex: <strong><a href="https://developers.facebook.com/tools/explorer/">Facebook graph API explorer</a></strong></p>

<h2>They know everybody isn't a developer</h2>

<p>Most of these services will give you the <strong>embed code</strong> so that you can just <strong>copy/paste some code in your HTML</strong>.</p>

<p><img src="./Le Wagon - Lectures_files/frontend-services-api-af3d2d472e118d66cf12c773c6a98a87.png" alt=""></p>

<h2>API use - connect social media</h2>

<ul>
<li>Read-write data from facebook / twitter / instagram <strong>from your website</strong>.</li>
</ul>

<h3>Example:</h3>

<ul>
<li>Include a twitter feed</li>
<li>Include a share button on facebook / twitter / g+ / ...</li>
</ul>

<h2>API use - make your site interactive</h2>

<p><a href="http://www.lewagon.org/blog/tutorial-olark"><img src="./Le Wagon - Lectures_files/olark-6ea6eddf54a0af476cf5236619dd11d8.png" alt="olark"></a></p>

<p><a href="https://disqus.com/"><img src="./Le Wagon - Lectures_files/disqus-f517d771d37060e140c7c720b1465777.png" alt="disqus"></a></p>

<h2>API use - build prototypes</h2>

<p><a href="https://zapier.com/"><img src="./Le Wagon - Lectures_files/zapier-1a0f8fde4f83dd8322ffb48fb0d5e950.png" alt="zapier"></a></p>

<p>Zapier is the <strong>APIs plumber</strong>. Use it to build <strong>prototypes delivering values</strong>.</p>

<h2>Use case: Le Wagon application process (1)</h2>

<p><img src="./Le Wagon - Lectures_files/trello-step-one-158bdcea9f9429355196d2108064a5f9.png" alt="zapier"></p>

<h2>Use case: Le Wagon application process (2)</h2>

<p><img src="./Le Wagon - Lectures_files/trello-step-two-48e57bdde58a8e868129ef771b5c3c02.png" alt="zapier"></p>

<h2>API use - create backends for you</h2>

<p><a href="https://parse.com/"><img src="./Le Wagon - Lectures_files/parse-api-861432e208dbc5f8a464123d3f2c1dc5.png" alt="zapier"></a></p>

<p>You still have to <strong>code the front-end client :)</strong></p>

<hr>

<h2>Build &amp; Scale</h2>

<ul>
<li>Prototypes are good</li>
<li>At one point they are <strong>limited</strong> and <strong>don't scale</strong></li>
<li>You need to code your own <strong>backend</strong></li>
</ul>

<p>What's a <strong>backend</strong>?</p>

<p><img src="./Le Wagon - Lectures_files/client-server-full-85ef4f3383bba69b98c43a297a5dbb6d.png" alt="client server"></p>

<h3>Backend languages</h3>

<p><img src="./Le Wagon - Lectures_files/backend-languages-90256d975d5e355afbc6560cc308c568.jpg" alt="backend"></p>

<hr>

<h2>Collaboration &amp; project management</h2>

<h2>Collaborate - User stories (1)</h2>

<p>Product pitch will help you write <strong>user stories</strong> to define your <strong><a href="http://en.wikipedia.org/wiki/Minimum_viable_product">MVP</a></strong></p>

<h2>Collaborate - User stories (2)</h2>

<blockquote>
<p>I want to build a social app with geolocation so that anyone, at any moment,
can organize real-time dinners and then receive analytics on expenses.. I see this as a connected shopping list for friends.. or more like a blablablabla...</p>

<p><cite>Some web-entrepreneur in the wrong direction</cite></p>
</blockquote>

<p>Developers <strong>don't</strong> understand <strong>blablabla</strong>.</p>

<p>Developers <strong>do</strong> understand <strong>user stories</strong>. They can assess complexity &amp; time cost.</p>

<h2>Collaborate - User stories (3)</h2>

<ul>
<li><strong>As a</strong> visitor, <strong>I can</strong> create an account</li>
<li><strong>As a</strong> user, <strong>I can</strong> create groups</li>
<li><strong>As a</strong> user, <strong>I can</strong> add existing friends on a group</li>
<li><strong>As a</strong> user, <strong>I can</strong> invite new friends on a group</li>
<li><strong>As a</strong> organizer, <strong>I can</strong> create dinners on a group</li>
<li><strong>As an</strong> invitee, <strong>I can</strong> comment on a dinner</li>
<li><strong>As an</strong> invitee, <strong>I can</strong> accept/decline a dinner</li>
<li><strong>As an</strong> invitee, <strong>I can</strong> tell what I bring to a dinner</li>
<li><strong>As an</strong> invitee, <strong>I can</strong> tell how much I paid for that</li>
<li>etc..</li>
</ul>

<h2>Collaborate - Project management</h2>

<p><a href="https://trello.com/b/nC8QJJoZ/trello-development"><img src="./Le Wagon - Lectures_files/trello-61afc3c5a0a777a224abc33a6bc432db.png" alt="trello"></a></p>

<h2>Collaborate - Developer workflow</h2>

<p><a href="https://github.com/"><img src="./Le Wagon - Lectures_files/github-29293a3c7d0ead5f493ed407f1675449.png" alt="github"></a></p>

<h1>Rails - Week 1 - Rails Basics</h1>

<h2>Install Rails</h2>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>gem install rails -v 4.2.6
</code></pre></div>
<p><strong>Quit and restart</strong> your terminal when it's done (<code></code> + <code>Q</code>)!</p>

<p><br><br>
On Ubuntu, run as well:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>sudo apt-get install nodejs
</code></pre></div>
<hr>

<h2>History</h2>

<p><img src="./Le Wagon - Lectures_files/rails-history-david-97c0eb58f35cc68b092b888563460219.jpg" alt=""></p>

<p>Created in 2003 by David Heinemeier Hansson, while working on Basecamp.</p>

<p>Extracted Ruby on Rails and released it as open source code in July of 2004</p>

<h3>3 principles</h3>

<ul>
<li>Ruby</li>
<li>MVC</li>
<li>Programmer happiness</li>
</ul>

<h3>Releases</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">1.0   December 13, 2005
1.2   January 19, 2007

2.0   December 7, 2007
2.1   June 1, 2008
2.2   November 21, 2008
2.3   March 16, 2009

3.0   August 29, 2010
3.1   August 31, 2011
3.2   January 20, 2012

4.0   June 25, 2013
4.1   April 8, 2014
4.2   December 19, 2014
</code></pre></div>
<h2>Philosophy</h2>

<ul>
<li>Convention over Configuration</li>
<li>Don't Repeat Yourself</li>
</ul>

<p><br><br>
(both mean write less code)</p>

<h2>Going strong</h2>

<p>More than 3400 <a href="http://contributors.rubyonrails.org/">contributors</a>.</p>

<p>Code is on GitHub at <a href="http://github.com/rails/rails">rails/rails</a></p>

<h2>Community</h2>

<p>+100k gems at <a href="http://rubygems.org/">rubygems.org</a>. How do I know which one to use?</p>

<ul>
<li>Ask teachers</li>
<li>Browse the <a href="https://www.ruby-toolbox.com/categories/by_group">Ruby Toolbox</a></li>
</ul>

<hr>

<h2>How every new rails project starts</h2>

<h3>Create a new rails app</h3>

<p>First, go to your personal code folder:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd</span> ~/code/<span class="nv">$GITHUB_USERNAME</span>
</code></pre></div>
<p><strong>Then</strong> create a new rails app</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails new lacuillere -T
</code></pre></div>
<p>This creates a new folder <code>~/code/$GITHUB_USERNAME/lacuillere</code>.</p>

<h3>Set up git</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd </span>lacuillere
<span class="nv">$ </span><span class="nb">pwd</span>
<span class="c"># =&gt; ~/code/$GITHUB_USERNAME/lacuillere</span>
<span class="nv">$ </span>git init
<span class="nv">$ </span>git add .
<span class="nv">$ </span>git commit -m <span class="s2">"Starting awesome development with Rails :)"</span>
</code></pre></div>
<h3>Push project to GitHub</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git remote -v
<span class="c"># =&gt; No remotes yet! Cannot push!</span>
</code></pre></div>
<p>Install the <code>hub</code> binary, with <code>brew install hub</code> (Mac) or <code>gem install hub</code> (Linux).
Then, just run:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>hub create
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git remote -v
<span class="c"># =&gt; An `origin` remote is now set!</span>
<span class="nv">$ </span>git push -u origin master  <span class="c"># Push the generated rails app to GitHub</span>
<span class="nv">$ </span>hub browse                 <span class="c"># Will open your browser to the new directory</span>
</code></pre></div>
<h3>Launch the rails server</h3>

<p>Open a <strong>new tab</strong> in your terminal:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd</span> ~/code/<span class="nv">$GITHUB_USERNAME</span>/lacuillere <span class="c"># if not already there</span>
<span class="nv">$ </span>rails s
</code></pre></div>
<p>Keep this tab <strong>opened</strong>!</p>

<p>Open your terminal and go to <a href="http://localhost:3000/">http://localhost:3000</a></p>

<p><img src="./Le Wagon - Lectures_files/rails_new_welcome-acc0069505f08d20b765ae8b76db7f12.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/rails_new_terminal-f2f9ec1819af0fa2a27a904d1bd49805.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/rails_new_basic_schema-92bfb6a63a985c90e016e3bd681730dd.png" alt=""></p>

<hr>

<h2>Rails Architecture</h2>

<h3>Open the project in Sublime Text:</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">pwd</span>
<span class="c"># =&gt; ~/code/$GITHUB_USERNAME/lacuillere</span>
<span class="nv">$ </span>stt
</code></pre></div>
<pre class="bash hljs">.
 <strong style="color: #117B8D">app</strong>
&nbsp;&nbsp;  <strong style="color: #117B8D">controllers</strong>
&nbsp;&nbsp; &nbsp;&nbsp;  application_controller.rb
&nbsp;&nbsp;  <strong style="color: #117B8D">models</strong>
&nbsp;&nbsp;  <strong style="color: #117B8D">views</strong>
&nbsp;&nbsp;      layouts
&nbsp;&nbsp;          application.html.erb
 <strong style="color: #117B8D">config</strong>
     <strong style="color: #117B8D">database.yml</strong>
 &nbsp;&nbsp;  <strong style="color: #117B8D">routes.rb</strong>
  
</pre>

<h3>MVC Revision</h3>

<p><img src="./Le Wagon - Lectures_files/rails_new_mvc_schema_1-e3a94112e48f987fce73ad5100c9fffe.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/rails_new_mvc_schema_2-6fded7f06c42284e405acf9f58f5f1c5.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/rails_new_mvc_schema_3-df94816c8ed202805d8b9b137e8b41d2.png" alt=""></p>

<hr>

<h2>Controller</h2>

<p>Let's add basic pages to our app (contact, about).</p>

<p>We need a new controller, which we'll generate:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails generate controller pages contact about
<span class="c">#      create  app/controllers/pages_controller.rb</span>
<span class="c">#       route  get 'pages/about'</span>
<span class="c">#       route  get 'pages/contact'</span>
<span class="c">#      invoke  erb</span>
<span class="c">#      create    app/views/pages</span>
<span class="c">#      create    app/views/pages/contact.html.erb</span>
<span class="c">#      create    app/views/pages/about.html.erb</span>
</code></pre></div>
<p>I can now navigate to:</p>

<ul>
<li><a href="http://localhost:3000/pages/contact">http://localhost:3000/pages/contact</a></li>
<li><a href="http://localhost:3000/pages/about">http://localhost:3000/pages/about</a></li>
</ul>

<p><br><br></p>

<p>The generator created 2 routes, you can find them in <code>config/routes.rb</code>.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s1">'pages/contact'</span>
  <span class="n">get</span> <span class="s1">'pages/about'</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/pages_controller.rb</span>
<span class="k">class</span> <span class="nc">PagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">contact</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">about</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<pre class="bash hljs view">.
 app
 &nbsp;&nbsp;  views
 &nbsp;&nbsp;      <strong style="color: #117B8D">pages</strong>
 &nbsp;&nbsp;          <strong style="color: #117B8D">about</strong>.html.erb
 &nbsp;&nbsp;          <strong style="color: #117B8D">contact</strong>.html.erb
</pre>

<h3>Customizing routes</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s1">'about'</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">'pages#about'</span>
  <span class="n">get</span> <span class="s1">'contact'</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">'pages#contact'</span>

  <span class="c1"># Generic syntax:</span>
  <span class="c1"># verb 'path', to: 'controller#action' (action is an instance method)</span>
<span class="k">end</span>
</code></pre></div>
<p>We ditched the <code>/pages</code> from the URL path:</p>

<ul>
<li><a href="http://localhost:3000/about">http://localhost:3000/about</a></li>
<li><a href="http://localhost:3000/contact">http://localhost:3000/contact</a></li>
</ul>

<h3>Root path</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="c1"># [...]</span>
  <span class="n">root</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">'pages#home'</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/pages_controller.rb</span>
<span class="k">class</span> <span class="nc">PagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">home</span>
  <span class="k">end</span>
  <span class="c1"># [...]</span>
<span class="k">end</span>
</code></pre></div>
<pre class="bash hljs view">.
 app
 &nbsp;&nbsp;  views
 &nbsp;&nbsp;      <strong style="color: #117B8D">pages</strong>
 &nbsp;&nbsp;          <strong style="color: #117B8D">home</strong>.html.erb
</pre>

<h3>Convention over Configuration</h3>

<p><img src="./Le Wagon - Lectures_files/controller_view_convention_over_configuration-654a7a306c0213bb92daf7d7b76a07ed.png" alt=""></p>

<h3>And if you get lost</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rake routes
</code></pre></div>
<div class="down-arrow"></div>
<div class="highlight"><pre><code class="language-text" data-lang="text"> Prefix Verb URI Pattern        Controller#Action
   root GET  /                  pages#home
  about GET  /about(.:format)   pages#about
contact GET  /contact(.:format) pages#contact
</code></pre></div>
<hr>

<h2>View</h2>

<pre class="bash hljs view">.
 app
 &nbsp;&nbsp;  views
 &nbsp;&nbsp;      <strong style="color: #117B8D">layouts</strong>
&nbsp; &nbsp;     &nbsp;&nbsp;  <strong style="color: #117B8D">application</strong>.html.erb
 &nbsp;&nbsp;      pages
 &nbsp;&nbsp;          about.html.erb
 &nbsp;&nbsp;          contact.html.erb
 &nbsp;&nbsp;          home.html.erb
</pre>

<p><img src="./Le Wagon - Lectures_files/layout_view-0a63978637f12f5cf0dd0a471bcd02b3.png" alt=""></p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="x">&lt;html&gt;</span>
<span class="x">&lt;head&gt;</span>
<span class="x">  &lt;title&gt;Lacuillere&lt;/title&gt;</span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span>    <span class="s1">'application'</span><span class="p">,</span> <span class="ss">media</span><span class="p">:</span> <span class="s1">'all'</span><span class="p">,</span> <span class="s1">'data-turbolinks-track'</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s1">'application'</span><span class="p">,</span> <span class="s1">'data-turbolinks-track'</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;/head&gt;</span>
<span class="x">&lt;body&gt;</span>

<span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">&lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</code></pre></div>
<h3>A typical generated view</h3>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;h1&gt;Pages#home&lt;/h1&gt;</span>
<span class="x">&lt;p&gt;Find me in app/views/pages/home.html.erb&lt;/p&gt;</span>
</code></pre></div>
<p>View is inserted in its layout at the line:</p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="o">=&gt;</span>
</code></pre></div>
<h3>ERB</h3>

<p>View files are <code>.html.erb</code> (".erb" stands for "<strong>e</strong>mbedded <strong>r</strong>u<strong>b</strong>y").</p>

<p>We will mix Ruby inside HTML.</p>

<h2>Syntax</h2>

<ul>
<li>You can write standard HTML</li>
<li>You can execute ruby code inside <code>&lt;% %&gt;</code></li>
<li>You can execute ruby code and add it to the HTML with <code>&lt;%= %&gt;</code> (~ <code>puts</code>)</li>
</ul>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;h1&gt;A 100%-HTML greetings!&lt;/h1&gt;</span>

<span class="cp">&lt;%</span> <span class="nb">name</span> <span class="o">=</span> <span class="s2">"boris"</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">&lt;p&gt;Hello </span><span class="cp">&lt;%=</span> <span class="nb">name</span><span class="o">.</span><span class="n">capitalize</span> <span class="cp">%&gt;</span><span class="x">!&lt;/p&gt;</span>
</code></pre></div>
<div class="down-arrow"></div>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;h1&gt;</span>A 100%-HTML greetings!<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span>Hello Boris!<span class="nt">&lt;/p&gt;</span>
</code></pre></div>
<h3>Get the date</h3>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;p&gt;Today we are </span><span class="cp">&lt;%=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%d/%m/%Y"</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x">&lt;p&gt;</span>
</code></pre></div>
<div class="down-arrow"></div>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;p&gt;</span>Today we are 8/11/2014<span class="nt">&lt;/p&gt;</span>
</code></pre></div>
<h3>Loop</h3>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%</span> <span class="n">ingredients</span> <span class="o">=</span> <span class="o">[</span> <span class="s1">'milk'</span><span class="p">,</span> <span class="s1">'sugar'</span><span class="p">,</span> <span class="s1">'bread'</span> <span class="o">]</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">&lt;h2&gt;Shopping list&lt;/h2&gt;</span>

<span class="x">&lt;ol&gt;</span>
<span class="cp">&lt;%</span> <span class="n">ingredients</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">ingredient</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">ingredient</span> <span class="cp">%&gt;</span><span class="x">&lt;/li&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;/ol&gt;</span>
</code></pre></div>
<div class="down-arrow"></div>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;h2&gt;</span>Shopping list<span class="nt">&lt;/h2&gt;</span>

<span class="nt">&lt;ol&gt;</span>
  <span class="nt">&lt;li&gt;</span>milk<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>sugar<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>bread<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ol&gt;</span>
</code></pre></div>
<hr>

<h2>Controller &lt;=&gt; View</h2>

<h3>Controller instance variables...</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/pages_controller.rb</span>
<span class="k">class</span> <span class="nc">PagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">home</span>
    <span class="vi">@last_year</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="mi">1</span><span class="o">.</span><span class="n">year</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>...are accessible by the associated action view.</p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;h1&gt;</span>
<span class="x">  Last year was exactly </span><span class="cp">&lt;%=</span> <span class="vi">@last_year</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;/h1&gt;</span>
</code></pre></div>
<h3>Where's the model?</h3>

<p>Let's anticipate tomorrow's lecture.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/post.rb</span>
<span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s1">'/posts'</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">'posts#index'</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/posts_controller.rb</span>
<span class="k">class</span> <span class="nc">PostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@posts</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">all</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%</span> <span class="vi">@posts</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">post</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;h2&gt;</span><span class="cp">&lt;%=</span> <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="cp">%&gt;</span><span class="x">&lt;/h2&gt;</span>
<span class="x">  &lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="n">post</span><span class="o">.</span><span class="n">content</span> <span class="cp">%&gt;</span><span class="x">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<p>Controller instance variables will often be model instances or array of model instances.</p>

<hr>

<h2>Params</h2>

<h3>Params coming from the Query String</h3>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;form action="/" method="get"&gt;</span>
<span class="x">  &lt;input type="text" name="search_term"&gt;</span>
<span class="x">  &lt;input type="submit"&gt;</span>
<span class="x">&lt;/form&gt;</span>
</code></pre></div>
<p>Clicking on the submit button, the browser will make the following request:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">GET /?search_term=something_you_typed
</code></pre></div>
<p>The  controller can then retrieve this parameter passed in the <strong>query string</strong>.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/pages_controller.rb</span>
<span class="k">class</span> <span class="nc">PagesController</span>
  <span class="k">def</span> <span class="nf">home</span>
    <span class="vi">@search_term</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:search_term</span><span class="o">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Query string</h3>

<p>Everything between the <code>?</code> and the <code>#</code> in the URL.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">GET /some_path?first_name=alan&amp;last_name=turing#some-facultative-anchor
</code></pre></div>
<div class="down-arrow"></div>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># `params` is the following hash:</span>
<span class="p">{</span>
  <span class="ss">first_name</span><span class="p">:</span> <span class="s2">"alan"</span><span class="p">,</span>
  <span class="ss">last_name</span><span class="p">:</span> <span class="s2">"turing"</span>
<span class="p">}</span>
</code></pre></div>
<h3>Params coming from the request body</h3>

<p>When do we have a request body?</p>

<h3><code>POST</code></h3>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;form action="/search" method="post"&gt;</span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">hidden_field_tag</span> <span class="ss">:authenticity_token</span><span class="p">,</span> <span class="n">form_authenticity_token</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;input type="text" name="search_term"&gt;</span>
<span class="x">  &lt;input type="submit"&gt;</span>
<span class="x">&lt;/form&gt;</span>
</code></pre></div>
<p>Clicking on the submit button, the browser will make the following request:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">Header: POST /

Body: search_term=something_you_typed
</code></pre></div>
<p>The  controller can then retrieve this parameter passed in the <strong>request body</strong>.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/pages_controller.rb</span>
<span class="k">class</span> <span class="nc">PagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">search</span>
    <span class="vi">@search_term</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:search_term</span><span class="o">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Wait, what was the route?</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">post</span> <span class="s1">'search'</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">'pages#search'</span>
<span class="k">end</span>
</code></pre></div>
<h3>Params coming from the URL path</h3>

<p>Anticipation on tomorrow's lecture</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s1">'posts/:id'</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">'posts#show'</span>
<span class="k">end</span>
</code></pre></div>
<p>When the browser navigates to the following URL:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">GET /posts/23
</code></pre></div>
<p>The  controller can then retrieve this parameter passed in the <strong>path</strong>.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/posts_controller.rb</span>
<span class="k">class</span> <span class="nc">PostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">show</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span>
    <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Summary</h3>

<p>The <code>params</code> hash is populated from 3 sources:</p>

<ul>
<li>The URL <strong>query string</strong> arguments</li>
<li>The <strong>body</strong> of a <code>POST</code> request</li>
<li>The URL <strong>path</strong> of parametric routes</li>
</ul>

<hr>

<h2>Links</h2>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"ANCHOR_URL"</span><span class="nt">&gt;</span>ANCHOR_TEXT<span class="nt">&lt;/a&gt;</span>
</code></pre></div>
<h3>Use <code>link_to</code></h3>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="no">ANCHOR_TEXT</span><span class="p">,</span> <span class="no">ANCHOR_URL</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<p><code>ANCHOR_URL</code> will use a <strong>path helper</strong> based on the route name.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s1">'about'</span><span class="p">,</span>   <span class="ss">to</span><span class="p">:</span> <span class="s1">'pages#about'</span>
  <span class="n">get</span> <span class="s1">'contact'</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">'pages#contact'</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rake routes
 Prefix Verb URI Pattern        Controller#Action
  about GET  /about<span class="o">(</span>.:format<span class="o">)</span>   pages#about
contact GET  /contact<span class="o">(</span>.:format<span class="o">)</span> pages#contact
</code></pre></div>
<p><br>
You can use in the view:</p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"some anchor text"</span><span class="p">,</span> <span class="n">about_path</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s1">'bonjour'</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">'pages#welcome'</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:welcome</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rake routes
 Prefix Verb URI Pattern        Controller#Action
welcome GET  /bonjour<span class="o">(</span>.:format<span class="o">)</span> pages#welcome
</code></pre></div>
<p><br>
You can use in the view:</p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"some anchor text"</span><span class="p">,</span> <span class="n">welcome_path</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<hr>

<h2>Useful tools</h2>

<h3>Better errors gem</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s2">"better_errors"</span>
  <span class="n">gem</span> <span class="s2">"binding_of_caller"</span>
<span class="k">end</span>
</code></pre></div>
<p>Then run in your terminal</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ bundle install
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/better_errors-46ef5416d1918a570dd057ca25489192.png" alt="">
<br>
Will basically give you an IRB in your browser each time you get an error.</p>

<hr>

<p>Your turn! Dive into the <strong>Routing</strong>/<strong>Controller</strong>/<strong>View</strong> with the exercises.</p>

<p>Tomorrow, we'll add the <strong>Model</strong> layer with the well-known <strong>ActiveRecord</strong>!</p>

<h1>Rails - Week 1 - Rails CRUD</h1>

<h2>ActiveRecord in Rails</h2>

<ul>
<li><strong>The same good old ActiveRecord</strong> you <strong>already know</strong></li>
<li>Rails just has some useful generators for models &amp; migrations.</li>
</ul>

<h3>Model Generator</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails generate model Restaurant name:string stars:integer
</code></pre></div>
<div class="down-arrow"></div>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">      invoke  active_record
      create    db/migrate/20141108192211_create_restaurants.rb
      create    app/models/restaurant.rb
</code></pre></div>
<h3>Auto-generated files</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># db/migrate/20141108192211_create_restaurants.rb</span>
<span class="k">class</span> <span class="nc">CreateRestaurants</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:restaurants</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:name</span>
      <span class="n">t</span><span class="o">.</span><span class="n">integer</span> <span class="ss">:stars</span>

      <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span> <span class="ss">null</span><span class="p">:</span> <span class="kp">false</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/restaurant.rb</span>
<span class="k">class</span> <span class="nc">Restaurant</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
<span class="k">end</span>
</code></pre></div>
<h3>Do not forget: apply the migration to schema</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rake db:migrate
</code></pre></div>
<p><br><br></p>

<p>This will create (and update then) the <code>db/schema.rb</code> file which holds
all your table definitions. Refer to it when in doubt about a table name
or a column name.</p>

<h3>And of course</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git status
<span class="nv">$ </span>git add .
<span class="nv">$ </span>git commit -m <span class="s2">"Add restaurant model"</span>
</code></pre></div>
<h3><code>rails destroy</code></h3>

<p><strong>Just after</strong> the <code>rails g model</code>, if you made a typo on your model name, run:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails destroy model Restaurant
</code></pre></div>
<p>It will remove the migration and the <code>app/models/restaurant.rb</code>.</p>

<hr>

<h2>Migration generator</h2>

<p>Not the same as <strong>model</strong> generator! Use it to <strong>update</strong> an <strong>existing</strong> model.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g migration AddAddressToRestaurants
</code></pre></div>
<div class="down-arrow"></div>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">      invoke  active_record
      create    db/migrate/20141108192916_add_address_to_restaurants.rb
</code></pre></div>
<p>This generator creates a file skeleton. There's still work to do.</p>

<h3>Write your migration code</h3>

<p>The migration is empty by default. Populate the <code>change</code> method.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># db/migrate/20141108192916_add_address_to_restaurants.rb</span>

<span class="k">class</span> <span class="nc">AddAddressToRestaurants</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">add_column</span> <span class="ss">:restaurants</span><span class="p">,</span> <span class="ss">:address</span><span class="p">,</span> <span class="ss">:string</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rake db:migrate
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git add .
<span class="nv">$ </span>git commit -m <span class="s2">"Add address to Restaurant"</span>
</code></pre></div>
<h3>Methods to be used in <code>change</code></h3>

<ul>
<li><code>add_column</code></li>
<li><code>change_column</code></li>
<li><code>rename_column</code></li>
<li><code>remove_column</code></li>
</ul>

<p><br><br></p>

<p>(And for 1:n, <code>add_reference</code>)</p>

<p><a href="http://guides.rubyonrails.org/migrations.html">Read more on Migrations</a></p>

<h2>Rake DB tasks</h2>

<ul>
<li><strong><code>rake db:drop</code></strong> - Drop the database (lose all your data!)</li>
<li><strong><code>rake db:create</code></strong> - Create the database with an empty schema</li>
<li><strong><code>rake db:migrate</code></strong> - Run pending migrations on the database schema</li>
<li><strong><code>rake db:rollback</code></strong> - Revert the last migration</li>
<li><strong><code>rake db:reset</code></strong> - Drop database + replay all migration</li>
</ul>

<hr>

<h2>Rails console</h2>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails console
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">Loading development environment <span class="o">(</span>Rails 4.1.7<span class="o">)</span>
irb<span class="o">(</span>main<span class="o">)</span>:001:0&gt;
</code></pre></div>
<p>You  can type ruby, with the <strong>rails environment loaded</strong></p>
<div class="highlight"><pre><code class="language-irb" data-lang="irb"><span class="go">Restaurant.all</span>
<span class="go">#  Restaurant Load (1.4ms)  SELECT "restaurants".* FROM "restaurants"</span>
<span class="go"># =&gt; #&lt;ActiveRecord::Relation []&gt;</span>
</code></pre></div>
<p>No   more <code>require_relative</code>!</p>

<p>Use the console to create or explore your records.</p>

<h3>Rails console tips</h3>

<ul>
<li>Whenever you change your code in the Rails app, you can call <code>reload!</code> to
get them (instead of restarting the console).</li>
<li>To exit the console, just type <code>exit</code>.</li>
</ul>

<h3>Sandbox</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails console --sandbox
</code></pre></div>
<p>All the changes you did (create / update / delete) will be rollbacked at exit.</p>

<hr>

<h2>CRUD</h2>

<h3>Read (all)</h3>

<p><a href="http://localhost:3000/restaurants">http://localhost:3000/restaurants</a></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">"restaurants"</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s2">"restaurants#index"</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@restaurants</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">all</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Read (one)</h3>

<p><a href="http://localhost:3000/restaurants/4">http://localhost:3000/restaurants/4</a></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">"restaurants/:id"</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s2">"restaurants#show"</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>Create</h2>

<h3>What are the steps?</h3>

<ol>
<li><code>GET</code> the restaurant creation form = <strong>1 request</strong></li>
<li><code>POST</code> the parameters to create a new restaurant = <strong>1 request</strong></li>
</ol>

<h3>How many requests?</h3>

<h2>2 requests</h2>

<p><img src="./Le Wagon - Lectures_files/create-df802eb8a21e34bcd467bf7705f7be59.png" alt=""></p>

<h3>Create - Step 1, <code>GET</code> the form</h3>

<p><code>GET</code> <a href="http://localhost:3000/restaurants/new">http://localhost:3000/restaurants/new</a></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">"restaurants/new"</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s2">"restaurants#new"</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">new</span>
    <span class="p">?</span>  <span class="c1"># We'll see that in a moment.</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>Create - Step 2, <code>POST</code> the form</h2>

<p><code>POST</code> <a href="http://localhost:3000/restaurants">http://localhost:3000/restaurants</a></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">post</span> <span class="s2">"restaurants"</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s2">"restaurants#create"</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="p">?</span>  <span class="c1"># We'll see that in a moment.</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>Update</h2>

<h3>What are the steps?</h3>

<ol>
<li><code>GET</code> the HTML form (pre-filled with restaurant attributes) for editing = <strong>1 request</strong></li>
<li><code>PATCH</code> the parameters to update an existing restaurant = <strong>1 request</strong></li>
</ol>

<h3>How many requests?</h3>

<h2>2 requests again!</h2>

<p><img src="./Le Wagon - Lectures_files/update-a415b2452ecced40364f509c36646fa6.png" alt=""></p>

<h3>Update - Step 1, <code>GET</code> the form</h3>

<p><code>GET</code> <a href="http://localhost:3000/restaurants/4/edit">http://localhost:3000/restaurants/4/edit</a></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">"restaurants/:id/edit"</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s2">"restaurants#edit"</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">edit</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>Create - Step 2, <code>PATCH</code> the form</h2>

<p><code>PATCH</code> <a href="http://localhost:3000/restaurants/4">http://localhost:3000/restaurants/4</a></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">patch</span> <span class="s2">"restaurants/:id"</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s2">"restaurants#update"</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">update</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@restaurant</span><span class="o">.</span><span class="p">?</span> <span class="c1"># We'll see that in a moment.</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>Delete</h2>

<p><code>DELETE</code> <a href="http://localhost:3000/restaurants/4">http://localhost:3000/restaurants/4</a></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">delete</span> <span class="s2">"restaurants/:id"</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s2">"restaurants#destroy"</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@restaurant</span><span class="o">.</span><span class="n">destroy</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Summary</h3>

<h3>There are 7 CRUD routes</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span>    <span class="s2">"restaurants"</span><span class="p">,</span>          <span class="ss">to</span><span class="p">:</span> <span class="s2">"restaurants#index"</span>

  <span class="n">get</span>    <span class="s2">"restaurants/:id"</span><span class="p">,</span>      <span class="ss">to</span><span class="p">:</span> <span class="s2">"restaurants#show"</span>

  <span class="n">get</span>    <span class="s2">"restaurants/new"</span><span class="p">,</span>      <span class="ss">to</span><span class="p">:</span> <span class="s2">"restaurants#new"</span>
  <span class="n">post</span>   <span class="s2">"restaurants"</span><span class="p">,</span>          <span class="ss">to</span><span class="p">:</span> <span class="s2">"restaurants#create"</span>

  <span class="n">get</span>    <span class="s2">"restaurants/:id/edit"</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s2">"restaurants#edit"</span>
  <span class="n">patch</span>  <span class="s2">"restaurants/:id"</span><span class="p">,</span>      <span class="ss">to</span><span class="p">:</span> <span class="s2">"restaurants#update"</span>

  <span class="n">delete</span> <span class="s2">"restaurants/:id"</span><span class="p">,</span>      <span class="ss">to</span><span class="p">:</span> <span class="s2">"restaurants#destroy"</span>
<span class="k">end</span>
</code></pre></div>
<h3>Know them by heart</h3>

<h3>But don't write them all!</h3>

<p>You can express the 7 routes shown before with just one line in <code>config/routes.rb</code>:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:restaurants</span>
<span class="k">end</span>
</code></pre></div>
<h3>Subset of the 7 routes</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:restaurants</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:create</span><span class="p">,</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:destroy</span><span class="o">]</span>
<span class="k">end</span>
</code></pre></div>
<p>You can also use the <code>except</code> keyword.</p>

<hr>

<h2>Controller &lt;=&gt; View</h2>

<h3>7 standard CRUD routes =&gt; 7 instance methods</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controller/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>         <span class="c1"># GET /restaurants</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>          <span class="c1"># GET /restaurants/:id</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>           <span class="c1"># GET /restaurants/new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>        <span class="c1"># POST /restaurants</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>          <span class="c1"># GET /restaurants/:id/edit</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>        <span class="c1"># PATCH /restaurants/:id</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>       <span class="c1"># DELETE /restaurants/:id</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>Read (all)</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@restaurants</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">all</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%</span> <span class="vi">@restaurants</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">restaurant</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;h2&gt;</span><span class="cp">&lt;%=</span> <span class="n">restaurant</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="x">&lt;/h2&gt;</span>
<span class="x">  &lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="n">restaurant</span><span class="o">.</span><span class="n">address</span> <span class="cp">%&gt;</span><span class="x">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<h2>Read (one)</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;h2&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="x">&lt;/h2&gt;</span>
<span class="x">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">address</span> <span class="cp">%&gt;</span><span class="x">&lt;/p&gt;</span>
</code></pre></div>
<h2>Create &amp; Update</h2>

<p>Remember, 2 requests for create:</p>

<ul>
<li>The first one to <code>GET</code> the empty HTML form</li>
<li>The second one to <code>POST</code> this form</li>
</ul>

<p><br><br></p>

<p>And for update, 2 requests as well:</p>

<ul>
<li>The first one to <code>GET</code> the pre-populated HTML form of existing record</li>
<li>The second one to <code>PATCH</code> this form</li>
</ul>

<h3>Building the <code>new</code> form, by hand</h3>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/restaurants"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"name"</span><span class="nt">&gt;</span>Name: <span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"restaurant[name]"</span> <span class="na">id=</span><span class="s">"name"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"address"</span><span class="nt">&gt;</span>Address: <span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"restaurant[address]"</span> <span class="na">id=</span><span class="s">"address"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div>
<p>On  <code>POST</code>, the <code>params</code> will be populated with</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># params</span>
<span class="p">{</span>
  <span class="ss">restaurant</span><span class="p">:</span> <span class="p">{</span>
    <span class="nb">name</span><span class="p">:</span> <span class="s2">"La tour d'argent"</span><span class="p">,</span>
    <span class="ss">address</span><span class="p">:</span> <span class="s2">"15 Quai de la Tournelle"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2>Building the <code>edit</code> form, by hand</h2>

<p>Same as <code>new</code> form, but with <code>value</code> attributes:</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"name"</span><span class="nt">&gt;</span>Name: <span class="nt">&lt;/label&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"restaurant[name]"</span> <span class="na">id=</span><span class="s">"name"</span>
       <span class="na">value=</span><span class="s">"La Tour d'Argent"</span><span class="nt">&gt;</span>
</code></pre></div>
<h3>DRY</h3>

<h2><code>form_for</code></h2>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@restaurant</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:name</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:name</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:address</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:address</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<p><em>disclaimer</em>: behaves differently for <strong>new</strong> record or <strong>existing</strong> record.</p>

<h3><code>@restaurant</code></h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><code>new.html.erb</code> <strong>AND</strong> <code>edit.html.erb</code></p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@restaurant</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:name</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:name</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:address</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:address</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<h3>DRY</h3>

<h3>Partial View</h3>

<p>Define the <code>_form</code> partial view (partials starts with a <code>_</code>)
```erb</p>

<p>&lt;%= form<em>for(@restaurant) do |f| %&gt;
  &lt;%= f.label :name %&gt;
  &lt;%= f.text</em>field :name %&gt;
  &lt;%= f.label :address %&gt;
  &lt;%= f.text_field :address %&gt;
  &lt;%= f.submit %&gt;
&lt;% end %&gt;
```</p>

<p><br>
Use this partial in <code>new</code> and <code>edit</code> views:
```erb</p>

<p>&lt;%= render 'form' %&gt;
```</p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'form'</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<h3>What now?</h3>

<p>We built the form.</p>

<p>We need to handle the <code>POST</code> and <code>PATCH</code> requests coming from them!</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:restaurant</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@restaurant</span><span class="o">.</span><span class="n">save</span>
    <span class="c1"># Will raise ActiveModel::ForbiddenAttributesError</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@restaurant</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:restaurant</span><span class="o">]</span><span class="p">)</span>
    <span class="c1"># Will raise ActiveModel::ForbiddenAttributesError</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Strong Params</h3>

<p>Why?</p>

<p>Suppose we have this schema and this app.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># db/schema.rb</span>
<span class="n">create_table</span> <span class="s2">"users"</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="o">.</span><span class="n">string</span>   <span class="s2">"email"</span>
  <span class="n">t</span><span class="o">.</span><span class="n">string</span>   <span class="s2">"encrypted_password"</span>
  <span class="n">t</span><span class="o">.</span><span class="n">boolean</span>  <span class="s2">"admin"</span>
  <span class="n">t</span><span class="o">.</span><span class="n">datetime</span> <span class="s2">"created_at"</span>
  <span class="n">t</span><span class="o">.</span><span class="n">datetime</span> <span class="s2">"updated_at"</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:email</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<div class="down-arrow"></div>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/users/1"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"user[email]"</span> <span class="na">value=</span><span class="s">"bob@leponge.com"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div>
<p>A malicious user could <strong>update</strong> the HTML in the browser</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/users/1"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"user[email]"</span> <span class="na">value=</span><span class="s">"bob@leponge.com"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"user[admin]"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div>
<p>And submit the form</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/users_controller.rb</span>
<span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">update</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@user</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:user</span><span class="o">]</span><span class="p">)</span>
    <span class="c1"># Will raise ActiveModel::ForbiddenAttributesError</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/users_controller.rb</span>
<span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">update</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@user</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">user_params</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">user_params</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:email</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Summary: Never trust user data</h3>

<p>Rails forces you to <strong>whitelist</strong> the <code>params</code> with <code>require</code> and <code>permit</code>.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">restaurant_params</span><span class="p">)</span>
    <span class="vi">@restaurant</span><span class="o">.</span><span class="n">save</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@restaurant</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">restaurant_params</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">restaurant_params</span>
    <span class="c1"># *Strong params*: You need to *whitelist* what can be updated by the user</span>
    <span class="c1"># Never trust user data!</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:restaurant</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:address</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>What next?</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">restaurant_params</span><span class="p">)</span>
    <span class="vi">@restaurant</span><span class="o">.</span><span class="n">save</span>

    <span class="c1"># no need for app/views/restaurants/create.html.erb</span>
    <span class="n">redirect_to</span> <span class="n">restaurant_path</span><span class="p">(</span><span class="vi">@restaurant</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@restaurant</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">restaurant_params</span><span class="p">)</span>

    <span class="c1"># no need for app/views/restaurants/update.html.erb</span>
    <span class="n">redirect_to</span> <span class="n">restaurant_path</span><span class="p">(</span><span class="vi">@restaurant</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">restaurant_params</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:restaurant</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:address</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>Delete</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@restaurant</span><span class="o">.</span><span class="n">destroy</span>

    <span class="c1"># no need for app/views/restaurants/destroy.html.erb</span>
    <span class="n">redirect_to</span> <span class="n">restaurants_path</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><br></p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Delete"</span><span class="p">,</span> <span class="n">restaurant_path</span><span class="p">(</span><span class="n">restaurant</span><span class="p">),</span>
      <span class="nb">method</span><span class="p">:</span> <span class="ss">:delete</span><span class="p">,</span>
      <span class="ss">data</span><span class="p">:</span> <span class="p">{</span> <span class="ss">confirm</span><span class="p">:</span> <span class="s2">"Are you sure?"</span> <span class="p">}</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<hr>

<h2>Filters</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">edit</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">update</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>DRY</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">before_action</span> <span class="ss">:set_restaurant</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:show</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="p">,</span> <span class="ss">:destroy</span><span class="o">]</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">edit</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">update</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">set_restaurant</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<hr>

<h2>Links and Route names</h2>

<h3><code>link_to</code> helper</h3>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="err">&lt;</span>%= link_to(title, url) %&gt;
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%</span> <span class="vi">@restaurants</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">restaurant</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">restaurant</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">restaurant_path</span><span class="p">(</span><span class="n">restaurant</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<div class="down-arrow"></div>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/restaurants/1"</span><span class="nt">&gt;</span>Chez Gladines<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/restaurants/2"</span><span class="nt">&gt;</span>Le Temps des Cerises<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/restaurants/3"</span><span class="nt">&gt;</span>La Tour d'Argent<span class="nt">&lt;/a&gt;</span>
</code></pre></div>
<h3><code>rake routes</code></h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">         Prefix Verb   URI Pattern                     Controller#Action
    restaurants GET    /restaurants<span class="o">(</span>.:format<span class="o">)</span>          restaurants#index
                POST   /restaurants<span class="o">(</span>.:format<span class="o">)</span>          restaurants#create
 new_restaurant GET    /restaurants/new<span class="o">(</span>.:format<span class="o">)</span>      restaurants#new
edit_restaurant GET    /restaurants/:id/edit<span class="o">(</span>.:format<span class="o">)</span> restaurants#edit
     restaurant GET    /restaurants/:id<span class="o">(</span>.:format<span class="o">)</span>      restaurants#show
                PATCH  /restaurants/:id<span class="o">(</span>.:format<span class="o">)</span>      restaurants#update
                DELETE /restaurants/:id<span class="o">(</span>.:format<span class="o">)</span>      restaurants#destroy
</code></pre></div>
<p><br><br></p>

<p>Add <code>_path</code> to the route prefix (left column).</p>

<hr>

<p>Your turn! Let's build a simple CRUD app with just one model.</p>

<h1>Rails - Week 1 - (1) Rails Advanced - Beyond CRUD</h1>

<h2>CRUD</h2>

<p>(Previous lecture)</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:restaurants</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">         Prefix Verb   URI Pattern                     Controller#Action
    restaurants GET    /restaurants<span class="o">(</span>.:format<span class="o">)</span>          restaurants#index
                POST   /restaurants<span class="o">(</span>.:format<span class="o">)</span>          restaurants#create
 new_restaurant GET    /restaurants/new<span class="o">(</span>.:format<span class="o">)</span>      restaurants#new
edit_restaurant GET    /restaurants/:id/edit<span class="o">(</span>.:format<span class="o">)</span> restaurants#edit
     restaurant GET    /restaurants/:id<span class="o">(</span>.:format<span class="o">)</span>      restaurants#show
                PATCH  /restaurants/:id<span class="o">(</span>.:format<span class="o">)</span>      restaurants#update
                DELETE /restaurants/:id<span class="o">(</span>.:format<span class="o">)</span>      restaurants#destroy
</code></pre></div>
<h2>Scaffold generator</h2>

<ul>
<li>Useful for <strong>quick demo</strong> but not for real projects</li>
<li>It generates useless files (<code>scaffold.css.scss</code>..)</li>
<li>You don't always need all of the 7 CRUD actions</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">rails g scaffold Restaurant name:string address:string description:text stars:integer
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">rake db:migrate
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># db/seeds.rb</span>
<span class="no">Restaurant</span><span class="o">.</span><span class="n">destroy_all</span>
<span class="n">restaurants_attributes</span> <span class="o">=</span> <span class="o">[</span>
  <span class="p">{</span>
    <span class="nb">name</span><span class="p">:</span>         <span class="s2">"Epicure au Bristol"</span><span class="p">,</span>
    <span class="ss">address</span><span class="p">:</span>      <span class="s2">"112 rue du Fg St-Honor 75008 Paris"</span><span class="p">,</span>
    <span class="ss">description</span><span class="p">:</span>  <span class="s2">"Face au jardin, on dcouvre une salle lumineuse... et la cuisine d'ric Frechon."</span><span class="p">,</span>
    <span class="ss">stars</span><span class="p">:</span>        <span class="mi">3</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nb">name</span><span class="p">:</span>         <span class="s2">"La truffire"</span><span class="p">,</span>
    <span class="ss">address</span><span class="p">:</span>      <span class="s2">"4 rue Blainville 75005 Paris"</span><span class="p">,</span>
    <span class="ss">description</span><span class="p">:</span>  <span class="s2">"Une valeur sre que cette belle maison du 17e et les recettes de Jean-Christophe Rizet"</span><span class="p">,</span>
    <span class="ss">stars</span><span class="p">:</span>        <span class="mi">1</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nb">name</span><span class="p">:</span>         <span class="s2">"Le pr catelan"</span><span class="p">,</span>
    <span class="ss">address</span><span class="p">:</span>      <span class="s2">"route de Suresnes 75016 Paris"</span><span class="p">,</span>
    <span class="ss">description</span><span class="p">:</span>  <span class="s2">"Oeil vif, geste sr: impossible de distinguer, dans les crations de Frdric Anton..."</span><span class="p">,</span>
    <span class="ss">stars</span><span class="p">:</span>        <span class="mi">3</span>
  <span class="p">}</span>
<span class="o">]</span>
<span class="n">restaurants_attributes</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">params</span><span class="o">|</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">$ rake db:seed
</code></pre></div>
<hr>

<h2>Beyond CRUD</h2>

<p>You are not limited to the <strong>seven</strong> routes that RESTful routing creates by default.</p>

<p>Say you want a route to list <strong>three stars</strong> restaurants. Something like:</p>

<p><code>GET /restaurants/top</code></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:restaurants</span> <span class="k">do</span>
    <span class="n">collection</span> <span class="k">do</span>                       <span class="c1"># collection =&gt; no restaurant id in URL</span>
      <span class="n">get</span> <span class="s1">'top'</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s2">"restaurants#top"</span>  <span class="c1"># RestaurantsController#top</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">top</span>
    <span class="vi">@restaurants</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">stars</span><span class="p">:</span> <span class="mi">3</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Now we want a route to <strong>display info about the chef of a restaurant</strong>.</p>

<p><code>GET /restaurants/42/chef</code></p>

<h2>Add a chef to Restaurants table</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ rails generate migration AddChefToRestaurants chef:string
$ rake db:migrate
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:restaurants</span> <span class="k">do</span>
    <span class="n">member</span> <span class="k">do</span>                             <span class="c1"># member =&gt; restaurant id in URL</span>
      <span class="n">get</span> <span class="s1">'chef'</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s2">"restaurants#chef"</span>  <span class="c1"># RestaurantsController#chef</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">before_action</span> <span class="ss">:find_restaurant</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span> <span class="ss">:chef</span> <span class="o">]</span>

  <span class="k">def</span> <span class="nf">chef</span>
    <span class="c1"># TODO: you can use @restaurant here</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">find_restaurant</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<hr>

<h2>Nested Resources</h2>

<p>Now we want routes to <strong>add a review on a restaurant</strong></p>

<ul>
<li><code>GET /restaurants/42/reviews/new</code></li>
<li><code>POST /restaurants/42/reviews</code></li>
</ul>

<h2>Models</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ rails generate model Review content:string restaurant:references
$ rake db:migrate
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/restaurant.rb</span>
<span class="k">class</span> <span class="nc">Restaurant</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:reviews</span><span class="p">,</span> <span class="ss">dependent</span><span class="p">:</span> <span class="ss">:destroy</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/review.rb</span>
<span class="k">class</span> <span class="nc">Review</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:restaurant</span>
<span class="k">end</span>
</code></pre></div>
<h2>Routing</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:restaurants</span> <span class="k">do</span>
    <span class="n">resources</span> <span class="ss">:reviews</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:new</span><span class="p">,</span> <span class="ss">:create</span><span class="o">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Will add 2 new routes</p>

<p><br></p>

<table>
  <thead>
    <tr>
      <th>Prefix</th>
      <th>Verb</th>
      <th>Path</th>
      <th>Controller#Action</th>
    </tr>
  </thead>
  <tbody>
  <tr>
    <td>new_restaurant_review</td>
    <td>GET</td>
    <td>/restaurants/:restaurant_id/reviews/new</td>
    <td>reviews#new</td>
  </tr>
  <tr>
    <td>restaurant_reviews</td>
    <td>POST</td>
    <td>/restaurants/:restaurant_id/reviews</td>
    <td>reviews#create</td>
  </tr>
  </tbody>
</table>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/reviews_controller.rb</span>
<span class="k">class</span> <span class="nc">ReviewsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">before_action</span> <span class="ss">:find_restaurant</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span> <span class="ss">:new</span><span class="p">,</span> <span class="ss">:create</span> <span class="o">]</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@review</span> <span class="o">=</span> <span class="no">Review</span><span class="o">.</span><span class="n">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@review</span> <span class="o">=</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">reviews</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">review_params</span><span class="p">)</span>
    <span class="vi">@review</span><span class="o">.</span><span class="n">save</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">review_params</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:review</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:content</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">find_restaurant</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:restaurant_id</span><span class="o">]</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>View</h2>

<p>Use <code>form_for</code> with nested resources</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># app/views/reviews/new.html.erb
&lt;%= form_for [@restaurant, @review] do |f| %&gt;
  &lt;%= f.text_field :content %&gt;
  &lt;%= f.submit "add a review" %&gt;
&lt;% end %&gt;
</code></pre></div>
<table>
  <thead>
    <tr>
      <th>Helper</th>
      <th>HTTP request</th>
    </tr>
  </thead>
  <tbody>
  <tr>
    <td>`form_for(@review)`</td>
    <td>POST **`reviews_path`**</td>
  </tr>
  <tr>
    <td>`form_for([@restaurant, @review])`</td>
    <td>POST **`restaurant_reviews_path`**</td>
  </tr>
  </tbody>
</table>

<hr>

<h2>Namespaced routing</h2>

<h2>What if?</h2>

<ul>
<li>You want <code>restaurants#index</code> to list <strong>all</strong> restaurants</li>
<li>You want another <code>restaurants#index</code> to list only restaurants <strong>you have created</strong></li>
</ul>

<h2>Routing</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">namespace</span> <span class="ss">:admin</span> <span class="k">do</span>
    <span class="n">resources</span> <span class="ss">:restaurants</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:index</span><span class="o">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Will add 1 new route</p>

<p><br></p>

<table>
  <thead>
    <tr>
      <th>Prefix</th>
      <th>Verb</th>
      <th>Path</th>
      <th>Controller#Action</th>
    </tr>
  </thead>
  <tbody>
  <tr>
    <td>admin_restaurants</td>
    <td>GET</td>
    <td>/admin/restaurants</td>
    <td>admin/restaurants#index</td>
  </tr>
  </tbody>
</table>

<h2>2 Restaurants Controller</h2>

<p>Usual one</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@restaurants</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">all</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>The new one</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/admin/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">Admin</span><span class="o">::</span><span class="no">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="c1"># Let's anticipate on next week (with login)</span>
    <span class="vi">@restaurants</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">restaurants</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>View</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text"># app/views/admin/restaurants/index.html.erb
&lt;h1&gt;My list of restaurants&lt;/h1&gt;
&lt;% @restaurants.each do |restaurant| %&gt;
  &lt;h2&gt;&lt;%= restaurant.name %&gt;&lt;/h2&gt;
  &lt;p&gt;&lt;%= restaurant.address %&gt;&lt;/p&gt;
&lt;% end %&gt;
</code></pre></div>
<p><a href="http://guides.rubyonrails.org/routing.html">All about routing</a></p>

<hr>

<h2>Validation</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/restaurant.rb</span>
<span class="k">class</span> <span class="nc">Restaurant</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:stars</span><span class="p">,</span> <span class="ss">inclusion</span><span class="p">:</span> <span class="p">{</span> <span class="k">in</span><span class="p">:</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">]</span><span class="p">,</span> <span class="ss">allow_nil</span><span class="p">:</span> <span class="kp">false</span> <span class="p">}</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">uniqueness</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:address</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">restaurant_params</span><span class="p">)</span>
    <span class="vi">@restaurant</span><span class="o">.</span><span class="n">save</span>
    <span class="c1"># Unless @restaurant.valid?, #save will return false,</span>
    <span class="c1"># and @restaurant is not persisted.</span>
    <span class="c1"># TODO: present the form again with error messages.</span>
    <span class="n">redirect_to</span> <span class="n">restaurant_path</span><span class="p">(</span><span class="vi">@restaurant</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">restaurant_params</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:restaurant</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:address</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">restaurant_params</span><span class="p">)</span>
    <span class="k">if</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">save</span>
      <span class="n">redirect_to</span> <span class="n">restaurant_path</span><span class="p">(</span><span class="vi">@restaurant</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:new</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">restaurant_params</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:restaurant</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:address</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>In the view, you can use:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="vi">@restaurant</span><span class="o">.</span><span class="n">errors</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">&lt;%= form_for(@restaurant) do |f| %&gt;
  &lt;% if @restaurant.errors.any? %&gt;
    &lt;div id="error_explanation"&gt;
      &lt;ul&gt;
      &lt;% @restaurant.errors.full_messages.each do |message| %&gt;
        &lt;li&gt;&lt;%= message %&gt;&lt;/li&gt;
      &lt;% end %&gt;
      &lt;/ul&gt;
    &lt;/div&gt;
  &lt;% end %&gt;


&lt;% end %&gt;
</code></pre></div>
<p>Do not forget to add the same logic to the <code>update</code> method in your controller!</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">update</span>
    <span class="k">if</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">restaurant_params</span><span class="p">)</span>
      <span class="n">redirect_to</span> <span class="n">restaurant_path</span><span class="p">(</span><span class="vi">@restaurant</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:edit</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><a href="http://guides.rubyonrails.org/active_record_validations.html#displaying-validation-errors-in-views">Documentation</a></p>

<h1>Rails - Week 1 - (2) Rails Advanced - Frontend setup</h1>

<h2>Assets pipeline</h2>

<h2>What is an asset?</h2>

<ul>
<li>CSS file</li>
<li>JS file</li>
<li>Image</li>
</ul>

<h2>Pipeline</h2>

<p>5 steps to make your assets <strong>production-ready</strong></p>

<ul>
<li>Precompile (coffee =&gt; js, scss =&gt; css)</li>
<li>Concatenate</li>
<li>Minify</li>
<li>Cache (stamp)</li>
<li>Compress</li>
</ul>

<h2>Precompile</h2>

<p><img src="./Le Wagon - Lectures_files/assets-precompile-17b1a4cfb40ffb8e5ec045939fd10b0a.png" alt="">
<br>
Your <strong>production assets</strong> go in <code>public/assets</code></p>

<h2>Concatenate</h2>

<p>1 file = <strong>1 HTTP request</strong> to load your CSS</p>

<p><img src="./Le Wagon - Lectures_files/assets-concatenate-722742dcde3cd06664bb4e36844fed29.png" alt=""></p>

<h2>Minify</h2>

<p>Less characters = <strong>Smaller file</strong></p>

<p><img src="./Le Wagon - Lectures_files/assets-minify-b01052705433d8e92af9703f658dc942.png" alt=""></p>

<h2>Stamps</h2>

<ul>
<li>Add a new stamp every time the file's binary code changes</li>
<li>Without this stamp, browser would always use files in cache.</li>
</ul>

<p><img src="./Le Wagon - Lectures_files/assets-stamps-443e5b2d16ff5ca9bccd6c0a48f7b952.png" alt=""></p>

<h2>Compress</h2>

<p>Browser will use the compressed version for too big files.</p>

<p><img src="./Le Wagon - Lectures_files/assets-compress-bc7c06f0cd103ac973765168acb77d8e.png" alt=""></p>

<hr>

<h2>Rails front-end setup</h2>

<h2>Gemfile</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s1">'bootstrap-sass'</span><span class="p">,</span> <span class="s1">'~&gt; 3.3.1'</span>
<span class="n">gem</span> <span class="s1">'font-awesome-sass'</span><span class="p">,</span> <span class="s1">'~&gt; 4.2.0'</span>
<span class="n">gem</span> <span class="s1">'simple_form'</span>
<span class="n">gem</span> <span class="s2">"autoprefixer-rails"</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bundle install
<span class="nv">$ </span>rails generate simple_form:install --bootstrap
</code></pre></div>
<ul>
<li>https://github.com/twbs/bootstrap-sass</li>
<li>https://github.com/FortAwesome/font-awesome-sass</li>
<li>https://github.com/plataformatec/simple_form</li>
</ul>

<h2>Stylesheets</h2>

<p>We don't like Rails choices for organizing CSS. Let's use <a href="https://github.com/lewagon/rails-stylesheets">lewagon/rails-stylesheets</a></p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rm -rf app/assets/stylesheets
<span class="nv">$ </span>curl -L https://github.com/lewagon/rails-stylesheets/archive/master.zip &gt; stylesheets.zip
<span class="nv">$ </span>unzip stylesheets.zip -d app/assets <span class="o">&amp;&amp;</span> rm stylesheets.zip <span class="o">&amp;&amp;</span> mv app/assets/rails-stylesheets-master app/assets/stylesheets
</code></pre></div>
<h2>Javascript</h2>

<ul>
<li><code>require</code> directives <strong>are not</strong> javascript comments</li>
<li>They load js files (such as <code>require</code> in ruby)</li>
<li>Add <code>bootstrap-sprockets</code> after <code>jquery</code>.</li>
</ul>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// app/assets/javascripts/application.js</span>

<span class="c1">//= require jquery</span>
<span class="c1">//= require jquery_ujs</span>
<span class="c1">//= require bootstrap-sprockets</span>
<span class="c1">//= require_tree .</span>
</code></pre></div>
<h2>Layout</h2>

<p>Don't forget viewport meta in the layout for Bootstrap responsiveness.</p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;head&gt;</span>

<span class="x">  &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;</span>
<span class="x">  &lt;meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"&gt;</span>
<span class="x">&lt;/head&gt;</span>
</code></pre></div>
<h3>External CSS/JS plugins</h3>

<p>If you're lucky, there's a good gem (like <code>bootstrap-sass</code>)</p>

<h3>External CSS/JS plugins</h3>

<p>Otherwise, look in <a href="https://rails-assets.org/">Rails assets</a>, then</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">source</span> <span class="s1">'https://rails-assets.org'</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'rails-assets-plugin'</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-scss" data-lang="scss"><span class="c1">// assets/stylesheets/application.scss</span>
<span class="k">@import</span> <span class="s2">"plugin"</span><span class="p">;</span>
</code></pre></div><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// assets/javascripts/application.js</span>
<span class="c1">//= require jquery</span>
<span class="c1">//= require plugin</span>
<span class="c1">//= require_tree .</span>
</code></pre></div>
<p><strong>Warning</strong>: plugin js file should be loaded <strong>after jQuery</strong> but <strong>before your own JS files</strong>.</p>

<hr>

<h2>Rails Helpers - advanced use</h2>

<h3><code>link_to</code></h3>

<ul>
<li>Never use <code>&lt;a&gt;</code> tags with absolute URLs</li>
<li>URLs should be defined in <code>routes.rb</code> only!</li>
<li>Use <code>link_to</code> with path helpers (ex: <code>something_path</code>)</li>
<li>Add HTML attributes (like <code>class</code> and <code>id</code>) in last hash argument</li>
</ul>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"All restaurants"</span><span class="p">,</span> <span class="n">restaurants_path</span><span class="p">,</span> <span class="p">{</span><span class="ss">class</span><span class="p">:</span> <span class="s2">"btn btn-primary"</span><span class="p">}</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<div class="down-arrow"></div>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/restaurants"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>All restaurants<span class="nt">&lt;/a&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;!-- #&lt;Restaurant: id=28, name="Jules Verne", address="Tour Eiffel"&gt; --&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">restaurant_path</span><span class="p">(</span><span class="vi">@restaurant</span><span class="p">),</span> <span class="p">{</span><span class="ss">class</span><span class="p">:</span> <span class="s2">"btn btn-primary"</span><span class="p">}</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<div class="down-arrow"></div>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/restaurants/28"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>Jules Verne<span class="nt">&lt;/a&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;!-- #&lt;Restaurant: id=28, name="Jules Verne", address="Tour Eiffel"&gt; --&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">restaurant_path</span><span class="p">(</span><span class="vi">@restaurant</span><span class="p">),</span> <span class="p">{</span><span class="ss">class</span><span class="p">:</span> <span class="s2">"btn btn-primary"</span><span class="p">}</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;span class="label label-primary"&gt;NEW&lt;/span&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<div class="down-arrow"></div>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/restaurants/28"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>
  Jules Verne <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"label label-primary"</span><span class="nt">&gt;</span>NEW<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;/a&gt;</span>
</code></pre></div>
<h3><code>image_tag</code></h3>

<ul>
<li>Never use <code>&lt;img&gt;</code> tags with absolute sources</li>
<li>Rails will add MD5 stamp in production</li>
<li>Use <code>image_tag</code></li>
<li>Add HTML attributes (like <code>class</code> and <code>id</code>) in last hash argument</li>
</ul>

<h3>In <strong>development</strong> mode</h3>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="s2">"logo.png"</span><span class="p">,</span> <span class="p">{</span><span class="ss">class</span><span class="p">:</span> <span class="s2">"img-circle"</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">"logo"</span><span class="p">}</span><span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<div class="down-arrow"></div>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;img</span> <span class="na">href=</span><span class="s">"assets/logo.png"</span> <span class="na">class=</span><span class="s">"img-circle"</span> <span class="na">id=</span><span class="s">"logo"</span><span class="nt">&gt;</span>
</code></pre></div>
<h3>Later in <strong>production</strong></h3>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="s2">"logo.png"</span><span class="p">,</span> <span class="p">{</span><span class="ss">class</span><span class="p">:</span> <span class="s2">"img-circle"</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">"logo"</span><span class="p">}</span><span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<div class="down-arrow"></div>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"assets/logo-f800df98aa2605c552400667353f47d2.png"</span>
     <span class="na">class=</span><span class="s">"img-circle"</span> <span class="na">id=</span><span class="s">"logo"</span><span class="nt">&gt;</span>
</code></pre></div>
<h3><code>form_for</code></h3>

<ul>
<li>Don't use <code>&lt;form&gt;</code> tags with absolute URLs</li>
<li>Rails must add an authenticity token to your form</li>
<li>Don't use <code>form_for</code> because it sucks</li>
<li>Use <code>simple_form_for</code>. Like <code>form_for</code>, but simpler</li>
</ul>

<h3>Using <code>form_for</code></h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;%= form_for(@restaurant) do |f| %&gt;
    &lt;% if @restaurant.errors.any? %&gt;

    &lt;% end %&gt;

    &lt;%= f.label :name %&gt;&lt;br&gt;
    &lt;%= f.text_field :name %&gt;
    &lt;%= f.label :address %&gt;&lt;br&gt;
    &lt;%= f.text_field :address %&gt;
    &lt;%= f.label :stars %&gt;&lt;br&gt;
    &lt;%= f.number_field :stars %&gt;

    &lt;%= f.submit %&gt;
&lt;% end %&gt;
</code></pre></div>
<ul>
<li>Lots of methods =&gt; <code>text_field</code>, <code>number_field</code>, <code>select</code>, etc...</li>
<li>Each method has its own signature. <strong>That's a mess!</strong></li>
</ul>

<h3>Using <code>simple_form_for</code></h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;%= simple_form_for(@restaurant) do |f| %&gt;
  &lt;%= f.error_notification %&gt;

  &lt;%= f.input :name %&gt;
  &lt;%= f.input :address %&gt;
  &lt;%= f.input :stars %&gt;

  &lt;%= f.button :submit %&gt;
&lt;% end %&gt;
</code></pre></div>
<ul>
<li>Only one method =&gt; <code>input</code></li>
<li>Automatic labels</li>
<li>With Bootstrap config, automatic <code>form-group</code> and <code>form-control</code> classes</li>
</ul>

<h2>Simple form - options</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;%= f.input :name, label: false %&gt;

&lt;%= f.input :name, label: "Entrez votre nom" %&gt;

&lt;%= f.input :name, placeholder: "Bob" %&gt;

&lt;%= f.input :name, input_html: {class: "input-lg"} %&gt;

&lt;%= f.input :name, label_html: {class: "label-lg"} %&gt;

&lt;%= f.input :stars, collection: 1..5, prompt: "Nb of stars", selected: 3 %&gt;
</code></pre></div>
<p>You can combine them all! Read the <a href="https://github.com/plataformatec/simple_form">doc</a></p>

<hr>

<h2>Front-End best practices</h2>

<h3>1 - Use Bootstrap SASS variables</h3>

<ul>
<li>Bootstrap SASS has a lot of <a href="http://getbootstrap.com/customize/#less-variables">variables</a></li>
<li>Override them in <strong><code>config/_bootstrap_variables.scss</code></strong></li>
<li>Don't write 1000 lines of CSS if there's a variable for that..</li>
</ul>

<h3>2 - Structure your layout with shared partials</h3>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;html&gt;</span>
<span class="x">  &lt;head&gt;</span>

<span class="x">  &lt;/head&gt;</span>
<span class="x">  &lt;body&gt;</span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s2">"shared/navbar"</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s2">"shared/footer"</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s2">"shared/analytics"</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text"> views
     layouts
    &nbsp;&nbsp;  application.html.erb
     shared
      &nbsp;  _navbar.html.erb
      &nbsp;  _footer.html.erb
      &nbsp;  _analytics.html.erb
</code></pre></div>
<h3>3 - Use our Navbar</h3>

<ul>
<li>Integrate our <a href="https://github.com/lewagon/awesome-navbars/blob/master/templates/_navbar_wagon_without_login.html.erb">ERB template</a> in your <code>_navbar.html.erb</code> partial</li>
</ul>

<h3>4 - Use our UI components</h3>

<ul>
<li>Pick SASS partials from <a href="http://lewagon.github.io/ui-components/">Le Wagon UI components</a></li>
<li>Add them in <code>stylesheets/components</code></li>
</ul>

<h3>5 - <code>content_for</code> &amp; title</h3>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;head&gt;</span>
<span class="x">  &lt;title&gt;</span><span class="cp">&lt;%=</span> <span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span><span class="o">.</span><span class="n">blank?</span> <span class="p">?</span> <span class="s2">"La Cuillere"</span> <span class="p">:</span> <span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x">&lt;/title&gt;</span>


<span class="x">&lt;/head&gt;</span>
</code></pre></div>
<p><br></p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%</span> <span class="n">content_for</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="x"> is on La Cuillere</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="x">&lt;/h1&gt;</span>
</code></pre></div>
<h3>6 - <code>content_for</code> &amp; description</h3>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;head&gt;</span>
<span class="x">  &lt;meta name="description"</span>
<span class="x">        content="</span><span class="cp">&lt;%=</span> <span class="p">(</span><span class="k">yield</span><span class="p">(</span><span class="ss">:description</span><span class="p">)</span> <span class="o">||</span> <span class="s2">""</span><span class="p">)</span><span class="o">.</span><span class="n">squish</span> <span class="cp">%&gt;</span><span class="x">"&gt;</span>


<span class="x">&lt;/head&gt;</span>
</code></pre></div>
<p><br></p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%</span> <span class="n">content_for</span><span class="p">(</span><span class="ss">:description</span><span class="p">)</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">description</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="x">&lt;/h1&gt;</span>
</code></pre></div>
<h3>7 - <code>content_for</code> &amp; js</h3>

<p>What if you need to interpolate ruby in your JS ?</p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;body&gt;</span>


<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s1">'application'</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="k">yield</span><span class="p">(</span><span class="ss">:js</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;/body&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%</span> <span class="n">content_for</span><span class="p">(</span><span class="ss">:js</span><span class="p">)</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">javascript_tag</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    $(function(){</span>
<span class="x">      $(".target").text("</span><span class="cp">&lt;%=</span> <span class="n">some_ruby</span> <span class="cp">%&gt;</span><span class="x">");</span>
<span class="x">    });</span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<h3>8 - Use different layouts</h3>

<p>Ex: for a <strong>blog</strong> or a <strong>dashboard</strong>.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">PostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">layout</span> <span class="s2">"blog"</span>

  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div>
<p>Actions in <code>PostsController</code> will use <code>app/views/layouts/blog.html.erb</code> layout.</p>

<h3>9 - Pass locals to your partial</h3>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%</span> <span class="vi">@restaurants</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">r</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s2">"restaurant"</span><span class="p">,</span> <span class="ss">restaurant</span><span class="p">:</span> <span class="n">r</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;div class="card"&gt;</span>
<span class="x">  &lt;div class="card-header"&gt;</span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="n">restaurant</span><span class="o">.</span><span class="n">picture</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;/div&gt;</span>
<span class="x">  &lt;div class="card-body"&gt;</span>
<span class="x">    &lt;h2&gt;</span><span class="cp">&lt;%=</span> <span class="n">restaurant</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="x">&lt;/h2&gt;</span>
<span class="x">    &lt;p class="address"&gt;</span><span class="cp">&lt;%=</span> <span class="n">restaurant</span><span class="o">.</span><span class="n">address</span> <span class="cp">%&gt;</span><span class="x">&lt;/p&gt;</span>
<span class="x">    &lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="n">restaurant</span><span class="o">.</span><span class="n">description</span> <span class="cp">%&gt;</span><span class="x">&lt;/p&gt;</span>
<span class="x">  &lt;/div&gt;</span>
<span class="x">&lt;/div&gt;</span>
</code></pre></div>
<h1>Rails - Week 1 - Hosting &amp; Deployment</h1>

<h2>Development</h2>

<p><img src="./Le Wagon - Lectures_files/hosting-laptop-358cd8909b0c8a14005fb83596e71ffa.png" alt=""></p>

<h2>Production</h2>

<p><img src="./Le Wagon - Lectures_files/hosting-production-1-13dd7ef086b10d14830f6e2f15f1c070.png" alt=""></p>

<h2>Production</h2>

<p><img src="./Le Wagon - Lectures_files/hosting-production-2-4f9f873e6f4020390c999a269eda1b79.png" alt=""></p>

<h2>Production</h2>

<p><img src="./Le Wagon - Lectures_files/hosting-production-3-d7d482aaad2a5cc93aca6d5e9646fa7d.png" alt=""></p>

<h2>SQLite is over. Say hello to</h2>

<p><img src="./Le Wagon - Lectures_files/hosting-postgresql-4c73788fddcdf29727135c8e6ea0a9a4.png" alt=""></p>

<h2>Install on OS X</h2>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>brew update
<span class="nv">$ </span>brew install postgresql
<span class="nv">$ </span>mkdir -p ~/Library/LaunchAgents
<span class="nv">$ </span>ln -sfv /usr/local/opt/postgresql/*.plist ~/Library/LaunchAgents
<span class="nv">$ </span>launchctl load ~/Library/LaunchAgents/homebrew.mxcl.postgresql.plist
</code></pre></div>
<h2>Install on Linux</h2>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>whoami
<span class="nv">$ </span>sudo apt-get install postgresql postgresql-contrib libpq-dev build-essential
<span class="nv">$ </span>sudo su - postgres
<span class="nv">$ </span>psql
&gt; create role <span class="s2">"XXXX"</span> login createdb<span class="p">;</span> <span class="c"># Replace XXXX with the result of whoami</span>
&gt; <span class="se">\q</span>
<span class="nv">$ </span><span class="nb">exit</span>
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/hosting-rails-pg-8d4723dcfb7ce95c33396ee551f0c30a.png" alt=""></p>

<h2>New Rails application</h2>

<p>Generate the rails app with the <code>--database</code> flag:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd</span> ~/code/<span class="nv">$YOUR_GITHUB_USERNAME</span>
<span class="nv">$ </span>rails new <span class="nv">$YOUR_APP_NAME</span> -T --database<span class="o">=</span>postgresql
<span class="nv">$ </span><span class="nb">cd</span> <span class="nv">$YOUR_APP_NAME</span>
</code></pre></div>
<p>Init and push your git repo</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git init
<span class="nv">$ </span>git add .
<span class="nv">$ </span>git commit -m <span class="s2">"Initial commit"</span>
<span class="nv">$ </span>hub create
<span class="nv">$ </span>git push origin master
</code></pre></div>
<p>Create the database on PostgreSQL</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ rake db:create
</code></pre></div>
<p>Look at your <code>Gemfile</code>:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># Gemfile
gem 'pg'  # No more `gem "sqlite"` thanks to `--database=postgresql`
</code></pre></div>
<h2>Scaffold a Post model</h2>

<p>Open <code>Gemfile</code>, and comment out the <code>jbuilder</code> gem.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># gem 'jbuilder'</span>
</code></pre></div>
<p>Then generate a <strong>scaffold</strong> of <code>article</code>.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails generate scaffold article title body:text
<span class="nv">$ </span>rake db:migrate
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git add .
<span class="nv">$ </span>git commit -m <span class="s2">"Add Article scaffold"</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails s
<span class="c"># Check that everything's working at http://localhost:3000/articles</span>
</code></pre></div>
<h3><code>root</code></h3>

<p>Your app does not have any route for <code>/</code>. Add one!</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="c1"># [...]</span>

  <span class="n">root</span> <span class="s1">'articles#index'</span>
<span class="k">end</span>
</code></pre></div>
<h3>Prepare for Heroku</h3>

<p>Open your Gemfile and add those lines</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">ruby</span> <span class="s1">'2.3.1'</span>
<span class="n">gem</span> <span class="s1">'rails_12factor'</span><span class="p">,</span> <span class="ss">group</span><span class="p">:</span> <span class="ss">:production</span>
<span class="n">gem</span> <span class="s1">'puma'</span><span class="p">,</span>           <span class="ss">group</span><span class="p">:</span> <span class="ss">:production</span>
</code></pre></div>
<p>Run this in the terminal:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bundle install
<span class="nv">$ </span>curl -L https://gist.github.com/ssaunier/24bc1c4db955c19e3289/raw/install.sh <span class="p">|</span> bash
</code></pre></div>
<p>And of course, commit your changes:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git add .
<span class="nv">$ </span>git commit -m <span class="s2">"Prepare for Heroku"</span>
</code></pre></div>
<hr>

<h2>Let's deploy this blog!</h2>

<h2>Production</h2>

<p><img src="./Le Wagon - Lectures_files/hosting-production-3-d7d482aaad2a5cc93aca6d5e9646fa7d.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/hosting-logo-heroku-1f8f53d9d26296965445f19cc5a455ee.png" alt=""></p>

<h2>Sign up</h2>

<p>https://id.heroku.com/signup</p>

<h3>Install on OS X</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># OS X</span>
<span class="nv">$ </span>brew install heroku
</code></pre></div>
<h3>Install on Ubuntu</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>wget -qO- https://toolbelt.heroku.com/install-ubuntu.sh <span class="p">|</span> sh
</code></pre></div>
<h2>Help</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ heroku
Usage: heroku COMMAND [--app APP] [command-specific-options]
Primary help topics, type "heroku help TOPIC" for more details:
  addons     # manage addon resources
  apps       # manage apps (create, destroy)
  auth       # authentication (login, logout)
  config     # manage app config vars
  domains    # manage custom domains
  logs       # display logs for an app
  ps         # manage dynos (dynos, workers)
  releases   # manage app releases
  run        # run one-off commands (console, rake)
  sharing    # manage collaborators on an app
</code></pre></div>
<h2>Login</h2>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>heroku login
</code></pre></div>
<h2>Create an Heroku app</h2>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>heroku create <span class="nv">$YOUR_APP_NAME</span> --region eu
</code></pre></div>
<h2>What happened?</h2>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git remote -v
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/origin_heroku_remotes-41b796ee7336a9af9bbee3c03e3d78a9.png" alt=""></p>

<h2>Let's deploy!</h2>

<p>Push your code to Heroku</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git push heroku master
</code></pre></div>
<p>Run a command on Heroku</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>heroku run rake db:migrate
</code></pre></div>
<h2>Done!</h2>

<p>Some useful commands</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>heroku open         <span class="c"># open in your browser</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>heroku logs --tail  <span class="c"># show the app logs and keep listening</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>heroku run rails c  <span class="c"># Run the production console</span>
</code></pre></div>
<hr>

<h2>Happy Hacking!</h2>

<h1>Rails - Week 1 - (1) Image Upload</h1>

<p>User-side upload. Not <strong>assets</strong>.</p>

<h3>Uploading / Storing to Heroku?</h3>

<p>You <em>can't</em>: the dyno file system is <a href="https://devcenter.heroku.com/articles/dynos#ephemeral-filesystem"><strong>ephemeral</strong></a>.</p>

<p>We need an external service.</p>

<h3>Cloudinary...</h3>

<p><img src="./Le Wagon - Lectures_files/cloudinary-701f3a1b06cba7dc282a8979e16a9ed6.png" alt=""></p>

<hr>

<h3>Create a Cloudinary account</h3>

<p><a href="https://cloudinary.com/users/register/free">Sign up</a> for a free account</p>

<h3>Security</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s1">'figaro'</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bundle install
<span class="nv">$ </span>bundle binstubs figaro
<span class="nv">$ </span>figaro install
<span class="nv">$ </span>spring stop
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git add .
<span class="nv">$ </span>git commit -m <span class="s2">"Add figaro - Protect my secret data in config/application.yml"</span>
</code></pre></div>
<p><em>This creates a commented <strong>config/application.yml</strong> file and adds it to your <strong>.gitignore</strong>. Add your own configuration to this file and you're done!</em></p>

<h3>Cloudinary &amp; Environment</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s1">'cloudinary'</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bundle install
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/application.yml</span>
<span class="ss">CLOUDINARY_URL</span><span class="p">:</span> <span class="s2">"cloudinary://298522699261255:Qa1ZfO4syfbOC-***********************8"</span>
</code></pre></div>
<h3>Let's upload one picture</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>curl http://lorempixel.com/800/600/city/9/ &gt; san_francisco.jpg
<span class="nv">$ </span>rails c
irb&gt; Cloudinary::Uploader.upload<span class="o">(</span><span class="s2">"san_francisco.jpg"</span><span class="o">)</span>
irb&gt; <span class="nb">exit</span>
<span class="nv">$ </span>rm san_francisco.jpg
</code></pre></div>
<p>And then go to <a href="https://cloudinary.com/console/media_library">cloudinary.com/console/media_library</a></p>

<h3>Let's display it</h3>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">cl_image_tag</span><span class="p">(</span><span class="s2">"THE_IMAGE_ID_FROM_LIBRARY"</span><span class="p">,</span>
      <span class="ss">width</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span> <span class="ss">height</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span> <span class="ss">crop</span><span class="p">:</span> <span class="ss">:fill</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<p><a href="http://cloudinary.com/documentation/image_transformations#crop_modes">Crop modes</a>:
<code>scale</code>, <code>fit</code>, <code>fill</code>, <code>limit</code>, <code>pad</code>, <code>crop</code>.</p>

<p>You even have <code>thumb</code> with <a href="http://cloudinary.com/documentation/image_transformations#face_detection">Face detection</a></p>

<h3>Transformation reference</h3>

<p>This <a href="http://cloudinary.com/documentation/image_transformations#transformations_reference">exhaustive documentation</a> lists all you can do.</p>

<p>You can change the <strong>quality</strong>, put some <strong>effects</strong> (like Instagram), add
an overlay (watermark)</p>

<p>You can upload also other file formats (<a href="http://cloudinary.com/blog/uploading_converting_and_generating_thumbnails_for_pdf_documents">PDFs</a>, etc.)</p>

<hr>

<h2>Carrierwave</h2>

<p>It's a <a href="https://github.com/carrierwaveuploader/carrierwave">gem</a> to upload files associated to <strong>Models</strong>.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s1">'carrierwave'</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bundle install
</code></pre></div>
<h3>Product</h3>

<p>Let's say we have a <code>Product</code> model like this:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g model Product name description:text
<span class="nv">$ </span>rake db:migrate
</code></pre></div>
<h3>Creating an uploader for photos</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g uploader Photo
</code></pre></div>
<p>It will create this file: <code>app/uploaders/photo_uploader.rb</code>. Open it and simplify it:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/uploaders/photo_uploader.rb</span>
<span class="k">class</span> <span class="nc">PhotoUploader</span> <span class="o">&lt;</span> <span class="no">CarrierWave</span><span class="o">::</span><span class="no">Uploader</span><span class="o">::</span><span class="no">Base</span>
  <span class="kp">include</span> <span class="no">Cloudinary</span><span class="o">::</span><span class="no">CarrierWave</span>
<span class="k">end</span>
</code></pre></div>
<h3>Mount it in model</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g migration AddPhotoToProduct photo:string
<span class="nv">$ </span>rake db:migrate
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/product.rb</span>
<span class="k">class</span> <span class="nc">Product</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">mount_uploader</span> <span class="ss">:photo</span><span class="p">,</span> <span class="no">PhotoUploader</span>
<span class="k">end</span>
</code></pre></div>
<h3>Form</h3>

<p>Simple form version:</p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">simple_form_for</span><span class="p">(</span><span class="vi">@product</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">input</span> <span class="ss">:name</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">input</span> <span class="ss">:description</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">input</span> <span class="ss">:photo</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">input</span> <span class="ss">:photo_cache</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:hidden</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<p>With a regular rails form, use <code>f.file_field :photo</code> and <code>f.hidden_field :photo_cache</code>.</p>

<h3>Strong params</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/products_controller.rb</span>
<span class="k">def</span> <span class="nf">product_params</span>
  <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:product</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:description</span><span class="p">,</span> <span class="ss">:photo</span><span class="p">,</span> <span class="ss">:photo_cache</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<h3>Show view</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;%= cl_image_tag @product.photo, height: 300, width: 400, crop: :fill %&gt;
</code></pre></div>
<h3>Uploader with versions</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/uploaders/photo_uploader.rb</span>
<span class="k">class</span> <span class="nc">PhotoUploader</span> <span class="o">&lt;</span> <span class="no">CarrierWave</span><span class="o">::</span><span class="no">Uploader</span><span class="o">::</span><span class="no">Base</span>
  <span class="kp">include</span> <span class="no">Cloudinary</span><span class="o">::</span><span class="no">CarrierWave</span>

  <span class="n">process</span> <span class="ss">eager</span><span class="p">:</span> <span class="kp">true</span>  <span class="c1"># Force version generation at upload time.</span>

  <span class="n">process</span> <span class="ss">convert</span><span class="p">:</span> <span class="s1">'jpg'</span>

  <span class="n">version</span> <span class="ss">:standard</span> <span class="k">do</span>
    <span class="n">resize_to_fit</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">600</span>
  <span class="k">end</span>

  <span class="n">version</span> <span class="ss">:bright_face</span> <span class="k">do</span>
    <span class="n">cloudinary_transformation</span> <span class="ss">effect</span><span class="p">:</span> <span class="s2">"brightness:30"</span><span class="p">,</span> <span class="ss">radius</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
      <span class="ss">width</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span> <span class="ss">height</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span> <span class="ss">crop</span><span class="p">:</span> <span class="ss">:thumb</span><span class="p">,</span> <span class="ss">gravity</span><span class="p">:</span> <span class="ss">:face</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Show view with versions</h3>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="vi">@product</span><span class="o">.</span><span class="n">photo</span><span class="o">.</span><span class="n">url</span><span class="p">(</span><span class="ss">:bright_face</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<hr>

<h2>Attachinary</h2>

<p><strong>Alternative</strong> <a href="https://github.com/assembler/attachinary">gem</a> to Carrierwave</p>

<h3>Config (1)</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s2">"cloudinary"</span>
<span class="n">gem</span> <span class="s2">"attachinary"</span>
<span class="n">gem</span> <span class="s2">"jquery-fileupload-rails"</span>
<span class="n">gem</span> <span class="s2">"coffee-rails"</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bundle install
<span class="nv">$ </span>rake attachinary:install:migrations
<span class="nv">$ </span>rake db:migrate
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text"># config/application.rb
# [...]
require "sprockets/railtie"
require "attachinary/orm/active_record"  # &lt;= Add this line
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text"># config/routes.rb
mount Attachinary::Engine =&gt; "/attachinary"
</code></pre></div>
<h3>Config (2)</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;%= cloudinary_js_config %&gt; 

```ruby
# app/controllers/products_controller.rb
def product_params
  params.require(:product).permit(:name, :description, :photo)
end
</code></pre></div>
<p>Simple form:</p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">input</span> <span class="ss">:photo</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:attachinary</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%</span> <span class="k">if</span> <span class="vi">@product</span><span class="o">.</span><span class="n">photo?</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">cl_image_tag</span> <span class="vi">@product</span><span class="o">.</span><span class="n">photo</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="ss">width</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="ss">height</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span> <span class="ss">crop</span><span class="p">:</span> <span class="ss">:fill</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<h3>Usage - Multiple attachments</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Product</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_attachments</span> <span class="ss">:photos</span><span class="p">,</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">2</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/products_controller.rb</span>
<span class="k">def</span> <span class="nf">product_params</span>
  <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:product</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:description</span><span class="p">,</span> <span class="ss">photos</span><span class="p">:</span> <span class="o">[]</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>Simple form:</p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">input</span> <span class="ss">:photos</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:attachinary</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%</span> <span class="vi">@product</span><span class="o">.</span><span class="n">photos</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">photo</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">cl_image_tag</span> <span class="n">photo</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="ss">width</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span> <span class="ss">height</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="ss">crop</span><span class="p">:</span> <span class="ss">:fill</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<hr>

<h2>Production</h2>

<p>Make sure to push your <code>CLOUDINARY_URL</code> env variable to Heroku:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>heroku config:set <span class="nv">CLOUDINARY_URL</span><span class="o">=</span>cloudinary://298522699261255:Qa1ZfO4syfbOC-***********************8
</code></pre></div>
<p>Check with:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>heroku config
</code></pre></div>
<hr>

<h2>AWS S3</h2>

<p>Alternative to Cloudinary</p>

<h3>What is S3?</h3>

<p>S3, is a highly durable and available <strong>store</strong> and can be used to reliably store application content such as media files, static assets and <strong>user uploads</strong>.</p>

<p><img src="./Le Wagon - Lectures_files/s3-production-with-s3-a51bb1a460e2dd1105d115c48d837806.png" alt=""></p>

<h3>Sign up</h3>

<p>https://aws.amazon.com/</p>

<p>You can sign up with your <strong>existing</strong> Amazon account</p>

<h3>Buckets</h3>

<p><img src="./Le Wagon - Lectures_files/s3-bucket-creation-83341f120d16bad61a849a6677afe2a2.png" alt=""></p>

<h3>Upload</h3>

<p><img src="./Le Wagon - Lectures_files/s3-upload-or-cyberduck-a460cb6332d8a859906b56caa1e1f52f.png" alt=""></p>

<p>By default, uploaded files are <strong>private</strong>.</p>

<h3>Security</h3>

<p>This is <strong>serious</strong>. You don't want to lose <a href="http://www.devfactor.net/2014/12/30/2375-amazon-mistake/">thousands of dollars overnight</a>.</p>

<p>So pay attention.</p>

<h3>Security (1)</h3>

<p>Go to AWS Identity &amp; Access Management<br>
(IAM, https://aws.amazon.com/iam/)</p>

<h3>Security (2)</h3>

<p>For each rails app, create a new user (same name as rails bucket).
Download the credentials file to your computer.</p>

<p><img src="./Le Wagon - Lectures_files/s3-iam-ad84550d34bb23680bac5c615cd6fa12.png" alt=""></p>

<h3>Security (3)</h3>

<p>Click on "Download Credentials" for the generated user.</p>

<p><img src="./Le Wagon - Lectures_files/s3-generate-access-key-01b24e5dee3172409f1bfe4cc9d48eb7.png" alt=""></p>

<h3>Security (4)</h3>

<p>Click on the created user. In Permissions, create a new <strong>inline policy</strong>.</p>

<p>Choose <strong>Custom Policy</strong> on the next screen. Copy paste this json
(do not forget to replace the string <code>REPLACE_THIS_WITH_YOUR_BUCKET_NAME</code>)</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">"Statement"</span><span class="p">:</span> <span class="p">[{</span>
      <span class="nt">"Effect"</span><span class="p">:</span> <span class="s2">"Allow"</span><span class="p">,</span>
      <span class="nt">"Action"</span><span class="p">:</span> <span class="s2">"s3:ListAllMyBuckets"</span><span class="p">,</span>
      <span class="nt">"Resource"</span><span class="p">:</span> <span class="s2">"arn:aws:s3:::*"</span>
    <span class="p">},</span> <span class="p">{</span>
      <span class="nt">"Action"</span><span class="p">:</span> <span class="s2">"s3:*"</span><span class="p">,</span>
      <span class="nt">"Effect"</span><span class="p">:</span> <span class="s2">"Allow"</span><span class="p">,</span>
      <span class="nt">"Resource"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">"arn:aws:s3:::REPLACE_THIS_WITH_YOUR_BUCKET_NAME"</span><span class="p">,</span>
        <span class="s2">"arn:aws:s3:::REPLACE_THIS_WITH_YOUR_BUCKET_NAME/*"</span>
      <span class="p">]</span>
  <span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>
<h3>Security (5)</h3>

<p>Make sure that <a href="https://github.com/laserlemon/figaro">figaro</a> is setup and
<code>config/application.yml</code> is in the <code>.gitignore</code>.</p>

<h3>Security (6)</h3>

<p>Paste these infos in your config/application.yml</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Change those values with yours!</span>
<span class="ss">AWS_REGION</span><span class="p">:</span> <span class="s2">"eu-west-1"</span>  <span class="c1"># If your bucket is created in Ireland Datacenter</span>
<span class="ss">AWS_S3_BUCKET_NAME</span><span class="p">:</span> <span class="s2">"your-bucket-name"</span>
<span class="ss">AWS_ACCESS_KEY_ID</span><span class="p">:</span> <span class="s2">"AK..............Q"</span>
<span class="ss">AWS_SECRET_ACCESS_KEY</span><span class="p">:</span> <span class="s2">"bS6OSdb9...hsAh"</span>
</code></pre></div>
<p>Remember, this file <strong>should not</strong> be tracked by git!</p>

<p>Share this file with your teamates over a <strong>secure</strong> channel.</p>

<h3>Push configuration to Heroku</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># View current environment variables</span>
<span class="nv">$ </span>heroku config
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Add environment variables from `config/application.yml`</span>
<span class="nv">$ </span>figaro heroku:set -e production
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Check that again!</span>
<span class="nv">$ </span>heroku config
</code></pre></div>
<h3>Image Magick</h3>

<p>Transformations of images will happen on your computer in dev, so you will need the ImageMagick:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># On MacOS X</span>
<span class="nv">$ </span>brew install imagemagick
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># On Ubuntu</span>
<span class="nv">$ </span>sudo apt-get install imagemagick
</code></pre></div>
<h3>Carrierwave with S3</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s2">"carrierwave"</span>
<span class="n">gem</span> <span class="s2">"mini_magick"</span>
<span class="n">gem</span> <span class="s2">"fog-aws"</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bundle install
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/initializers/carrierwave.rb</span>
<span class="no">CarrierWave</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="o">.</span><span class="n">fog_provider</span> <span class="o">=</span> <span class="s1">'fog/aws'</span>
  <span class="n">config</span><span class="o">.</span><span class="n">fog_credentials</span> <span class="o">=</span> <span class="p">{</span>
    <span class="ss">:provider</span>              <span class="o">=&gt;</span> <span class="s1">'AWS'</span><span class="p">,</span>
    <span class="ss">:aws_access_key_id</span>     <span class="o">=&gt;</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'AWS_ACCESS_KEY_ID'</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:aws_secret_access_key</span> <span class="o">=&gt;</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'AWS_SECRET_ACCESS_KEY'</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:region</span>                <span class="o">=&gt;</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'AWS_REGION'</span><span class="o">]</span>
  <span class="p">}</span>

  <span class="n">config</span><span class="o">.</span><span class="n">fog_directory</span>    <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'AWS_S3_BUCKET_NAME'</span><span class="o">]</span>
  <span class="n">config</span><span class="o">.</span><span class="n">fog_public</span>       <span class="o">=</span> <span class="kp">false</span>  <span class="c1"># &lt;- Private URLS (with expiration) are generated</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text"># app/uploaders/photo_uploader.rb
class PhotoUploader &lt; CarrierWave::Uploader::Base
  include CarrierWave::MiniMagick # &lt;- Notice this

  storage :fog                    # &lt;- and this

  version :standard do
    resize_to_fill 400, 300
  end

  version :thumb do
    resize_to_fill 100, 100
  end
end
</code></pre></div>
<hr>

<h2>Happy Uploading!</h2>

<h1>Rails - Week 1 - (2) Refacto in Rails</h1>

<h2>Partials</h2>

<h3>First usage: isolate code</h3>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>

  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>

    <span class="err">&lt;</span>%= render 'shared/navbar' %&gt;

    <span class="err">&lt;</span>%= yield %&gt;

  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>
<p><code>render</code> calls the file <code>app/views/shared/_navbar.html.erb</code></p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;navbar&gt;</span>

<span class="x">&lt;/navbar&gt;</span>
</code></pre></div>
<p>You can also create a <code>app/views/shared/_footer.html.erb</code></p>

<h3>Second usage: DRY</h3>

<p><img src="./Le Wagon - Lectures_files/wagon_alumni-a03d581b0e4409f78a237c778a3cbf24.png" alt=""></p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%</span> <span class="vi">@testimonials</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">testimonial</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;div&gt;</span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">testimonial</span><span class="o">.</span><span class="n">text</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">testimonial</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="n">testimonial</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">image</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<p>What if I want to reuse these cards on another page?</p>

<p>Create the following partial:</p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;div&gt;</span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">testimonial</span><span class="o">.</span><span class="n">text</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">testimonial</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="n">testimonial</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">image</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;/div&gt;</span>
</code></pre></div>
<p>And use it:</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="err">&lt;</span>% @testimonials.each do |t| %&gt;
  <span class="err">&lt;</span>%= render "shared/testimonial", testimonial: t %&gt;
<span class="err">&lt;</span>% end %&gt;
</code></pre></div>
<p>We passed <strong>locals</strong> to the partial.</p>

<hr>

<h2>Helpers</h2>

<p>Sometimes you have complex ruby code in your views.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;head&gt;
  &lt;title&gt;
    &lt;%= content_for?(:title) ? yield(:title) : "The default title for your site" %&gt;
  &lt;/title&gt;
&lt;/head&gt;
</code></pre></div>
<p>We want to do something simpler:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;head&gt;
  &lt;title&gt;
    &lt;%= yield_with_default(:title, "The default title for your site") %&gt;
  &lt;/title&gt;
&lt;/head&gt;
</code></pre></div>
<h3>Helper creation</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/helpers/application_helper.rb</span>
<span class="k">module</span> <span class="nn">ApplicationHelper</span>
  <span class="k">def</span> <span class="nf">yield_with_default</span><span class="p">(</span><span class="n">holder</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">content_for?</span><span class="p">(</span><span class="n">holder</span><span class="p">)</span>
      <span class="n">content_for</span><span class="p">(</span><span class="n">holder</span><span class="p">)</span><span class="o">.</span><span class="n">squish</span>
    <span class="k">else</span>
      <span class="n">default</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Other example - the <code>flash</code></h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">restaurant_params</span><span class="p">)</span>
    <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"Restaurant </span><span class="si">#{</span><span class="vi">@restaurant</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> has been created"</span>
    <span class="n">redirect_to</span> <span class="n">restaurent_path</span><span class="p">(</span><span class="vi">@restaurant</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Bootstrap alert component</h3>

<p><a href="http://getbootstrap.com/components/#alerts">getbootstrap.com/components/#alerts</a></p>

<p><img src="./Le Wagon - Lectures_files/bootstrap_alerts-e667ffe5133a50d956bcb4d5b8e70d7d.png" alt=""></p>

<p>In the <strong>layout</strong>, we need to render the flash:</p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;body&gt;</span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    &lt;div class="alert alert-info fade in"&gt;</span>
<span class="x">      &lt;button class="close" data-dismiss="alert"&gt;&lt;/button&gt;</span>
<span class="x">      </span><span class="cp">&lt;%=</span> <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">  </span><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">flash</span><span class="o">[</span><span class="ss">:alert</span><span class="o">]</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    &lt;div class="alert alert-error fade in"&gt;</span>
<span class="x">      &lt;button class="close" data-dismiss="alert"&gt;&lt;/button&gt;</span>
<span class="x">      </span><span class="cp">&lt;%=</span> <span class="n">flash</span><span class="o">[</span><span class="ss">:alert</span><span class="o">]</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">  </span><span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;/body&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/application_helper.rb</span>
<span class="k">module</span> <span class="nn">ApplicationHelper</span>
  <span class="k">def</span> <span class="nf">bootstrap_class_for</span><span class="p">(</span><span class="n">flash_type</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">flash_type</span>
    <span class="k">when</span> <span class="ss">:alert</span>   <span class="k">then</span> <span class="s2">"alert-error"</span>
    <span class="k">when</span> <span class="ss">:notice</span>  <span class="k">then</span> <span class="s2">"alert-success"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;body&gt;</span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="n">flash</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">type</span><span class="o">|</span> <span class="o">%</span><span class="n">i</span><span class="p">(</span><span class="n">alert</span> <span class="n">notice</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="p">}</span> <span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">type</span><span class="p">,</span> <span class="n">message</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    &lt;div class="alert </span><span class="cp">&lt;%=</span> <span class="n">bootstrap_class_for</span><span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x"> fade in"&gt;</span>
<span class="x">      &lt;button class="close" data-dismiss="alert"&gt;&lt;/button&gt;</span>
<span class="x">      </span><span class="cp">&lt;%=</span> <span class="n">message</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">  </span><span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;/body&gt;</span>
</code></pre></div>
<p>We should even push the view code to a <strong>partial</strong>.</p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;body&gt;</span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'shared/flash'</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;/body&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%</span> <span class="n">flash</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">type</span><span class="o">|</span> <span class="o">%</span><span class="n">i</span><span class="p">(</span><span class="n">alert</span> <span class="n">notice</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="p">}</span> <span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">type</span><span class="p">,</span> <span class="n">message</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;div class="alert </span><span class="cp">&lt;%=</span> <span class="n">bootstrap_class_for</span><span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x"> fade in"&gt;</span>
<span class="x">    &lt;button class="close" data-dismiss="alert"&gt;&lt;/button&gt;</span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">message</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<h1>Rails - Week 2 - (1) Authentication</h1>

<p><img src="./Le Wagon - Lectures_files/airbnb_login-4b05ce52b80a0dad2bbbf922820a357b.png" alt=""></p>

<hr>

<h2>What we'll use</h2>

<p><strong>Devise</strong> An authentication gem for Rails</p>

<p>https://github.com/plataformatec/devise/</p>

<h3>Start with a rails minimal template</h3>

<p><a href="https://github.com/lewagon/rails-templates#minimal">github.com/lewagon/rails-templates#minimal</a></p>

<hr>

<h2>How-to</h2>

<h3>Installation</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s1">'devise'</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bundle install
<span class="nv">$ </span>rails generate devise:install
</code></pre></div>
<h3>Configuration</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">Some setup you must do manually if you haven't yet:

  1. Ensure you have defined default url options in your environments files. Here
     is an example of default_url_options appropriate for a development environment
     in config/environments/development.rb:

       config.action_mailer.default_url_options = { host: 'localhost', port: 3000 }

     In production, :host should be set to the actual host of your application.

  2. Ensure you have defined root_url to *something* in your config/routes.rb.
     For example:

       root to: "home#index"

  3. Ensure you have flash messages in app/views/layouts/application.html.erb.
     For example:

       &lt;p class="notice"&gt;&lt;%= notice %&gt;&lt;/p&gt;
       &lt;p class="alert"&gt;&lt;%= alert %&gt;&lt;/p&gt;
</code></pre></div>
<h2>Initializer</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/initializers/devise.rb</span>

<span class="c1"># ==&gt; Mailer Configuration</span>
<span class="c1"># Configure the e-mail address which will be shown in Devise::Mailer,</span>
<span class="c1"># note that it will be overwritten if you use your own mailer class</span>
<span class="c1"># with default "from" parameter.</span>
<span class="n">config</span><span class="o">.</span><span class="n">mailer_sender</span> <span class="o">=</span> <span class="s1">'please-change-me-at-config-initializers-devise@example.com'</span>
</code></pre></div>
<h3>User Model</h3>

<p>Generate the <code>User</code> model with the <strong>devise</strong> generator (not <code>model</code> nor <code>scaffold</code>).</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails generate devise User
<span class="c">#      invoke  active_record</span>
<span class="c">#      create    db/migrate/TIMESTAMP_devise_create_users.rb</span>
<span class="c">#      create    app/models/user.rb</span>
<span class="c">#      insert    app/models/user.rb</span>
<span class="c">#       route  devise_for :users</span>
</code></pre></div>
<p>This <strong>creates</strong> the <code>User</code> model and its migration. So run:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rake db:migrate
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/user.rb</span>

<span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="c1"># Include default devise modules. Others available are:</span>
  <span class="c1"># :confirmable, :lockable, :timeoutable and :omniauthable</span>
  <span class="n">devise</span> <span class="ss">:database_authenticatable</span><span class="p">,</span> <span class="ss">:registerable</span><span class="p">,</span>
         <span class="ss">:recoverable</span><span class="p">,</span> <span class="ss">:rememberable</span><span class="p">,</span> <span class="ss">:trackable</span><span class="p">,</span> <span class="ss">:validatable</span>
<span class="k">end</span>
</code></pre></div>
<hr>

<h2>Views</h2>

<h3>Helpers</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">user_signed_in?</span>
<span class="c1"># =&gt; true / false</span>

<span class="n">current_user</span>
<span class="c1"># =&gt; User instance / nil</span>
</code></pre></div>
<h3>Navbar</h3>

<p>Use the helpers in the navbar</p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'shared/navbar'</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x"># app/views/shared/_navbar.html.erb</span>
</code></pre></div>
<p>You can start from this <a href="https://github.com/lewagon/awesome-navbars/blob/master/templates/_navbar_wagon.html.erb">navbar template</a></p>

<h3>Alerts</h3>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'shared/flashes'</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">notice</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;div class="alert alert-info alert-dismissible" role="alert"&gt;</span>
<span class="x">    &lt;button type="button" class="close" data-dismiss="alert" aria-label="Close"&gt;&lt;span aria-hidden="true"&gt;&amp;times;&lt;/span&gt;&lt;/button&gt;</span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">notice</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">alert</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;div class="alert alert-warning alert-dismissible" role="alert"&gt;</span>
<span class="x">    &lt;button type="button" class="close" data-dismiss="alert" aria-label="Close"&gt;&lt;span aria-hidden="true"&gt;&amp;times;&lt;/span&gt;&lt;/button&gt;</span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">alert</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<h3>Customize devise views</h3>

<p>Sign in / Sign up / Forget password / [...]</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g devise:views
</code></pre></div>
<p>And look into <code>app/views/devise</code> folder.</p>

<hr>

<h2>Controller</h2>

<h3>White-list approach</h3>

<p>Protect <strong>every route</strong> by default.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/application_controller.rb</span>
<span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">before_action</span> <span class="ss">:authenticate_user!</span>
<span class="k">end</span>
</code></pre></div>
<h3>Skipping login for some pages</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/welcome_controller.rb</span>
<span class="k">class</span> <span class="nc">PagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">skip_before_action</span> <span class="ss">:authenticate_user!</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="ss">:home</span>

  <span class="k">def</span> <span class="nf">home</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<hr>

<h2>Happy Authenticating!</h2>

<h1>Rails - Week 2 - (2) Coding as a team</h1>

<h3>Public project</h3>

<p><strong>Free</strong> on GitHub but be aware that the project will be <strong>visible</strong> to everyone.</p>

<h3>Private project</h3>

<p><a href="https://github.com/pricing">GitHub <strong>paid</strong> plan</a>. Project visible only to <strong>repo collaborators</strong>.</p>

<p>Cheapest plan, <em>"Personal"</em>: $7/month, unlimited repos.</p>

<p><br></p>

<p>Alternatives (Free):</p>

<ul>
<li><a href="https://bitbucket.org/">BitBucket</a></li>
<li><a href="https://gitlab.com/">GitLab</a></li>
</ul>

<p><br></p>

<p>You can use multiple cloud hosting for your git repositories!</p>

<h3>GitHub Organization</h3>

<p>Example: <a href="https://github.com/lewagon">github.com/lewagon</a></p>

<p><br><br></p>

<ul>
<li><a href="https://help.github.com/articles/what-s-the-difference-between-user-and-organization-accounts">GitHub - User and organization differences</a></li>
<li><a href="https://help.github.com/articles/converting-a-user-into-an-organization">GitHub - Converting a user into an organization</a></li>
</ul>

<hr>

<h2>Create a repo</h2>

<h3>Hacker's version</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd</span> ~/code/YOUR_GITHUB_USERNAME
<span class="nv">$ </span>rails new my-new-awesome-project -T --database<span class="o">=</span>postgresql
<span class="nv">$ </span><span class="nb">cd </span>my-new-awesome-project
<span class="nv">$ </span>git init
<span class="nv">$ </span>git add .
<span class="nv">$ </span>git commit -m <span class="s2">"Initial commit"</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>hub create
</code></pre></div>
<h3>Alternative version</h3>

<p><img src="./Le Wagon - Lectures_files/github_new_1-07212e9eb54ce9c91da44fbb9cd81407.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/github_new_2-7a3f73f3ff3045d44ce69c151ac3319c.png" alt=""></p>

<p>Usually, with rails, you already have run <code>git init</code>. You just need a remote:</p>

<p><img src="./Le Wagon - Lectures_files/github_new_3-fa7668cb705e5c0b7ed06ed5f9f9fcab.png" alt=""></p>

<hr>

<h2>Adding collaborators</h2>

<p><img src="./Le Wagon - Lectures_files/github_click_on_settings-16284075b1ddbf9cf67d98c260f817e7.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/github_add_collaborator-dece1edfdb6a3d58f597b55f00f96c15.png" alt=""></p>

<p>You gave them <strong>push</strong> access to the repository.</p>

<p>(and <a href="https://help.github.com/articles/permission-levels-for-a-user-account-repository/#collaborator-access-on-a-repository-owned-by-a-user-account">other</a> rights)</p>

<p>Now, collaborators can <strong>clone</strong> the project on their own computer:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>mkdir ~/code/OWNER_GITHUB_USERNAME
<span class="nv">$ </span><span class="nb">cd</span> ~/code/OWNER_GITHUB_USERNAME
<span class="nv">$ </span>git clone git@github.com:OWNER_GITHUB_USERNAME/PROJECT_NAME.git
<span class="nv">$ </span><span class="nb">cd </span>PROJECT_NAME
</code></pre></div>
<p>Clone with <strong><code>SSH</code></strong>, <strong>not</strong> HTTPS.</p>

<p><img src="./Le Wagon - Lectures_files/github_clone_ssh_url-2f1257e7db5f630da442472c97bdba67.png" alt=""></p>

<hr>

<h2>Working as a team</h2>

<h3>Think of features (user stories)</h3>

<h3>Problems</h3>

<ul>
<li>Overlap (we both need to change the <code>RestaurantsController</code>)</li>
<li>Dependency (I need your feature done to start mine)</li>
</ul>

<h3>Solutions</h3>

<ul>
<li>Technical (<code>git</code> branching)</li>
<li>Human (communication)</li>
</ul>

<h3>Git Branching</h3>

<p>When cloning a repository, you're by default on a branch, the originating branch.</p>

<p>In Git this branch is called <strong>master</strong>.</p>

<p>So basically, any collaborator can create a <strong>new branch from master</strong> branch and start working on a <strong>new feature</strong> (or bug, etc).</p>

<p><img src="./Le Wagon - Lectures_files/git-branching-4304b8d0fbd54abc04886f3f59d60f63.png" alt=""></p>

<h3>Listing local and remote branches</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ git branch -a
* master
  remotes/origin/master
</code></pre></div>
<p>We're currently on master branch (the one with an asterisk).
There's also a remote master branch (the one pushed on GitHub).</p>

<h3>Working on a new branch</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ git checkout -b add-description-to-restaurant
$ git branch -a
* add-description-to-restaurant
  master
  remote/origin/master
</code></pre></div>
<p>We've created a new local branch called <strong>add-description-to-restaurant</strong>. Locally, we're currently on this new branch.</p>

<p>Any new commit will only be applied to this branch.</p>

<h3>Pushing a branch to GitHub</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ git push origin add-description-to-restaurant
$ git branch -a
* add-description-to-restaurant
  master
  remote/origin/add-description-to-restaurant
  remote/origin/master
</code></pre></div>
<p>We've pushed the branch to GitHub.</p>

<h3>Finishing a feature</h3>

<p>Using branches, we work on different parts of a project at the same time.</p>

<p>When a feature is finished, we'd like to have its related <strong>commits back on master</strong>.</p>

<p><strong>How?</strong></p>

<hr>

<h2>GitHub Pull Requests</h2>

<h3>Usages</h3>

<ul>
<li>Get feedback on code written in a given branch (code review)</li>
<li>Merge the branch back into master</li>
</ul>

<h3>A Pull Request is a conversation</h3>

<p>Example: <a href="https://github.com/lewagon/www-sinatra/pull/45">lewagon/www-sinatra#45</a>.</p>

<h3>Creating a Pull Request (1)</h3>

<p>As soon as you push a new branch, a pull request button appears on your GitHub repository page.</p>

<p>Just click on this button, review the diff and add clear title and description.</p>

<p><img src="./Le Wagon - Lectures_files/compare-and-pull-request-button-easy-way-62970a8cd4670197e72a6c54dd156185.png" alt=""></p>

<h3>Creating a Pull Request (2)</h3>

<ul>
<li>Take some time to write a proper <strong>title</strong> and <strong>description</strong></li>
<li>Explain what you did on the branch (gem added, code tricks, etc...)</li>
<li>Ease the reviewer's job</li>
<li>You can poke people with <code>@...</code>, like <code>@ssaunier</code> or <code>@papillard</code> to get their feedback</li>
</ul>

<h3>Reviewing a Pull Request</h3>

<ul>
<li>Look at the diff, comment on errors (indentation, style, useless code, etc.)</li>
<li>Comment <strong>inline</strong> or at the pull request level</li>
<li>When done:

<ul>
<li>If code is fine, click on "Merge Pull Request" then "Delete Branch"</li>
<li>If not, add a general comment "Review done"</li>
</ul></li>
</ul>

<p><img src="./Le Wagon - Lectures_files/github_pull_request-5dd48b90c17df5b3bea37f5a9310af19.png" alt=""></p>

<hr>

<h2>Looping over</h2>

<h3>Getting <code>master</code> up to date</h3>

<p>When a Pull Request is <strong>merged</strong>, a new commit is created on <code>master</code>.</p>

<p>You need to fetch it on your <strong>local</strong> repository.</p>

<h3>Be <strong>very</strong> careful</h3>

<p>First, you need a <strong>CLEAN</strong> git status.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git status
<span class="c"># On branch master</span>
<span class="c"># Your branch is up-to-date with 'origin/master'.</span>
<span class="c"># nothing to commit, working directory clean</span>
</code></pre></div>
<h3>Get the latest <code>master</code></h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git checkout master
<span class="nv">$ </span>git pull origin master
</code></pre></div>
<p>Then you can clean up local unused branches</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git sweep
</code></pre></div>
<h3>Merging <code>master</code> in your branches</h3>

<p>Do you need something in <code>master</code> back into your current branch?</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git status
<span class="c"># MAKE SURE THIS IS CLEAN</span>
<span class="nv">$ </span>git checkout add-description-to-restaurant
<span class="nv">$ </span>git merge master
</code></pre></div>
<h3>2 rules</h3>

<ul>
<li><strong>Never</strong> commit directly to <code>master</code>. Use feature branches</li>
<li><strong>Always</strong> make sure <code>git status</code> is <strong>clean</strong> before <code>pull</code>, <code>checkout</code> or <code>merge</code>.</li>
</ul>

<hr>

<h3>Project Management</h3>

<p>Week objective: Implement your own version of AirBnB</p>

<ul>
<li>Teams of 2 to 4</li>
</ul>

<h3>Day One</h3>

<ul>
<li>Write 5 to 10 user stories (week backlog) + Validate with teacher</li>
<li>Brainstorm Data Model + Validate with teacher</li>
<li>Brainstorm Routes / Draw Mockups + Validate with teacher</li>
<li>Lead Dev creates rails app, github repo, invite collaborators</li>
<li>Development starts. Pair program if too much dependencies at the beginning</li>
</ul>

<h3>User stories</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">As a &lt;ROLE&gt;
I can &lt;ACTION&gt;
So that &lt;VALUE&gt;
</code></pre></div>
<p><strong>DO NOT</strong> commit to <code>master</code>. Exception, the rails app creation:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd</span> ~/code/<span class="nv">$GITHUB_USERNAME</span>
<span class="nv">$ </span>rails new rbnb -T --database<span class="o">=</span>postgresql
<span class="nv">$ </span><span class="nb">cd </span>rbnb
<span class="nv">$ </span>git init
<span class="nv">$ </span>git add .
<span class="nv">$ </span>git commit -m <span class="s2">"Initial commit"</span>
<span class="nv">$ </span>hub create
<span class="nv">$ </span>git push origin master
<span class="c"># And now, `checkout -b` a new branch BEFORE writing code.</span>
</code></pre></div>
<hr>

<h2>Happy Collaborating!</h2>

<h1>Rails - Week 2 - Facebook Connect</h1>

<h2>Facebook Connect</h2>

<ul>
<li>Based on <a href="https://fr.wikipedia.org/wiki/OAuth">OAuth</a></li>
<li>Takes charge of the Facebook Connect process:</li>
</ul>

<ol>
<li>Sign in to Facebook</li>
<li>Authorize app</li>
<li>Callback</li>
</ol>

<h3>Start with a rails devise template</h3>

<p><a href="https://github.com/lewagon/rails-templates#devise">github.com/lewagon/rails-templates#devise</a></p>

<hr>

<h2>Setup</h2>

<ul>
<li>Devise already include an <code>omniauthable</code> extension.</li>
<li>We assume that both <strong>devise</strong> and <strong>figaro</strong> gems ar installed</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s1">'omniauth-facebook'</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bundle install
</code></pre></div>
<hr>

<h2>Facebook App</h2>

<h3>Create the FB app</h3>

<ul>
<li>Sign in on <a href="https://developers.facebook.com/">FB developer platform</a></li>
<li>Create your app

<ul>
<li>Add a new platform, "Website", and specify the root url (*.herokuapp.com or your domain)</li>
</ul></li>
<li>Add a test app

<ul>
<li>Add a new platform, "Website", and specify <code>http://localhost:3000</code></li>
</ul></li>
</ul>

<hr>

<h2>Integration in Rails</h2>

<p>What follows is a summary of the <a href="https://github.com/plataformatec/devise/wiki/OmniAuth:-Overview">devise omniauth wiki</a>.</p>

<h3>Set your API keys</h3>

<ol>
<li><p>Remember, You need the <a href="https://github.com/laserlemon/figaro#getting-started"><code>figaro</code></a> gem installed before, to have an ignored <code>config/application.yml</code> file (don't push your credentials to GitHub!)</p></li>
<li><p>copy/paste your FB keys in <code>config/application.yml</code> as follows</p></li>
</ol>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="ss">development</span><span class="p">:</span>
  <span class="ss">FB_ID</span><span class="p">:</span> <span class="s2">"3************1"</span>
  <span class="ss">FB_SECRET</span><span class="p">:</span> <span class="s2">"4************e"</span>
</code></pre></div>
<h3>Configure devise</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/initializers/devise.rb</span>

<span class="no">Devise</span><span class="o">.</span><span class="n">setup</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="o">.</span><span class="n">omniauth</span> <span class="ss">:facebook</span><span class="p">,</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">"FB_ID"</span><span class="o">]</span><span class="p">,</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">"FB_SECRET"</span><span class="o">]</span><span class="p">,</span> <span class="ss">scope</span><span class="p">:</span> <span class="s1">'email'</span><span class="p">,</span> <span class="ss">info_fields</span><span class="p">:</span> <span class="s1">'email, first_name,last_name'</span><span class="p">,</span> <span class="ss">image_size</span><span class="p">:</span> <span class="s1">'large'</span>
<span class="k">end</span>
</code></pre></div>
<p>See the <a href="https://github.com/mkdynamic/omniauth-facebook#configuring">omniauth config</a> doc for more.</p>

<p><img src="./Le Wagon - Lectures_files/facebook_omniauth_sequence-e24c5cbdf9db17482a8850af34f4b122.png" alt=""></p>

<!--

title Facebook Omniauth Sequence

note right of Bob
    Bob clicks on "Sign in with Facebook"
end note

Bob->OmniauthCallbacksController: /users/auth/facebook
OmniauthCallbacksController->Facebook: redirects to Facebook login form


note right of Facebook
    Bob fills the Facebook form + authorize app
end note

Facebook->OmniauthCallbacksController: `facebook`


OmniauthCallbacksController->User: `self.find_for_facebook_oauth`

note right of User
    Omniauth find or creates user in database
end note

User->OmniauthCallbacksController: returns user

OmniauthCallbacksController->OmniauthCallbacksController: sign_in_and_redirect

note right of OmniauthCallbacksController
    Bob is redirected to /
end note

-->

<h3>Routing</h3>

<p>Replace your old devise route by the following one</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>

<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">devise_for</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">controllers</span><span class="p">:</span> <span class="p">{</span> <span class="ss">omniauth_callbacks</span><span class="p">:</span> <span class="s1">'users/omniauth_callbacks'</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div>
<h2>Make your <code>User</code> model omniauthable</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/user.rb</span>

<span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">devise</span> <span class="ss">:omniauthable</span><span class="p">,</span> <span class="ss">omniauth_providers</span><span class="p">:</span> <span class="o">[</span><span class="ss">:facebook</span><span class="o">]</span>
<span class="k">end</span>
</code></pre></div>
<h3>Add new attributes to your users</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g migration AddOmniauthToUsers <span class="se">\</span>
    provider uid picture first_name last_name token token_expiry:datetime
<span class="nv">$ </span>rake db:migrate
</code></pre></div>
<h3>Implement a <code>find_for_facebook_oauth</code></h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/user.rb</span>
<span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">find_for_facebook_oauth</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>
    <span class="n">where</span><span class="p">(</span><span class="ss">provider</span><span class="p">:</span> <span class="n">auth</span><span class="o">.</span><span class="n">provider</span><span class="p">,</span> <span class="ss">uid</span><span class="p">:</span> <span class="n">auth</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span><span class="o">.</span><span class="n">first_or_create</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span>
      <span class="n">user</span><span class="o">.</span><span class="n">provider</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">provider</span>
      <span class="n">user</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">uid</span>
      <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">email</span>
      <span class="n">user</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="no">Devise</span><span class="o">.</span><span class="n">friendly_token</span><span class="o">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="o">]</span>  <span class="c1"># Fake password for validation</span>
      <span class="n">user</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">first_name</span>
      <span class="n">user</span><span class="o">.</span><span class="n">last_name</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">last_name</span>
      <span class="n">user</span><span class="o">.</span><span class="n">picture</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">image</span>
      <span class="n">user</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">token</span>
      <span class="n">user</span><span class="o">.</span><span class="n">token_expiry</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">auth</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">expires_at</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Callback Controller</h3>

<p>Create a new controller to handle Omniauth callback requests</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/users/omniauth_callbacks_controller.rb</span>

<span class="k">class</span> <span class="nc">Users</span><span class="o">::</span><span class="no">OmniauthCallbacksController</span> <span class="o">&lt;</span> <span class="no">Devise</span><span class="o">::</span><span class="no">OmniauthCallbacksController</span>
  <span class="k">def</span> <span class="nf">facebook</span>
    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_for_facebook_oauth</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">env</span><span class="o">[</span><span class="s1">'omniauth.auth'</span><span class="o">]</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">persisted?</span>
      <span class="n">sign_in_and_redirect</span> <span class="n">user</span><span class="p">,</span> <span class="ss">event</span><span class="p">:</span> <span class="ss">:authentication</span>
      <span class="n">set_flash_message</span><span class="p">(</span><span class="ss">:notice</span><span class="p">,</span> <span class="ss">:success</span><span class="p">,</span> <span class="ss">kind</span><span class="p">:</span> <span class="s1">'Facebook'</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_navigational_format?</span>
    <span class="k">else</span>
      <span class="n">session</span><span class="o">[</span><span class="s1">'devise.facebook_data'</span><span class="o">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">env</span><span class="o">[</span><span class="s1">'omniauth.auth'</span><span class="o">]</span>
      <span class="n">redirect_to</span> <span class="n">new_user_registration_url</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Add your profile picture</h3>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">current_user.picture</span>
</code></pre></div>
<h3>Keep a regular sign-up</h3>

<p>User may disable access to his/her email =&gt; Devise can't register user!</p>

<hr>

<h2>Production</h2>

<ol>
<li>You need to create another Facebook App (because of the redirect URL)</li>
<li>You need to push the <code>FB_ID</code> and <code>FB_SECRET</code> of this app to Heroku:</li>
</ol>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>heroku config:set <span class="nv">FB_ID</span><span class="o">=</span>************ <span class="nv">FB_SECRET</span><span class="o">=</span>*********
</code></pre></div>
<hr>

<h2>Happy Hacking!</h2>

<h1>Rails - Week 2 - Geo</h1>

<h2>Address -&gt; GPS Coordinates</h2>

<h3>Geocoding</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">"Eiffel Tower"  48.8582, 2.2945
</code></pre></div>
<h3>A new gem for your <code>Gemfile</code></h3>

<p><a href="https://github.com/alexreisner/geocoder">geocoder</a></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s2">"geocoder"</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bundle install
</code></pre></div>
<h3>Add columns to your model</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/flat.rb</span>
<span class="k">class</span> <span class="nc">Flat</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
<span class="k">end</span>
</code></pre></div>
<p>Add <strong>two columns</strong> to your model you want to geocode:</p>

<p>(Replace <code>Flat</code> with the model you want to geocode!)</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g migration AddCoordinatesTo*Flats* latitude:float longitude:float
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rake db:migrate
</code></pre></div>
<h3>Geocoding</h3>

<p>Suppose that your store the address in a <code>address</code> column:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/flat.rb</span>
<span class="k">class</span> <span class="nc">Flat</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">geocoded_by</span> <span class="ss">:address</span>
  <span class="n">after_validation</span> <span class="ss">:geocode</span><span class="p">,</span> <span class="k">if</span><span class="p">:</span> <span class="ss">:address_changed?</span>
<span class="k">end</span>
</code></pre></div>
<h3>Result</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Flat</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">address</span><span class="p">:</span> <span class="s1">'25 rue du petit musc, Paris'</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">'Le Wagon'</span><span class="p">)</span>
<span class="c1"># =&gt; &lt;Flat id: 1, name: "Le Wagon",</span>
<span class="c1">#                 address: "25 rue du petit musc, Paris",</span>
<span class="c1">#                 created_at: "2015-02-19 07:20:01",</span>
<span class="c1">#                 updated_at: "2015-02-19 07:20:01",</span>
<span class="c1">#                 latitude: 48.8529369,</span>
<span class="c1">#                 longitude: 2.364178&gt;</span>
</code></pre></div>
<h3>Search</h3>

<p>Say we have a geocoded <code>Flat</code> model,</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Flat</span><span class="o">.</span><span class="n">near</span><span class="p">(</span><span class="s1">'Tour Eiffel'</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>      <span class="c1"># venues within 10 km of Tour Eiffel</span>
<span class="no">Flat</span><span class="o">.</span><span class="n">near</span><span class="p">(</span><span class="o">[</span><span class="mi">40</span><span class="o">.</span><span class="mi">71</span><span class="p">,</span> <span class="mi">100</span><span class="o">.</span><span class="mi">23</span><span class="o">]</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>    <span class="c1"># venues within 10 km of a point</span>
</code></pre></div>
<hr>

<h2>Reminder on JavaScript</h2>

<p>Before we try to display a map with markers of our flats.</p>

<p><strong>Objective</strong>: we want to <code>alert</code> a dynamic message.</p>

<p><strong>Problem</strong>: content in <code>app/assets/javascripts/</code> is <strong>static</strong></p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// app/assets/javascripts/application.js</span>

<span class="nx">alert</span><span class="p">(</span><span class="s1">'Sadly this is static...'</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/flats_controller.rb</span>
<span class="k">class</span> <span class="nc">FlatsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@flat</span> <span class="o">=</span> <span class="no">Flat</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@alert_message</span> <span class="o">=</span> <span class="s2">"You are viewing </span><span class="si">#{</span><span class="vi">@flat</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">javascript_tag</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  $(document).ready(function() {</span>
<span class="x">    alert('</span><span class="cp">&lt;%=</span> <span class="n">j</span> <span class="vi">@alert_message</span> <span class="cp">%&gt;</span><span class="x">');</span>
<span class="x">  });</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<p>The <code>j</code> is a shortcut for <a href="http://api.rubyonrails.org/classes/ActionView/Helpers/JavaScriptHelper.html#method-i-escape_javascript"><code>escape_javascript</code></a>. Escapes carriage returns and single and double quotes for JavaScript segments.</p>

<p>Default rails layout + View is:</p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="x">&lt;html&gt;</span>
<span class="x">  &lt;head&gt;</span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span>    <span class="s1">'application'</span><span class="p">,</span> <span class="ss">media</span><span class="p">:</span> <span class="s1">'all'</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s1">'application'</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;/head&gt;</span>
<span class="x">  &lt;body&gt;</span>

<span class="x">    </span><span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">  &lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</code></pre></div>
<p><strong>BUT</strong>, for <strong>performance</strong> reasons, <code>javascript_include_tag</code> should move to the bottom, just before <code>&lt;/body&gt;</code></p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="x">&lt;html&gt;</span>
<span class="x">  &lt;head&gt;</span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span>    <span class="s1">'application'</span><span class="p">,</span> <span class="ss">media</span><span class="p">:</span> <span class="s1">'all'</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;/head&gt;</span>
<span class="x">  &lt;body&gt;</span>

<span class="x">    </span><span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s1">'application'</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</code></pre></div>
<p>New issue: if view contains some javascript, jQuery &amp; libraries are not available.</p>

<p><strong>Why?</strong> Appended at the <code>yield</code>, <em>before</em> <code>javascript_include_tag</code>.</p>

<p><img src="./Le Wagon - Lectures_files/dollar_undefined-6e2b148fafd16a0cfa910fe4520a3ade.png" alt=""></p>

<p>Solution: Adding a <code>content_for</code></p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="x">&lt;html&gt;</span>
<span class="x">  &lt;head&gt;</span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span>    <span class="s1">'application'</span><span class="p">,</span> <span class="ss">media</span><span class="p">:</span> <span class="s1">'all'</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;/head&gt;</span>
<span class="x">  &lt;body&gt;</span>

<span class="x">    </span><span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s1">'application'</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="k">yield</span><span class="p">(</span><span class="ss">:after_js</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%</span> <span class="n">content_for</span><span class="p">(</span><span class="ss">:after_js</span><span class="p">)</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">javascript_tag</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    $(document).ready(function() {</span>
<span class="x">      alert('</span><span class="cp">&lt;%=</span> <span class="n">j</span> <span class="vi">@alert_message</span> <span class="cp">%&gt;</span><span class="x">');</span>
<span class="x">    });</span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<h3><code>raw</code></h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">FlatsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@flat</span> <span class="o">=</span> <span class="no">Flat</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@flat_coordinates</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">lat</span><span class="p">:</span> <span class="vi">@flat</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="ss">lng</span><span class="p">:</span> <span class="vi">@flat</span><span class="o">.</span><span class="n">lng</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%</span> <span class="n">content_for</span><span class="p">(</span><span class="ss">:after_js</span><span class="p">)</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">javascript_tag</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    $(document).ready(function() {</span>
<span class="x">      var coord = </span><span class="cp">&lt;%=</span> <span class="n">raw</span> <span class="vi">@flat_coordinates</span> <span class="cp">%&gt;</span><span class="x">;</span>
<span class="x">      alert('Flat coordinates are ' + coord.lat + ', ' + coord.lng);</span>
<span class="x">    });</span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<hr>

<h2>Google Maps (Static)</h2>

<p><strong>Objective</strong>: Display a google map with markers of flats</p>

<p><img src="./Le Wagon - Lectures_files/google_maps_markers-060ec3824c2e23ff47ed013acce9d875.png" alt=""></p>

<ol>
<li><a href="http://lewagon.github.io/google-maps-markers-static/">Demo on GitHub Pages</a></li>
<li><a href="https://github.com/lewagon/google-maps-markers-static/blob/gh-pages/index.html">Code on GitHub</a></li>
</ol>

<hr>

<h2>Google Maps (Dynamic)</h2>

<h3>Demo</h3>

<ol>
<li><a href="https://wagon-google-maps-markers.herokuapp.com/">Demo on Heroku</a></li>
<li><a href="https://github.com/lewagon/rails-google-maps">Code on GitHub</a></li>
</ol>

<h3>Using the <code>gmaps4rails</code> gem</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s2">"coffee-rails"</span>
<span class="n">gem</span> <span class="s2">"gmaps4rails"</span>

<span class="n">source</span> <span class="s1">'https://rails-assets.org'</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s2">"rails-assets-underscore"</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bundle install
</code></pre></div>
<h3>JavaScript dependencies</h3>

<p>Add this after <code>jquery</code> and <code>bootstrap</code>:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// app/assets/javascripts/application.js</span>

<span class="c1">//= require underscore</span>
<span class="c1">//= require gmaps/google</span>
</code></pre></div>
<h3>Remove turbolinks</h3>

<p>Turbolinks is very hard to configure correctly with Google Maps.</p>

<p>Just delete this line from <code>app/assets/javascript/application.js</code></p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">//= require turbolinks   // REMOVE THIS LINE</span>
</code></pre></div>
<p>And remove it from the <code>Gemfile</code> as well.</p>

<h3>Layout</h3>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s2">"https://maps.google.com/maps/api/js?libraries=places&amp;sensor=false"</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s2">"https://cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s2">"application"</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">  </span><span class="cp">&lt;%=</span> <span class="k">yield</span><span class="p">(</span><span class="ss">:after_js</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;/body&gt;</span>
</code></pre></div>
<p>Make sure you only have one <code>javascript_include_tag "application"</code> (remove
it from the <code>&lt;head /&gt;</code> if there is still one)</p>

<h3>Controller</h3>

<p>You want to display a map on the <code>flats#index</code> route:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/flats_controller.rb</span>

<span class="k">class</span> <span class="nc">FlatsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@flats</span> <span class="o">=</span> <span class="no">Flat</span><span class="o">.</span><span class="n">all</span>

    <span class="c1"># Let's DYNAMICALLY build the markers for the view.</span>
    <span class="vi">@markers</span> <span class="o">=</span> <span class="no">Gmaps4rails</span><span class="o">.</span><span class="n">build_markers</span><span class="p">(</span><span class="vi">@flats</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">flat</span><span class="p">,</span> <span class="n">marker</span><span class="o">|</span>
      <span class="n">marker</span><span class="o">.</span><span class="n">lat</span> <span class="n">flat</span><span class="o">.</span><span class="n">latitude</span>
      <span class="n">marker</span><span class="o">.</span><span class="n">lng</span> <span class="n">flat</span><span class="o">.</span><span class="n">longitude</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>View</h3>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;div id="map" style="width: 100%; height: 600px;"&gt;&lt;/div&gt;</span>

<span class="cp">&lt;%</span> <span class="n">content_for</span><span class="p">(</span><span class="ss">:after_js</span><span class="p">)</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">javascript_tag</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    $(document).on('ready', function() {</span>
<span class="x">      handler = Gmaps.build('Google');</span>
<span class="x">      handler.buildMap({ internal: { id: 'map' } }, function(){</span>
<span class="x">        markers = handler.addMarkers(</span><span class="cp">&lt;%=</span> <span class="n">raw</span> <span class="vi">@markers</span><span class="o">.</span><span class="n">to_json</span> <span class="cp">%&gt;</span><span class="x">);</span>
<span class="x">        handler.bounds.extendWith(markers);</span>
<span class="x">        handler.fitMapToBounds();</span>
<span class="x">      });</span>
<span class="x">    })</span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<h3>Documentation</h3>

<p>For more, read <a href="https://developers.google.com/maps/documentation/javascript/overlays">Drawing on the maps</a></p>

<hr>

<h2>Address autocomplete</h2>

<p><img src="./Le Wagon - Lectures_files/tuto-google-place-autocomplete-86e574808a3e09062b3b7bc3f898fe4ec58484d9d10c284d8c1efb1d51e6f89d.gif" alt=""></p>

<ol>
<li><a href="http://lewagon.github.io/google-place-autocomplete/">Demo</a></li>
<li><a href="http://www.lewagon.org/blog/tuto-google-place-autocomplete">Tutorial (French)</a></li>
<li><a href="https://github.com/lewagon/google-place-autocomplete">Source code</a></li>
</ol>

<hr>

<h2>Production</h2>

<h3><code>geocoder</code></h3>

<p>Geocoder uses the Google Geocoding API.</p>

<p>Limited number of requests per day (2500) in the free plan.</p>

<h3>Register a new project</h3>

<ol>
<li>New project at <a href="https://console.developers.google.com/project">console.developers.google.com/project</a></li>
<li>Enable the "Geocoding API" in <code>APIs &amp; Auth &gt; API</code>.</li>
<li>Create a new <strong>Server</strong> Key in <code>APIs &amp; Auth &gt; Credentials</code> (leave the IP addresses blank).</li>
</ol>

<p><img src="./Le Wagon - Lectures_files/google_server_api_key-e21fd474547f340055286981f520e720.png" alt=""></p>

<h3>Add configuration key</h3>

<ol>
<li><p>Remember, you need the <a href="https://github.com/laserlemon/figaro#getting-started"><code>figaro</code></a> gem installed before to have an ignored <code>config/application.yml</code> file (don't push your credentials to GitHub!).</p></li>
<li><p>copy/paste your key in <code>config/application.yml</code> as follows</p></li>
</ol>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="ss">GOOGLE_API_SERVER_KEY</span><span class="p">:</span> <span class="no">AIzaSyDMg1</span><span class="o">******************</span><span class="mi">8</span><span class="n">wxJqE</span>
</code></pre></div>
<h3>Add an initializer</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/initializers/geocoder.rb</span>

<span class="no">Geocoder</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
  <span class="ss">lookup</span><span class="p">:</span>    <span class="ss">:google</span><span class="p">,</span>
  <span class="ss">api_key</span><span class="p">:</span>   <span class="no">ENV</span><span class="o">[</span><span class="s1">'GOOGLE_API_SERVER_KEY'</span><span class="o">]</span><span class="p">,</span>
  <span class="ss">use_https</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span>
  <span class="ss">units</span><span class="p">:</span>     <span class="ss">:km</span>       <span class="c1"># :km for kilometers or :mi for mile</span>
<span class="p">)</span>
</code></pre></div>
<h3>Push configuration to Heroku</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>figaro heroku:set -e production
</code></pre></div>
<h3>Autocomplete &amp; Google Maps (1)</h3>

<p>1 - <em>Don't forget to enable these APIs</em> for your project in the Google Developers Console:</p>

<p><code>Google Maps JavaScript API v3</code> (free plan: 1,000,000 requests / day)</p>

<p>2 - Generate a <strong>browser</strong> key for your javascript tag.</p>

<h3>Autocomplete &amp; Google Maps (2)</h3>

<p>3 - copy/paste your browser key in <code>config/application.yml</code> as follows</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="ss">GOOGLE_API_BROWSER_KEY</span><span class="p">:</span> <span class="no">Sz1MDgyAaI</span><span class="o">******************</span><span class="no">EJ8xwq</span>
</code></pre></div>
<p>4 - Update your javascript include tag:</p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span>
        <span class="s2">"https://maps.google.com/maps/api/js?libraries=places&amp;sensor=false&amp;key=</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'GOOGLE_API_BROWSER_KEY'</span><span class="o">]</span><span class="si">}</span><span class="s2">"</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<hr>

<h2>Google Skins</h2>

<p><a href="https://snazzymaps.com/">Snazzy Maps</a></p>

<hr>

<h2>Google Alternatives</h2>

<p><a href="https://www.mapbox.com/">Mapbox</a>, uses <a href="http://openstreetmap.fr/">OpenStreetmap</a></p>

<hr>

<h2>Happy geocoding!</h2>

<h1>Rails - Week 2 - Mailing</h1>

<h1>Transactional Email</h1>

<h2>SMTP</h2>

<h2>What is SMTP?</h2>

<p>Simple Mail Transfer <strong>Protocol</strong>.</p>

<p>(HTTP is another protocol you know)</p>

<h3>Start with a rails devise template</h3>

<p><a href="https://github.com/lewagon/rails-templates#devise">github.com/lewagon/rails-templates#devise</a></p>

<p>We want to send a <strong>welcome email</strong> to our user.</p>

<hr>

<h2>ActionMailer (Rails)</h2>

<p>Think of Controller + View</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails generate mailer UserMailer welcome
<span class="c">#      create  app/mailers/user_mailer.rb</span>
<span class="c">#      invoke  erb</span>
<span class="c">#      create    app/views/user_mailer</span>
<span class="c">#      create    app/views/user_mailer/welcome.text.erb</span>
<span class="c">#      create    app/views/user_mailer/welcome.html.erb</span>
</code></pre></div>
<h3>Customize Default Mailer</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">ApplicationMailer</span> <span class="o">&lt;</span> <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">default</span> <span class="ss">from</span><span class="p">:</span> <span class="s1">'your-email@example.com'</span>

  <span class="n">layout</span> <span class="s1">'mailer'</span>
<span class="k">end</span>
</code></pre></div>
<h3>Customize User Mailer</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/mailers/user_mailer.rb</span>

<span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="k">def</span> <span class="nf">welcome</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">user</span>  <span class="c1"># Instance variable =&gt; available in view</span>

    <span class="n">mail</span><span class="p">(</span><span class="ss">to</span><span class="p">:</span> <span class="vi">@user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="ss">subject</span><span class="p">:</span> <span class="s1">'Welcome to LeWagon'</span><span class="p">)</span>
    <span class="c1"># This will render a view in `app/views/user_mailer`!</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Email content</h3>

<p>To set the email content, you define it like views</p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">Hi </span><span class="cp">&lt;%=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="x">,</span>

<span class="x">Today we'll talk about SMTP and Mandrill!</span>

<span class="x">See ya!</span>
</code></pre></div>
<p>You can send HTML email if you have a view</p>

<p><code>app/views/user_mailer/welcome.html.erb</code></p>

<h3>Testing</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>mkdir -p <span class="nb">test</span>/mailers/previews
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># test/mailers/previews/user_mailer_preview.rb</span>
<span class="k">class</span> <span class="nc">UserMailerPreview</span> <span class="o">&lt;</span> <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Preview</span>
  <span class="k">def</span> <span class="nf">welcome</span>
    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">first</span>
    <span class="no">UserMailer</span><span class="o">.</span><span class="n">welcome</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Go to <a href="http://localhost:3000/rails/mailers/user_mailer/welcome">localhost:3000/rails/mailers/user_mailer/welcome</a></p>

<hr>

<h2>Development</h2>

<p>We don't really send emails.</p>

<h3>Letter Opener</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>

<span class="n">gem</span> <span class="s2">"letter_opener"</span><span class="p">,</span> <span class="ss">group</span><span class="p">:</span> <span class="ss">:development</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bundle install
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/environments/development.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span>
  <span class="c1"># [...]</span>
  <span class="n">config</span><span class="o">.</span><span class="n">action_mailer</span><span class="o">.</span><span class="n">delivery_method</span> <span class="o">=</span> <span class="ss">:letter_opener</span>
  <span class="n">config</span><span class="o">.</span><span class="n">action_mailer</span><span class="o">.</span><span class="n">default_url_options</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">host</span><span class="p">:</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'HOST'</span><span class="o">]</span> <span class="o">||</span> <span class="s2">"localhost:3000"</span> <span class="p">}</span>
  <span class="c1"># [...]</span>
<span class="k">end</span>
</code></pre></div>
<p>A new tab will open in the browser to show the mail you just sent.</p>

<hr>

<h2>Delivering the mail</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">first</span>
<span class="no">UserMailer</span><span class="o">.</span><span class="n">welcome</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">deliver_now</span>
</code></pre></div>
<h3>From model (on callback)</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">after_create</span> <span class="ss">:send_welcome_email</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">send_welcome_email</span>
    <span class="no">UserMailer</span><span class="o">.</span><span class="n">welcome</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">.</span><span class="n">deliver_now</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Another example : Restaurant Mailer</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/mailers/restaurant_mailer.rb</span>
<span class="k">class</span> <span class="nc">RestaurantMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="k">def</span> <span class="nf">creation_confirmation</span><span class="p">(</span><span class="n">restaurant</span><span class="p">)</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="n">restaurant</span>

    <span class="n">mail</span><span class="p">(</span>
      <span class="ss">to</span><span class="p">:</span>       <span class="vi">@restaurant</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
      <span class="ss">subject</span><span class="p">:</span>  <span class="s2">"Restaurant </span><span class="si">#{</span><span class="vi">@restaurant</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> created!"</span>
    <span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>From controller (on action)</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">restaurants</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">restaurant_params</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">save</span>
      <span class="no">RestaurantMailer</span><span class="o">.</span><span class="n">creation_confirmation</span><span class="p">(</span><span class="vi">@restaurant</span><span class="p">)</span><span class="o">.</span><span class="n">deliver_now</span>
      <span class="n">redirect_to</span> <span class="n">restaurant_path</span><span class="p">(</span><span class="vi">@restaurant</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:new</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<hr>

<h2>Production</h2>

<h3>Postmark</h3>

<p><a href="https://elements.heroku.com/addons/postmark">Add-on on Heroku</a></p>

<p>Free plan: 10,000 emails / month.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>heroku addons:create postmark:10k
</code></pre></div>
<h3>Authenticate</h3>

<p>Configure your sender email:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>heroku addons:open postmark
</code></pre></div>
<p>You have to use your <strong>own domain</strong>.</p>

<p>If you want <code>@gmail.com</code>, this is <a href="https://support.google.com/a/answer/176600?hl=en">the doc</a></p>

<h3>Configuration (1)</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/initializers/smtp.rb</span>
<span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">smtp_settings</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">address</span><span class="p">:</span> <span class="s1">'smtp.postmarkapp.com'</span><span class="p">,</span>
  <span class="ss">port</span><span class="p">:</span> <span class="s1">'25'</span><span class="p">,</span>
  <span class="ss">domain</span><span class="p">:</span> <span class="s1">'heroku.com'</span><span class="p">,</span>
  <span class="ss">user_name</span><span class="p">:</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'POSTMARK_API_TOKEN'</span><span class="o">]</span><span class="p">,</span>
  <span class="ss">password</span><span class="p">:</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'POSTMARK_API_TOKEN'</span><span class="o">]</span><span class="p">,</span>
  <span class="ss">authentication</span><span class="p">:</span> <span class="ss">:cram_md5</span><span class="p">,</span>
  <span class="ss">enable_starttls_auto</span><span class="p">:</span> <span class="kp">true</span>
<span class="p">}</span>
</code></pre></div>
<h3>Configuration (2)</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/environments/production.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span>
  <span class="c1"># [...]</span>
  <span class="n">config</span><span class="o">.</span><span class="n">action_mailer</span><span class="o">.</span><span class="n">delivery_method</span> <span class="o">=</span> <span class="ss">:smtp</span>
  <span class="n">config</span><span class="o">.</span><span class="n">action_mailer</span><span class="o">.</span><span class="n">default_url_options</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">host</span><span class="p">:</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'HOST'</span><span class="o">]</span> <span class="p">}</span>
  <span class="c1"># [...]</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text"># config/application.yml
production:
  HOST: 'yourapp.herokuapp.com'
</code></pre></div>
<p>Use <code>_url</code> path helpers in your email views!</p>

<h3>Deliverability from your domain</h3>

<p>Add DKIM and SPF for your domain</p>

<hr>

<h2>Mail interceptor</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># lib/email_interceptor.rb</span>
<span class="k">class</span> <span class="nc">EmailInterceptor</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">delivering_email</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="n">message</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="n">message</span><span class="o">.</span><span class="n">to</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">message</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">message</span><span class="o">.</span><span class="n">to</span> <span class="o">=</span> <span class="o">[</span> <span class="s1">'seb@lewagon.org'</span> <span class="o">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/initializers/development_email_interceptor.rb</span>
<span class="k">if</span> <span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">development?</span>
  <span class="nb">require</span> <span class="s2">"email_interceptor"</span>
  <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">register_interceptor</span><span class="p">(</span><span class="no">EmailInterceptor</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<hr>

<h2>Documentation</h2>

<p>Read more about <a href="http://guides.rubyonrails.org/action_mailer_basics.html">Action Mailer on Rails Guides</a></p>

<hr>

<h1>Marketing Email</h1>

<h3>MailChimp</h3>

<p>Create an account. Free for 2000 subscribers.</p>

<p>Alternatives: Mailjet, Campaign Monitor, InfusionSoft, etc.</p>

<hr>

<h2>Static website</h2>

<p>For instance, one hosted on GitHub Pages</p>

<p>You need a client-side solution =&gt; HTML/JS</p>

<p><img src="./Le Wagon - Lectures_files/mailchimp_go_to_embedded_forms-d84be9a691ea78b42b0ef01b3df8dbb7.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/mailchimp_choose_embedded_forms-5e082d891ca8e217e82f12ee59aed7c5.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/mailchimp_embedded_form-dd15e3fc4a63731ecd0a606034aaf040.png" alt=""></p>

<hr>

<h2>Dynamic website</h2>

<p>For instance, a Rails app</p>

<h3>Use the API!</h3>

<h3><code>gibbon</code> gem</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s1">'gibbon'</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bundle install
</code></pre></div>
<h3>Create an API key</h3>

<p><img src="./Le Wagon - Lectures_files/mailchimp_go_to_api_keys-b176d61abb2f2b25744bb89598ec8a24.png" alt=""></p>

<p>Click on the <em>Create an API key</em> button. Copy the key.</p>

<h3>Sensitive data</h3>

<p>As the API key is sensitive data, you should not store it in the code directly
Supposing you have the <a href="https://github.com/laserlemon/figaro#getting-started">figaro</a> gem installed:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/application.yml</span>

<span class="ss">MAILCHIMP_API_KEY</span><span class="p">:</span> <span class="n">ehrv</span><span class="o">***********************</span><span class="mi">123</span>
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/mailchimp_copy_list_id-6fd2c1f9e2f8ef9c102f01794a90293e.png" alt=""></p>

<h3>Configuration data</h3>

<p>Put this id in your configuration file as well:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/application.yml</span>

<span class="ss">MAILCHIMP_LIST_ID</span><span class="p">:</span> <span class="mo">04</span><span class="mi">94</span><span class="n">cf26c5</span>
</code></pre></div>
<h3>Business Logic</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/services/subscribe_to_newsletter_service.rb</span>
<span class="k">class</span> <span class="nc">SubscribeToNewsletterService</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="vi">@gibbon</span> <span class="o">=</span> <span class="no">Gibbon</span><span class="o">::</span><span class="no">Request</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">api_key</span><span class="p">:</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'MAILCHIMP_API_KEY'</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@list_id</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'MAILCHIMP_LIST_ID'</span><span class="o">]</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">call</span>
    <span class="vi">@gibbon</span><span class="o">.</span><span class="n">lists</span><span class="p">(</span><span class="vi">@list_id</span><span class="p">)</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
      <span class="ss">body</span><span class="p">:</span> <span class="p">{</span>
        <span class="ss">email_address</span><span class="p">:</span> <span class="vi">@user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
        <span class="ss">status</span><span class="p">:</span> <span class="s2">"subscribed"</span><span class="p">,</span>
        <span class="c1"># merge_fields: {</span>
        <span class="c1">#   FNAME: @user.first_name,</span>
        <span class="c1">#   LNAME: @user.last_name</span>
        <span class="c1"># }</span>
      <span class="p">}</span>
    <span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Register user</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/user.rb</span>
<span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">after_create</span> <span class="ss">:subscribe_to_newsletter</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">subscribe_to_newsletter</span>
    <span class="no">SubscribeToNewsletterService</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">.</span><span class="n">call</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>More stuff</h3>

<p>Read the <a href="https://github.com/amro/gibbon"><code>gibbon</code> gem README</a></p>

<hr>

<h2>Happy Mailing!</h2>

<h1>Rails - Week 2 - Ajax in Rails</h1>

<h2>Let's start from scratch</h2>

<h3>Generate new app</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails new <span class="se">\</span>
  -T --database postgresql <span class="se">\</span>
  -m https://raw.githubusercontent.com/lewagon/rails-templates/master/devise.rb <span class="se">\</span>
  lafourchette_ajaxified
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd </span>lafourchette_ajaxified
</code></pre></div>
<h3>Models</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g model Restaurant name address
<span class="nv">$ </span>rails g model Review content:text restaurant:references
<span class="nv">$ </span>rake db:migrate
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/restaurant.rb</span>
<span class="k">class</span> <span class="nc">Restaurant</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:reviews</span><span class="p">,</span> <span class="ss">dependent</span><span class="p">:</span> <span class="ss">:destroy</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/review.rb</span>
<span class="k">class</span> <span class="nc">Review</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:restaurant</span>
  <span class="n">validates</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">minimum</span><span class="p">:</span> <span class="mi">20</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git add app/models db/*
<span class="nv">$ </span>git commit -m <span class="s2">"Generate Restaurant &amp; Review models"</span>
</code></pre></div>
<h3>Seed</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># db/seeds.rb</span>
<span class="no">Restaurant</span><span class="o">.</span><span class="n">create!</span><span class="p">({</span>
  <span class="nb">name</span><span class="p">:</span> <span class="s2">"Le Dindon en Laisse"</span><span class="p">,</span>
  <span class="ss">address</span><span class="p">:</span> <span class="s2">"18 Rue Beautreillis, 75004 Paris, France"</span>
<span class="p">})</span>
<span class="no">Restaurant</span><span class="o">.</span><span class="n">create!</span><span class="p">({</span>
  <span class="nb">name</span><span class="p">:</span> <span class="s2">"Neuf et Voisins"</span><span class="p">,</span>
  <span class="ss">address</span><span class="p">:</span> <span class="s2">"Van Arteveldestraat 1, 1000 Brussels, Belgium"</span>
<span class="p">})</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rake db:seed
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git add db/seeds.rb
<span class="nv">$ </span>git commit -m <span class="s2">"Seed 2 restaurants"</span>
</code></pre></div>
<h3>Restaurant Controller &amp; Routes</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g controller restaurants
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:restaurants</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:show</span> <span class="o">]</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@restaurants</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Restaurant Index View</h3>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;h1&gt;Restaurants&lt;/h1&gt;</span>

<span class="x">&lt;ul&gt;</span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="vi">@restaurants</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">restaurant</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    &lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">restaurant</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">restaurant_path</span><span class="p">(</span><span class="n">restaurant</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x">&lt;/li&gt;</span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;/ul&gt;</span>
</code></pre></div>
<h3>Restaurant Show View</h3>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="x">&lt;/h1&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="s2">"https://maps.googleapis.com/maps/api/staticmap?zoom=15&amp;size=400x300&amp;sensor=false&amp;maptype=roadmap&amp;markers=color:red|</span><span class="si">#{</span><span class="vi">@restaurant</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="s2">"</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;h2&gt;</span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">pluralize</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">reviews</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="s2">"review"</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;/h2&gt;</span>

<span class="x">&lt;div id="reviews"&gt;</span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="k">if</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">reviews</span><span class="o">.</span><span class="n">blank?</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    Be the first to leave a review for </span><span class="cp">&lt;%=</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="k">else</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    </span><span class="cp">&lt;%</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">reviews</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">review</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">      </span><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'reviews/show'</span><span class="p">,</span> <span class="ss">review</span><span class="p">:</span> <span class="n">review</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;/div&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="n">review</span><span class="o">.</span><span class="n">content</span> <span class="cp">%&gt;</span><span class="x">&lt;/p&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git status
<span class="nv">$ </span>git add .
<span class="nv">$ </span>git commit -m <span class="s2">"Add Restaurant index &amp; show views"</span>
</code></pre></div>
<p>We want to add reviews to a restaurant, but with the form inlined in the restaurant show view.</p>

<h3>Add a new route</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:restaurants</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:show</span> <span class="o">]</span> <span class="k">do</span>
    <span class="n">resources</span> <span class="ss">:reviews</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="ss">:create</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g controller reviews
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/reviews_controller.rb</span>
<span class="k">class</span> <span class="nc">ReviewsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:restaurant_id</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@review</span> <span class="o">=</span> <span class="no">Review</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">review_params</span><span class="p">)</span>
    <span class="vi">@review</span><span class="o">.</span><span class="n">restaurant</span> <span class="o">=</span> <span class="vi">@restaurant</span>
    <span class="k">if</span> <span class="vi">@review</span><span class="o">.</span><span class="n">save</span>
      <span class="n">redirect_to</span> <span class="n">restaurant_path</span><span class="p">(</span><span class="vi">@restaurant</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="s1">'restaurants/show'</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">review_params</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:review</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:content</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Review form</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="c1"># [...]</span>
  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@review</span> <span class="o">=</span> <span class="no">Review</span><span class="o">.</span><span class="n">new</span>  <span class="c1"># &lt;-- You need this now.</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'reviews/form'</span><span class="p">,</span> <span class="ss">restaurant</span><span class="p">:</span> <span class="vi">@restaurant</span><span class="p">,</span> <span class="ss">review</span><span class="p">:</span> <span class="vi">@review</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">simple_form_for</span><span class="p">(</span><span class="o">[</span> <span class="n">restaurant</span><span class="p">,</span> <span class="n">review</span> <span class="o">]</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">form</span><span class="o">.</span><span class="n">input</span> <span class="ss">:content</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">form</span><span class="o">.</span><span class="n">button</span> <span class="ss">:submit</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<p>It works!</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git status
<span class="nv">$ </span>git add .
<span class="nv">$ </span>git commit -m <span class="s2">"Add review to restaurant"</span>
</code></pre></div>
<hr>

<h2>Let's ajaxify this app</h2>

<h3>Configuration</h3>

<p>Make sure this is set to <code>true</code>:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/application.rb</span>

<span class="c1"># [...]</span>
  <span class="k">class</span> <span class="nc">Application</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Application</span>
    <span class="n">config</span><span class="o">.</span><span class="n">action_view</span><span class="o">.</span><span class="n">embed_authenticity_token_in_remote_forms</span> <span class="o">=</span> <span class="kp">true</span>
    <span class="c1"># [...]</span>
  <span class="k">end</span>
</code></pre></div>
<h3><code>remote: true</code></h3>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">simple_form_for</span><span class="p">(</span><span class="o">[</span> <span class="n">restaurant</span><span class="p">,</span> <span class="n">review</span> <span class="o">]</span><span class="p">,</span> <span class="ss">remote</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">form</span><span class="o">.</span><span class="n">input</span> <span class="ss">:content</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">form</span><span class="o">.</span><span class="n">button</span> <span class="ss">:submit</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/remote_true_ajax_headers-396803350948193935819ffa7f1b63a2.png" alt=""></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/reviews_controller.rb</span>
<span class="k">class</span> <span class="nc">ReviewsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="c1"># [...]</span>
    <span class="k">if</span> <span class="vi">@review</span><span class="o">.</span><span class="n">save</span>
      <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
        <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="n">restaurant_path</span><span class="p">(</span><span class="vi">@restaurant</span><span class="p">)</span> <span class="p">}</span>
        <span class="nb">format</span><span class="o">.</span><span class="n">js</span>  <span class="c1"># &lt;-- will render `app/views/reviews/create.js.erb`</span>
      <span class="k">end</span>
    <span class="k">else</span>
      <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
        <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="p">{</span> <span class="n">render</span> <span class="s1">'restaurants/show'</span> <span class="p">}</span>
        <span class="nb">format</span><span class="o">.</span><span class="n">js</span>  <span class="c1"># &lt;-- idem</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c1"># [...]</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">// app/views/reviews/create.js.erb</span>
<span class="x">// Here you will write *javascript* that would be executed by the browser</span>
<span class="cp">&lt;%</span> <span class="k">if</span> <span class="vi">@review</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">any?</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  // Render new review form with errors</span>
<span class="x">  $('#new_review').html("</span><span class="cp">&lt;%=</span> <span class="n">j</span> <span class="n">render</span> <span class="s1">'reviews/form'</span><span class="p">,</span> <span class="ss">restaurant</span><span class="p">:</span> <span class="vi">@restaurant</span><span class="p">,</span> <span class="ss">review</span><span class="p">:</span> <span class="vi">@review</span> <span class="cp">%&gt;</span><span class="x">");</span>
<span class="cp">&lt;%</span> <span class="k">else</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  // Create a paragraph for the new review. But hide it.</span>
<span class="x">  var new_review = $("</span><span class="cp">&lt;%=</span> <span class="n">j</span> <span class="n">render</span> <span class="s1">'reviews/show'</span><span class="p">,</span> <span class="ss">review</span><span class="p">:</span> <span class="vi">@review</span> <span class="cp">%&gt;</span><span class="x">").hide();</span>
<span class="x">  // Add it to the DOM, at the end of the existing reviews. It's still hidden.</span>
<span class="x">  $('#reviews').append(new_review);</span>
<span class="x">  // Show the new review with an animation!</span>
<span class="x">  new_review.slideDown();</span>
<span class="x">  // Remove the text from the content textarea.</span>
<span class="x">  $('#review_content').val('');</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<p>That's it! You form works with JavaScript enabled <strong>or</strong> disabled.</p>

<p>Unobtrusive JavaScript FTW.</p>

<h3>One more thing</h3>

<p>You can use this technique with <code>link_to</code> as well.</p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;ul&gt;</span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="vi">@restaurants</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">restaurant</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    &lt;li id="restaurant-</span><span class="cp">&lt;%=</span> <span class="n">restaurant</span><span class="o">.</span><span class="n">id</span> <span class="cp">%&gt;</span><span class="x">"&gt;</span>
<span class="x">      </span><span class="cp">&lt;%=</span> <span class="n">restaurant</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">      </span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Delete"</span><span class="p">,</span> <span class="n">restaurant</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:delete</span><span class="p">,</span> <span class="ss">remote</span><span class="p">:</span> <span class="kp">true</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    &lt;/li&gt;</span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;/ul&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="c1"># TODO: Add the `destroy` action to the</span>
  <span class="c1">#       `restaurants` resources in `config/routes.rb`</span>
  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@restaurant</span><span class="o">.</span><span class="n">destroy</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// app/views/restaurants/destroy.js.erb</span>
<span class="nx">$</span><span class="p">(</span><span class="s1">'#restaurant-&lt;%= @restaurant.id %&gt;'</span><span class="p">).</span><span class="nx">slideUp</span><span class="p">();</span>
</code></pre></div>
<hr>

<h2>Happy Ajaxification!</h2>

<h1>Projects - Week 1 - Pundit</h1>

<h2>Authorization</h2>

<p><code>!=</code> from <code>Authentication</code>.</p>

<h3>Example</h3>

<ul>
<li>As a <strong>user</strong>, I <strong>can</strong> create a restaurant.</li>
<li>As a <strong>user</strong>, I <strong>can</strong> update/destroy a restaurant if I <strong>created</strong> it.</li>
</ul>

<h3>Let's scaffold an example</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails new <span class="se">\</span>
  -T --database postgresql <span class="se">\</span>
  -m https://raw.githubusercontent.com/lewagon/rails-templates/master/devise.rb <span class="se">\</span>
  restaurants_with_pundit
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g scaffold restaurant name:string user:references
<span class="nv">$ </span>rake db:migrate
</code></pre></div>
<p>Update the scaffold so that <code>current_user</code> is used in <code>RestaurantsController#create</code>.</p>

<p><strong>Problem</strong>: you can delete a restaurant you did not create.</p>

<p><strong>Solution</strong>: use the <a href="https://github.com/elabs/pundit">*<em>Pundit</em> gem</a></p>

<h3>Pundit Setup</h3>
<div class="highlight"><pre><code class="language-Ruby" data-lang="Ruby"><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s2">"pundit"</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bundle install
<span class="nv">$ </span>rails g pundit:install
</code></pre></div>
<h3>White list approach</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>

  <span class="c1"># [...]</span>
  <span class="n">before_action</span> <span class="ss">:authenticate_user!</span>
  <span class="kp">include</span> <span class="no">Pundit</span>

  <span class="n">after_action</span> <span class="ss">:verify_authorized</span><span class="p">,</span> <span class="ss">except</span><span class="p">:</span> <span class="ss">:index</span><span class="p">,</span> <span class="k">unless</span><span class="p">:</span> <span class="ss">:devise_controller?</span>
  <span class="n">after_action</span> <span class="ss">:verify_policy_scoped</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="ss">:index</span><span class="p">,</span> <span class="k">unless</span><span class="p">:</span> <span class="ss">:devise_controller?</span>

  <span class="n">rescue_from</span> <span class="no">Pundit</span><span class="o">::</span><span class="no">NotAuthorizedError</span><span class="p">,</span> <span class="ss">with</span><span class="p">:</span> <span class="ss">:user_not_authorized</span>

  <span class="k">def</span> <span class="nf">user_not_authorized</span>
    <span class="n">flash</span><span class="o">[</span><span class="ss">:alert</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"You are not authorized to perform this action."</span>
    <span class="n">redirect_to</span><span class="p">(</span><span class="n">root_path</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Protect <code>Restaurant</code></h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g pundit:policy restaurant
<span class="c"># =&gt; generates the file `app/policies/restaurant_policy.rb`</span>
</code></pre></div>
<h3>Update your Policy</h3>

<p>Update <code>resolve</code> method of <code>Scope</code> nested class</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Scope</span> <span class="o">&lt;</span> <span class="no">Scope</span>
  <span class="k">def</span> <span class="nf">resolve</span>
    <span class="n">scope</span><span class="o">.</span><span class="n">all</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Update predicates methods to implement the update/destroy restriction to owner.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">update?</span>
  <span class="n">record</span><span class="o">.</span><span class="n">user</span> <span class="o">==</span> <span class="n">user</span>
<span class="k">end</span>
</code></pre></div>
<h3>Update your Controller</h3>

<p>Use <code>policy_scope</code> and <code>authorize</code>.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="vi">@restaurants</span> <span class="o">=</span> <span class="n">policy_scope</span><span class="p">(</span><span class="no">Restaurant</span><span class="p">)</span> <span class="c1"># for index action</span>
<span class="n">authorize</span> <span class="vi">@restaurant</span>                   <span class="c1"># for other actions</span>
</code></pre></div>
<h3>Update your Views</h3>

<p>Use policies to hide actions not accessible for a given user.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">policy</span><span class="p">(</span><span class="no">Restaurant</span><span class="p">)</span><span class="o">.</span><span class="n">create?</span>  <span class="c1"># for Restaurant creation</span>
<span class="n">policy</span><span class="p">(</span><span class="vi">@restaurant</span><span class="p">)</span><span class="o">.</span><span class="n">update?</span> <span class="c1"># for updating/deleting a restaurant</span>
</code></pre></div>
<h3>Example code</h3>

<p>See <a href="https://github.com/lewagon/rails-pundit/compare/app-without-authorization...app-with-authorization?diff=split&amp;name=app-with-authorization">lewagon/rails-pundit</a></p>

<p>And read <a href="https://github.com/elabs/pundit">all the doc</a></p>

<hr>

<h2>Going further</h2>

<h3>Admin</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g migration AddAdminToUsers admin:boolean
<span class="nv">$ </span>rake db:migrate
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails c
pry&gt; <span class="nv">user</span> <span class="o">=</span> User.where<span class="o">(</span>email: <span class="s1">'seb@lewagon.org'</span><span class="o">)</span>.first
pry&gt; user.admin <span class="o">=</span> <span class="nb">true</span>
pry&gt; user.save
</code></pre></div>
<p>You can use this <code>admin</code> field in your policies!</p>

<h1>Projects - Week 1 - i18n</h1>

<h2>Internationalization</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s2">"nternationalizatio"</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">18</span>  <span class="c1"># i18n</span>
</code></pre></div>
<p>We'll <strong>abstract</strong> strings out of the code.</p>

<p>i18n is already in your app.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/locales/en.yml</span>

<span class="ss">en</span><span class="p">:</span>
  <span class="ss">hello</span><span class="p">:</span> <span class="s2">"Hello world"</span>
</code></pre></div>
<p>You can <strong>create</strong> a new file:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/locales/fr.yml</span>

<span class="ss">fr</span><span class="p">:</span>
  <span class="ss">hello</span><span class="p">:</span> <span class="s2">"Bonjour  tous"</span>
</code></pre></div>
<h3>Views</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">translate</span> <span class="c1"># Lookup text translations</span>
<span class="n">localize</span>  <span class="c1"># Localize Date and Time objects to local formats</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">&lt;%= t('hello') %&gt;


&lt;%= l(Time.now) %&gt;
</code></pre></div>
<hr>

<h2>You will have 2+ locales</h2>

<p>You want a way to switch locales, and display the content in the right one.</p>

<h3>Not in a cookie or session</h3>

<blockquote>
<p>You may be tempted to <strong>store</strong> the chosen locale in a <strong>session</strong> or a <strong>cookie</strong>, however <strong>do not</strong> do this. The <strong>locale should be transparent and a part of the URL</strong>. This way you won't break people's basic assumptions about the web itself: if you send a URL to a friend, they should see the same page and content as you. A fancy word for this would be that you're being RESTful. Read more about the RESTful approach in Stefan Tilkov's articles. Sometimes there are exceptions to this rule and those are discussed below.
<cite><a href="http://guides.rubyonrails.org/i18n.html#setting-and-passing-the-locale">Rubyonrails Guide</a></cite></p>
</blockquote>

<h3>In the URL</h3>

<p>Assuming you want <code>I18n.default_locale == :en</code></p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">http://www.awesomeapp.com/restaurants/2
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">http://www.awesomeapp.com/fr/restaurants/2
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">http://www.awesomeapp.com/es/restaurants/2
</code></pre></div>
<p><br><br></p>

<p>(You can also do it from the <a href="http://guides.rubyonrails.org/i18n.html#setting-the-locale-from-the-domain-name">domain name</a>, requires more configuration on your Domain and Heroku)</p>

<h3>Route &amp; Controller</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">scope</span> <span class="s1">'(:locale)'</span><span class="p">,</span> <span class="ss">locale</span><span class="p">:</span> <span class="sr">/fr|es/</span> <span class="k">do</span>
    <span class="n">resources</span> <span class="ss">:restaurants</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/application_controller.rb</span>
<span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">before_action</span> <span class="ss">:set_locale</span>

  <span class="k">def</span> <span class="nf">set_locale</span>
    <span class="no">I18n</span><span class="o">.</span><span class="n">locale</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:locale</span><span class="o">]</span> <span class="o">||</span> <span class="no">I18n</span><span class="o">.</span><span class="n">default_locale</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">default_url_options</span>
    <span class="p">{</span> <span class="ss">locale</span><span class="p">:</span> <span class="no">I18n</span><span class="o">.</span><span class="n">locale</span> <span class="o">==</span> <span class="no">I18n</span><span class="o">.</span><span class="n">default_locale</span> <span class="p">?</span> <span class="kp">nil</span> <span class="p">:</span> <span class="no">I18n</span><span class="o">.</span><span class="n">locale</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>Default locale</h2>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/application.rb</span>

<span class="c1"># [...]</span>
<span class="n">config</span><span class="o">.</span><span class="n">i18n</span><span class="o">.</span><span class="n">default_locale</span> <span class="o">=</span> <span class="ss">:en</span>
</code></pre></div>
<hr>

<h2>Adding translations</h2>

<h3>Lazy lookup</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">config</span><span class="o">/</span><span class="n">locales</span><span class="o">/</span><span class="n">en</span><span class="o">.</span><span class="n">yml</span>
<span class="ss">en</span><span class="p">:</span>
  <span class="ss">restaurants</span><span class="p">:</span>
    <span class="ss">index</span><span class="p">:</span>
      <span class="ss">title</span><span class="p">:</span> <span class="s2">"List of Restaurants"</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;%=</span> <span class="n">t</span><span class="p">(</span><span class="s1">'.title'</span><span class="p">)</span> <span class="o">%&gt;</span>
</code></pre></div>
<p>(note the <strong>dot</strong>)</p>

<h3>Interpolation</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/locales/en.yml</span>
<span class="ss">en</span><span class="p">:</span>
  <span class="ss">restaurants</span><span class="p">:</span>
    <span class="ss">show</span><span class="p">:</span>
      <span class="ss">reviews_for</span><span class="p">:</span> <span class="s1">'Reviews for %{name}'</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;%=</span> <span class="n">t</span><span class="p">(</span><span class="s1">'.reviews_for'</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">%&gt;</span>
</code></pre></div>
<h3>Pluralization</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/locales/en.yml</span>
<span class="ss">en</span><span class="p">:</span>
  <span class="ss">restaurants</span><span class="p">:</span>
    <span class="ss">show</span><span class="p">:</span>
      <span class="ss">reviews</span><span class="p">:</span>
        <span class="ss">zero</span><span class="p">:</span>  <span class="s1">'Be the first to review!'</span>
        <span class="ss">one</span><span class="p">:</span>   <span class="s1">'One review'</span>
        <span class="ss">other</span><span class="p">:</span> <span class="s1">'%{count} reviews'</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;%=</span> <span class="n">t</span><span class="p">(</span><span class="s1">'.reviews'</span><span class="p">,</span> <span class="ss">count</span><span class="p">:</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">reviews</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">%&gt;</span>
</code></pre></div>
<h3>Safe HTML</h3>

<p><strong>Do not</strong> abuse this</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/locales/en.yml</span>
<span class="ss">en</span><span class="p">:</span>
  <span class="ss">hello_html</span><span class="p">:</span> <span class="s1">'Hello &lt;strong&gt;there&lt;/strong&gt;!'</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;%=</span> <span class="n">t</span><span class="p">(</span><span class="s1">'hello_html'</span><span class="p">)</span> <span class="o">%&gt;</span>
</code></pre></div>
<h3>Time/Date formats</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;</span><span class="sx">%= l(@restaurant.created_at, format: :short) %&gt;</span>
<span class="sx">&lt;%=</span> <span class="n">l</span><span class="p">(</span><span class="vi">@restaurant</span><span class="o">.</span><span class="n">created_at</span><span class="o">.</span><span class="n">to_date</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="ss">:short</span><span class="p">)</span> <span class="o">%&gt;</span>
</code></pre></div>
<p>Default <a href="https://github.com/svenfuchs/rails-i18n/blob/master/rails/locale/en.yml#L41-L44">date</a> and <a href="https://github.com/svenfuchs/rails-i18n/blob/master/rails/locale/en.yml#L206-L209">time</a> formats</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s2">"rails-i18n"</span>
</code></pre></div>
<h3>Models</h3>

<p>Suppose you ran</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g scaffold restaurant name:string
</code></pre></div>
<p>Then you can i18n the <code>Restaurant</code> model name and attributes with</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/locales/fr.yml</span>
<span class="ss">fr</span><span class="p">:</span>
  <span class="ss">activerecord</span><span class="p">:</span>
    <span class="ss">models</span><span class="p">:</span>
      <span class="ss">restaurant</span><span class="p">:</span> <span class="s2">"Resto"</span>
    <span class="ss">attributes</span><span class="p">:</span>
      <span class="ss">restaurant</span><span class="p">:</span>
        <span class="nb">name</span><span class="p">:</span> <span class="s2">"Nom"</span>
</code></pre></div>
<hr>

<h2>Useful gems</h2>

<h3>For devise</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>

<span class="n">gem</span> <span class="s1">'devise-i18n'</span>
<span class="n">gem</span> <span class="s1">'devise-i18n-views'</span>
</code></pre></div>
<p>Then you need to import <strong>i18n-compatible</strong> views:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g devise:views:i18n_templates
</code></pre></div>
<p><br><br></p>

<p>Why? Compare <a href="https://github.com/plataformatec/devise/blob/master/app/views/devise/confirmations/new.html.erb">devise</a> with <a href="https://github.com/mcasimir/devise-i18n-views/blob/master/app/views/devise/confirmations/new.html.erb">devise-i18n-views</a></p>

<h3><code>i18n-tasks</code></h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>gem install i18n-tasks
</code></pre></div>
<p>(<strong>not</strong> for your <code>Gemfile</code>). <a href="https://github.com/glebm/i18n-tasks">README</a></p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>i18n-tasks health
<span class="nv">$ </span>i18n-tasks add-missing
<span class="nv">$ </span>i18n-tasks translate-missing  <span class="c"># Requires GOOGLE_TRANSLATE_API_KEY</span>
</code></pre></div>
<hr>

<h2>Documentation</h2>

<p>You can read the <a href="http://guides.rubyonrails.org/i18n.html">whole guide</a></p>

<h1>Projects - Week 1 - Admin Interfaces</h1>

<h2>The match</h2>

<p><strong>ActiveAdmin</strong> vs <strong>RailsAdmin</strong> on <a href="https://www.ruby-toolbox.com/categories/rails_admin_interfaces">Ruby Toolbox</a></p>

<h3>Why do we need them?</h3>

<p><code>rails console</code> is cool, what about a web interface?</p>

<hr>

<h1>ActiveAdmin</h1>

<p><img src="./Le Wagon - Lectures_files/active-admin-14cf15b0b90e6f0bccac3a2934223d5d.png" alt=""></p>

<h3>Example</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails new <span class="se">\</span>
  -T --database postgresql <span class="se">\</span>
  -m https://raw.githubusercontent.com/lewagon/rails-templates/master/devise.rb <span class="se">\</span>
  lafourchette_active_admin
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd </span>lafourchette_active_admin
<span class="nv">$ </span>rails g model restaurant name:string description user:references
<span class="nv">$ </span>rails g model review content:text restaurant:references user:references
<span class="nv">$ </span>rake db:migrate
</code></pre></div>
<p>Then add <code>has_many</code> and validations.</p>

<h3>Allow a user to be an admin</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g migration AddAdminToUsers
</code></pre></div>
<p>Open the newly created <code>***_add_admin_to_users.rb</code> migration file:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">change</span>
  <span class="n">add_column</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:admin</span><span class="p">,</span> <span class="ss">:boolean</span><span class="p">,</span> <span class="ss">null</span><span class="p">:</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">default</span><span class="p">:</span> <span class="kp">false</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rake db:migrate
</code></pre></div>
<p>Let's <strong>commit</strong> (on <code>master</code>, only for this lecture) for a checkpoint here.</p>

<h3>Setup</h3>

<p>Let's branch from here (later we'll install RailsAdmin from here as well).</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="err">$</span> <span class="n">git</span> <span class="n">checkout</span> <span class="o">-</span><span class="n">b</span> <span class="n">active</span><span class="o">-</span><span class="n">admin</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>

<span class="n">gem</span> <span class="s1">'activeadmin'</span><span class="p">,</span> <span class="ss">github</span><span class="p">:</span> <span class="s1">'activeadmin'</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bundle install
</code></pre></div>
<h3>Generator</h3>

<p>Assuming you <strong>already</strong> have a devise <code>User</code> model.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails generate active_admin:install --skip-users
<span class="c">#     create  config/initializers/active_admin.rb</span>
<span class="c">#      create  app/admin</span>
<span class="c">#      create  app/admin/dashboard.rb</span>
<span class="c">#       route  ActiveAdmin.routes(self)</span>
<span class="c">#    generate  active_admin:assets</span>
<span class="c">#      create  app/assets/javascripts/active_admin.js.coffee</span>
<span class="c">#      create  app/assets/stylesheets/active_admin.css.scss</span>
<span class="c">#      create  db/migrate/20141119203507_create_active_admin_comments.rb</span>
</code></pre></div>
<p>Then run:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rake db:migrate
</code></pre></div>
<h3>Authentication configuration</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/initializers/active_admin.rb</span>

<span class="c1"># Add this line at the beginning, before `ActiveAdmin.setup do |config|`</span>
<span class="k">def</span> <span class="nf">authenticate_admin!</span>
  <span class="n">redirect_to</span> <span class="n">new_user_session_path</span> <span class="k">unless</span> <span class="n">current_user</span> <span class="o">&amp;&amp;</span> <span class="n">current_user</span><span class="o">.</span><span class="n">admin</span>
<span class="k">end</span>

<span class="c1"># Edit those four lines, to reuse existing `User` model.</span>
<span class="no">ActiveAdmin</span><span class="o">.</span><span class="n">setup</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="c1"># [...]</span>
  <span class="n">config</span><span class="o">.</span><span class="n">authentication_method</span> <span class="o">=</span> <span class="ss">:authenticate_admin!</span>
  <span class="c1"># [...]</span>
  <span class="n">config</span><span class="o">.</span><span class="n">current_user_method</span> <span class="o">=</span> <span class="ss">:current_user</span>
  <span class="c1"># [...]</span>
  <span class="n">config</span><span class="o">.</span><span class="n">logout_link_path</span> <span class="o">=</span> <span class="ss">:destroy_user_session_path</span>
  <span class="c1"># [...]</span>
  <span class="n">config</span><span class="o">.</span><span class="n">logout_link_method</span> <span class="o">=</span> <span class="ss">:delete</span>
<span class="k">end</span>
</code></pre></div>
<h3>Beware</h3>

<p>In your <code>application.js</code>, <code>require_tree</code> will also ActiveAdmin JS for your entire website.</p>

<p>Switch to using specifics <code>require</code> for each file.</p>

<h3>Grant existing user admin access</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails c  <span class="c"># Start a rails console, then type:</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by_email</span><span class="p">(</span><span class="s1">'seb@lewagon.org'</span><span class="p">)</span>
<span class="n">user</span><span class="o">.</span><span class="n">admin</span> <span class="o">=</span> <span class="kp">true</span>
<span class="n">user</span><span class="o">.</span><span class="n">save</span>
</code></pre></div>
<p>(You can do that in production with <code>heroku run rails c</code>)</p>

<p>Aren't you happy that <strong>strong params</strong> exist?</p>

<h3>Access our brand new back-end</h3>

<p>Go to <a href="http://localhost:3000/"><code>localhost:3000/admin</code></a> and enjoy.</p>

<hr>

<h2>Registering models</h2>

<p>You need to tell ActiveAdmin which models it will handle.</p>

<h3>Folder</h3>

<p><code>app/admin/</code></p>

<h3>Register a new model</h3>

<p>Say you have a <code>Product</code> model, then run</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails generate active_admin:resource product
<span class="c">#     create  app/admin/product.rb</span>
</code></pre></div>
<p>And configure <a href="https://github.com/activeadmin/activeadmin/blob/master/docs/2-resource-customization.md#setting-up-strong-parameters">strong params for ActiveAdmin</a>:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/admin/product.rb</span>
<span class="no">ActiveAdmin</span><span class="o">.</span><span class="n">register</span> <span class="no">Product</span> <span class="k">do</span>
  <span class="n">permit_params</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:price</span> <span class="c1"># etc...</span>
<span class="k">end</span>
</code></pre></div>
<p><br></p>

<p>This adds the resource to your back-end:</p>

<p><img src="./Le Wagon - Lectures_files/active-admin-tab-da4eb1ddd5ce908e0361b7ab6017d1fc.png" alt=""></p>

<h3>Register the <code>User</code> model!</h3>

<p>Of course :)</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails generate active_admin:resource user
</code></pre></div>
<hr>

<h2>DRY</h2>

<p>ActiveAdmin understands <code>has_many</code> relations.</p>

<p>ActiveAdmin reuses your validations.</p>

<hr>

<h2>Advanced</h2>

<p>Customization</p>

<p>User index view has too many columns!</p>

<h3>Customize the index view</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/admin/user.rb</span>
<span class="no">ActiveAdmin</span><span class="o">.</span><span class="n">register</span> <span class="no">User</span> <span class="k">do</span>
  <span class="n">index</span> <span class="k">do</span>
    <span class="n">selectable_column</span>
    <span class="n">column</span> <span class="ss">:id</span>
    <span class="n">column</span> <span class="ss">:email</span>
    <span class="n">column</span> <span class="ss">:name</span>
    <span class="n">column</span> <span class="ss">:created_at</span>
    <span class="n">column</span> <span class="ss">:admin</span>
    <span class="n">actions</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>User creation/edition form has too many fields!</p>

<h3>Customize the form</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/admin/user.rb</span>
<span class="no">ActiveAdmin</span><span class="o">.</span><span class="n">register</span> <span class="no">User</span> <span class="k">do</span>
  <span class="n">form</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
    <span class="n">f</span><span class="o">.</span><span class="n">inputs</span> <span class="s2">"Identity"</span> <span class="k">do</span>
      <span class="n">f</span><span class="o">.</span><span class="n">input</span> <span class="ss">:name</span>
      <span class="n">f</span><span class="o">.</span><span class="n">input</span> <span class="ss">:email</span>
    <span class="k">end</span>
    <span class="n">f</span><span class="o">.</span><span class="n">inputs</span> <span class="s2">"Admin"</span> <span class="k">do</span>
      <span class="n">f</span><span class="o">.</span><span class="n">input</span> <span class="ss">:admin</span>
    <span class="k">end</span>
    <span class="n">f</span><span class="o">.</span><span class="n">actions</span>
  <span class="k">end</span>

  <span class="n">permit_params</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:admin</span>
<span class="k">end</span>
</code></pre></div>
<p>More goodies in the <a href="http://activeadmin.info/docs/5-forms.html">documentation</a></p>

<hr>

<h1>Rails Admin</h1>

<p><img src="./Le Wagon - Lectures_files/rails_admin-68f8ce04df2af327d01f7efbd283a1a1.png" alt=""></p>

<h3>Setup</h3>

<p>For the lecture, let's go back on <code>master</code> and create <code>rails-admin</code> branch.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># Gemfile

gem "rails_admin"
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bundle install
</code></pre></div>
<h3>Generator</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g rails_admin:install
</code></pre></div>
<h2>Configuration</h2>

<p><strong>BEWARE</strong>: Rails admin is accessible to <strong>every logged in user</strong>... Put this:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># in config/initializer/rails_admin.rb

RailsAdmin.config do |config|
  config.authorize_with do |controller|
    redirect_to main_app.root_path unless current_user &amp;&amp; current_user.admin
  end

  # [...]
end
</code></pre></div>
<p>(Relaunch your <code>rails s</code>)</p>

<hr>

<h2>Your turn!</h2>

<ul>
<li><a href="http://activeadmin.info/docs/documentation.html">activeadmin.info/docs/documentation.html</a></li>
<li><a href="https://github.com/sferik/rails_admin">github.com/sferik/rails_admin</a></li>
</ul>

<h1>Projects - Week 1 - Background Jobs</h1>

<h2>What for?</h2>

<p>Push outside of the controller <strong>time-consuming processes</strong>.</p>

<h3>Examples</h3>

<ul>
<li>Delivering emails</li>
<li>Posting to an API (Slack)</li>
<li>Cleaning up</li>
<li>etc.</li>
</ul>

<!-- title Without Background Process

Browser->+Web Process: HTTP Request
Web Process->+SMTP: Send email
SMTP->-Web Process: OK
Web Process->-Browser: HTML answer -->

<p><img src="./Le Wagon - Lectures_files/without_background_process-8bc4a0c1e288813d2f8b0afea2be61f7.png" alt=""></p>

<!-- title With Background Process

Browser->+Web Process: HTTP Request
Web Process->Background Process: Enqueue job
Web Process->-Browser: HTML Answer
Background Process->+SMTP: Send email
SMTP->-Background Process: OK -->

<p><img src="./Le Wagon - Lectures_files/with_background_process-88b701ef5b0b90c6d29849602bdbc261.png" alt=""></p>

<p><img src="./Le Wagon - Lectures_files/background_process_schema-efbe2c8b7ea6390a85608f06bd034db2.png" alt=""></p>

<hr>

<h2>Active Job</h2>

<p><a href="http://edgeguides.rubyonrails.org/active_job_basics.html">Rails Guide</a></p>

<h3>Starting from scratch</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails new <span class="se">\</span>
    -T --database postgresql <span class="se">\</span>
    -m https://raw.githubusercontent.com/lewagon/rails-templates/master/devise.rb <span class="se">\</span>
    jobs_example
</code></pre></div>
<p>(We need users to protect the Sidekiq dashboard)</p>

<h3>Our first job</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails generate job fake
<span class="c"># create  app/jobs/fake_job.rb</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">FakeJob</span> <span class="o">&lt;</span> <span class="no">ActiveJob</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">queue_as</span> <span class="ss">:default</span>

  <span class="k">def</span> <span class="nf">perform</span>
    <span class="nb">puts</span> <span class="s2">"I'm starting the fake job"</span>
    <span class="nb">sleep</span> <span class="mi">3</span>
    <span class="nb">puts</span> <span class="s2">"OK I'm done now"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<hr>

<h2>Back-end : Sidekiq</h2>

<p><a href="http://sidekiq.org/">sidekiq.org</a></p>

<p>Alternatives: <a href="http://api.rubyonrails.org/classes/ActiveJob/QueueAdapters.html">ActiveJob / QueueAdapters</a></p>

<h3>Dependency over Redis</h3>

<p><a href="http://redis.io/"><strong>Redis</strong></a> is a <strong>key-value store</strong>. Think of it as a PostgreSQL database storing <strong>hashes</strong> in memory.
Sidekiq needs it.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># On OSX</span>
<span class="nv">$ </span>brew update
<span class="nv">$ </span>brew install redis
<span class="c"># Launch redis at boot</span>
<span class="nv">$ </span>sudo ln -sfv /usr/local/opt/redis/*.plist ~/Library/LaunchAgents
<span class="c"># Launch redis now</span>
<span class="nv">$ </span>sudo launchctl load ~/Library/LaunchAgents/homebrew.mxcl.redis.plist
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Ubuntu</span>
<span class="nv">$ </span>sudo apt-get install redis-server
</code></pre></div>
<h3>Gemfile</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">gem</span> <span class="s1">'sidekiq'</span>
<span class="n">gem</span> <span class="s1">'sinatra'</span>  <span class="c1"># Dependency of sidekiq</span>
<span class="n">gem</span> <span class="s1">'sidekiq-failures'</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bundle install
<span class="nv">$ </span>bundle binstub sidekiq
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/application.rb</span>
<span class="k">class</span> <span class="nc">Application</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Application</span>
  <span class="c1"># [...]</span>
  <span class="n">config</span><span class="o">.</span><span class="n">active_job</span><span class="o">.</span><span class="n">queue_adapter</span> <span class="o">=</span> <span class="ss">:sidekiq</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="c1"># [...]</span>
  <span class="nb">require</span> <span class="s2">"sidekiq/web"</span>
  <span class="n">authenticate</span> <span class="ss">:user</span><span class="p">,</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|</span><span class="n">u</span><span class="o">|</span> <span class="n">u</span><span class="o">.</span><span class="n">admin</span> <span class="p">}</span> <span class="k">do</span>
    <span class="n">mount</span> <span class="no">Sidekiq</span><span class="o">::</span><span class="no">Web</span> <span class="o">=&gt;</span> <span class="s1">'/sidekiq'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/sidekiq.yml</span>
<span class="ss">:concurrency</span><span class="p">:</span> <span class="mi">3</span>
<span class="ss">:timeout</span><span class="p">:</span> <span class="mi">60</span>
<span class="ss">:verbose</span><span class="p">:</span> <span class="kp">true</span>
<span class="ss">:queues</span><span class="p">:</span>  <span class="c1"># Queue priority: https://github.com/mperham/sidekiq/wiki/Advanced-Options</span>
  <span class="o">-</span> <span class="n">default</span>
  <span class="o">-</span> <span class="n">mailers</span>
</code></pre></div>
<hr>

<h2>Using ActiveJob</h2>

<h3>Let's start Sidekiq</h3>

<p>Open a new terminal tab and run:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>sidekiq
</code></pre></div>
<h3>Enqueue our first job</h3>

<p>Open a rails console with <code>rails c</code> and run:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="no">FakeJob</span><span class="o">.</span><span class="n">perform_later</span>
</code></pre></div>
<h3>Arguments</h3>

<p>You can pass arguments to the <code>perform_later</code> method.</p>

<p><strong>BEWARE</strong>: Arguments will be serialized to json, so pass id, string, not full objects.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">UpdateUserJob</span> <span class="o">&lt;</span> <span class="no">ActiveJob</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">queue_as</span> <span class="ss">:default</span>

  <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
    <span class="c1"># TODO: perform a time consuming task like Clearbit's Enrinchment API.</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Controller / Models</h3>

<p>You can enqueue jobs from the controller or model activerecord callbacks (<code>after_create</code>, ...)</p>

<h3>Mailers</h3>

<p>No need to write any job</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># UserMailer.welcome(user).deliver_now</span>

<span class="no">UserMailer</span><span class="o">.</span><span class="n">welcome</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">deliver_later</span>
</code></pre></div>
<p>(Enqueued to the <code>mailers</code> queue)</p>

<p><strong>BEWARE</strong>: Again, arguments will be serialized to json, so pass id, string, not full objects.</p>

<h3>Delay</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">FakeJob</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="ss">wait</span><span class="p">:</span> <span class="mi">1</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span><span class="o">.</span><span class="n">perform_later</span>

<span class="no">FakeJob</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="ss">wait_until</span><span class="p">:</span> <span class="no">Day</span><span class="o">.</span><span class="n">tomorrow</span><span class="o">.</span><span class="n">noon</span><span class="p">)</span><span class="o">.</span><span class="n">perform_later</span>
</code></pre></div>
<p>By default, Sidekiq checks for scheduled job every <strong>15 seconds</strong> (<a href="https://github.com/mperham/sidekiq/wiki/Scheduled-Jobs#checking-for-new-jobs">see doc</a>).</p>

<hr>

<h2>Heroku</h2>

<p>We'll use <a href="https://elements.heroku.com/addons/rediscloud">Redis Cloud</a></p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>heroku addons:create rediscloud
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/initializers/redis.rb</span>
<span class="vg">$redis</span> <span class="o">=</span> <span class="no">Redis</span><span class="o">.</span><span class="n">new</span>

<span class="n">url</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">"REDISCLOUD_URL"</span><span class="o">]</span>

<span class="k">if</span> <span class="n">url</span>
  <span class="no">Sidekiq</span><span class="o">.</span><span class="n">configure_server</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
    <span class="n">config</span><span class="o">.</span><span class="n">redis</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">url</span><span class="p">:</span> <span class="n">url</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="no">Sidekiq</span><span class="o">.</span><span class="n">configure_client</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
    <span class="n">config</span><span class="o">.</span><span class="n">redis</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">url</span><span class="p">:</span> <span class="n">url</span> <span class="p">}</span>
  <span class="k">end</span>
  <span class="vg">$redis</span> <span class="o">=</span> <span class="no">Redis</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:url</span> <span class="o">=&gt;</span> <span class="n">url</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>Add a second line to your <code>Procfile</code></p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Procfile</span>
web: bundle <span class="nb">exec </span>puma -C config/puma.rb
worker: bundle <span class="nb">exec </span>sidekiq -C config/sidekiq.yml
</code></pre></div>
<h3>Heroku Cron jobs</h3>

<p>Use the <a href="https://devcenter.heroku.com/articles/scheduler">Heroku Scheduler</a></p>

<p><img src="./Le Wagon - Lectures_files/467-original.jpg" alt=""></p>

<hr>

<h2>Happy Asynchronizing!</h2>

<h1>Projects - Week 1 - Build an API</h1>

<h2>Intro</h2>

<h3>No big deal</h3>

<p>It's just a new set of <strong>Controllers</strong>...</p>

<p>...which return <strong>JSON</strong> instead of HTML (the <code>.html.erb</code> views).</p>

<hr>

<h2>Starting from Scratch</h2>

<p>With <strong>users</strong></p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails new <span class="se">\</span>
  -T --database postgresql <span class="se">\</span>
  -m https://raw.githubusercontent.com/lewagon/rails-templates/master/devise.rb <span class="se">\</span>
  lafourchette_api
<span class="nv">$ </span><span class="nb">cd </span>lafourchette_api
</code></pre></div>
<p>Add <strong>Pundit</strong>, then</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g model restaurant name address
<span class="nv">$ </span>rails g model comment content:text restaurant:references
</code></pre></div>
<h3>API Setup</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>mkdir -p app/controllers/api/v1
<span class="nv">$ </span>touch app/controllers/api/v1/base_controller.rb
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s2">"jbuilder"</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bundle install
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text"># app/controllers/api/v1/base_controller.rb
class Api::V1::BaseController &lt; ActionController::Base
  before_action :authenticate_user!
  include Pundit

  after_action :verify_authorized, except: :index
  after_action :verify_policy_scoped, only: :index

  rescue_from Pundit::NotAuthorizedError, with: :user_not_authorized

  def user_not_authorized(exception)
    policy_name = exception.policy.class.to_s.underscore
    render json: { type: 'error', message: "Unauthorized #{policy_name.camelize}.#{exception.query}" },
status: :unauthorized
  end
end
</code></pre></div>
<hr>

<h3>First endpoint</h3>

<p>Let's build the endpoint <code>GET /api/v1/restaurants</code>, with no authentication required.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="c1"># [...]</span>
  <span class="n">namespace</span> <span class="ss">:api</span><span class="p">,</span> <span class="ss">defaults</span><span class="p">:</span> <span class="p">{</span> <span class="nb">format</span><span class="p">:</span> <span class="ss">:json</span> <span class="p">}</span> <span class="k">do</span>
    <span class="n">namespace</span> <span class="ss">:v1</span> <span class="k">do</span>
      <span class="n">resources</span> <span class="ss">:restaurants</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span> <span class="ss">:index</span> <span class="o">]</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>First endpoint (Controller)</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/api/v1/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">Api</span><span class="o">::</span><span class="no">V1</span><span class="o">::</span><span class="no">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">Api</span><span class="o">::</span><span class="no">V1</span><span class="o">::</span><span class="no">BaseController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@restaurants</span> <span class="o">=</span> <span class="n">policy_scope</span><span class="p">(</span><span class="no">Restaurant</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>First endpoint (View)</h3>

<p>The view now renders <strong>json</strong> and is built using the <strong>jbuilder</strong> gem.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/views/api/v1/restaurants/index.json.jbuilder</span>
<span class="n">json</span><span class="o">.</span><span class="n">restaurants</span> <span class="k">do</span>
  <span class="n">json</span><span class="o">.</span><span class="n">array!</span> <span class="vi">@restaurants</span> <span class="k">do</span> <span class="o">|</span><span class="n">restaurant</span><span class="o">|</span>
    <span class="n">json</span><span class="o">.</span><span class="n">id</span> <span class="n">restaurant</span><span class="o">.</span><span class="n">id</span>
    <span class="n">json</span><span class="o">.</span><span class="n">name</span> <span class="n">restaurant</span><span class="o">.</span><span class="n">name</span>
    <span class="n">json</span><span class="o">.</span><span class="n">address</span> <span class="n">restaurant</span><span class="o">.</span><span class="n">address</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<hr>

<h2>Second endpoint</h2>

<p>Let's build the endpoint for <code>GET /api/v1/restaurants/:id</code>, still public.
On this new endpoint, we'll add the restaurant comments.</p>

<ul>
<li>We must add a route</li>
<li>We must add a <code>show</code> method to the <code>Api::V1::RestaurantsController</code></li>
<li>We must add a view for this <code>show</code> method.</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="c1"># [...]</span>
  <span class="n">namespace</span> <span class="ss">:api</span><span class="p">,</span> <span class="ss">defaults</span><span class="p">:</span> <span class="p">{</span> <span class="nb">format</span><span class="p">:</span> <span class="ss">:json</span> <span class="p">}</span> <span class="k">do</span>
    <span class="n">namespace</span> <span class="ss">:v1</span> <span class="k">do</span>
      <span class="n">resources</span> <span class="ss">:restaurants</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:show</span> <span class="o">]</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/api/v1/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">Api</span><span class="o">::</span><span class="no">V1</span><span class="o">::</span><span class="no">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">Api</span><span class="o">::</span><span class="no">V1</span><span class="o">::</span><span class="no">BaseController</span>
  <span class="c1"># [...]</span>
  <span class="n">before_action</span> <span class="ss">:set_restaurant</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span> <span class="ss">:show</span> <span class="o">]</span>
  <span class="c1"># [...]</span>

  <span class="k">def</span> <span class="nf">show</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">set_restaurant</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
    <span class="n">authorize</span> <span class="vi">@restaurant</span>  <span class="c1"># For Pundit</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/views/api/v1/restaurants/show.json.jbuilder</span>
<span class="n">json</span><span class="o">.</span><span class="n">restaurant</span> <span class="k">do</span>
  <span class="n">json</span><span class="o">.</span><span class="n">id</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">id</span>
  <span class="n">json</span><span class="o">.</span><span class="n">name</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">name</span>
  <span class="n">json</span><span class="o">.</span><span class="n">address</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">address</span>
  <span class="n">json</span><span class="o">.</span><span class="n">comments</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">comments</span> <span class="k">do</span> <span class="o">|</span><span class="n">comment</span><span class="o">|</span>
    <span class="n">json</span><span class="o">.</span><span class="n">id</span> <span class="n">comment</span><span class="o">.</span><span class="n">id</span>
    <span class="n">json</span><span class="o">.</span><span class="n">content</span> <span class="n">comment</span><span class="o">.</span><span class="n">content</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<hr>

<h2>Authentication</h2>

<p>Let's add a new endpoint: <code>PATCH /api/v1/restaurants/:id</code> to <strong>update</strong> a restaurant.
We need authentication &amp; authorization for it.</p>

<h3>Restaurant Policy</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/policies/restaurant_policy.rb</span>
<span class="k">class</span> <span class="nc">RestaurantPolicy</span> <span class="o">&lt;</span> <span class="no">ApplicationPolicy</span>
  <span class="k">class</span> <span class="nc">Scope</span> <span class="o">&lt;</span> <span class="no">Scope</span>
    <span class="k">def</span> <span class="nf">resolve</span>
      <span class="n">scope</span><span class="o">.</span><span class="n">all</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show?</span>
    <span class="kp">true</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update?</span>
    <span class="n">record</span><span class="o">.</span><span class="n">user</span> <span class="o">==</span> <span class="n">user</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>The API should make a call <strong>on behalf</strong> of a given user.</p>

<p>In the browser, there is a <strong>session</strong> stored in a <strong>cookie</strong>.</p>

<p>For an API, we'll use a <strong>token</strong>.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s2">"simple_token_authentication"</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bundle install
<span class="nv">$ </span>rails g migration AddTokenToUsers authentication_token:string:index
<span class="nv">$ </span>rake db:migrate
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/user.rb</span>

<span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">acts_as_token_authenticatable</span>
  <span class="c1"># [...]</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="c1"># [...]</span>
  <span class="n">namespace</span> <span class="ss">:api</span><span class="p">,</span> <span class="ss">defaults</span><span class="p">:</span> <span class="p">{</span> <span class="nb">format</span><span class="p">:</span> <span class="ss">:json</span> <span class="p">}</span> <span class="k">do</span>
    <span class="n">namespace</span> <span class="ss">:v1</span> <span class="k">do</span>
      <span class="n">resources</span> <span class="ss">:restaurants</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:show</span><span class="p">,</span> <span class="ss">:update</span> <span class="o">]</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">Api</span><span class="o">::</span><span class="no">V1</span><span class="o">::</span><span class="no">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">Api</span><span class="o">::</span><span class="no">V1</span><span class="o">::</span><span class="no">BaseController</span>
  <span class="n">acts_as_token_authentication_handler_for</span> <span class="no">User</span><span class="p">,</span> <span class="ss">except</span><span class="p">:</span> <span class="o">[</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:show</span> <span class="o">]</span>
  <span class="c1"># [...]</span>
  <span class="n">before_action</span> <span class="ss">:set_restaurant</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span> <span class="ss">:show</span><span class="p">,</span> <span class="ss">:update</span> <span class="o">]</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="k">if</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">restaurant_params</span><span class="p">)</span>
      <span class="n">render</span> <span class="ss">:show</span>
    <span class="k">else</span>
      <span class="n">render_error</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>
  <span class="c1"># [...]</span>

  <span class="k">def</span> <span class="nf">restaurant_params</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:restaurant</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:address</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">render_error</span>
    <span class="n">render</span> <span class="ss">json</span><span class="p">:</span> <span class="p">{</span> <span class="ss">errors</span><span class="p">:</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">full_messages</span> <span class="p">},</span> <span class="ss">status</span><span class="p">:</span> <span class="ss">:unprocessable_entity</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Usage</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># $ rails c</span>
<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by_email</span><span class="p">(</span><span class="s2">"seb@lewagon.org"</span><span class="p">)</span>
<span class="n">user</span><span class="o">.</span><span class="n">save</span>  <span class="c1"># The user did not have any token yet. This call generated one.</span>
<span class="n">user</span><span class="o">.</span><span class="n">reload</span><span class="o">.</span><span class="n">authentication_token</span>
<span class="c1"># =&gt; "a6hYpzsfNJdYC6zEMxs3"</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>curl -i -X PATCH                                      <span class="se">\</span>
       -H <span class="s1">'Content-Type: application/json'</span>              <span class="se">\</span>
       -H <span class="s1">'X-User-Email: seb@lewagon.org'</span>               <span class="se">\</span>
       -H <span class="s1">'X-User-Token: a6hYpzsfNJdYC6zEMxs3'</span>          <span class="se">\</span>
       -d <span class="s1">'{ "restaurant": { "name": "New name" } }'</span>    <span class="se">\</span>
       http://localhost:3000/api/v1/restaurants/1
</code></pre></div>
<p>You can also use a browser "Rest Client" (Like Postman) or <a href="http://stackoverflow.com/a/12161762/197944">ruby code</a>.</p>

<h3>Create endpoint</h3>

<p>Let's add the <code>POST /api/v1/restaurants</code> endpoint to <strong>create</strong> a new restaurant.
We need to be logged in to create one.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="c1"># [...]</span>
  <span class="n">namespace</span> <span class="ss">:api</span><span class="p">,</span> <span class="ss">defaults</span><span class="p">:</span> <span class="p">{</span> <span class="nb">format</span><span class="p">:</span> <span class="ss">:json</span> <span class="p">}</span> <span class="k">do</span>
    <span class="n">namespace</span> <span class="ss">:v1</span> <span class="k">do</span>
      <span class="n">resources</span> <span class="ss">:restaurants</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:show</span><span class="p">,</span> <span class="ss">:update</span><span class="p">,</span> <span class="ss">:create</span> <span class="o">]</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/api/v1/restaurants_controller.rb</span>
<span class="k">class</span> <span class="nc">Api</span><span class="o">::</span><span class="no">V1</span><span class="o">::</span><span class="no">RestaurantsController</span> <span class="o">&lt;</span> <span class="no">Api</span><span class="o">::</span><span class="no">V1</span><span class="o">::</span><span class="no">BaseController</span>
  <span class="c1"># [...]</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@restaurant</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">restaurants</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">restaurant_params</span><span class="p">)</span>
    <span class="n">authorize</span> <span class="vi">@restaurant</span>
    <span class="k">if</span> <span class="vi">@restaurant</span><span class="o">.</span><span class="n">save</span>
      <span class="n">render</span> <span class="ss">:show</span>
    <span class="k">else</span>
      <span class="n">render_error</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c1"># [...]</span>
<span class="k">end</span>
</code></pre></div>
<h3>Usage</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>curl -i -X POST                                                              <span class="se">\</span>
       -H <span class="s1">'Content-Type: application/json'</span>                                     <span class="se">\</span>
       -H <span class="s1">'X-User-Email: seb@lewagon.org'</span>                                      <span class="se">\</span>
       -H <span class="s1">'X-User-Token: a6hYpzsfNJdYC6zEMxs3'</span>                                 <span class="se">\</span>
       -d <span class="s1">'{ "restaurant": { "name": "New restaurant", "address": "Paris" } }'</span> <span class="se">\</span>
       http://localhost:3000/api/v1/restaurants
</code></pre></div>
<hr>

<h2>Your turn!</h2>

<h1>Projects - Week 2 - Stripe</h1>

<h2>New app</h2>

<p>We'll build a Teddies shop!</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ rails new \
  -T --database postgresql \
  -m https://raw.githubusercontent.com/lewagon/rails-templates/master/minimal.rb \
  teddies_shop
$ cd teddies_shop
</code></pre></div>
<p>Add the <code>coffee-script</code> gem to your Gemfile &amp; <code>bundle install</code>.</p>

<hr>

<h2>Models</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ rails g model Category name:string
$ rails g model Teddy sku:string name:string category:references
</code></pre></div>
<p>And run migrations</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ rake db:migrate
</code></pre></div>
<h2>Seeds</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text"># db/seeds.rb
Category.destroy_all
Teddy.destroy_all

geek = Category.create!(name: 'geek')
kids = Category.create!(name: 'kids')

Teddy.create!(sku: 'original-teddy-bear', name: 'Teddy bear', category: kids, photo_url: 'http://onehdwallpaper.com/wp-content/uploads/2015/07/Teddy-Bears-HD-Images.jpg')

Teddy.create!(sku: 'jean-mimi', name: 'Jean-Michel - Le Wagon', category: geek, photo_url: 'https://pbs.twimg.com/media/B_AUcKeU4AE6ZcG.jpg:large')
Teddy.create!(sku: 'octocat',   name: 'Octocat -  GitHub',      category: geek, photo_url: 'https://cdn.shopify.com/s/files/1/0051/4802/products/mona-2_1024x1024.jpg?v=1447180277')
</code></pre></div>
<p>And run them</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ rake db:seed
</code></pre></div>
<hr>

<h2>Listing our Teddies</h2>

<h2>Routes &amp; Controller</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ rails g controller teddies index show
</code></pre></div>
<p>Edit routes</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># config/routes.rb
root 'teddies#index'
resources :teddies, only: [:index, :show]
</code></pre></div>
<h2>Edit controller</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">def index
  @teddies = Teddy.all
end

def show
  @teddy = Teddy.find(params[:id])
end
</code></pre></div>
<h2>And its views</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text"># app/views/teddies/index.html.erb
&lt;div class="row"&gt;
  &lt;div class="col-sm-12"&gt;
    &lt;h1&gt;Teddies&lt;/h1&gt;
    &lt;% @teddies.each do |teddy| %&gt;
      &lt;div class="col-sm-6 col-md-4"&gt;
        &lt;div class="thumbnail"&gt;
          &lt;%= link_to image_tag(teddy.photo_url), teddy_path(teddy) %&gt;
          &lt;div class="caption"&gt;
            &lt;h3&gt;&lt;%= link_to teddy.name, teddy_path(teddy) %&gt;&lt;/h3&gt;
            &lt;p&gt;&lt;%= teddy.category.name %&gt;&lt;/p&gt;
            &lt;p&gt;$$$&lt;/p&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;% end %&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text"># app/views/teddies/show.html.erb
&lt;div class="row"&gt;
  &lt;div class="col-sm-12"&gt;
    &lt;h1&gt;Teddy&lt;/h1&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;div class="row"&gt;
  &lt;div class="col-sm-12 col-md-6"&gt;
    &lt;%= image_tag(@teddy.photo_url, width: '100%') %&gt;
  &lt;/div&gt;
  &lt;div class="col-sm-12 col-md-6"&gt;
    &lt;h2&gt;&lt;%= @teddy.name %&gt;&lt;/h2&gt;
    &lt;p&gt;Some awesome description of our amazing teddy.&lt;/p&gt;
    &lt;p&gt;$$$&lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre></div>
<hr>

<h2>Prices</h2>

<p><a href="https://github.com/RubyMoney/money-rails">Money-rails</a></p>

<h2>Add money rails gem</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text"># Gemfile
gem 'money-rails'
</code></pre></div>
<p>Set default currency</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># config/initializers/money.rb
MoneyRails.configure do |config|
  config.default_currency = :eur
end
</code></pre></div>
<h2>Add price to teddies</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ rails g migration add_price_to_teddies
</code></pre></div>
<p>Edit migration</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">add_monetize :teddies, :price, currency: { present: false }
</code></pre></div>
<p>And run it</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ rake db:migrate
</code></pre></div>
<h2>Enable monetize</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text"># app/models/teddy.rb
monetize :price_cents
</code></pre></div>
<h2>Seeds</h2>

<p>Don't forget to set price in your seeds!</p>

<h2>Displayng price</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text"># app/views/teddies/index.html.erb
&lt;p&gt;Amount: &lt;%= humanized_money_with_symbol(teddy.price) %&gt;&lt;/p&gt;
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text"># app/views/teddies/show.html.erb
&lt;p&gt;Amount: &lt;%= humanized_money_with_symbol(@teddy.price) %&gt;&lt;/p&gt;
</code></pre></div>
<hr>

<h2>Stripe</h2>

<p>http://stripe.com/</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># Gemfile
gem 'stripe'
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">$ bundle install
</code></pre></div>
<p>Add stripe initializer
```</p>

<h1>config/initializers/stripe.rb</h1>

<p>Rails.configuration.stripe = {
  publishable<em>key: ENV['STRIPE</em>PUBLISHABLE<em>KEY'],
  secret</em>key:      ENV['STRIPE<em>SECRET</em>KEY']
}</p>

<p>Stripe.api<em>key = Rails.configuration.stripe[:secret</em>key]
```</p>

<p>Add your keys
```</p>

<h1>config/application.yml</h1>

<p>STRIPE<em>PUBLISHABLE</em>KEY: pk<em>**H
STRIPE</em>SECRET<em>KEY: sk</em>**f
```</p>

<hr>

<h2>Making an Order</h2>

<h2>Model</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ rails g model Order state:string teddy_sku:string amount:monetize payment:json
</code></pre></div>
<p>Edit migration to remove currency
<code>
t.monetize :amount, currency: { present: false }
</code></p>

<p>Don't forget to run the migration
<code>
$ rake db:migrate
</code></p>

<p>Enable monetize</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># app/models/order.rb
monetize :amount_cents
</code></pre></div>
<h2>Routes &amp; Controller</h2>

<p>Add orders controller
<code>
$ rails g controller orders show
</code></p>

<p>Edit routes</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># config/routes.rb
resources :orders, only: [:show, :create]
</code></pre></div>
<h2>Edit Teddy page</h2>

<p>Add a form to create an Order</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># app/views/teddies/show.html.erb
&lt;%= form_tag orders_path do %&gt;
  &lt;%= hidden_field_tag 'teddy_id', @teddy.id %&gt;
  &lt;%= submit_tag 'Purchase', class: 'btn btn-primary' %&gt;
&lt;% end %&gt;
</code></pre></div>
<h2>Edit Orders controller</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text"># app/controllers/orders_controller.rb
def create
  @teddy = Teddy.find(params[:teddy_id])
  order  = Order.create!(teddy_sku: @teddy.sku, amount: @teddy.price, state: 'pending')

  redirect_to new_order_payment_path(order)
end
</code></pre></div>
<hr>

<h2>Payments</h2>

<h2>Routes &amp; Controller</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ rails g controller payments new
</code></pre></div>
<p>Edit routes</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># config/routes.rb
resources :orders, only: [:show, :create] do
  resources :payments, only: [:new, :create]
end
</code></pre></div>
<h2>Edit Payment controller (1/2)</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text"># app/controllers/payments_controller.rb
class PaymentsController &lt; ApplicationController
  before_action :set_order

  def new
  end

  def create
    # ...
  end

private

  def set_order
    @order = Order.where(state: 'pending').find(params[:order_id])
  end
end
</code></pre></div>
<h2>Edit payment form</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text"># app/views/payments/new.html.erb
&lt;h1&gt;Purchase of teddy &lt;%= @order.teddy_sku %&gt;&lt;/h1&gt;
&lt;%= form_tag order_payments_path(@order) do %&gt;
  &lt;article&gt;
    &lt;label class="amount"&gt;
      &lt;span&gt;Amount: &lt;%= humanized_money_with_symbol(@order.amount) %&gt;&lt;/span&gt;
    &lt;/label&gt;
  &lt;/article&gt;

  &lt;!-- # Commented for the lecture, remove comments.
  &lt;script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
    data-key="&lt;%= Rails.configuration.stripe[:publishable_key] %&gt;"
    data-name="My Teddy"
    data-description="Teddy &lt;%= @order.teddy_sku %&gt;"
    data-amount="&lt;%= @order.amount_cents %&gt;"
    data-currency="EUR"&gt;&lt;/script&gt;
  --&gt;
&lt;% end %&gt;
</code></pre></div>
<p>Payment controller (2/2)</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># app/controllers/payments_controller.rb
def create
  @amount_cents = @order.amount_cents

  customer = Stripe::Customer.create(
    source: params[:stripeToken],
    email:  params[:stripeEmail]
  )

  charge = Stripe::Charge.create(
    customer:     customer.id,   # You should store this customer id and re-use it.
    amount:       @amount_cents, # in cents
    description:  "Payment for teddy #{@order.teddy_sku} for order #{@order.id}",
    currency:     'eur'
  )

  @order.update(payment: charge.to_json, state: 'paid')
  redirect_to order_path(@order)

rescue Stripe::CardError =&gt; e
  flash[:error] = e.message
  redirect_to new_order_payment_path(@order)
end
</code></pre></div>
<h2>Edit Orders controller</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text"># app/controllers/orders_controller.rb
def show
  @order = Order.where(state: 'paid').find(params[:id])
end
</code></pre></div>
<h2>Edit order page</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text"># app/views/orders/show.html.erb
&lt;h1&gt;Order&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;Status: &lt;%= @order.state %&gt;&lt;/li&gt;
  &lt;li&gt;Item: &lt;%= @order.teddy_sku %&gt;&lt;/li&gt;
  &lt;li&gt;Amount: &lt;%= humanized_money_with_symbol(@order.amount) %&gt;&lt;/li&gt;
&lt;ul&gt;
</code></pre></div>
<hr>

<h2>Testing</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">4242 4242 4242 4242
</code></pre></div>
<p>More cards: https://stripe.com/docs/testing#cards</p>

<hr>

<h2>Happy Striping!</h2>

<p>https://stripe.com/docs</p>

<h1>Projects - Week 2 - Search</h1>

<p>This is not enough:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Movie</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">"title ILIKE ?"</span><span class="p">,</span> <span class="s2">"%</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:search</span><span class="o">]</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span>
</code></pre></div>
<p><code>superman batman</code> in search won't return <em>Batman v Superman: Dawn of Justice</em></p>

<hr>

<h2>Postgresql Fulltext Search</h2>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="o">=#</span> <span class="k">SELECT</span> <span class="s1">'a fat cat sat on a mat and ate a fat rat'</span> <span class="k">ILIKE</span> <span class="s1">'%cat rat%'</span><span class="p">;</span>
 <span class="o">?</span><span class="k">column</span><span class="o">?</span>
<span class="c1">----------</span>
 <span class="n">f</span>
<span class="p">(</span><span class="mi">1</span> <span class="k">row</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="o">=#</span> <span class="k">SELECT</span> <span class="s1">'a fat cat sat on a mat and ate a fat rat'</span> <span class="o">@@</span> <span class="s1">'cat rat'</span><span class="p">;</span>
 <span class="o">?</span><span class="k">column</span><span class="o">?</span>
<span class="c1">----------</span>
 <span class="n">t</span>
<span class="p">(</span><span class="mi">1</span> <span class="k">row</span><span class="p">)</span>
</code></pre></div>
<h3>Let's start from scratch</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails new <span class="se">\</span>
  -T --database postgresql <span class="se">\</span>
  -m https://raw.githubusercontent.com/lewagon/rails-templates/master/minimal.rb <span class="se">\</span>
  imdb_search
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd </span>imdb_search
</code></pre></div>
<h3>Schema</h3>

<p><img src="./Le Wagon - Lectures_files/movies_series_directors_schema-f153d6115a065a48292d2321687a39fd.png" alt=""></p>

<h3>Migrations</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g model director first_name last_name
<span class="nv">$ </span>rails g model movie title year:integer syllabus:text director:references
<span class="nv">$ </span>rails g model serie title year:integer syllabus:text
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rake db:migrate
</code></pre></div>
<p>And add <code>has_many :movies</code> to <code>Director</code>.</p>

<h3><a href="https://gist.github.com/ssaunier/25920c896baa0e4495fd">Seed</a></h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># db/seeds.rb</span>
<span class="nb">require</span> <span class="s2">"open-uri"</span>
<span class="nb">require</span> <span class="s2">"yaml"</span>

<span class="n">file</span> <span class="o">=</span> <span class="s2">"https://gist.githubusercontent.com/ssaunier/25920c896baa0e4495fd/raw/9c26ce104c15fc237126bf6b136b8e318368f8ad/imdb.yml"</span>
<span class="n">sample</span> <span class="o">=</span> <span class="no">YAML</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">)</span>

<span class="n">directors</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># slug =&gt; Director</span>
<span class="n">sample</span><span class="o">[</span><span class="s2">"directors"</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">director</span><span class="o">|</span>
  <span class="n">directors</span><span class="o">[</span><span class="n">director</span><span class="o">[</span><span class="s2">"slug"</span><span class="o">]]</span> <span class="o">=</span> <span class="no">Director</span><span class="o">.</span><span class="n">create!</span> <span class="n">director</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="s2">"first_name"</span><span class="p">,</span> <span class="s2">"last_name"</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">sample</span><span class="o">[</span><span class="s2">"movies"</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">movie</span><span class="o">|</span>
  <span class="n">director</span> <span class="o">=</span> <span class="n">directors</span><span class="o">[</span><span class="n">movie</span><span class="o">[</span><span class="s2">"director_slug"</span><span class="o">]]</span>
  <span class="no">Movie</span><span class="o">.</span><span class="n">create!</span> <span class="n">movie</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="s2">"title"</span><span class="p">,</span> <span class="s2">"year"</span><span class="p">,</span> <span class="s2">"syllabus"</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="ss">director</span><span class="p">:</span> <span class="n">director</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">sample</span><span class="o">[</span><span class="s2">"series"</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">serie</span><span class="o">|</span>
  <span class="no">Serie</span><span class="o">.</span><span class="n">create!</span> <span class="n">serie</span>
<span class="k">end</span>
</code></pre></div>
<h3><code>pg_search</code> gem</h3>

<p><a href="https://github.com/Casecommons/pg_search">github.com/Casecommons/pg_search</a></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s1">'pg_search'</span>
</code></pre></div>
<h3>Searching one model (scope)</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Movie</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="kp">include</span> <span class="no">PgSearch</span>
  <span class="n">pg_search_scope</span> <span class="ss">:search_by_title_and_syllabus</span><span class="p">,</span> <span class="ss">against</span><span class="p">:</span> <span class="o">[</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:syllabus</span> <span class="o">]</span>

  <span class="c1"># [...]</span>
<span class="k">end</span>
</code></pre></div>
<p>You can add <a href="https://github.com/Casecommons/pg_search#tsearch-full-text-search">weighting</a>
to each field searched.</p>

<h3>Searching through association</h3>

<p>Still only <strong>one</strong> model.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Movie</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="kp">include</span> <span class="no">PgSearch</span>
  <span class="n">pg_search_scope</span> <span class="ss">:global_search</span><span class="p">,</span>
    <span class="ss">against</span><span class="p">:</span> <span class="o">[</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:syllabus</span> <span class="o">]</span><span class="p">,</span>
    <span class="ss">associated_against</span><span class="p">:</span> <span class="p">{</span>
      <span class="ss">director</span><span class="p">:</span> <span class="o">[</span> <span class="ss">:first_name</span><span class="p">,</span> <span class="ss">:last_name</span> <span class="o">]</span>
    <span class="p">}</span>

  <span class="n">belongs_to</span> <span class="ss">:director</span>
<span class="k">end</span>
</code></pre></div>
<h3>Multi-search - Setup</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g pg_search:migration:multisearch
<span class="nv">$ </span>rake db:migrate
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">class Movie &lt; ActiveRecord::Base
  include PgSearch
  multisearchable against: [:title, :syllabus]
end

class Serie &lt; ActiveRecord::Base
  include PgSearch
  multisearchable against: [:title, :syllabus]
end
</code></pre></div>
<h3>Multi-search - Usage</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># rails c</span>
<span class="no">PgSearch</span><span class="o">::</span><span class="no">Multisearch</span><span class="o">.</span><span class="n">rebuild</span><span class="p">(</span><span class="no">Movie</span><span class="p">)</span>
<span class="no">PgSearch</span><span class="o">::</span><span class="no">Multisearch</span><span class="o">.</span><span class="n">rebuild</span><span class="p">(</span><span class="no">Serie</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="no">PgSearch</span><span class="o">.</span><span class="n">multisearch</span><span class="p">(</span><span class="s1">'superman'</span><span class="p">)</span>

<span class="n">results</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">result</span><span class="o">.</span><span class="n">searchable</span>
<span class="k">end</span>
</code></pre></div>
<h3>A lot more</h3>

<p>Read the <a href="https://github.com/Casecommons/pg_search">doc</a>.</p>

<hr>

<h2>Option #2: Elasticsearch</h2>

<h3>When use it?</h3>

<p>You need one or more of these features:</p>

<ul>
<li>Scoring complexity (boost some fields)</li>
<li>Mispelling</li>
<li>Suggestions</li>
<li>Highlighting</li>
<li>Facets</li>
<li>Autocomplete</li>
<li>Geo-aware search</li>
</ul>

<h3>Infrastructure</h3>

<p>You need to install ElasticSearch on each developer's workstation + on Heroku.
<img src="./Le Wagon - Lectures_files/elasticsearch-a1e6a8c5fa2b037b2bd2e0e8f5c532e5.png" alt=""></p>

<h3><code>searchkick</code> gem</h3>

<p><a href="https://github.com/ankane/searchkick">github.com/ankane/searchkick</a></p>

<hr>

<h2>Option #3: Algolia</h2>

<h3>When use it?</h3>

<ul>
<li>You don't want to mess with complex ElasticSearch install</li>
<li>You want <strong>speed</strong></li>
<li>Awesome autocompletion (<a href="https://hn.algolia.com/">hn.algolia.com</a>)</li>
<li>Fault-tolerance to typos</li>
<li>Awesome on short texts (user names, movie titles).</li>
</ul>

<p><br></p>

<p>If you index huge documents (like PDF, web pages, etc.), ElasticSearch will do a better job.</p>

<p><br></p>

<p>You can achieve Algolia awesomeness with ElasticSearch but it will take a lot of time and expertise.</p>

<h3><code>algolia-search</code> gem</h3>

<p><a href="https://github.com/algolia/algoliasearch-rails">github.com/algolia/algoliasearch-rails</a></p>

<h1>Projects - Week 2 - Testing</h1>

<h2>Setup</h2>

<p>Let's create (once again) a Product Hunt clone, from scratch.</p>

<p>Let's just <strong>code</strong>, no <code>rails s</code>, no browser.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">rails new <span class="se">\</span>
  -T --database postgresql <span class="se">\</span>
  -m https://raw.githubusercontent.com/lewagon/rails-templates/master/devise.rb <span class="se">\</span>
  product_hunt_clone
<span class="nb">cd </span>product_hunt_clone
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">rails g migration AddNameToUsers first_name last_name
rails g model Product name tagline
rake db:migrate
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s1">'faker'</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># db/seeds.rb</span>
<span class="mi">5</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
  <span class="no">Product</span><span class="o">.</span><span class="n">create!</span> <span class="p">\</span>
    <span class="nb">name</span><span class="p">:</span> <span class="no">Faker</span><span class="o">::</span><span class="no">Company</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
    <span class="ss">tagline</span><span class="p">:</span> <span class="no">Faker</span><span class="o">::</span><span class="no">Company</span><span class="o">.</span><span class="n">catch_phrase</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">rake db:seed
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">rails g controller products index
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">devise_for</span> <span class="ss">:users</span>
  <span class="n">root</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">'products#index'</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">curl https://raw.githubusercontent.com/lewagon/design/master/guidelines/brand/assets_pack/pixels/le-wagon-square-rounded-500.png <span class="se">\</span>
  &gt; app/assets/images/logo.png
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">curl https://raw.githubusercontent.com/lewagon/ui-components/master/source/stylesheets/components/_post_item.scss <span class="se">\</span>
  &gt; app/assets/stylesheets/components/_post_item.scss
</code></pre></div><div class="highlight"><pre><code class="language-sass" data-lang="sass"><span class="c1">// app/assets/stylesheets/components/_index.scss</span>
<span class="c1">// [...]</span>
<span class="k">@import</span> <span class="s">"post_item";</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">ProductsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@products</span> <span class="o">=</span> <span class="no">Product</span><span class="o">.</span><span class="n">all</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;h1&gt;Products&lt;/h1&gt;</span>
<span class="cp">&lt;%</span> <span class="vi">@products</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">product</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;div class="product"&gt;</span>
<span class="x">    &lt;div class='product-upvote'&gt;</span>
<span class="x">      &lt;div class="product-arrow"&gt;&lt;/div&gt;</span>
<span class="x">      &lt;div class='product-count'&gt;0&lt;/div&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">    &lt;div class='product-body'&gt;</span>
<span class="x">      &lt;h3&gt;Kudoz&lt;/h3&gt;</span>
<span class="x">      &lt;p&gt;Your career is ahead&lt;/p&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">  &lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<p>Now what?</p>

<hr>

<h2>Manual Testing</h2>

<p><img src="./Le Wagon - Lectures_files/classic_developer_workflow-1ed5a92b36775859165e416fcab1d218.png" alt=""></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">rails s
</code></pre></div>
<p>Looks good? Deploy!</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">git status
git add Gemfile Gemfile.lock app config db
git commit -m <span class="s2">"Add Product Hunt list"</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">heroku create --region<span class="o">=</span>eu
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">git push heroku master
heroku run rake db:migrate db:seed
heroku open
</code></pre></div>
<p>So far, so good.</p>

<p>Let's modify the view to display product name.</p>

<p>That's <strong>so easy</strong>! Let's code, commit and deploy!</p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;div class='product-body'&gt;</span>
<span class="x">  &lt;h3&gt;</span><span class="cp">&lt;%=</span> <span class="n">product</span><span class="o">.</span><span class="n">title</span> <span class="cp">%&gt;</span><span class="x">&lt;/h3&gt;</span>
<span class="x">  &lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="n">product</span><span class="o">.</span><span class="n">tagline</span> <span class="cp">%&gt;</span><span class="x">&lt;/p&gt;</span>
<span class="x">&lt;/div&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">git status
git add app/views
git commit -m <span class="s2">"Put tagline below product title"</span>
git push heroku master
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">heroku open
</code></pre></div>
<h1></h1>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">heroku rollback

<span class="c"># Did you have migrations run in the last release?</span>
heroku run rake db:rollback
</code></pre></div>
<h1></h1>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">heroku logs --tail
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">heroku<span class="o">[</span>router<span class="o">]</span>: <span class="nv">at</span><span class="o">=</span>info <span class="nv">method</span><span class="o">=</span>GET <span class="nv">path</span><span class="o">=</span><span class="s2">"/"</span> <span class="nv">host</span><span class="o">=</span>serene-depths-42608.herokuapp.com <span class="nv">request_id</span><span class="o">=</span>5ea475f9-6db3-42b1-8ccd-2d0fd86e56b3 <span class="nv">fwd</span><span class="o">=</span><span class="s2">"81.64.135.232"</span> <span class="nv">dyno</span><span class="o">=</span>web.1 <span class="nv">connect</span><span class="o">=</span>1ms <span class="nv">service</span><span class="o">=</span>63ms <span class="nv">status</span><span class="o">=</span><span class="m">500</span> <span class="nv">bytes</span><span class="o">=</span>1669
app<span class="o">[</span>web.1<span class="o">]</span>: Processing by ProductsController#index as HTML
app<span class="o">[</span>web.1<span class="o">]</span>: Started GET <span class="s2">"/"</span> <span class="k">for</span> 81.64.135.232 at 2016-05-31 16:08:00 +0000
app<span class="o">[</span>web.1<span class="o">]</span>:   Rendering products/index.html.erb within layouts/application
app<span class="o">[</span>web.1<span class="o">]</span>: Completed <span class="m">500</span> Internal Server Error in 24ms <span class="o">(</span>ActiveRecord: 7.7ms<span class="o">)</span>
app<span class="o">[</span>web.1<span class="o">]</span>:   Rendered products/index.html.erb within layouts/application <span class="o">(</span>20.4ms<span class="o">)</span>
app<span class="o">[</span>web.1<span class="o">]</span>:   Product Load <span class="o">(</span>1.2ms<span class="o">)</span>  SELECT <span class="s2">"products"</span>.* FROM <span class="s2">"products"</span>
app<span class="o">[</span>web.1<span class="o">]</span>:      8:             &lt;div <span class="nv">class</span><span class="o">=</span><span class="s1">'product-count'</span>&gt;0&lt;/div&gt;
app<span class="o">[</span>web.1<span class="o">]</span>:     11:             &lt;h3&gt;&lt;%<span class="o">=</span> product.title %&gt;&lt;/h3&gt;
app<span class="o">[</span>web.1<span class="o">]</span>:     10:           &lt;div <span class="nv">class</span><span class="o">=</span><span class="s1">'product-body'</span>&gt;
app<span class="o">[</span>web.1<span class="o">]</span>:      9:           &lt;/div&gt;
app<span class="o">[</span>web.1<span class="o">]</span>:     13:           &lt;/div&gt;
app<span class="o">[</span>web.1<span class="o">]</span>: app/views/products/index.html.erb:11:in <span class="sb">`</span>block in _app_views_products_index_html_erb___3319655114577111177_70175408985480<span class="s1">'</span>
<span class="s1">app[web.1]: ActionView::Template::Error (undefined method `title'</span> <span class="k">for</span> <span class="c">#&lt;Product:0x007fa5f7fdf8f0&gt;):</span>
app<span class="o">[</span>web.1<span class="o">]</span>: app/views/products/index.html.erb:4:in <span class="sb">`</span>_app_views_products_index_html_erb___3319655114577111177_70175408985480<span class="err">'</span>
app<span class="o">[</span>web.1<span class="o">]</span>:
app<span class="o">[</span>web.1<span class="o">]</span>:
app<span class="o">[</span>web.1<span class="o">]</span>:     12:             &lt;p&gt;&lt;%<span class="o">=</span> product.tagline %&gt;&lt;/p&gt;
app<span class="o">[</span>web.1<span class="o">]</span>:     14:         &lt;/div&gt;
</code></pre></div>
<p>Replace <code>title</code> with <code>name</code>, <code>commit</code> and re-deploy.</p>

<hr>

<h2>Automated Testing</h2>

<p><code>rake</code></p>

<p>We'll use the <a href="http://guides.rubyonrails.org/testing.html"><strong>rails way</strong></a>, <a href="http://www.rubydoc.info/gems/minitest/2.3.1/MiniTest/Assertions">Minitest</a>.</p>

<h3>Setup (3 steps)</h3>

<p>For a rails app generated with the <code>-T</code> flag. Skip this if not.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># config/application.rb</span>
require <span class="s2">"rails/test_unit/railtie"</span>  <span class="c"># Uncomment this line</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># In the terminal, run:</span>
<span class="nv">folders</span><span class="o">=(</span>controllers fixtures helpers integration mailers models<span class="o">)</span>
<span class="k">for</span> dir in <span class="s2">"${folders[@]}"</span><span class="p">;</span> <span class="k">do</span> mkdir -p <span class="s2">"test/$dir"</span> <span class="o">&amp;&amp;</span> touch <span class="s2">"test/$dir/.keep"</span><span class="p">;</span> <span class="k">done</span>
cat &gt;test/test_helper.rb <span class="s">&lt;&lt;RUBY</span>
<span class="s">ENV['RAILS_ENV'] ||= 'test'</span>
<span class="s">require File.expand_path('../../config/environment', __FILE__)</span>
<span class="s">require 'rails/test_help'</span>

<span class="s">class ActiveSupport::TestCase</span>
<span class="s">  fixtures :all</span>
<span class="s">end</span>
<span class="s">RUBY</span>
</code></pre></div>
<p>We'll simulate a real browser. We'll do <strong>Integration Testing</strong>.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">brew install phantomjs  <span class="c"># on OSX only</span>
                        <span class="c"># Linux: see https://gist.github.com/julionc/7476620</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">group</span> <span class="ss">:development</span><span class="p">,</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'capybara'</span>
  <span class="n">gem</span> <span class="s1">'poltergeist'</span>
  <span class="n">gem</span> <span class="s1">'launchy'</span>
  <span class="n">gem</span> <span class="s1">'minitest-reporters'</span>
  <span class="c1"># [...]</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">bundle install
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># test/test_helper.rb</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'RAILS_ENV'</span><span class="o">]</span> <span class="o">||=</span> <span class="s1">'test'</span>
<span class="nb">require</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">'../../config/environment'</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>
<span class="nb">require</span> <span class="s1">'rails/test_help'</span>
<span class="nb">require</span> <span class="s1">'minitest/reporters'</span>
<span class="no">Minitest</span><span class="o">::</span><span class="no">Reporters</span><span class="o">.</span><span class="n">use!</span> <span class="o">[</span><span class="no">Minitest</span><span class="o">::</span><span class="no">Reporters</span><span class="o">::</span><span class="no">SpecReporter</span><span class="o">.</span><span class="n">new</span><span class="o">]</span>

<span class="k">class</span> <span class="nc">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">fixtures</span> <span class="ss">:all</span>
<span class="k">end</span>

<span class="nb">require</span> <span class="s1">'capybara/rails'</span>
<span class="k">class</span> <span class="nc">ActionDispatch</span><span class="o">::</span><span class="no">IntegrationTest</span>
  <span class="kp">include</span> <span class="no">Capybara</span><span class="o">::</span><span class="no">DSL</span>
  <span class="k">def</span> <span class="nf">teardown</span>
    <span class="no">Capybara</span><span class="o">.</span><span class="n">reset_sessions!</span>
    <span class="no">Capybara</span><span class="o">.</span><span class="n">use_default_driver</span>
    <span class="no">Warden</span><span class="o">.</span><span class="n">test_reset!</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="nb">require</span> <span class="s1">'capybara/poltergeist'</span>
<span class="no">Capybara</span><span class="o">.</span><span class="n">default_driver</span> <span class="o">=</span> <span class="ss">:poltergeist</span>

<span class="kp">include</span> <span class="no">Warden</span><span class="o">::</span><span class="no">Test</span><span class="o">::</span><span class="no">Helpers</span>
<span class="no">Warden</span><span class="o">.</span><span class="n">test_mode!</span>
</code></pre></div>
<h3>Test Principle</h3>

<p>4 phases</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">TestSomeObject</span>
  <span class="k">def</span> <span class="nf">test_something_on_object</span>
    <span class="c1"># setup</span>
    <span class="c1"># exercise</span>
    <span class="c1"># verify</span>
    <span class="c1"># teardown</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Our first integration test</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">rails generate integration_test home
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># test/integration/home_test.rb</span>
<span class="k">class</span> <span class="nc">HomeTest</span> <span class="o">&lt;</span> <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">IntegrationTest</span>
  <span class="nb">test</span> <span class="s2">"loads correctly"</span> <span class="k">do</span>
    <span class="n">visit</span> <span class="s2">"/"</span>
    <span class="n">assert</span> <span class="mi">200</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">status_code</span>
    <span class="n">assert</span> <span class="n">page</span><span class="o">.</span><span class="n">has_content?</span><span class="p">(</span><span class="s2">"Products"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">rake
</code></pre></div>
<h1></h1>

<p>Our test does not catch the <code>title</code> / <code>name</code> mix-up.</p>

<p>We need products in the database.</p>

<p>There are <strong>2</strong> different databases (cf <code>config/database.yml</code>)</p>

<h3>Let's test with products!</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">touch <span class="nb">test</span>/fixtures/products.yml
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># test/fixtures/products.yml</span>
<span class="ss">kudoz</span><span class="p">:</span>
  <span class="nb">name</span><span class="p">:</span> <span class="s2">"Kudoz"</span>
  <span class="ss">tagline</span><span class="p">:</span> <span class="s2">"Tinder for Jobs"</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">rake
</code></pre></div>
<p> Tests are now broken if we use <code>title</code>.</p>

<h3>Debugging your test</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">puts</span> <span class="n">page</span><span class="o">.</span><span class="n">html</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">save_and_open_page</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">save_and_open_screenshot</span>
</code></pre></div>
<h3>Second test</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">test</span> <span class="s2">"loads correctly"</span> <span class="k">do</span>
  <span class="n">visit</span> <span class="s2">"/"</span>
  <span class="n">assert</span> <span class="mi">200</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">status_code</span>
  <span class="n">assert</span> <span class="n">page</span><span class="o">.</span><span class="n">has_selector?</span><span class="p">(</span><span class="s1">'.product'</span><span class="p">,</span> <span class="ss">count</span><span class="p">:</span> <span class="no">Product</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>You can put <strong>erb</strong> inside your fixtures!</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># products.yml</span>
<span class="o">&lt;</span><span class="sx">% 1.upto(5) </span><span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="sx">%&gt;</span>
<span class="sx">product_&lt;%= i %&gt;</span><span class="p">:</span>
  <span class="nb">name</span><span class="p">:</span> <span class="o">&lt;</span><span class="sx">%= Faker::Company.name %&gt;</span>
<span class="sx">  tagline: &lt;%=</span> <span class="no">Faker</span><span class="o">::</span><span class="no">Company</span><span class="o">.</span><span class="n">catch_phrase</span> <span class="sx">%&gt;</span>
<span class="sx">&lt;% end %&gt;</span>
</code></pre></div>
<hr>

<h2>TDD</h2>

<p>Test Driven Development</p>

<p>Let's add a new feature: <strong>add a new product</strong>.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">touch <span class="nb">test</span>/fixtures/users.yml
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># test/fixtures/users.yml</span>
<span class="ss">george</span><span class="p">:</span>
  <span class="ss">email</span><span class="p">:</span> <span class="s2">"george@abitbol.com"</span>
  <span class="ss">first_name</span><span class="p">:</span> <span class="s2">"George"</span>
  <span class="ss">last_name</span><span class="p">:</span> <span class="s2">"Abitbol"</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">rails g integration_test product
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># test/integration/product_test.rb</span>
<span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">ProductTest</span> <span class="o">&lt;</span> <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">IntegrationTest</span>
  <span class="nb">test</span> <span class="s2">"lets a signed in user create a new product"</span> <span class="k">do</span>
    <span class="n">login_as</span> <span class="n">users</span><span class="p">(</span><span class="ss">:george</span><span class="p">)</span>
    <span class="n">visit</span> <span class="s2">"/products/new"</span>

    <span class="n">fill_in</span> <span class="s2">"product_name"</span><span class="p">,</span> <span class="ss">with</span><span class="p">:</span> <span class="s2">"Le Wagon"</span>
    <span class="n">fill_in</span> <span class="s2">"product_tagline"</span><span class="p">,</span> <span class="ss">with</span><span class="p">:</span> <span class="s2">"Change your life: Learn to code"</span>
    <span class="n">click_button</span> <span class="s1">'Create Product'</span>

    <span class="c1"># Should be redirected to Home with new product</span>
    <span class="n">assert_equal</span> <span class="n">root_path</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">current_path</span>
    <span class="n">assert</span> <span class="mi">200</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">status_code</span>
    <span class="n">assert</span> <span class="n">page</span><span class="o">.</span><span class="n">has_content?</span><span class="p">(</span><span class="s2">"Change your life: Learn to code"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>And now, <strong>let's code</strong>!</h3>

<p>We'll follow error messages. Until we make the test green!</p>

<p>Note that we should also write a test to handle the <strong>error</strong> scenario.</p>

<hr>

<h2>Unit Test</h2>

<p>Example: add a method <code>#full_name</code> to the <code>User</code> model.</p>

<p>Let's use TDD!</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">touch <span class="nb">test</span>/models/user_test.rb
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># test/models/user_test.rb</span>
<span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">UserTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="nb">test</span> <span class="s2">"full_name returns the capitalized fist name and last name"</span> <span class="k">do</span>
    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">first_name</span><span class="p">:</span> <span class="s2">"john"</span><span class="p">,</span> <span class="ss">last_name</span><span class="p">:</span> <span class="s2">"lennon"</span><span class="p">)</span>
    <span class="n">assert_equal</span> <span class="s2">"John Lennon"</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">full_name</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Time to implement the feature, following the test error messages!</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">rake <span class="nb">test</span>:models
</code></pre></div>
<p><img src="./Le Wagon - Lectures_files/red_green_refactor-a7abd99cbb660369debc29578dd6b43c.png" alt=""></p>

<hr>

<h2>Continuous Integration</h2>

<p><a href="https://travis-ci.org/"><img src="./Le Wagon - Lectures_files/travis-2e7b722cba05dad51be0ec4fbb6a143f.png" alt=""></a></p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># 1. We need a special file:</span>
cat &gt;.travis.yml <span class="s">&lt;&lt;YAML</span>
<span class="s">language: ruby</span>
<span class="s">before_script:</span>
<span class="s">  - psql -c 'create database product_hunt_clone_test;' -U postgres</span>
<span class="s">YAML</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># 2. Let's commit our work</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># 3. Let's create a GitHub repo</span>
hub create
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># 4. Go to travis-ci.org and add your repository.</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># 5. Now let's push the code on GitHub:</span>
git push origin master
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># 6. Go back to Travis' Dashboard!</span>
</code></pre></div>
<p>Travis integrates with Pull Request </p>

<hr>

<h2>Going Further</h2>

<ul>
<li>Must read: <a href="http://guides.rubyonrails.org/testing.html">guides.rubyonrails.org/testing.html</a></li>
<li><a href="http://rspec.info/">RSpec</a></li>
<li><a href="https://github.com/bblimke/webmock">Webmock</a></li>
<li>...</li>
</ul>

<hr>

<h2>One last thing</h2>

<p>You need <strong>Monitoring</strong>!</p>

<ul>
<li><a href="https://uptimerobot.com/">Uptime Robot</a></li>
<li><a href="https://elements.heroku.com/addons#errors-exceptions">Error Tracking</a> (Try Raygun or AppSignal)</li>
</ul>

<h1>Projects - Week 2 - React</h1>

<h2>Why?</h2>

<h3>Suppose you want to code this upvote</h3>

<p><img src="./Le Wagon - Lectures_files/react_product_hunt-cecba06242a7717b1f61ecb35f5e9dca.png" alt=""></p>

<h3>HTML</h3>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"upvote"</span> <span class="na">data-id=</span><span class="s">"1928382"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"fa fa-caret-up"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"count"</span><span class="nt">&gt;</span>
    159
  <span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<h3>JS</h3>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// app/assets/javascripts/WHERE.JS????</span>
<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'.upvote'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s1">'POST'</span><span class="p">,</span>
      <span class="nx">url</span><span class="o">:</span> <span class="s1">'/resources/'</span> <span class="p">.</span> <span class="nx">element</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">'id'</span><span class="p">)</span> <span class="p">.</span> <span class="s1">'/upvote'</span><span class="p">,</span>
      <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.count'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">upvotes</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">upvoted</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">element</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">'upvoted'</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">element</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">'upvoted'</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<h3>Rails way</h3>

<p>You could use <code>remote: true</code> here on a regular <code>link_to</code>. You still
have to write the <code>.js.erb</code> view for the callback.</p>

<h3>Problems</h3>

<ul>
<li>Where should I put my JavaScript?</li>
<li>How can I reuse my upvote component on another page?</li>
<li>State is everywhere, stored in HTML and CSS classes (no type)</li>
<li>JS code mixes event handling, and presentation logic.</li>
</ul>

<p><strong>Use React when you have dynamic views</strong>.</p>

<hr>

<h2>React Basics</h2>

<h3>Component</h3>

<ul>
<li>A <code>render</code> method</li>
<li>Props (think immutable instance variables)</li>
<li>State (think mutable instance variables)</li>
</ul>

<h3>Our first component</h3>

<p>We use <a href="https://facebook.github.io/react/docs/jsx-in-depth.html"><strong>JSX</strong></a>. Mixing HTML &amp; JS in the same file.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">Hello</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="nx">Hello</span> <span class="nx">guys</span><span class="o">&lt;</span><span class="err">/div&gt;;</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p>We can render it with:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">React</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">Hello</span> <span class="o">/&gt;</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
</code></pre></div>
<p><a href="http://jsbin.com/veluka/1/edit?html,js,output">Live example</a></p>

<h3>Adding a prop (immutable)</h3>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">Hello</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="nx">Hello</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;;</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">React</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">Hello</span> <span class="nx">name</span><span class="o">=</span><span class="s2">"Boris"</span> <span class="o">/&gt;</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
</code></pre></div>
<h3>Adding state</h3>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">Hello</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="nx">getInitialState</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span> <span class="nx">activated</span><span class="o">:</span> <span class="kc">false</span> <span class="p">};</span>
  <span class="p">},</span>

  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">divClasses</span> <span class="o">=</span> <span class="nx">classNames</span><span class="p">({</span>
      <span class="s1">'activated'</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">activated</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">divClasses</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Hello</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;;</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<h3>Adding events</h3>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">Hello</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="nx">getInitialState</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span> <span class="nx">activated</span><span class="o">:</span> <span class="kc">false</span> <span class="p">};</span>
  <span class="p">},</span>

  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">divClasses</span> <span class="o">=</span> <span class="nx">classNames</span><span class="p">({</span>
      <span class="s1">'activated'</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">activated</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">activate</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">divClasses</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Hello</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;;</span>
  <span class="p">},</span>

  <span class="nx">activate</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">activated</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p><a href="http://jsbin.com/veluka/7/edit?html,js,output">Live example</a></p>

<hr>

<h2>Combining components</h2>

<h3>List Item pattern</h3>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">PostListItem</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">post</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/h3&gt;</span>
      <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">post</span><span class="p">.</span><span class="nx">content</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">PostList</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">posts</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">post</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">&lt;</span><span class="nx">PostListItem</span> <span class="nx">post</span><span class="o">=</span><span class="p">{</span><span class="nx">post</span><span class="p">}</span> <span class="o">/&gt;</span><span class="p">;</span>
      <span class="p">})}</span>
    <span class="o">&lt;</span><span class="err">/div&gt;;</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">posts</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="s2">"The first post"</span><span class="p">,</span> <span class="nx">content</span><span class="o">:</span> <span class="s2">"lorem ipsum"</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="s2">"The second post"</span><span class="p">,</span> <span class="nx">content</span><span class="o">:</span> <span class="s2">"other lorem"</span> <span class="p">}</span>
<span class="p">]</span>
<span class="nx">React</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">PostList</span> <span class="nx">posts</span><span class="o">=</span><span class="p">{</span><span class="nx">posts</span><span class="p">}</span> <span class="o">/&gt;</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
</code></pre></div>
<p><a href="http://jsbin.com/veluka/8/edit?html,js,output">Live Example</a></p>

<hr>

<h2>React + Rails</h2>

<h3>Setup</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails new <span class="se">\</span>
  -T --database postgresql <span class="se">\</span>
  -m https://raw.githubusercontent.com/lewagon/rails-templates/master/devise.rb <span class="se">\</span>
  product_hunt_clone
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd </span>product_hunt_clone
</code></pre></div>
<p>We'll use <a href="https://github.com/reactjs/react-rails">react-rails</a>, <a href="https://github.com/railsware/js-routes">js-routes</a> gems and <a href="https://github.com/JedWatson/classnames">classnames</a> bower package</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s1">'js-routes'</span>
<span class="n">gem</span> <span class="s1">'react-rails'</span><span class="p">,</span> <span class="s1">'1.6.1'</span>

<span class="n">source</span> <span class="s1">'https://rails-assets.org'</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'rails-assets-classnames'</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g react:install
</code></pre></div>
<h3>Config (1)</h3>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// app/assets/javascripts/components.js</span>

<span class="c1">//= require js-routes</span>
<span class="c1">//= require classnames</span>
<span class="c1">//= require_tree ./components</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/initializers/jsroutes.rb</span>

<span class="c1"># https://github.com/railsware/js-routes#advanced-setup</span>
<span class="no">JsRoutes</span><span class="o">.</span><span class="n">setup</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="c1"># Whitelist routes to include on the Front-End</span>
  <span class="c1"># NOTE: if you add a new route here, do not forget to run:</span>
  <span class="c1">#       $ rake tmp:cache:clear</span>
  <span class="c1">#       before restarting your `rails s`.</span>
  <span class="n">config</span><span class="o">.</span><span class="n">include</span> <span class="o">=</span> <span class="o">[</span>

  <span class="o">]</span>
<span class="k">end</span>
</code></pre></div>
<h3>Config (2)</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/environments/development.rb</span>
<span class="no">MyApp</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span>
  <span class="n">config</span><span class="o">.</span><span class="n">react</span><span class="o">.</span><span class="n">variant</span> <span class="o">=</span> <span class="ss">:development</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/environments/production.rb</span>
<span class="no">MyApp</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span>
  <span class="n">config</span><span class="o">.</span><span class="n">react</span><span class="o">.</span><span class="n">variant</span> <span class="o">=</span> <span class="ss">:production</span>
<span class="k">end</span>
</code></pre></div>
<h3>Thinking in components</h3>

<p><img src="./Le Wagon - Lectures_files/react_product_hunt_components-6976fc85eeb7a7de2aceccef9a264c90.png" alt=""></p>

<h3>Model</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g model product name tagline url user:references
<span class="nv">$ </span>rails g migration AddAvatarUrlToUsers avatar_url:string
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s1">'acts_as_votable'</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails generate acts_as_votable:migration
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/product.rb</span>
<span class="k">class</span> <span class="nc">Product</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">acts_as_votable</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/models/user.rb</span>
<span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">acts_as_voter</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># db/seeds.rb</span>
<span class="n">john</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">email</span><span class="p">:</span> <span class="s1">'john@beatles.com'</span><span class="p">,</span> <span class="ss">password</span><span class="p">:</span> <span class="s1">'testtest'</span><span class="p">,</span> <span class="ss">avatar_url</span><span class="p">:</span> <span class="s1">'http://johnlennonartwork.com/wp-content/uploads/2011/05/john-lennon1-300x294.jpg'</span><span class="p">)</span>
<span class="n">paul</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">email</span><span class="p">:</span> <span class="s1">'paul@beatles.com'</span><span class="p">,</span> <span class="ss">password</span><span class="p">:</span> <span class="s1">'testtest'</span><span class="p">,</span> <span class="ss">avatar_url</span><span class="p">:</span> <span class="s1">'http://beatlesthe.free.fr/img/paul.jpg'</span><span class="p">)</span>
<span class="n">ringo</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">email</span><span class="p">:</span> <span class="s1">'ringo@beatles.com'</span><span class="p">,</span> <span class="ss">password</span><span class="p">:</span> <span class="s1">'testtest'</span><span class="p">,</span> <span class="ss">avatar_url</span><span class="p">:</span> <span class="s1">''</span><span class="p">)</span>
<span class="n">george</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">email</span><span class="p">:</span> <span class="s1">'george@beatles.com'</span><span class="p">,</span> <span class="ss">password</span><span class="p">:</span> <span class="s1">'testtest'</span><span class="p">,</span> <span class="ss">avatar_url</span><span class="p">:</span> <span class="s1">''</span><span class="p">)</span>

<span class="n">startup_stash</span> <span class="o">=</span> <span class="no">Product</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
  <span class="nb">name</span><span class="p">:</span> <span class="s1">'Startup Stash'</span><span class="p">,</span>
  <span class="ss">tagline</span><span class="p">:</span> <span class="s1">'A curated directory of 400 resources &amp; tools for startups'</span><span class="p">,</span>
  <span class="ss">url</span><span class="p">:</span> <span class="s1">'http://startupstash.com'</span><span class="p">,</span>
  <span class="ss">user</span><span class="p">:</span> <span class="n">john</span>
<span class="p">)</span>

<span class="n">startup_launch_list</span> <span class="o">=</span> <span class="no">Product</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
  <span class="nb">name</span><span class="p">:</span> <span class="s1">'Startup Launch List'</span><span class="p">,</span>
  <span class="ss">tagline</span><span class="p">:</span> <span class="s1">'Articles you need to read before launching a startup'</span><span class="p">,</span>
  <span class="ss">url</span><span class="p">:</span> <span class="s1">'http://startuplaunchlist.com'</span><span class="p">,</span>
  <span class="ss">user</span><span class="p">:</span> <span class="n">paul</span>
<span class="p">)</span>

<span class="n">john</span><span class="o">.</span><span class="n">up_votes</span> <span class="n">startup_stash</span>
<span class="n">paul</span><span class="o">.</span><span class="n">up_votes</span> <span class="n">startup_stash</span>
<span class="n">george</span><span class="o">.</span><span class="n">up_votes</span> <span class="n">startup_stash</span>

<span class="n">ringo</span><span class="o">.</span><span class="n">up_votes</span> <span class="n">startup_launch_list</span>
</code></pre></div>
<h3>Let's build the components</h3>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// app/assets/javascripts/components/product_list_item.js.jsx</span>
<span class="kd">var</span> <span class="nx">ProductListItem</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"post"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"post-upvote"</span><span class="o">&gt;</span><span class="nx">TODO</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"post-body"</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">url</span><span class="p">}</span> <span class="nx">target</span><span class="o">=</span><span class="s2">"_blank"</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/a&gt;</span>
          <span class="o">&lt;</span><span class="err">/h3&gt;</span>
          <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">tagline</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"post-controls"</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"post-control"</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"user-badge-container "</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">avatar_url</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"avatar"</span><span class="o">/&gt;</span>
            <span class="o">&lt;</span><span class="err">/div&gt;</span>
          <span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
      <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p>And add some <a href="https://raw.githubusercontent.com/lewagon/ui-components/master/source/stylesheets/components/_post_item.scss">css</a></p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// app/assets/javascripts/components/product_list.js.jsx</span>
<span class="kd">var</span> <span class="nx">ProductList</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">product</span><span class="p">){</span>
          <span class="k">return</span> <span class="o">&lt;</span><span class="nx">ProductListItem</span> <span class="nx">product</span><span class="o">=</span><span class="p">{</span><span class="nx">product</span><span class="p">}</span> <span class="o">/&gt;</span><span class="p">;</span>
        <span class="p">})}</span>
      <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<h3>Building the props (with jbuilder)</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/views/products/_product.json.jbuilder</span>
<span class="n">json</span><span class="o">.</span><span class="n">extract!</span> <span class="n">product</span><span class="p">,</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:tagline</span><span class="p">,</span> <span class="ss">:url</span><span class="p">,</span> <span class="ss">:id</span>

<span class="n">json</span><span class="o">.</span><span class="n">user</span> <span class="k">do</span>
  <span class="n">json</span><span class="o">.</span><span class="n">extract!</span> <span class="n">product</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="ss">:avatar_url</span>
<span class="k">end</span>

<span class="n">json</span><span class="o">.</span><span class="n">up_votes</span> <span class="n">product</span><span class="o">.</span><span class="n">votes_for</span><span class="o">.</span><span class="n">count</span>

<span class="k">if</span> <span class="n">user_signed_in?</span>
  <span class="n">json</span><span class="o">.</span><span class="n">up_voted</span> <span class="n">current_user</span><span class="o">.</span><span class="n">voted_for?</span> <span class="n">product</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/views/products/index.json.jbuilder</span>
<span class="n">json</span><span class="o">.</span><span class="n">products</span> <span class="k">do</span>
  <span class="n">json</span><span class="o">.</span><span class="n">array!</span> <span class="vi">@products</span> <span class="k">do</span> <span class="o">|</span><span class="n">product</span><span class="o">|</span>
    <span class="n">json</span><span class="o">.</span><span class="n">partial!</span> <span class="s2">"products/product"</span><span class="p">,</span> <span class="ss">product</span><span class="p">:</span> <span class="n">product</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>Controller</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">'products#index'</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails g controller products
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/products_controller.rb</span>
<span class="k">class</span> <span class="nc">ProductsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@products</span> <span class="o">=</span> <span class="no">Product</span><span class="o">.</span><span class="n">all</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>View</h3>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">react_component</span> <span class="s2">"ProductList"</span><span class="p">,</span>
      <span class="n">render</span><span class="p">(</span><span class="ss">template</span><span class="p">:</span> <span class="s1">'products/index.json.jbuilder'</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<p>You can prerender (for SEO)!</p>
<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">react_component</span> <span class="s2">"ProductList"</span><span class="p">,</span>
      <span class="n">render</span><span class="p">(</span><span class="ss">template</span><span class="p">:</span> <span class="s1">'products/index.json.jbuilder'</span><span class="p">),</span>
      <span class="ss">prerender</span><span class="p">:</span> <span class="kp">true</span> <span class="cp">%&gt;</span><span class="x"></span>
</code></pre></div>
<h3>Let's upvote</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
  <span class="n">resources</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[]</span> <span class="k">do</span>
    <span class="n">member</span> <span class="k">do</span>
      <span class="n">post</span> <span class="ss">:upvote</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/products_controller.rb</span>
  <span class="k">def</span> <span class="nf">upvote</span>
    <span class="vi">@product</span> <span class="o">=</span> <span class="no">Product</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">voted_for?</span> <span class="vi">@product</span>
      <span class="n">current_user</span><span class="o">.</span><span class="n">unvote_for</span> <span class="vi">@product</span>
    <span class="k">else</span>
      <span class="n">current_user</span><span class="o">.</span><span class="n">up_votes</span> <span class="vi">@product</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/views/products/upvote.json.jbuilder</span>
<span class="n">json</span><span class="o">.</span><span class="n">partial!</span> <span class="s2">"products/product"</span><span class="p">,</span> <span class="ss">product</span><span class="p">:</span> <span class="vi">@product</span>
</code></pre></div>
<h3>JS Route</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">JsRoutes.setup do |config|
  config.include = [
    /^upvote_product$/
  ]
end
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Kill your rails s with Ctrl-C</span>
<span class="nv">$ </span>rake tmp:cache:clear
<span class="nv">$ </span>rails s
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">// app/assets/javascripts/components/upvote.js.jsx
var Upvote = React.createClass({
  getInitialState: function() {
    return {
      product: this.props.product
    }
  },

  render: function() {
    var divClasses = classNames({
      "post-upvote": true,
      "post-upvote-upvoted": this.state.product.up_voted
    });

    return (
      &lt;div className={divClasses}&gt;
        &lt;div className="post-upvote-arrow"&gt;&lt;/div&gt;
        &lt;div className="post-upvote-count"&gt;
          {this.state.product.up_votes}
        &lt;/div&gt;
      &lt;/div&gt;
    );
  }
});
</code></pre></div>
<h3>With click event handling</h3>
<div class="highlight"><pre><code class="language-js" data-lang="js">  <span class="c1">// [...]</span>
  <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">divClasses</span><span class="p">}</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">}</span><span class="o">&gt;</span>
  <span class="c1">// [...]</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js">  <span class="c1">// [...]</span>
  <span class="nx">handleClick</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s1">'POST'</span><span class="p">,</span>
      <span class="nx">url</span><span class="o">:</span> <span class="nx">Routes</span><span class="p">.</span><span class="nx">upvote_product_path</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="p">{</span> <span class="nx">format</span><span class="o">:</span> <span class="s1">'json'</span> <span class="p">}),</span>
      <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">that</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">product</span><span class="o">:</span> <span class="nx">data</span> <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="c1">// [...]</span>
</code></pre></div>
<hr>

<h2>Advanced</h2>

<h3>Pubsub</h3>

<p>To communicate between components <em>without direct filiation</em>.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">source</span> <span class="s1">'https://rails-assets.org'</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'rails-assets-pubsub-js'</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// app/assets/javascripts/components.js</span>

<span class="c1">//= require pubsub-js</span>
</code></pre></div>
<p><a href="https://github.com/mroderick/PubSubJS#pubsubjs">Documentation on GitHub</a></p>

<hr>

<h2>The future</h2>

<p><a href="https://facebook.github.io/react-native/">React Native</a></p>

    </div>
  
<span style="height: 20px; width: 40px; position: absolute; opacity: 1; z-index: 8675309; display: none; cursor: pointer; border: none; background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAoCAYAAABpYH0BAAAHjElEQVR4Ae1bBXAbvRLO0GNmpv+VmflnZmZmZi4zMzMzM4Y58ZwTz4SZnZzpjLWzBa38Zs8aO332pdy7ma9JPmml1XfSaqXacfgYjRIcPrwP9u7dqSMKHDq0D5hmiLi4vDwJEH6/H86dOxcFdAQCfq5ZQUEexOHM8/l8cPbsWR0xADVD7eJwSuqCaANqpwt4MQTU9uiPLuDFErC1tVUDdFw0AV0l5VA1dS4Y7n4SUv7VD+J/0QHif3YT/1168Dmonb8MfBbr9StgIBDQBE9DE+Q//zYX69QP/3NBJP6pO1TPXgwBvx9trwu0S0BblgFSOwwigRJ+1xnyn3wVqqfNh6aVG6Fu7mIofudzSL1poCCk6aX3wO/1XV8C4ikkFjgKSiD5b71IlIIX3oHTbDayR5ji/GEdVU+dK8zS0m8mYDvXPLQJyDLw7CH3khjlTAx8LmSDYtbOXEg28b/sAPb8Qir3ebxg3ncY5MTUiz5Ir80BTTv2UX+R4KyownraBcRjSbRo3LaHhDDc8Ri0BgKcd5lboOTL0ZDPZqOclBpmh/XSuwwj2+IPv+a81+2B3DsfI75+/VbkLwpczTKkdx+B7fKNzSblCeVl42dA8j/78PLaZWtjbl+TgManXqPBWk4mBXmvF7KH3U98CnOKCRNmW/zul1QnvdfNnDMfPkEcomzklIsmYOWMBULbTdv3Ik8+J/+9N5UpRSXaBfR6vVEj5d99sUMeA/3/4xp3H0ROgFJbF2ZbMW66uun8thPnbAaJ4mMKG5CztAL5i4LGDduov6w+t4FPUahMzjJQWep/B6EgMbdPAno8nqhx6sfBTrMH3k1c6feTwlIW1kGYbdk3E9U4+PMOyPF69uQMqF+8Gk43y2R3MYBxSt5zCJpWb4ZWl1AmzM6CF9/V0r42AZP/3CP4RgfcRVzozEIYH3kxom3Bqx+qb/3f/ThXtXAlSI+9xPAytJxIpLp2FtilJ14F6dGXoPCT78AqmcDI4mtqx8Ec+S+/D0pdwwV9Lfl6QrDtJ14BW1Ep5/JZGpVz+6NsJfUnX9I6D+WcxMKTJgHdbnfUyBn+QHAJ/rojOOobOGfef0QQsHbBioi2Wf3vFDYgxqHzxDEBqW7l3MWq2DcNYEu+c1iYMDz0XJt+Kk1mnOU0251sk7MyEck+AnKDPkULbQJWz1LTEdNbn3FOzsolDpe4s7I6zM5aXAanfqrmgpVs1lpNheqy/2M38DjV+sYnXxUHd/ODUP7VeBbLbicOd9a2/KzbskuwRc7O/Cr7gmUKT71OZXjcLPt8JIclMUWbgE6nM2p4HQ4ekPlO2n045yoox2Nct+HYeJid6d0vQuLff3nuVTl/GXHSwy+o9RVFSNSL3vqMck1bcoa6Ef2+c5t+Fryj9lf+7STOoV/YRtWUuVRW+PrHyCFwWcakBQmoKEpM8LHlYHrmDXSM/y09qaY2mBo4mmWhfgNb4vE/+68QtNEBSZ1lbGYvovpNKapIyX/thUkuldWG7KzZg+9p08eMPreGhgahzHDvU2reuW4LcpqgWUAcfCCYQOPfbBn0FWMTu4FpZstaLiyCEpasJvymkxrP/jOAX0IoDgfmi8RbDRK1XzZ5NvGm594W+i54T51ZpZ+PiuifpbwCQwmd0d0O9QU4rFZI/EMXCjeYbrVbQIfDoRnNBkm4UMD8LkKApnzLXVwanGWpmULizV4KtRk6Q+qWrRX6ywiGDw7zgWMRfapavl59mXc/IZQ1HDlJZRhP0RetY78oAlYuWK7GMTZw64nE0CMbxaoSFgNPt8gkVPm0+VRufPwVag9nT8KvO1CZrbhMLauqoY0Iz9NOiyWiT/mvfED2FSOnCGWYCtFxkvmEXLsFtNvtmmF87i11Z500BwXCKxlQciSQ9x0BR1oWtHr4sQ47JTvp6deF2xniX3qPePYiBJvaXQeoLKPXzW36lNlX3anrWMwkexaLQzOBavbyeRl7EebMnJjHTgJarVbNSOs0hBySU7OQQ1CsxJ+R7LIG3k12Eku8G1nMzHv9I+IQhW98LNhUhOSGiSyhrz8eDzVMVF6uAlMiqpfDLipq2Xm7YulqtBETfnYZ3HAqCQwsiY9ns95skGIae7sFtDQ20hvFkwVuDNHaSvc/g3YC8EysxlC+Qwo2dZt2Ih+G8oUrhXrGR1+KWA83Ddq4RODlL852bQJaLBZNMEt56i0KW4ax2MrH4zE2CsvVcugEJP6e75Bs5+4ItqoawUaxWjEpFs7TRW9+CoosC/W8DCUffsN2224hu39/MG/cCbb4FDyrE48XGHhXiSEm1vG3W8Bmo4kuD5Sa2phscWkHZAvfdFySCeMmcvgf1vj5E/yJbznMLoCpU7YB7EyIQIscceBoh5cSGHudBiO4C0rwZpxCSiuDkmXAfpHHBBvttAsoy7I2VFUHA/WC5dhgrPZoQ5tEDHZYH+3+b59YjnVR0Eg89asR2gVUHaFTBfHXPy6egAhcQtrtdQERuoAtLS06NEAX8GIJaDabdWgAFxA/ptrQUBejsQ7UDLXjHzLPzExjREOUxjpQK9SsoMAIcewf/jWHQ4e0fM1B/5rDebD10oZZukwlAAAAAElFTkSuQmCC&quot;); background-color: transparent; background-size: 40px 20px;"></span></body></html>